/*! For license information please see main.6bba0f5b.js.LICENSE.txt */
(()=>{var e={4:(e,t,n)=>{"use strict";var r=n(853),o=n(43),a=n(950);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function u(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function l(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function c(e){if(u(e)!==e)throw Error(i(188))}function f(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=f(e)))return t;e=e.sibling}return null}var h=Object.assign,d=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),w=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope");var I=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var _=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var N=Symbol.iterator;function T(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}var A=Symbol.for("react.client.reference");function D(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===A?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case m:return"Fragment";case y:return"Profiler";case g:return"StrictMode";case E:return"Suspense";case S:return"SuspenseList";case I:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case v:return"Portal";case w:return(e.displayName||"Context")+".Provider";case x:return(e._context.displayName||"Context")+".Consumer";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:D(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return D(e(t))}catch(n){}}return null}var O=Array.isArray,M=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P={pending:!1,data:null,method:null,action:null},L=[],B=-1;function z(e){return{current:e}}function W(e){0>B||(e.current=L[B],L[B]=null,B--)}function U(e,t){B++,L[B]=e.current,e.current=t}var V=z(null),j=z(null),G=z(null),H=z(null);function q(e,t){switch(U(G,t),U(j,e),U(V,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?of(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=af(t=of(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(V),U(V,e)}function K(){W(V),W(j),W(G)}function X(e){null!==e.memoizedState&&U(H,e);var t=V.current,n=af(t,e.type);t!==n&&(U(j,e),U(V,n))}function $(e){j.current===e&&(W(V),W(j)),H.current===e&&(W(H),$f._currentValue=P)}var Y=Object.prototype.hasOwnProperty,Q=r.unstable_scheduleCallback,J=r.unstable_cancelCallback,Z=r.unstable_shouldYield,ee=r.unstable_requestPaint,te=r.unstable_now,ne=r.unstable_getCurrentPriorityLevel,re=r.unstable_ImmediatePriority,oe=r.unstable_UserBlockingPriority,ae=r.unstable_NormalPriority,ie=r.unstable_LowPriority,se=r.unstable_IdlePriority,ue=r.log,le=r.unstable_setDisableYieldValue,ce=null,fe=null;function he(e){if("function"===typeof ue&&le(e),fe&&"function"===typeof fe.setStrictMode)try{fe.setStrictMode(ce,e)}catch(t){}}var de=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(pe(e)/ve|0)|0},pe=Math.log,ve=Math.LN2;var me=256,ge=4194304;function ye(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function be(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var o=0,a=e.suspendedLanes,i=e.pingedLanes;e=e.warmLanes;var s=134217727&r;return 0!==s?0!==(r=s&~a)?o=ye(r):0!==(i&=s)?o=ye(i):n||0!==(n=s&~e)&&(o=ye(n)):0!==(s=r&~a)?o=ye(s):0!==i?o=ye(i):n||0!==(n=r&~e)&&(o=ye(n)),0===o?0:0!==t&&t!==o&&0===(t&a)&&((a=o&-o)>=(n=t&-t)||32===a&&0!==(4194048&n))?t:o}function xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function we(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ce(){var e=me;return 0===(4194048&(me<<=1))&&(me=256),e}function Ee(){var e=ge;return 0===(62914560&(ge<<=1))&&(ge=4194304),e}function Se(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ke(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Re(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-de(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function Ie(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-de(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}function _e(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ne(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Te(){var e=F.p;return 0!==e?e:void 0===(e=window.event)?32:ch(e.type)}var Ae=Math.random().toString(36).slice(2),De="__reactFiber$"+Ae,Oe="__reactProps$"+Ae,Me="__reactContainer$"+Ae,Fe="__reactEvents$"+Ae,Pe="__reactListeners$"+Ae,Le="__reactHandles$"+Ae,Be="__reactResources$"+Ae,ze="__reactMarker$"+Ae;function We(e){delete e[De],delete e[Oe],delete e[Fe],delete e[Pe],delete e[Le]}function Ue(e){var t=e[De];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Me]||n[De]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=xf(e);null!==e;){if(n=e[De])return n;e=xf(e)}return t}n=(e=n).parentNode}return null}function Ve(e){if(e=e[De]||e[Me]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function je(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(i(33))}function Ge(e){var t=e[Be];return t||(t=e[Be]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function He(e){e[ze]=!0}var qe=new Set,Ke={};function Xe(e,t){$e(e,t),$e(e+"Capture",t)}function $e(e,t){for(Ke[e]=t,e=0;e<t.length;e++)qe.add(t[e])}var Ye,Qe,Je=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ze={},et={};function tt(e,t,n){if(o=t,Y.call(et,o)||!Y.call(Ze,o)&&(Je.test(o)?et[o]=!0:(Ze[o]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var o}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function rt(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function ot(e){if(void 0===Ye)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ye=t&&t[1]||"",Qe=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ye+e+Qe}var at=!1;function it(e,t){if(!e||at)return"";at=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(o){var r=o}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(i){r=i}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"===typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),i=a[0],s=a[1];if(i&&s){var u=i.split("\n"),l=s.split("\n");for(o=r=0;r<u.length&&!u[r].includes("DetermineComponentFrameRoot");)r++;for(;o<l.length&&!l[o].includes("DetermineComponentFrameRoot");)o++;if(r===u.length||o===l.length)for(r=u.length-1,o=l.length-1;1<=r&&0<=o&&u[r]!==l[o];)o--;for(;1<=r&&0<=o;r--,o--)if(u[r]!==l[o]){if(1!==r||1!==o)do{if(r--,0>--o||u[r]!==l[o]){var c="\n"+u[r].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=r&&0<=o);break}}}finally{at=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?ot(n):""}function st(e){switch(e.tag){case 26:case 27:case 5:return ot(e.type);case 16:return ot("Lazy");case 13:return ot("Suspense");case 19:return ot("SuspenseList");case 0:case 15:return it(e.type,!1);case 11:return it(e.type.render,!1);case 1:return it(e.type,!0);case 31:return ot("Activity");default:return""}}function ut(e){try{var t="";do{t+=st(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function lt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ct(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ft(e){e._valueTracker||(e._valueTracker=function(e){var t=ct(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ct(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function dt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var pt=/[\n"\\]/g;function vt(e){return e.replace(pt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function mt(e,t,n,r,o,a,i,s){e.name="",null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i?e.type=i:e.removeAttribute("type"),null!=t?"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+lt(t)):e.value!==""+lt(t)&&(e.value=""+lt(t)):"submit"!==i&&"reset"!==i||e.removeAttribute("value"),null!=t?yt(e,i,lt(t)):null!=n?yt(e,i,lt(n)):null!=r&&e.removeAttribute("value"),null==o&&null!=a&&(e.defaultChecked=!!a),null!=o&&(e.checked=o&&"function"!==typeof o&&"symbol"!==typeof o),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+lt(s):e.removeAttribute("name")}function gt(e,t,n,r,o,a,i,s){if(null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.type=a),null!=t||null!=n){if(!("submit"!==a&&"reset"!==a||void 0!==t&&null!==t))return;n=null!=n?""+lt(n):"",t=null!=t?""+lt(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:o)&&"symbol"!==typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i&&(e.name=i)}function yt(e,t,n){"number"===t&&dt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function bt(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+lt(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+lt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+lt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function wt(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(i(92));if(O(r)){if(1<r.length)throw Error(i(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=lt(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function Ct(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Et=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function St(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||Et.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function kt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(i(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var o in t)r=t[o],t.hasOwnProperty(o)&&n[o]!==r&&St(e,o,r)}else for(var a in t)t.hasOwnProperty(a)&&St(e,a,t[a])}function Rt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var It=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_t=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Nt(e){return _t.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Tt=null;function At(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Dt=null,Ot=null;function Mt(e){var t=Ve(e);if(t&&(e=t.stateNode)){var n=e[Oe]||null;e:switch(e=t.stateNode,t.type){case"input":if(mt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+vt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=r[Oe]||null;if(!o)throw Error(i(90));mt(r,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ht(r)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&bt(e,!!n.multiple,t,!1)}}}var Ft=!1;function Pt(e,t,n){if(Ft)return e(t,n);Ft=!0;try{return e(t)}finally{if(Ft=!1,(null!==Dt||null!==Ot)&&(Ul(),Dt&&(t=Dt,e=Ot,Ot=Dt=null,Mt(t),e)))for(t=0;t<e.length;t++)Mt(e[t])}}function Lt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Oe]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Bt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),zt=!1;if(Bt)try{var Wt={};Object.defineProperty(Wt,"passive",{get:function(){zt=!0}}),window.addEventListener("test",Wt,Wt),window.removeEventListener("test",Wt,Wt)}catch(Mh){zt=!1}var Ut=null,Vt=null,jt=null;function Gt(){if(jt)return jt;var e,t,n=Vt,r=n.length,o="value"in Ut?Ut.value:Ut.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return jt=o.slice(e,1<t?1-t:void 0)}function Ht(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function qt(){return!0}function Kt(){return!1}function Xt(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?qt:Kt,this.isPropagationStopped=Kt,this}return h(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=qt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=qt)},persist:function(){},isPersistent:qt}),t}var $t,Yt,Qt,Jt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zt=Xt(Jt),en=h({},Jt,{view:0,detail:0}),tn=Xt(en),nn=h({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Qt&&(Qt&&"mousemove"===e.type?($t=e.screenX-Qt.screenX,Yt=e.screenY-Qt.screenY):Yt=$t=0,Qt=e),$t)},movementY:function(e){return"movementY"in e?e.movementY:Yt}}),rn=Xt(nn),on=Xt(h({},nn,{dataTransfer:0})),an=Xt(h({},en,{relatedTarget:0})),sn=Xt(h({},Jt,{animationName:0,elapsedTime:0,pseudoElement:0})),un=Xt(h({},Jt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ln=Xt(h({},Jt,{data:0})),cn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=hn[e])&&!!t[e]}function pn(){return dn}var vn=Xt(h({},en,{key:function(e){if(e.key){var t=cn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Ht(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?fn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Ht(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Ht(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),mn=Xt(h({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),gn=Xt(h({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),yn=Xt(h({},Jt,{propertyName:0,elapsedTime:0,pseudoElement:0})),bn=Xt(h({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=Xt(h({},Jt,{newState:0,oldState:0})),wn=[9,13,27,32],Cn=Bt&&"CompositionEvent"in window,En=null;Bt&&"documentMode"in document&&(En=document.documentMode);var Sn=Bt&&"TextEvent"in window&&!En,kn=Bt&&(!Cn||En&&8<En&&11>=En),Rn=String.fromCharCode(32),In=!1;function _n(e,t){switch(e){case"keyup":return-1!==wn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Tn=!1;var An={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!An[e.type]:"textarea"===t}function On(e,t,n,r){Dt?Ot?Ot.push(r):Ot=[r]:Dt=r,0<(t=Gc(t,"onChange")).length&&(n=new Zt("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Mn=null,Fn=null;function Pn(e){Pc(e,0)}function Ln(e){if(ht(je(e)))return e}function Bn(e,t){if("change"===e)return t}var zn=!1;if(Bt){var Wn;if(Bt){var Un="oninput"in document;if(!Un){var Vn=document.createElement("div");Vn.setAttribute("oninput","return;"),Un="function"===typeof Vn.oninput}Wn=Un}else Wn=!1;zn=Wn&&(!document.documentMode||9<document.documentMode)}function jn(){Mn&&(Mn.detachEvent("onpropertychange",Gn),Fn=Mn=null)}function Gn(e){if("value"===e.propertyName&&Ln(Fn)){var t=[];On(t,Fn,e,At(e)),Pt(Pn,t)}}function Hn(e,t,n){"focusin"===e?(jn(),Fn=n,(Mn=t).attachEvent("onpropertychange",Gn)):"focusout"===e&&jn()}function qn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ln(Fn)}function Kn(e,t){if("click"===e)return Ln(t)}function Xn(e,t){if("input"===e||"change"===e)return Ln(t)}var $n="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Yn(e,t){if($n(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!Y.call(t,o)||!$n(e[o],t[o]))return!1}return!0}function Qn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Jn(e,t){var n,r=Qn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Qn(r)}}function Zn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Zn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function er(e){for(var t=dt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=dt((e=t.contentWindow).document)}return t}function tr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var nr=Bt&&"documentMode"in document&&11>=document.documentMode,rr=null,or=null,ar=null,ir=!1;function sr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ir||null==rr||rr!==dt(r)||("selectionStart"in(r=rr)&&tr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},ar&&Yn(ar,r)||(ar=r,0<(r=Gc(or,"onSelect")).length&&(t=new Zt("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rr)))}function ur(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var lr={animationend:ur("Animation","AnimationEnd"),animationiteration:ur("Animation","AnimationIteration"),animationstart:ur("Animation","AnimationStart"),transitionrun:ur("Transition","TransitionRun"),transitionstart:ur("Transition","TransitionStart"),transitioncancel:ur("Transition","TransitionCancel"),transitionend:ur("Transition","TransitionEnd")},cr={},fr={};function hr(e){if(cr[e])return cr[e];if(!lr[e])return e;var t,n=lr[e];for(t in n)if(n.hasOwnProperty(t)&&t in fr)return cr[e]=n[t];return e}Bt&&(fr=document.createElement("div").style,"AnimationEvent"in window||(delete lr.animationend.animation,delete lr.animationiteration.animation,delete lr.animationstart.animation),"TransitionEvent"in window||delete lr.transitionend.transition);var dr=hr("animationend"),pr=hr("animationiteration"),vr=hr("animationstart"),mr=hr("transitionrun"),gr=hr("transitionstart"),yr=hr("transitioncancel"),br=hr("transitionend"),xr=new Map,wr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cr(e,t){xr.set(e,t),Xe(t,[e])}wr.push("scrollEnd");var Er=new WeakMap;function Sr(e,t){if("object"===typeof e&&null!==e){var n=Er.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ut(t)},Er.set(e,t),t)}return{value:e,source:t,stack:ut(t)}}var kr=[],Rr=0,Ir=0;function _r(){for(var e=Rr,t=Ir=Rr=0;t<e;){var n=kr[t];kr[t++]=null;var r=kr[t];kr[t++]=null;var o=kr[t];kr[t++]=null;var a=kr[t];if(kr[t++]=null,null!==r&&null!==o){var i=r.pending;null===i?o.next=o:(o.next=i.next,i.next=o),r.pending=o}0!==a&&Dr(n,o,a)}}function Nr(e,t,n,r){kr[Rr++]=e,kr[Rr++]=t,kr[Rr++]=n,kr[Rr++]=r,Ir|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Tr(e,t,n,r){return Nr(e,t,n,r),Or(e)}function Ar(e,t){return Nr(e,null,null,t),Or(e)}function Dr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var o=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(o=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,o&&null!==t&&(o=31-de(n),null===(r=(e=a.hiddenUpdates)[o])?e[o]=[t]:r.push(t),t.lane=536870912|n),a):null}function Or(e){if(50<Dl)throw Dl=0,Ol=null,Error(i(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Mr={};function Fr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pr(e,t,n,r){return new Fr(e,t,n,r)}function Lr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Br(e,t){var n=e.alternate;return null===n?((n=Pr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function zr(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Wr(e,t,n,r,o,a){var s=0;if(r=e,"function"===typeof e)Lr(e)&&(s=1);else if("string"===typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,V.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case I:return(e=Pr(31,n,t,o)).elementType=I,e.lanes=a,e;case m:return Ur(n.children,o,a,t);case g:s=8,o|=24;break;case y:return(e=Pr(12,n,t,2|o)).elementType=y,e.lanes=a,e;case E:return(e=Pr(13,n,t,o)).elementType=E,e.lanes=a,e;case S:return(e=Pr(19,n,t,o)).elementType=S,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case b:case w:s=10;break e;case x:s=9;break e;case C:s=11;break e;case k:s=14;break e;case R:s=16,r=null;break e}s=29,n=Error(i(130,null===e?"null":typeof e,"")),r=null}return(t=Pr(s,n,t,o)).elementType=e,t.type=r,t.lanes=a,t}function Ur(e,t,n,r){return(e=Pr(7,e,r,t)).lanes=n,e}function Vr(e,t,n){return(e=Pr(6,e,null,t)).lanes=n,e}function jr(e,t,n){return(t=Pr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Gr=[],Hr=0,qr=null,Kr=0,Xr=[],$r=0,Yr=null,Qr=1,Jr="";function Zr(e,t){Gr[Hr++]=Kr,Gr[Hr++]=qr,qr=e,Kr=t}function eo(e,t,n){Xr[$r++]=Qr,Xr[$r++]=Jr,Xr[$r++]=Yr,Yr=e;var r=Qr;e=Jr;var o=32-de(r)-1;r&=~(1<<o),n+=1;var a=32-de(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,Qr=1<<32-de(t)+o|n<<o|r,Jr=a+e}else Qr=1<<a|n<<o|r,Jr=e}function to(e){null!==e.return&&(Zr(e,1),eo(e,1,0))}function no(e){for(;e===qr;)qr=Gr[--Hr],Gr[Hr]=null,Kr=Gr[--Hr],Gr[Hr]=null;for(;e===Yr;)Yr=Xr[--$r],Xr[$r]=null,Jr=Xr[--$r],Xr[$r]=null,Qr=Xr[--$r],Xr[$r]=null}var ro=null,oo=null,ao=!1,io=null,so=!1,uo=Error(i(519));function lo(e){throw mo(Sr(Error(i(418,"")),e)),uo}function co(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[De]=e,t[Oe]=r,n){case"dialog":Lc("cancel",t),Lc("close",t);break;case"iframe":case"object":case"embed":Lc("load",t);break;case"video":case"audio":for(n=0;n<Mc.length;n++)Lc(Mc[n],t);break;case"source":Lc("error",t);break;case"img":case"image":case"link":Lc("error",t),Lc("load",t);break;case"details":Lc("toggle",t);break;case"input":Lc("invalid",t),gt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),ft(t);break;case"select":Lc("invalid",t);break;case"textarea":Lc("invalid",t),wt(t,r.value,r.defaultValue,r.children),ft(t)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Yc(t.textContent,n)?(null!=r.popover&&(Lc("beforetoggle",t),Lc("toggle",t)),null!=r.onScroll&&Lc("scroll",t),null!=r.onScrollEnd&&Lc("scrollend",t),null!=r.onClick&&(t.onclick=Qc),t=!0):t=!1,t||lo(e)}function fo(e){for(ro=e.return;ro;)switch(ro.tag){case 5:case 13:return void(so=!1);case 27:case 3:return void(so=!0);default:ro=ro.return}}function ho(e){if(e!==ro)return!1;if(!ao)return fo(e),ao=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||sf(e.type,e.memoizedProps)),t=!t),t&&oo&&lo(e),fo(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){oo=yf(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}oo=null}}else 27===n?(n=oo,pf(e.type)?(e=bf,bf=null,oo=e):oo=n):oo=ro?yf(e.stateNode.nextSibling):null;return!0}function po(){oo=ro=null,ao=!1}function vo(){var e=io;return null!==e&&(null===bl?bl=e:bl.push.apply(bl,e),io=null),e}function mo(e){null===io?io=[e]:io.push(e)}var go=z(null),yo=null,bo=null;function xo(e,t,n){U(go,t._currentValue),t._currentValue=n}function wo(e){e._currentValue=go.current,W(go)}function Co(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Eo(e,t,n,r){var o=e.child;for(null!==o&&(o.return=e);null!==o;){var a=o.dependencies;if(null!==a){var s=o.child;a=a.firstContext;e:for(;null!==a;){var u=a;a=o;for(var l=0;l<t.length;l++)if(u.context===t[l]){a.lanes|=n,null!==(u=a.alternate)&&(u.lanes|=n),Co(a.return,n,e),r||(s=null);break e}a=u.next}}else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(a=s.alternate)&&(a.lanes|=n),Co(s,n,e),s=null}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===e){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}}function So(e,t,n,r){e=null;for(var o=t,a=!1;null!==o;){if(!a)if(0!==(524288&o.flags))a=!0;else if(0!==(262144&o.flags))break;if(10===o.tag){var s=o.alternate;if(null===s)throw Error(i(387));if(null!==(s=s.memoizedProps)){var u=o.type;$n(o.pendingProps.value,s.value)||(null!==e?e.push(u):e=[u])}}else if(o===H.current){if(null===(s=o.alternate))throw Error(i(387));s.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(null!==e?e.push($f):e=[$f])}o=o.return}null!==e&&Eo(t,e,n,r),t.flags|=262144}function ko(e){for(e=e.firstContext;null!==e;){if(!$n(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ro(e){yo=e,bo=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Io(e){return No(yo,e)}function _o(e,t){return null===yo&&Ro(e),No(e,t)}function No(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===bo){if(null===e)throw Error(i(308));bo=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else bo=bo.next=t;return n}var To="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ao=r.unstable_scheduleCallback,Do=r.unstable_NormalPriority,Oo={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Mo(){return{controller:new To,data:new Map,refCount:0}}function Fo(e){e.refCount--,0===e.refCount&&Ao(Do,function(){e.controller.abort()})}var Po=null,Lo=0,Bo=0,zo=null;function Wo(){if(0===--Lo&&null!==Po){null!==zo&&(zo.status="fulfilled");var e=Po;Po=null,Bo=0,zo=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Uo=M.S;M.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Po){var n=Po=[];Lo=0,Bo=Nc(),zo={status:"pending",value:void 0,then:function(e){n.push(e)}}}Lo++,t.then(Wo,Wo)}(0,t),null!==Uo&&Uo(e,t)};var Vo=z(null);function jo(){var e=Vo.current;return null!==e?e:rl.pooledCache}function Go(e,t){U(Vo,null===t?Vo.current:t.pool)}function Ho(){var e=jo();return null===e?null:{parent:Oo._currentValue,pool:e}}var qo=Error(i(460)),Ko=Error(i(474)),Xo=Error(i(542)),$o={then:function(){}};function Yo(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Qo(){}function Jo(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Qo,Qo),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw ta(e=t.reason),e;default:if("string"===typeof t.status)t.then(Qo,Qo);else{if(null!==(e=rl)&&100<e.shellSuspendCounter)throw Error(i(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ta(e=t.reason),e}throw Zo=t,qo}}var Zo=null;function ea(){if(null===Zo)throw Error(i(459));var e=Zo;return Zo=null,e}function ta(e){if(e===qo||e===Xo)throw Error(i(483))}var na=!1;function ra(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function aa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ia(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&nl)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,t=Or(e),Dr(e,null,n),t}return Nr(e,r,t,n),Or(e)}function sa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ie(e,n)}}function ua(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var la=!1;function ca(){if(la){if(null!==zo)throw zo}}function fa(e,t,n,r){la=!1;var o=e.updateQueue;na=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var u=s,l=u.next;u.next=null,null===i?a=l:i.next=l,i=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==i&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==a){var f=o.baseState;for(i=0,c=l=u=null,s=a;;){var d=-536870913&s.lane,p=d!==s.lane;if(p?(al&d)===d:(r&d)===d){0!==d&&d===Bo&&(la=!0),null!==c&&(c=c.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var v=e,m=s;d=t;var g=n;switch(m.tag){case 1:if("function"===typeof(v=m.payload)){f=v.call(g,f,d);break e}f=v;break e;case 3:v.flags=-65537&v.flags|128;case 0:if(null===(d="function"===typeof(v=m.payload)?v.call(g,f,d):v)||void 0===d)break e;f=h({},f,d);break e;case 2:na=!0}}null!==(d=s.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=o.callbacks)?o.callbacks=[d]:p.push(d))}else p={lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=p,u=f):c=c.next=p,i|=d;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(p=s).next,p.next=null,o.lastBaseUpdate=p,o.shared.pending=null}}null===c&&(u=f),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,null===a&&(o.shared.lanes=0),dl|=i,e.lanes=i,e.memoizedState=f}}function ha(e,t){if("function"!==typeof e)throw Error(i(191,e));e.call(t)}function da(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ha(n[e],t)}var pa=z(null),va=z(0);function ma(e,t){U(va,e=fl),U(pa,t),fl=e|t.baseLanes}function ga(){U(va,fl),U(pa,pa.current)}function ya(){fl=va.current,W(pa),W(va)}var ba=0,xa=null,wa=null,Ca=null,Ea=!1,Sa=!1,ka=!1,Ra=0,Ia=0,_a=null,Na=0;function Ta(){throw Error(i(321))}function Aa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!$n(e[n],t[n]))return!1;return!0}function Da(e,t,n,r,o,a){return ba=a,xa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,M.H=null===e||null===e.memoizedState?qi:Ki,ka=!1,a=n(r,o),ka=!1,Sa&&(a=Ma(t,n,r,o)),Oa(e),a}function Oa(e){M.H=Hi;var t=null!==wa&&null!==wa.next;if(ba=0,Ca=wa=xa=null,Ea=!1,Ia=0,_a=null,t)throw Error(i(300));null===e||Is||null!==(e=e.dependencies)&&ko(e)&&(Is=!0)}function Ma(e,t,n,r){xa=e;var o=0;do{if(Sa&&(_a=null),Ia=0,Sa=!1,25<=o)throw Error(i(301));if(o+=1,Ca=wa=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}M.H=Xi,a=t(n,r)}while(Sa);return a}function Fa(){var e=M.H,t=e.useState()[0];return t="function"===typeof t.then?Ua(t):t,e=e.useState()[0],(null!==wa?wa.memoizedState:null)!==e&&(xa.flags|=1024),t}function Pa(){var e=0!==Ra;return Ra=0,e}function La(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Ba(e){if(Ea){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Ea=!1}ba=0,Ca=wa=xa=null,Sa=!1,Ia=Ra=0,_a=null}function za(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ca?xa.memoizedState=Ca=e:Ca=Ca.next=e,Ca}function Wa(){if(null===wa){var e=xa.alternate;e=null!==e?e.memoizedState:null}else e=wa.next;var t=null===Ca?xa.memoizedState:Ca.next;if(null!==t)Ca=t,wa=e;else{if(null===e){if(null===xa.alternate)throw Error(i(467));throw Error(i(310))}e={memoizedState:(wa=e).memoizedState,baseState:wa.baseState,baseQueue:wa.baseQueue,queue:wa.queue,next:null},null===Ca?xa.memoizedState=Ca=e:Ca=Ca.next=e}return Ca}function Ua(e){var t=Ia;return Ia+=1,null===_a&&(_a=[]),e=Jo(_a,e,t),t=xa,null===(null===Ca?t.memoizedState:Ca.next)&&(t=t.alternate,M.H=null===t||null===t.memoizedState?qi:Ki),e}function Va(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Ua(e);if(e.$$typeof===w)return Io(e)}throw Error(i(438,String(e)))}function ja(e){var t=null,n=xa.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=xa.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},xa.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=_;return t.index++,n}function Ga(e,t){return"function"===typeof t?t(e):t}function Ha(e){return qa(Wa(),wa,e)}function qa(e,t,n){var r=e.queue;if(null===r)throw Error(i(311));r.lastRenderedReducer=n;var o=e.baseQueue,a=r.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}t.baseQueue=o=a,r.pending=null}if(a=e.baseState,null===o)e.memoizedState=a;else{var u=s=null,l=null,c=t=o.next,f=!1;do{var h=-536870913&c.lane;if(h!==c.lane?(al&h)===h:(ba&h)===h){var d=c.revertLane;if(0===d)null!==l&&(l=l.next={lane:0,revertLane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),h===Bo&&(f=!0);else{if((ba&d)===d){c=c.next,d===Bo&&(f=!0);continue}h={lane:0,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(u=l=h,s=a):l=l.next=h,xa.lanes|=d,dl|=d}h=c.action,ka&&n(a,h),a=c.hasEagerState?c.eagerState:n(a,h)}else d={lane:h,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(u=l=d,s=a):l=l.next=d,xa.lanes|=h,dl|=h;c=c.next}while(null!==c&&c!==t);if(null===l?s=a:l.next=u,!$n(a,e.memoizedState)&&(Is=!0,f&&null!==(n=zo)))throw n;e.memoizedState=a,e.baseState=s,e.baseQueue=l,r.lastRenderedState=a}return null===o&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Ka(e){var t=Wa(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,a=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{a=e(a,s.action),s=s.next}while(s!==o);$n(a,t.memoizedState)||(Is=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Xa(e,t,n){var r=xa,o=Wa(),a=ao;if(a){if(void 0===n)throw Error(i(407));n=n()}else n=t();var s=!$n((wa||o).memoizedState,n);if(s&&(o.memoizedState=n,Is=!0),o=o.queue,gi(2048,8,Qa.bind(null,r,o,e),[e]),o.getSnapshot!==t||s||null!==Ca&&1&Ca.memoizedState.tag){if(r.flags|=2048,pi(9,{destroy:void 0,resource:void 0},Ya.bind(null,r,o,n,t),null),null===rl)throw Error(i(349));a||0!==(124&ba)||$a(r,t,n)}return n}function $a(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=xa.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},xa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ya(e,t,n,r){t.value=n,t.getSnapshot=r,Ja(t)&&Za(e)}function Qa(e,t,n){return n(function(){Ja(t)&&Za(e)})}function Ja(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!$n(e,n)}catch(r){return!0}}function Za(e){var t=Ar(e,2);null!==t&&Pl(t,e,2)}function ei(e){var t=za();if("function"===typeof e){var n=e;if(e=n(),ka){he(!0);try{n()}finally{he(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ga,lastRenderedState:e},t}function ti(e,t,n,r){return e.baseState=n,qa(e,wa,"function"===typeof r?r:Ga)}function ni(e,t,n,r,o){if(Vi(e))throw Error(i(485));if(null!==(e=t.action)){var a={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==M.T?n(!0):a.isTransition=!1,r(a),null===(n=t.pending)?(a.next=t.pending=a,ri(t,a)):(a.next=n.next,t.pending=n.next=a)}}function ri(e,t){var n=t.action,r=t.payload,o=e.state;if(t.isTransition){var a=M.T,i={};M.T=i;try{var s=n(o,r),u=M.S;null!==u&&u(i,s),oi(e,t,s)}catch(l){ii(e,t,l)}finally{M.T=a}}else try{oi(e,t,a=n(o,r))}catch(c){ii(e,t,c)}}function oi(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){ai(e,t,n)},function(n){return ii(e,t,n)}):ai(e,t,n)}function ai(e,t,n){t.status="fulfilled",t.value=n,si(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,ri(e,n)))}function ii(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,si(t),t=t.next}while(t!==r)}e.action=null}function si(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ui(e,t){return t}function li(e,t){if(ao){var n=rl.formState;if(null!==n){e:{var r=xa;if(ao){if(oo){t:{for(var o=oo,a=so;8!==o.nodeType;){if(!a){o=null;break t}if(null===(o=yf(o.nextSibling))){o=null;break t}}o="F!"===(a=o.data)||"F"===a?o:null}if(o){oo=yf(o.nextSibling),r="F!"===o.data;break e}}lo(r)}r=!1}r&&(t=n[0])}}return(n=za()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ui,lastRenderedState:t},n.queue=r,n=zi.bind(null,xa,r),r.dispatch=n,r=ei(!1),a=Ui.bind(null,xa,!1,r.queue),o={state:t,dispatch:null,action:e,pending:null},(r=za()).queue=o,n=ni.bind(null,xa,o,a,n),o.dispatch=n,r.memoizedState=e,[t,n,!1]}function ci(e){return fi(Wa(),wa,e)}function fi(e,t,n){if(t=qa(e,t,ui)[0],e=Ha(Ga)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=Ua(t)}catch(i){if(i===qo)throw Xo;throw i}else r=t;var o=(t=Wa()).queue,a=o.dispatch;return n!==t.memoizedState&&(xa.flags|=2048,pi(9,{destroy:void 0,resource:void 0},hi.bind(null,o,n),null)),[r,a,e]}function hi(e,t){e.action=t}function di(e){var t=Wa(),n=wa;if(null!==n)return fi(t,n,e);Wa(),t=t.memoizedState;var r=(n=Wa()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function pi(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=xa.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},xa.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function vi(){return Wa().memoizedState}function mi(e,t,n,r){var o=za();r=void 0===r?null:r,xa.flags|=e,o.memoizedState=pi(1|t,{destroy:void 0,resource:void 0},n,r)}function gi(e,t,n,r){var o=Wa();r=void 0===r?null:r;var a=o.memoizedState.inst;null!==wa&&null!==r&&Aa(r,wa.memoizedState.deps)?o.memoizedState=pi(t,a,n,r):(xa.flags|=e,o.memoizedState=pi(1|t,a,n,r))}function yi(e,t){mi(8390656,8,e,t)}function bi(e,t){gi(2048,8,e,t)}function xi(e,t){return gi(4,2,e,t)}function wi(e,t){return gi(4,4,e,t)}function Ci(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ei(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,gi(4,4,Ci.bind(null,t,e),n)}function Si(){}function ki(e,t){var n=Wa();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&Aa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ri(e,t){var n=Wa();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&Aa(t,r[1]))return r[0];if(r=e(),ka){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[r,t],r}function Ii(e,t,n){return void 0===n||0!==(1073741824&ba)?e.memoizedState=t:(e.memoizedState=n,e=Fl(),xa.lanes|=e,dl|=e,n)}function _i(e,t,n,r){return $n(n,t)?n:null!==pa.current?(e=Ii(e,n,r),$n(e,t)||(Is=!0),e):0===(42&ba)?(Is=!0,e.memoizedState=n):(e=Fl(),xa.lanes|=e,dl|=e,t)}function Ni(e,t,n,r,o){var a=F.p;F.p=0!==a&&8>a?a:8;var i=M.T,s={};M.T=s,Ui(e,!1,t,n);try{var u=o(),l=M.S;if(null!==l&&l(s,u),null!==u&&"object"===typeof u&&"function"===typeof u.then)Wi(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(u,r),Ml());else Wi(e,t,r,Ml())}catch(c){Wi(e,t,{then:function(){},status:"rejected",reason:c},Ml())}finally{F.p=a,M.T=i}}function Ti(){}function Ai(e,t,n,r){if(5!==e.tag)throw Error(i(476));var o=Di(e).queue;Ni(e,o,t,P,null===n?Ti:function(){return Oi(e),n(r)})}function Di(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:P,baseState:P,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ga,lastRenderedState:P},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ga,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Oi(e){Wi(e,Di(e).next.queue,{},Ml())}function Mi(){return Io($f)}function Fi(){return Wa().memoizedState}function Pi(){return Wa().memoizedState}function Li(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Ml(),r=ia(t,e=aa(n),n);return null!==r&&(Pl(r,t,n),sa(r,t,n)),t={cache:Mo()},void(e.payload=t)}t=t.return}}function Bi(e,t,n){var r=Ml();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Vi(e)?ji(t,n):null!==(n=Tr(e,t,n,r))&&(Pl(n,e,r),Gi(n,t,r))}function zi(e,t,n){Wi(e,t,n,Ml())}function Wi(e,t,n,r){var o={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Vi(e))ji(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,$n(s,i))return Nr(e,t,o,0),null===rl&&_r(),!1}catch(u){}if(null!==(n=Tr(e,t,o,r)))return Pl(n,e,r),Gi(n,t,r),!0}return!1}function Ui(e,t,n,r){if(r={lane:2,revertLane:Nc(),action:r,hasEagerState:!1,eagerState:null,next:null},Vi(e)){if(t)throw Error(i(479))}else null!==(t=Tr(e,n,r,2))&&Pl(t,e,2)}function Vi(e){var t=e.alternate;return e===xa||null!==t&&t===xa}function ji(e,t){Sa=Ea=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Gi(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ie(e,n)}}var Hi={readContext:Io,use:Va,useCallback:Ta,useContext:Ta,useEffect:Ta,useImperativeHandle:Ta,useLayoutEffect:Ta,useInsertionEffect:Ta,useMemo:Ta,useReducer:Ta,useRef:Ta,useState:Ta,useDebugValue:Ta,useDeferredValue:Ta,useTransition:Ta,useSyncExternalStore:Ta,useId:Ta,useHostTransitionStatus:Ta,useFormState:Ta,useActionState:Ta,useOptimistic:Ta,useMemoCache:Ta,useCacheRefresh:Ta},qi={readContext:Io,use:Va,useCallback:function(e,t){return za().memoizedState=[e,void 0===t?null:t],e},useContext:Io,useEffect:yi,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,mi(4194308,4,Ci.bind(null,t,e),n)},useLayoutEffect:function(e,t){return mi(4194308,4,e,t)},useInsertionEffect:function(e,t){mi(4,2,e,t)},useMemo:function(e,t){var n=za();t=void 0===t?null:t;var r=e();if(ka){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=za();if(void 0!==n){var o=n(t);if(ka){he(!0);try{n(t)}finally{he(!1)}}}else o=t;return r.memoizedState=r.baseState=o,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},r.queue=e,e=e.dispatch=Bi.bind(null,xa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},za().memoizedState=e},useState:function(e){var t=(e=ei(e)).queue,n=zi.bind(null,xa,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Si,useDeferredValue:function(e,t){return Ii(za(),e,t)},useTransition:function(){var e=ei(!1);return e=Ni.bind(null,xa,e.queue,!0,!1),za().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=xa,o=za();if(ao){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===rl)throw Error(i(349));0!==(124&al)||$a(r,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,yi(Qa.bind(null,r,a,e),[e]),r.flags|=2048,pi(9,{destroy:void 0,resource:void 0},Ya.bind(null,r,a,n,t),null),n},useId:function(){var e=za(),t=rl.identifierPrefix;if(ao){var n=Jr;t="\xab"+t+"R"+(n=(Qr&~(1<<32-de(Qr)-1)).toString(32)+n),0<(n=Ra++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Na++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Mi,useFormState:li,useActionState:li,useOptimistic:function(e){var t=za();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Ui.bind(null,xa,!0,n),n.dispatch=t,[e,t]},useMemoCache:ja,useCacheRefresh:function(){return za().memoizedState=Li.bind(null,xa)}},Ki={readContext:Io,use:Va,useCallback:ki,useContext:Io,useEffect:bi,useImperativeHandle:Ei,useInsertionEffect:xi,useLayoutEffect:wi,useMemo:Ri,useReducer:Ha,useRef:vi,useState:function(){return Ha(Ga)},useDebugValue:Si,useDeferredValue:function(e,t){return _i(Wa(),wa.memoizedState,e,t)},useTransition:function(){var e=Ha(Ga)[0],t=Wa().memoizedState;return["boolean"===typeof e?e:Ua(e),t]},useSyncExternalStore:Xa,useId:Fi,useHostTransitionStatus:Mi,useFormState:ci,useActionState:ci,useOptimistic:function(e,t){return ti(Wa(),0,e,t)},useMemoCache:ja,useCacheRefresh:Pi},Xi={readContext:Io,use:Va,useCallback:ki,useContext:Io,useEffect:bi,useImperativeHandle:Ei,useInsertionEffect:xi,useLayoutEffect:wi,useMemo:Ri,useReducer:Ka,useRef:vi,useState:function(){return Ka(Ga)},useDebugValue:Si,useDeferredValue:function(e,t){var n=Wa();return null===wa?Ii(n,e,t):_i(n,wa.memoizedState,e,t)},useTransition:function(){var e=Ka(Ga)[0],t=Wa().memoizedState;return["boolean"===typeof e?e:Ua(e),t]},useSyncExternalStore:Xa,useId:Fi,useHostTransitionStatus:Mi,useFormState:di,useActionState:di,useOptimistic:function(e,t){var n=Wa();return null!==wa?ti(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:ja,useCacheRefresh:Pi},$i=null,Yi=0;function Qi(e){var t=Yi;return Yi+=1,null===$i&&($i=[]),Jo($i,e,t)}function Ji(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Zi(e,t){if(t.$$typeof===d)throw Error(i(525));throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function es(e){return(0,e._init)(e._payload)}function ts(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function o(e,t){return(e=Br(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Vr(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===m?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===R&&es(a)===t.type)?(Ji(t=o(t,n.props),n),t.return=e,t):(Ji(t=Wr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=jr(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function f(e,t,n,r,a){return null===t||7!==t.tag?((t=Ur(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Vr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return Ji(n=Wr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case v:return(t=jr(t,e.mode,n)).return=e,t;case R:return h(e,t=(0,t._init)(t._payload),n)}if(O(t)||T(t))return(t=Ur(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return h(e,Qi(t),n);if(t.$$typeof===w)return h(e,_o(e,t),n);Zi(e,t)}return null}function d(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==o?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case p:return n.key===o?l(e,t,n,r):null;case v:return n.key===o?c(e,t,n,r):null;case R:return d(e,t,n=(o=n._init)(n._payload),r)}if(O(n)||T(n))return null!==o?null:f(e,t,n,r,null);if("function"===typeof n.then)return d(e,t,Qi(n),r);if(n.$$typeof===w)return d(e,t,_o(e,n),r);Zi(e,n)}return null}function g(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return u(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case p:return l(t,e=e.get(null===r.key?n:r.key)||null,r,o);case v:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case R:return g(e,t,n,r=(0,r._init)(r._payload),o)}if(O(r)||T(r))return f(t,e=e.get(n)||null,r,o,null);if("function"===typeof r.then)return g(e,t,n,Qi(r),o);if(r.$$typeof===w)return g(e,t,n,_o(t,r),o);Zi(t,r)}return null}function y(u,l,c,f){if("object"===typeof c&&null!==c&&c.type===m&&null===c.key&&(c=c.props.children),"object"===typeof c&&null!==c){switch(c.$$typeof){case p:e:{for(var b=c.key;null!==l;){if(l.key===b){if((b=c.type)===m){if(7===l.tag){n(u,l.sibling),(f=o(l,c.props.children)).return=u,u=f;break e}}else if(l.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===R&&es(b)===l.type){n(u,l.sibling),Ji(f=o(l,c.props),c),f.return=u,u=f;break e}n(u,l);break}t(u,l),l=l.sibling}c.type===m?((f=Ur(c.props.children,u.mode,f,c.key)).return=u,u=f):(Ji(f=Wr(c.type,c.key,c.props,null,u.mode,f),c),f.return=u,u=f)}return s(u);case v:e:{for(b=c.key;null!==l;){if(l.key===b){if(4===l.tag&&l.stateNode.containerInfo===c.containerInfo&&l.stateNode.implementation===c.implementation){n(u,l.sibling),(f=o(l,c.children||[])).return=u,u=f;break e}n(u,l);break}t(u,l),l=l.sibling}(f=jr(c,u.mode,f)).return=u,u=f}return s(u);case R:return y(u,l,c=(b=c._init)(c._payload),f)}if(O(c))return function(o,i,s,u){for(var l=null,c=null,f=i,p=i=0,v=null;null!==f&&p<s.length;p++){f.index>p?(v=f,f=null):v=f.sibling;var m=d(o,f,s[p],u);if(null===m){null===f&&(f=v);break}e&&f&&null===m.alternate&&t(o,f),i=a(m,i,p),null===c?l=m:c.sibling=m,c=m,f=v}if(p===s.length)return n(o,f),ao&&Zr(o,p),l;if(null===f){for(;p<s.length;p++)null!==(f=h(o,s[p],u))&&(i=a(f,i,p),null===c?l=f:c.sibling=f,c=f);return ao&&Zr(o,p),l}for(f=r(f);p<s.length;p++)null!==(v=g(f,o,p,s[p],u))&&(e&&null!==v.alternate&&f.delete(null===v.key?p:v.key),i=a(v,i,p),null===c?l=v:c.sibling=v,c=v);return e&&f.forEach(function(e){return t(o,e)}),ao&&Zr(o,p),l}(u,l,c,f);if(T(c)){if("function"!==typeof(b=T(c)))throw Error(i(150));return function(o,s,u,l){if(null==u)throw Error(i(151));for(var c=null,f=null,p=s,v=s=0,m=null,y=u.next();null!==p&&!y.done;v++,y=u.next()){p.index>v?(m=p,p=null):m=p.sibling;var b=d(o,p,y.value,l);if(null===b){null===p&&(p=m);break}e&&p&&null===b.alternate&&t(o,p),s=a(b,s,v),null===f?c=b:f.sibling=b,f=b,p=m}if(y.done)return n(o,p),ao&&Zr(o,v),c;if(null===p){for(;!y.done;v++,y=u.next())null!==(y=h(o,y.value,l))&&(s=a(y,s,v),null===f?c=y:f.sibling=y,f=y);return ao&&Zr(o,v),c}for(p=r(p);!y.done;v++,y=u.next())null!==(y=g(p,o,v,y.value,l))&&(e&&null!==y.alternate&&p.delete(null===y.key?v:y.key),s=a(y,s,v),null===f?c=y:f.sibling=y,f=y);return e&&p.forEach(function(e){return t(o,e)}),ao&&Zr(o,v),c}(u,l,c=b.call(c),f)}if("function"===typeof c.then)return y(u,l,Qi(c),f);if(c.$$typeof===w)return y(u,l,_o(u,c),f);Zi(u,c)}return"string"===typeof c&&""!==c||"number"===typeof c||"bigint"===typeof c?(c=""+c,null!==l&&6===l.tag?(n(u,l.sibling),(f=o(l,c)).return=u,u=f):(n(u,l),(f=Vr(c,u.mode,f)).return=u,u=f),s(u)):n(u,l)}return function(e,t,n,r){try{Yi=0;var o=y(e,t,n,r);return $i=null,o}catch(i){if(i===qo||i===Xo)throw i;var a=Pr(29,i,null,e.mode);return a.lanes=r,a.return=e,a}}}var ns=ts(!0),rs=ts(!1),os=z(null),as=null;function is(e){var t=e.alternate;U(cs,1&cs.current),U(os,e),null===as&&(null===t||null!==pa.current||null!==t.memoizedState)&&(as=e)}function ss(e){if(22===e.tag){if(U(cs,cs.current),U(os,e),null===as){var t=e.alternate;null!==t&&null!==t.memoizedState&&(as=e)}}else us()}function us(){U(cs,cs.current),U(os,os.current)}function ls(e){W(os),as===e&&(as=null),W(cs)}var cs=z(0);function fs(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gf(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function hs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:h({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ds={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Ml(),o=aa(r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=ia(e,o,r))&&(Pl(t,e,r),sa(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Ml(),o=aa(r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=ia(e,o,r))&&(Pl(t,e,r),sa(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ml(),r=aa(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=ia(e,r,n))&&(Pl(t,e,n),sa(t,e,n))}};function ps(e,t,n,r,o,a,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!Yn(n,r)||!Yn(o,a))}function vs(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ds.enqueueReplaceState(t,t.state,null)}function ms(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var o in n===t&&(n=h({},n)),e)void 0===n[o]&&(n[o]=e[o]);return n}var gs="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function ys(e){gs(e)}function bs(e){console.error(e)}function xs(e){gs(e)}function ws(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Cs(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Es(e,t,n){return(n=aa(n)).tag=3,n.payload={element:null},n.callback=function(){ws(e,t)},n}function Ss(e){return(e=aa(e)).tag=3,e}function ks(e,t,n,r){var o=n.type.getDerivedStateFromError;if("function"===typeof o){var a=r.value;e.payload=function(){return o(a)},e.callback=function(){Cs(t,n,r)}}var i=n.stateNode;null!==i&&"function"===typeof i.componentDidCatch&&(e.callback=function(){Cs(t,n,r),"function"!==typeof o&&(null===Sl?Sl=new Set([this]):Sl.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Rs=Error(i(461)),Is=!1;function _s(e,t,n,r){t.child=null===e?rs(t,null,n,r):ns(t,e.child,n,r)}function Ns(e,t,n,r,o){n=n.render;var a=t.ref;if("ref"in r){var i={};for(var s in r)"ref"!==s&&(i[s]=r[s])}else i=r;return Ro(t),r=Da(e,t,n,i,a,o),s=Pa(),null===e||Is?(ao&&s&&to(t),t.flags|=1,_s(e,t,r,o),t.child):(La(e,t,o),$s(e,t,o))}function Ts(e,t,n,r,o){if(null===e){var a=n.type;return"function"!==typeof a||Lr(a)||void 0!==a.defaultProps||null!==n.compare?((e=Wr(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,As(e,t,a,r,o))}if(a=e.child,!Ys(e,o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:Yn)(i,r)&&e.ref===t.ref)return $s(e,t,o)}return t.flags|=1,(e=Br(a,r)).ref=t.ref,e.return=t,t.child=e}function As(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(Yn(a,r)&&e.ref===t.ref){if(Is=!1,t.pendingProps=r=a,!Ys(e,o))return t.lanes=e.lanes,$s(e,t,o);0!==(131072&e.flags)&&(Is=!0)}}return Fs(e,t,n,r,o)}function Ds(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(0!==(128&t.flags)){if(r=null!==a?a.baseLanes|n:n,null!==e){for(o=t.child=e.child,a=0;null!==o;)a=a|o.lanes|o.childLanes,o=o.sibling;t.childLanes=a&~r}else t.childLanes=0,t.child=null;return Os(e,t,r,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Os(e,t,null!==a?a.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Go(0,null!==a?a.cachePool:null),null!==a?ma(t,a):ga(),ss(t)}else null!==a?(Go(0,a.cachePool),ma(t,a),us(),t.memoizedState=null):(null!==e&&Go(0,null),ga(),us());return _s(e,t,o,n),t.child}function Os(e,t,n,r){var o=jo();return o=null===o?null:{parent:Oo._currentValue,pool:o},t.memoizedState={baseLanes:n,cachePool:o},null!==e&&Go(0,null),ga(),ss(t),null!==e&&So(e,t,r,!0),null}function Ms(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(i(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Fs(e,t,n,r,o){return Ro(t),n=Da(e,t,n,r,void 0,o),r=Pa(),null===e||Is?(ao&&r&&to(t),t.flags|=1,_s(e,t,n,o),t.child):(La(e,t,o),$s(e,t,o))}function Ps(e,t,n,r,o,a){return Ro(t),t.updateQueue=null,n=Ma(t,r,n,o),Oa(e),r=Pa(),null===e||Is?(ao&&r&&to(t),t.flags|=1,_s(e,t,n,a),t.child):(La(e,t,a),$s(e,t,a))}function Ls(e,t,n,r,o){if(Ro(t),null===t.stateNode){var a=Mr,i=n.contextType;"object"===typeof i&&null!==i&&(a=Io(i)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=ds,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},ra(t),i=n.contextType,a.context="object"===typeof i&&null!==i?Io(i):Mr,a.state=t.memoizedState,"function"===typeof(i=n.getDerivedStateFromProps)&&(hs(t,n,i,r),a.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(i=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),i!==a.state&&ds.enqueueReplaceState(a,a.state,null),fa(t,r,a,o),ca(),a.state=t.memoizedState),"function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,u=ms(n,s);a.props=u;var l=a.context,c=n.contextType;i=Mr,"object"===typeof c&&null!==c&&(i=Io(c));var f=n.getDerivedStateFromProps;c="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,c||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s||l!==i)&&vs(t,a,r,i),na=!1;var h=t.memoizedState;a.state=h,fa(t,r,a,o),ca(),l=t.memoizedState,s||h!==l||na?("function"===typeof f&&(hs(t,n,f,r),l=t.memoizedState),(u=na||ps(t,n,u,r,h,l,i))?(c||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=i,r=u):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,oa(e,t),c=ms(n,i=t.memoizedProps),a.props=c,f=t.pendingProps,h=a.context,l=n.contextType,u=Mr,"object"===typeof l&&null!==l&&(u=Io(l)),(l="function"===typeof(s=n.getDerivedStateFromProps)||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(i!==f||h!==u)&&vs(t,a,r,u),na=!1,h=t.memoizedState,a.state=h,fa(t,r,a,o),ca();var d=t.memoizedState;i!==f||h!==d||na||null!==e&&null!==e.dependencies&&ko(e.dependencies)?("function"===typeof s&&(hs(t,n,s,r),d=t.memoizedState),(c=na||ps(t,n,c,r,h,d,u)||null!==e&&null!==e.dependencies&&ko(e.dependencies))?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,d,u),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,d,u)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=d),a.props=r,a.state=d,a.context=u,r=c):("function"!==typeof a.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Ms(e,t),r=0!==(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=ns(t,e.child,null,o),t.child=ns(t,null,n,o)):_s(e,t,n,o),t.memoizedState=a.state,e=t.child):e=$s(e,t,o),e}function Bs(e,t,n,r){return po(),t.flags|=256,_s(e,t,n,r),t.child}var zs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ws(e){return{baseLanes:e,cachePool:Ho()}}function Us(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=ml),e}function Vs(e,t,n){var r,o=t.pendingProps,a=!1,s=0!==(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&0!==(2&cs.current)),r&&(a=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(ao){if(a?is(t):us(),ao){var u,l=oo;if(u=l){e:{for(u=l,l=so;8!==u.nodeType;){if(!l){l=null;break e}if(null===(u=yf(u.nextSibling))){l=null;break e}}l=u}null!==l?(t.memoizedState={dehydrated:l,treeContext:null!==Yr?{id:Qr,overflow:Jr}:null,retryLane:536870912,hydrationErrors:null},(u=Pr(18,null,null,0)).stateNode=l,u.return=t,t.child=u,ro=t,oo=null,u=!0):u=!1}u||lo(t)}if(null!==(l=t.memoizedState)&&null!==(l=l.dehydrated))return gf(l)?t.lanes=32:t.lanes=536870912,null;ls(t)}return l=o.children,o=o.fallback,a?(us(),l=Gs({mode:"hidden",children:l},a=t.mode),o=Ur(o,a,n,null),l.return=t,o.return=t,l.sibling=o,t.child=l,(a=t.child).memoizedState=Ws(n),a.childLanes=Us(e,r,n),t.memoizedState=zs,o):(is(t),js(t,l))}if(null!==(u=e.memoizedState)&&null!==(l=u.dehydrated)){if(s)256&t.flags?(is(t),t.flags&=-257,t=Hs(e,t,n)):null!==t.memoizedState?(us(),t.child=e.child,t.flags|=128,t=null):(us(),a=o.fallback,l=t.mode,o=Gs({mode:"visible",children:o.children},l),(a=Ur(a,l,n,null)).flags|=2,o.return=t,a.return=t,o.sibling=a,t.child=o,ns(t,e.child,null,n),(o=t.child).memoizedState=Ws(n),o.childLanes=Us(e,r,n),t.memoizedState=zs,t=a);else if(is(t),gf(l)){if(r=l.nextSibling&&l.nextSibling.dataset)var c=r.dgst;r=c,(o=Error(i(419))).stack="",o.digest=r,mo({value:o,source:null,stack:null}),t=Hs(e,t,n)}else if(Is||So(e,t,n,!1),r=0!==(n&e.childLanes),Is||r){if(null!==(r=rl)&&(0!==(o=0!==((o=0!==(42&(o=n&-n))?1:_e(o))&(r.suspendedLanes|n))?0:o)&&o!==u.retryLane))throw u.retryLane=o,Ar(e,o),Pl(r,e,o),Rs;"$?"===l.data||Kl(),t=Hs(e,t,n)}else"$?"===l.data?(t.flags|=192,t.child=e.child,t=null):(e=u.treeContext,oo=yf(l.nextSibling),ro=t,ao=!0,io=null,so=!1,null!==e&&(Xr[$r++]=Qr,Xr[$r++]=Jr,Xr[$r++]=Yr,Qr=e.id,Jr=e.overflow,Yr=t),(t=js(t,o.children)).flags|=4096);return t}return a?(us(),a=o.fallback,l=t.mode,c=(u=e.child).sibling,(o=Br(u,{mode:"hidden",children:o.children})).subtreeFlags=65011712&u.subtreeFlags,null!==c?a=Br(c,a):(a=Ur(a,l,n,null)).flags|=2,a.return=t,o.return=t,o.sibling=a,t.child=o,o=a,a=t.child,null===(l=e.child.memoizedState)?l=Ws(n):(null!==(u=l.cachePool)?(c=Oo._currentValue,u=u.parent!==c?{parent:c,pool:c}:u):u=Ho(),l={baseLanes:l.baseLanes|n,cachePool:u}),a.memoizedState=l,a.childLanes=Us(e,r,n),t.memoizedState=zs,o):(is(t),e=(n=e.child).sibling,(n=Br(n,{mode:"visible",children:o.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function js(e,t){return(t=Gs({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Gs(e,t){return(e=Pr(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Hs(e,t,n){return ns(t,e.child,null,n),(e=js(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function qs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Co(e.return,t,n)}function Ks(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Xs(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(_s(e,t,r.children,n),0!==(2&(r=cs.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&qs(e,n,t);else if(19===e.tag)qs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(U(cs,r),o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===fs(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Ks(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===fs(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Ks(t,!0,n,null,a);break;case"together":Ks(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $s(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),dl|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(So(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Br(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Br(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ys(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!ko(e))}function Qs(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Is=!0;else{if(!Ys(e,n)&&0===(128&t.flags))return Is=!1,function(e,t,n){switch(t.tag){case 3:q(t,t.stateNode.containerInfo),xo(0,Oo,e.memoizedState.cache),po();break;case 27:case 5:X(t);break;case 4:q(t,t.stateNode.containerInfo);break;case 10:xo(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(is(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Vs(e,t,n):(is(t),null!==(e=$s(e,t,n))?e.sibling:null);is(t);break;case 19:var o=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(So(e,t,n,!1),r=0!==(n&t.childLanes)),o){if(r)return Xs(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),U(cs,cs.current),r)break;return null;case 22:case 23:return t.lanes=0,Ds(e,t,n);case 24:xo(0,Oo,e.memoizedState.cache)}return $s(e,t,n)}(e,t,n);Is=0!==(131072&e.flags)}else Is=!1,ao&&0!==(1048576&t.flags)&&eo(t,Kr,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,o=r._init;if(r=o(r._payload),t.type=r,"function"!==typeof r){if(void 0!==r&&null!==r){if((o=r.$$typeof)===C){t.tag=11,t=Ns(null,t,r,e,n);break e}if(o===k){t.tag=14,t=Ts(null,t,r,e,n);break e}}throw t=D(r)||r,Error(i(306,t,""))}Lr(r)?(e=ms(r,e),t.tag=1,t=Ls(null,t,r,e,n)):(t.tag=0,t=Fs(null,t,r,e,n))}return t;case 0:return Fs(e,t,t.type,t.pendingProps,n);case 1:return Ls(e,t,r=t.type,o=ms(r,t.pendingProps),n);case 3:e:{if(q(t,t.stateNode.containerInfo),null===e)throw Error(i(387));r=t.pendingProps;var a=t.memoizedState;o=a.element,oa(e,t),fa(t,r,null,n);var s=t.memoizedState;if(r=s.cache,xo(0,Oo,r),r!==a.cache&&Eo(t,[Oo],n,!0),ca(),r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Bs(e,t,r,n);break e}if(r!==o){mo(o=Sr(Error(i(424)),t)),t=Bs(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(oo=yf(e.firstChild),ro=t,ao=!0,io=null,so=!0,n=rs(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(po(),r===o){t=$s(e,t,n);break e}_s(e,t,r,n)}t=t.child}return t;case 26:return Ms(e,t),null===e?(n=Nf(t.type,null,t.pendingProps,null))?t.memoizedState=n:ao||(n=t.type,e=t.pendingProps,(r=rf(G.current).createElement(n))[De]=t,r[Oe]=e,ef(r,n,e),He(r),t.stateNode=r):t.memoizedState=Nf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&ao&&(r=t.stateNode=wf(t.type,t.pendingProps,G.current),ro=t,so=!0,o=oo,pf(t.type)?(bf=o,oo=yf(r.firstChild)):oo=o),_s(e,t,t.pendingProps.children,n),Ms(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&ao&&((o=r=oo)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var o=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[ze])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==o.rel||e.getAttribute("href")!==(null==o.href||""===o.href?null:o.href)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin)||e.getAttribute("title")!==(null==o.title?null:o.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==o.src?null:o.src)||e.getAttribute("type")!==(null==o.type?null:o.type)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==o.name?null:""+o.name;if("hidden"===o.type&&e.getAttribute("name")===a)return e}if(null===(e=yf(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,so))?(t.stateNode=r,ro=t,oo=yf(r.firstChild),so=!1,o=!0):o=!1),o||lo(t)),X(t),o=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,r=a.children,sf(o,a)?r=null:null!==s&&sf(o,s)&&(t.flags|=32),null!==t.memoizedState&&(o=Da(e,t,Fa,null,null,n),$f._currentValue=o),Ms(e,t),_s(e,t,r,n),t.child;case 6:return null===e&&ao&&((e=n=oo)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=yf(e.nextSibling)))return null}return e}(n,t.pendingProps,so))?(t.stateNode=n,ro=t,oo=null,e=!0):e=!1),e||lo(t)),null;case 13:return Vs(e,t,n);case 4:return q(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ns(t,null,r,n):_s(e,t,r,n),t.child;case 11:return Ns(e,t,t.type,t.pendingProps,n);case 7:return _s(e,t,t.pendingProps,n),t.child;case 8:case 12:return _s(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,xo(0,t.type,r.value),_s(e,t,r.children,n),t.child;case 9:return o=t.type._context,r=t.pendingProps.children,Ro(t),r=r(o=Io(o)),t.flags|=1,_s(e,t,r,n),t.child;case 14:return Ts(e,t,t.type,t.pendingProps,n);case 15:return As(e,t,t.type,t.pendingProps,n);case 19:return Xs(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=Gs(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Br(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ds(e,t,n);case 24:return Ro(t),r=Io(Oo),null===e?(null===(o=jo())&&(o=rl,a=Mo(),o.pooledCache=a,a.refCount++,null!==a&&(o.pooledCacheLanes|=n),o=a),t.memoizedState={parent:r,cache:o},ra(t),xo(0,Oo,o)):(0!==(e.lanes&n)&&(oa(e,t),fa(t,null,null,n),ca()),o=e.memoizedState,a=t.memoizedState,o.parent!==r?(o={parent:r,cache:r},t.memoizedState=o,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=o),xo(0,Oo,r)):(r=a.cache,xo(0,Oo,r),r!==o.cache&&Eo(t,[Oo],n,!0))),_s(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function Js(e){e.flags|=4}function Zs(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Vf(t)){if(null!==(t=os.current)&&((4194048&al)===al?null!==as:(62914560&al)!==al&&0===(536870912&al)||t!==as))throw Zo=$o,Ko;e.flags|=8192}}function eu(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ee():536870912,e.lanes|=t,gl|=t)}function tu(e,t){if(!ao)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function nu(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=65011712&o.subtreeFlags,r|=65011712&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function ru(e,t,n){var r=t.pendingProps;switch(no(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nu(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),wo(Oo),K(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ho(t)?Js(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,vo())),nu(t),null;case 26:return n=t.memoizedState,null===e?(Js(t),null!==n?(nu(t),Zs(t,n)):(nu(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Js(t),nu(t),Zs(t,n)):(nu(t),t.flags&=-16777217):(e.memoizedProps!==r&&Js(t),nu(t),t.flags&=-16777217),null;case 27:$(t),n=G.current;var o=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Js(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return nu(t),null}e=V.current,ho(t)?co(t):(e=wf(o,r,n),t.stateNode=e,Js(t))}return nu(t),null;case 5:if($(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Js(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return nu(t),null}if(e=V.current,ho(t))co(t);else{switch(o=rf(G.current),e){case 1:e=o.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=o.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=o.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=o.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=o.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof r.is?o.createElement("select",{is:r.is}):o.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"===typeof r.is?o.createElement(n,{is:r.is}):o.createElement(n)}}e[De]=t,e[Oe]=r;e:for(o=t.child;null!==o;){if(5===o.tag||6===o.tag)e.appendChild(o.stateNode);else if(4!==o.tag&&27!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;null===o.sibling;){if(null===o.return||o.return===t)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.stateNode=e;e:switch(ef(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Js(t)}}return nu(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Js(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(e=G.current,ho(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(o=ro))switch(o.tag){case 27:case 5:r=o.memoizedProps}e[De]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||Yc(e.nodeValue,n)))||lo(t)}else(e=rf(e).createTextNode(r))[De]=t,t.stateNode=e}return nu(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(o=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[De]=t}else po(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nu(t),o=!1}else o=vo(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return 256&t.flags?(ls(t),t):(ls(t),null)}if(ls(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){o=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(o=r.alternate.memoizedState.cachePool.pool);var a=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(a=r.memoizedState.cachePool.pool),a!==o&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),eu(t,t.updateQueue),nu(t),null;case 4:return K(),null===e&&Wc(t.stateNode.containerInfo),nu(t),null;case 10:return wo(t.type),nu(t),null;case 19:if(W(cs),null===(o=t.memoizedState))return nu(t),null;if(r=0!==(128&t.flags),null===(a=o.rendering))if(r)tu(o,!1);else{if(0!==hl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=fs(e))){for(t.flags|=128,tu(o,!1),e=a.updateQueue,t.updateQueue=e,eu(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)zr(n,e),n=n.sibling;return U(cs,1&cs.current|2),t.child}e=e.sibling}null!==o.tail&&te()>Cl&&(t.flags|=128,r=!0,tu(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=fs(a))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,eu(t,e),tu(o,!0),null===o.tail&&"hidden"===o.tailMode&&!a.alternate&&!ao)return nu(t),null}else 2*te()-o.renderingStartTime>Cl&&536870912!==n&&(t.flags|=128,r=!0,tu(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=o.last)?e.sibling=a:t.child=a,o.last=a)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=te(),t.sibling=null,e=cs.current,U(cs,r?1&e|2:1&e),t):(nu(t),null);case 22:case 23:return ls(t),ya(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(nu(t),6&t.subtreeFlags&&(t.flags|=8192)):nu(t),null!==(n=t.updateQueue)&&eu(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&W(Vo),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),wo(Oo),nu(t),null;case 25:case 30:return null}throw Error(i(156,t.tag))}function ou(e,t){switch(no(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return wo(Oo),K(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return $(t),null;case 13:if(ls(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));po()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return W(cs),null;case 4:return K(),null;case 10:return wo(t.type),null;case 22:case 23:return ls(t),ya(),null!==e&&W(Vo),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return wo(Oo),null;default:return null}}function au(e,t){switch(no(t),t.tag){case 3:wo(Oo),K();break;case 26:case 27:case 5:$(t);break;case 4:K();break;case 13:ls(t);break;case 19:W(cs);break;case 10:wo(t.type);break;case 22:case 23:ls(t),ya(),null!==e&&W(Vo);break;case 24:wo(Oo)}}function iu(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var o=r.next;n=o;do{if((n.tag&e)===e){r=void 0;var a=n.create,i=n.inst;r=a(),i.destroy=r}n=n.next}while(n!==o)}}catch(s){cc(t,t.return,s)}}function su(e,t,n){try{var r=t.updateQueue,o=null!==r?r.lastEffect:null;if(null!==o){var a=o.next;r=a;do{if((r.tag&e)===e){var i=r.inst,s=i.destroy;if(void 0!==s){i.destroy=void 0,o=t;var u=n,l=s;try{l()}catch(c){cc(o,u,c)}}}r=r.next}while(r!==a)}}catch(c){cc(t,t.return,c)}}function uu(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{da(t,n)}catch(r){cc(e,e.return,r)}}}function lu(e,t,n){n.props=ms(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){cc(e,t,r)}}function cu(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(o){cc(e,t,o)}}function fu(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(o){cc(e,t,o)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(a){cc(e,t,a)}else n.current=null}function hu(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(o){cc(e,e.return,o)}}function du(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,a=null,s=null,u=null,l=null,c=null,f=null;for(p in n){var h=n[p];if(n.hasOwnProperty(p)&&null!=h)switch(p){case"checked":case"value":break;case"defaultValue":l=h;default:r.hasOwnProperty(p)||Jc(e,t,p,null,r,h)}}for(var d in r){var p=r[d];if(h=n[d],r.hasOwnProperty(d)&&(null!=p||null!=h))switch(d){case"type":a=p;break;case"name":o=p;break;case"checked":c=p;break;case"defaultChecked":f=p;break;case"value":s=p;break;case"defaultValue":u=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(i(137,t));break;default:p!==h&&Jc(e,t,d,p,r,h)}}return void mt(e,s,u,l,c,f,a,o);case"select":for(a in p=s=u=d=null,n)if(l=n[a],n.hasOwnProperty(a)&&null!=l)switch(a){case"value":break;case"multiple":p=l;default:r.hasOwnProperty(a)||Jc(e,t,a,null,r,l)}for(o in r)if(a=r[o],l=n[o],r.hasOwnProperty(o)&&(null!=a||null!=l))switch(o){case"value":d=a;break;case"defaultValue":u=a;break;case"multiple":s=a;default:a!==l&&Jc(e,t,o,a,r,l)}return t=u,n=s,r=p,void(null!=d?bt(e,!!n,d,!1):!!r!==!!n&&(null!=t?bt(e,!!n,t,!0):bt(e,!!n,n?[]:"",!1)));case"textarea":for(u in p=d=null,n)if(o=n[u],n.hasOwnProperty(u)&&null!=o&&!r.hasOwnProperty(u))switch(u){case"value":case"children":break;default:Jc(e,t,u,null,r,o)}for(s in r)if(o=r[s],a=n[s],r.hasOwnProperty(s)&&(null!=o||null!=a))switch(s){case"value":d=o;break;case"defaultValue":p=o;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(i(91));break;default:o!==a&&Jc(e,t,s,o,r,a)}return void xt(e,d,p);case"option":for(var v in n)if(d=n[v],n.hasOwnProperty(v)&&null!=d&&!r.hasOwnProperty(v))if("selected"===v)e.selected=!1;else Jc(e,t,v,null,r,d);for(l in r)if(d=r[l],p=n[l],r.hasOwnProperty(l)&&d!==p&&(null!=d||null!=p))if("selected"===l)e.selected=d&&"function"!==typeof d&&"symbol"!==typeof d;else Jc(e,t,l,d,r,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)d=n[m],n.hasOwnProperty(m)&&null!=d&&!r.hasOwnProperty(m)&&Jc(e,t,m,null,r,d);for(c in r)if(d=r[c],p=n[c],r.hasOwnProperty(c)&&d!==p&&(null!=d||null!=p))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(i(137,t));break;default:Jc(e,t,c,d,r,p)}return;default:if(Rt(t)){for(var g in n)d=n[g],n.hasOwnProperty(g)&&void 0!==d&&!r.hasOwnProperty(g)&&Zc(e,t,g,void 0,r,d);for(f in r)d=r[f],p=n[f],!r.hasOwnProperty(f)||d===p||void 0===d&&void 0===p||Zc(e,t,f,d,r,p);return}}for(var y in n)d=n[y],n.hasOwnProperty(y)&&null!=d&&!r.hasOwnProperty(y)&&Jc(e,t,y,null,r,d);for(h in r)d=r[h],p=n[h],!r.hasOwnProperty(h)||d===p||null==d&&null==p||Jc(e,t,h,d,r,p)}(r,e.type,n,t),r[Oe]=t}catch(o){cc(e,e.return,o)}}function pu(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&pf(e.type)||4===e.tag}function vu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||pu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&pf(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function mu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Qc));else if(4!==r&&(27===r&&pf(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(mu(e,t,n),e=e.sibling;null!==e;)mu(e,t,n),e=e.sibling}function gu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&pf(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(gu(e,t,n),e=e.sibling;null!==e;)gu(e,t,n),e=e.sibling}function yu(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,o=t.attributes;o.length;)t.removeAttributeNode(o[0]);ef(t,r,n),t[De]=e,t[Oe]=n}catch(a){cc(e,e.return,a)}}var bu=!1,xu=!1,wu=!1,Cu="function"===typeof WeakSet?WeakSet:Set,Eu=null;function Su(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Lu(e,n),4&r&&iu(5,n);break;case 1:if(Lu(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(i){cc(n,n.return,i)}else{var o=ms(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(o,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){cc(n,n.return,s)}}64&r&&uu(n),512&r&&cu(n,n.return);break;case 3:if(Lu(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{da(e,t)}catch(i){cc(n,n.return,i)}}break;case 27:null===t&&4&r&&yu(n);case 26:case 5:Lu(e,n),null===t&&4&r&&hu(n),512&r&&cu(n,n.return);break;case 12:Lu(e,n);break;case 13:Lu(e,n),4&r&&Tu(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=pc.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||bu)){t=null!==t&&null!==t.memoizedState||xu,o=bu;var a=xu;bu=r,(xu=t)&&!a?zu(e,n,0!==(8772&n.subtreeFlags)):Lu(e,n),bu=o,xu=a}break;case 30:break;default:Lu(e,n)}}function ku(e){var t=e.alternate;null!==t&&(e.alternate=null,ku(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&We(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ru=null,Iu=!1;function _u(e,t,n){for(n=n.child;null!==n;)Nu(e,t,n),n=n.sibling}function Nu(e,t,n){if(fe&&"function"===typeof fe.onCommitFiberUnmount)try{fe.onCommitFiberUnmount(ce,n)}catch(a){}switch(n.tag){case 26:xu||fu(n,t),_u(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:xu||fu(n,t);var r=Ru,o=Iu;pf(n.type)&&(Ru=n.stateNode,Iu=!1),_u(e,t,n),Cf(n.stateNode),Ru=r,Iu=o;break;case 5:xu||fu(n,t);case 6:if(r=Ru,o=Iu,Ru=null,_u(e,t,n),Iu=o,null!==(Ru=r))if(Iu)try{(9===Ru.nodeType?Ru.body:"HTML"===Ru.nodeName?Ru.ownerDocument.body:Ru).removeChild(n.stateNode)}catch(i){cc(n,t,i)}else try{Ru.removeChild(n.stateNode)}catch(i){cc(n,t,i)}break;case 18:null!==Ru&&(Iu?(vf(9===(e=Ru).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),_h(e)):vf(Ru,n.stateNode));break;case 4:r=Ru,o=Iu,Ru=n.stateNode.containerInfo,Iu=!0,_u(e,t,n),Ru=r,Iu=o;break;case 0:case 11:case 14:case 15:xu||su(2,n,t),xu||su(4,n,t),_u(e,t,n);break;case 1:xu||(fu(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&lu(n,t,r)),_u(e,t,n);break;case 21:_u(e,t,n);break;case 22:xu=(r=xu)||null!==n.memoizedState,_u(e,t,n),xu=r;break;default:_u(e,t,n)}}function Tu(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{_h(e)}catch(n){cc(t,t.return,n)}}function Au(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Cu),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Cu),t;default:throw Error(i(435,e.tag))}}(e);t.forEach(function(t){var r=vc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function Du(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r],a=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 27:if(pf(u.type)){Ru=u.stateNode,Iu=!1;break e}break;case 5:Ru=u.stateNode,Iu=!1;break e;case 3:case 4:Ru=u.stateNode.containerInfo,Iu=!0;break e}u=u.return}if(null===Ru)throw Error(i(160));Nu(a,s,o),Ru=null,Iu=!1,null!==(a=o.alternate)&&(a.return=null),o.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Mu(t,e),t=t.sibling}var Ou=null;function Mu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Du(t,e),Fu(e),4&r&&(su(3,e,e.return),iu(3,e),su(5,e,e.return));break;case 1:Du(t,e),Fu(e),512&r&&(xu||null===n||fu(n,n.return)),64&r&&bu&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var o=Ou;if(Du(t,e),Fu(e),512&r&&(xu||null===n||fu(n,n.return)),4&r){var a=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,o=o.ownerDocument||o;t:switch(r){case"title":(!(a=o.getElementsByTagName("title")[0])||a[ze]||a[De]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=o.createElement(r),o.head.insertBefore(a,o.querySelector("head > title"))),ef(a,r,n),a[De]=e,He(a),r=a;break e;case"link":var s=Wf("link","href",o).get(r+(n.href||""));if(s)for(var u=0;u<s.length;u++)if((a=s[u]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(u,1);break t}ef(a=o.createElement(r),r,n),o.head.appendChild(a);break;case"meta":if(s=Wf("meta","content",o).get(r+(n.content||"")))for(u=0;u<s.length;u++)if((a=s[u]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(u,1);break t}ef(a=o.createElement(r),r,n),o.head.appendChild(a);break;default:throw Error(i(468,r))}a[De]=e,He(a),r=a}e.stateNode=r}else Uf(o,e.type,e.stateNode);else e.stateNode=Ff(o,r,e.memoizedProps);else a!==r?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===r?Uf(o,e.type,e.stateNode):Ff(o,r,e.memoizedProps)):null===r&&null!==e.stateNode&&du(e,e.memoizedProps,n.memoizedProps)}break;case 27:Du(t,e),Fu(e),512&r&&(xu||null===n||fu(n,n.return)),null!==n&&4&r&&du(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Du(t,e),Fu(e),512&r&&(xu||null===n||fu(n,n.return)),32&e.flags){o=e.stateNode;try{Ct(o,"")}catch(p){cc(e,e.return,p)}}4&r&&null!=e.stateNode&&du(e,o=e.memoizedProps,null!==n?n.memoizedProps:o),1024&r&&(wu=!0);break;case 6:if(Du(t,e),Fu(e),4&r){if(null===e.stateNode)throw Error(i(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(p){cc(e,e.return,p)}}break;case 3:if(zf=null,o=Ou,Ou=kf(t.containerInfo),Du(t,e),Ou=o,Fu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{_h(t.containerInfo)}catch(p){cc(e,e.return,p)}wu&&(wu=!1,Pu(e));break;case 4:r=Ou,Ou=kf(e.stateNode.containerInfo),Du(t,e),Fu(e),Ou=r;break;case 12:default:Du(t,e),Fu(e);break;case 13:Du(t,e),Fu(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(wl=te()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Au(e,r)));break;case 22:o=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,c=bu,f=xu;if(bu=c||o,xu=f||l,Du(t,e),xu=f,bu=c,Fu(e),8192&r)e:for(t=e.stateNode,t._visibility=o?-2&t._visibility:1|t._visibility,o&&(null===n||l||bu||xu||Bu(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(a=l.stateNode,o)"function"===typeof(s=a.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{u=l.stateNode;var h=l.memoizedProps.style,d=void 0!==h&&null!==h&&h.hasOwnProperty("display")?h.display:null;u.style.display=null==d||"boolean"===typeof d?"":(""+d).trim()}}catch(p){cc(l,l.return,p)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=o?"":l.memoizedProps}catch(p){cc(l,l.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Au(e,n))));break;case 19:Du(t,e),Fu(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Au(e,r)));case 30:case 21:}}function Fu(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(pu(r)){n=r;break}r=r.return}if(null==n)throw Error(i(160));switch(n.tag){case 27:var o=n.stateNode;gu(e,vu(e),o);break;case 5:var a=n.stateNode;32&n.flags&&(Ct(a,""),n.flags&=-33),gu(e,vu(e),a);break;case 3:case 4:var s=n.stateNode.containerInfo;mu(e,vu(e),s);break;default:throw Error(i(161))}}catch(u){cc(e,e.return,u)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Pu(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Pu(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Lu(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Su(e,t.alternate,t),t=t.sibling}function Bu(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:su(4,t,t.return),Bu(t);break;case 1:fu(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&lu(t,t.return,n),Bu(t);break;case 27:Cf(t.stateNode);case 26:case 5:fu(t,t.return),Bu(t);break;case 22:null===t.memoizedState&&Bu(t);break;default:Bu(t)}e=e.sibling}}function zu(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,o=e,a=t,i=a.flags;switch(a.tag){case 0:case 11:case 15:zu(o,a,n),iu(4,a);break;case 1:if(zu(o,a,n),"function"===typeof(o=(r=a).stateNode).componentDidMount)try{o.componentDidMount()}catch(l){cc(r,r.return,l)}if(null!==(o=(r=a).updateQueue)){var s=r.stateNode;try{var u=o.shared.hiddenCallbacks;if(null!==u)for(o.shared.hiddenCallbacks=null,o=0;o<u.length;o++)ha(u[o],s)}catch(l){cc(r,r.return,l)}}n&&64&i&&uu(a),cu(a,a.return);break;case 27:yu(a);case 26:case 5:zu(o,a,n),n&&null===r&&4&i&&hu(a),cu(a,a.return);break;case 12:zu(o,a,n);break;case 13:zu(o,a,n),n&&4&i&&Tu(o,a);break;case 22:null===a.memoizedState&&zu(o,a,n),cu(a,a.return);break;case 30:break;default:zu(o,a,n)}t=t.sibling}}function Wu(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Fo(n))}function Uu(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Fo(e))}function Vu(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ju(e,t,n,r),t=t.sibling}function ju(e,t,n,r){var o=t.flags;switch(t.tag){case 0:case 11:case 15:Vu(e,t,n,r),2048&o&&iu(9,t);break;case 1:case 13:default:Vu(e,t,n,r);break;case 3:Vu(e,t,n,r),2048&o&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Fo(e)));break;case 12:if(2048&o){Vu(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,i=a.id,s=a.onPostCommit;"function"===typeof s&&s(i,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(u){cc(t,t.return,u)}}else Vu(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,i=t.alternate,null!==t.memoizedState?2&a._visibility?Vu(e,t,n,r):Hu(e,t):2&a._visibility?Vu(e,t,n,r):(a._visibility|=2,Gu(e,t,n,r,0!==(10256&t.subtreeFlags))),2048&o&&Wu(i,t);break;case 24:Vu(e,t,n,r),2048&o&&Uu(t.alternate,t)}}function Gu(e,t,n,r,o){for(o=o&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var a=e,i=t,s=n,u=r,l=i.flags;switch(i.tag){case 0:case 11:case 15:Gu(a,i,s,u,o),iu(8,i);break;case 23:break;case 22:var c=i.stateNode;null!==i.memoizedState?2&c._visibility?Gu(a,i,s,u,o):Hu(a,i):(c._visibility|=2,Gu(a,i,s,u,o)),o&&2048&l&&Wu(i.alternate,i);break;case 24:Gu(a,i,s,u,o),o&&2048&l&&Uu(i.alternate,i);break;default:Gu(a,i,s,u,o)}t=t.sibling}}function Hu(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,o=r.flags;switch(r.tag){case 22:Hu(n,r),2048&o&&Wu(r.alternate,r);break;case 24:Hu(n,r),2048&o&&Uu(r.alternate,r);break;default:Hu(n,r)}t=t.sibling}}var qu=8192;function Ku(e){if(e.subtreeFlags&qu)for(e=e.child;null!==e;)Xu(e),e=e.sibling}function Xu(e){switch(e.tag){case 26:Ku(e),e.flags&qu&&null!==e.memoizedState&&function(e,t,n){if(null===jf)throw Error(i(475));var r=jf;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var o=Tf(n.href),a=e.querySelector(Af(o));if(a)return null!==(e=a._p)&&"object"===typeof e&&"function"===typeof e.then&&(r.count++,r=Hf.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=a,void He(a);a=e.ownerDocument||e,n=Df(n),(o=Ef.get(o))&&Lf(n,o),He(a=a.createElement("link"));var s=a;s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),ef(a,"link",n),t.instance=a}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(r.count++,t=Hf.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Ou,e.memoizedState,e.memoizedProps);break;case 5:default:Ku(e);break;case 3:case 4:var t=Ou;Ou=kf(e.stateNode.containerInfo),Ku(e),Ou=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=qu,qu=16777216,Ku(e),qu=t):Ku(e))}}function $u(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Yu(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Eu=r,Zu(r,e)}$u(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Qu(e),e=e.sibling}function Qu(e){switch(e.tag){case 0:case 11:case 15:Yu(e),2048&e.flags&&su(9,e,e.return);break;case 3:case 12:default:Yu(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Ju(e)):Yu(e)}}function Ju(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Eu=r,Zu(r,e)}$u(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:su(8,t,t.return),Ju(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Ju(t));break;default:Ju(t)}e=e.sibling}}function Zu(e,t){for(;null!==Eu;){var n=Eu;switch(n.tag){case 0:case 11:case 15:su(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Fo(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Eu=r;else e:for(n=e;null!==Eu;){var o=(r=Eu).sibling,a=r.return;if(ku(r),r===n){Eu=null;break e}if(null!==o){o.return=a,Eu=o;break e}Eu=a}}}var el={getCacheForType:function(e){var t=Io(Oo),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tl="function"===typeof WeakMap?WeakMap:Map,nl=0,rl=null,ol=null,al=0,il=0,sl=null,ul=!1,ll=!1,cl=!1,fl=0,hl=0,dl=0,pl=0,vl=0,ml=0,gl=0,yl=null,bl=null,xl=!1,wl=0,Cl=1/0,El=null,Sl=null,kl=0,Rl=null,Il=null,_l=0,Nl=0,Tl=null,Al=null,Dl=0,Ol=null;function Ml(){if(0!==(2&nl)&&0!==al)return al&-al;if(null!==M.T){return 0!==Bo?Bo:Nc()}return Te()}function Fl(){0===ml&&(ml=0===(536870912&al)||ao?Ce():536870912);var e=os.current;return null!==e&&(e.flags|=32),ml}function Pl(e,t,n){(e!==rl||2!==il&&9!==il)&&null===e.cancelPendingCommit||(jl(e,0),Wl(e,al,ml,!1)),ke(e,n),0!==(2&nl)&&e===rl||(e===rl&&(0===(2&nl)&&(pl|=n),4===hl&&Wl(e,al,ml,!1)),Cc(e))}function Ll(e,t,n){if(0!==(6&nl))throw Error(i(327));for(var r=!n&&0===(124&t)&&0===(t&e.expiredLanes)||xe(e,t),o=r?function(e,t){var n=nl;nl|=2;var r=Hl(),o=ql();rl!==e||al!==t?(El=null,Cl=te()+500,jl(e,t)):ll=xe(e,t);e:for(;;)try{if(0!==il&&null!==ol){t=ol;var a=sl;t:switch(il){case 1:il=0,sl=null,Zl(e,t,a,1);break;case 2:case 9:if(Yo(a)){il=0,sl=null,Jl(t);break}t=function(){2!==il&&9!==il||rl!==e||(il=7),Cc(e)},a.then(t,t);break e;case 3:il=7;break e;case 4:il=5;break e;case 7:Yo(a)?(il=0,sl=null,Jl(t)):(il=0,sl=null,Zl(e,t,a,7));break;case 5:var s=null;switch(ol.tag){case 26:s=ol.memoizedState;case 5:case 27:var u=ol;if(!s||Vf(s)){il=0,sl=null;var l=u.sibling;if(null!==l)ol=l;else{var c=u.return;null!==c?(ol=c,ec(c)):ol=null}break t}}il=0,sl=null,Zl(e,t,a,5);break;case 6:il=0,sl=null,Zl(e,t,a,6);break;case 8:Vl(),hl=6;break e;default:throw Error(i(462))}}Yl();break}catch(f){Gl(e,f)}return bo=yo=null,M.H=r,M.A=o,nl=n,null!==ol?0:(rl=null,al=0,_r(),hl)}(e,t):Xl(e,t,!0),a=r;;){if(0===o){ll&&!r&&Wl(e,t,0,!1);break}if(n=e.current.alternate,!a||zl(n)){if(2===o){if(a=t,e.errorRecoveryDisabledLanes&a)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var u=e;o=yl;var l=u.current.memoizedState.isDehydrated;if(l&&(jl(u,s).flags|=256),2!==(s=Xl(u,s,!1))){if(cl&&!l){u.errorRecoveryDisabledLanes|=a,pl|=a,o=4;break e}a=bl,bl=o,null!==a&&(null===bl?bl=a:bl.push.apply(bl,a))}o=s}if(a=!1,2!==o)continue}}if(1===o){jl(e,0),Wl(e,t,0,!0);break}e:{switch(r=e,a=o){case 0:case 1:throw Error(i(345));case 4:if((4194048&t)!==t)break;case 6:Wl(r,t,ml,!ul);break e;case 2:bl=null;break;case 3:case 5:break;default:throw Error(i(329))}if((62914560&t)===t&&10<(o=wl+300-te())){if(Wl(r,t,ml,!ul),0!==be(r,0,!0))break e;r.timeoutHandle=lf(Bl.bind(null,r,n,bl,El,xl,t,ml,pl,gl,ul,a,2,-0,0),o)}else Bl(r,n,bl,El,xl,t,ml,pl,gl,ul,a,0,-0,0)}break}o=Xl(e,t,!1),a=!1}Cc(e)}function Bl(e,t,n,r,o,a,s,u,l,c,f,h,d,p){if(e.timeoutHandle=-1,(8192&(h=t.subtreeFlags)||16785408===(16785408&h))&&(jf={stylesheets:null,count:0,unsuspend:Gf},Xu(t),null!==(h=function(){if(null===jf)throw Error(i(475));var e=jf;return e.stylesheets&&0===e.count&&Kf(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Kf(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=h(nc.bind(null,e,t,a,n,r,o,s,u,l,f,1,d,p)),void Wl(e,a,s,!c);nc(e,t,a,n,r,o,s,u,l)}function zl(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!$n(a(),o))return!1}catch(i){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Wl(e,t,n,r){t&=~vl,t&=~pl,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var o=t;0<o;){var a=31-de(o),i=1<<a;r[a]=-1,o&=~i}0!==n&&Re(e,n,t)}function Ul(){return 0!==(6&nl)||(Ec(0,!1),!1)}function Vl(){if(null!==ol){if(0===il)var e=ol.return;else bo=yo=null,Ba(e=ol),$i=null,Yi=0,e=ol;for(;null!==e;)au(e.alternate,e),e=e.return;ol=null}}function jl(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,cf(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Vl(),rl=e,ol=n=Br(e.current,null),al=t,il=0,sl=null,ul=!1,ll=xe(e,t),cl=!1,gl=ml=vl=pl=dl=hl=0,bl=yl=null,xl=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var o=31-de(r),a=1<<o;t|=e[o],r&=~a}return fl=t,_r(),n}function Gl(e,t){xa=null,M.H=Hi,t===qo||t===Xo?(t=ea(),il=3):t===Ko?(t=ea(),il=4):il=t===Rs?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,sl=t,null===ol&&(hl=1,ws(e,Sr(t,e.current)))}function Hl(){var e=M.H;return M.H=Hi,null===e?Hi:e}function ql(){var e=M.A;return M.A=el,e}function Kl(){hl=4,ul||(4194048&al)!==al&&null!==os.current||(ll=!0),0===(134217727&dl)&&0===(134217727&pl)||null===rl||Wl(rl,al,ml,!1)}function Xl(e,t,n){var r=nl;nl|=2;var o=Hl(),a=ql();rl===e&&al===t||(El=null,jl(e,t)),t=!1;var i=hl;e:for(;;)try{if(0!==il&&null!==ol){var s=ol,u=sl;switch(il){case 8:Vl(),i=6;break e;case 3:case 2:case 9:case 6:null===os.current&&(t=!0);var l=il;if(il=0,sl=null,Zl(e,s,u,l),n&&ll){i=0;break e}break;default:l=il,il=0,sl=null,Zl(e,s,u,l)}}$l(),i=hl;break}catch(c){Gl(e,c)}return t&&e.shellSuspendCounter++,bo=yo=null,nl=r,M.H=o,M.A=a,null===ol&&(rl=null,al=0,_r()),i}function $l(){for(;null!==ol;)Ql(ol)}function Yl(){for(;null!==ol&&!Z();)Ql(ol)}function Ql(e){var t=Qs(e.alternate,e,fl);e.memoizedProps=e.pendingProps,null===t?ec(e):ol=t}function Jl(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ps(n,t,t.pendingProps,t.type,void 0,al);break;case 11:t=Ps(n,t,t.pendingProps,t.type.render,t.ref,al);break;case 5:Ba(t);default:au(n,t),t=Qs(n,t=ol=zr(t,fl),fl)}e.memoizedProps=e.pendingProps,null===t?ec(e):ol=t}function Zl(e,t,n,r){bo=yo=null,Ba(t),$i=null,Yi=0;var o=t.return;try{if(function(e,t,n,r,o){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&So(t,n,o,!0),null!==(n=os.current)){switch(n.tag){case 13:return null===as?Kl():null===n.alternate&&0===hl&&(hl=3),n.flags&=-257,n.flags|=65536,n.lanes=o,r===$o?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),fc(e,r,o)),!1;case 22:return n.flags|=65536,r===$o?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),fc(e,r,o)),!1}throw Error(i(435,n.tag))}return fc(e,r,o),Kl(),!1}if(ao)return null!==(t=os.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=o,r!==uo&&mo(Sr(e=Error(i(422),{cause:r}),n))):(r!==uo&&mo(Sr(t=Error(i(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,o&=-o,e.lanes|=o,r=Sr(r,n),ua(e,o=Es(e.stateNode,r,o)),4!==hl&&(hl=2)),!1;var a=Error(i(520),{cause:r});if(a=Sr(a,n),null===yl?yl=[a]:yl.push(a),4!==hl&&(hl=2),null===t)return!0;r=Sr(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=o&-o,n.lanes|=e,ua(n,e=Es(n.stateNode,r,e)),!1;case 1:if(t=n.type,a=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==a&&"function"===typeof a.componentDidCatch&&(null===Sl||!Sl.has(a))))return n.flags|=65536,o&=-o,n.lanes|=o,ks(o=Ss(o),e,n,r),ua(n,o),!1}n=n.return}while(null!==n);return!1}(e,o,t,n,al))return hl=1,ws(e,Sr(n,e.current)),void(ol=null)}catch(a){if(null!==o)throw ol=o,a;return hl=1,ws(e,Sr(n,e.current)),void(ol=null)}32768&t.flags?(ao||1===r?e=!0:ll||0!==(536870912&al)?e=!1:(ul=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=os.current)&&13===r.tag&&(r.flags|=16384))),tc(t,e)):ec(t)}function ec(e){var t=e;do{if(0!==(32768&t.flags))return void tc(t,ul);e=t.return;var n=ru(t.alternate,t,fl);if(null!==n)return void(ol=n);if(null!==(t=t.sibling))return void(ol=t);ol=t=e}while(null!==t);0===hl&&(hl=5)}function tc(e,t){do{var n=ou(e.alternate,e);if(null!==n)return n.flags&=32767,void(ol=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(ol=e);ol=e=n}while(null!==e);hl=6,ol=null}function nc(e,t,n,r,o,a,s,u,l){e.cancelPendingCommit=null;do{sc()}while(0!==kl);if(0!==(6&nl))throw Error(i(327));if(null!==t){if(t===e.current)throw Error(i(177));if(a=t.lanes|t.childLanes,function(e,t,n,r,o,a){var i=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,u=e.expirationTimes,l=e.hiddenUpdates;for(n=i&~n;0<n;){var c=31-de(n),f=1<<c;s[c]=0,u[c]=-1;var h=l[c];if(null!==h)for(l[c]=null,c=0;c<h.length;c++){var d=h[c];null!==d&&(d.lane&=-536870913)}n&=~f}0!==r&&Re(e,r,0),0!==a&&0===o&&0!==e.tag&&(e.suspendedLanes|=a&~(i&~t))}(e,n,a|=Ir,s,u,l),e===rl&&(ol=rl=null,al=0),Il=t,Rl=e,_l=n,Nl=a,Tl=o,Al=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,Q(ae,function(){return uc(),null})):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=M.T,M.T=null,o=F.p,F.p=2,s=nl,nl|=4;try{!function(e,t){if(e=e.containerInfo,tf=rh,tr(e=er(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(m){n=null;break e}var s=0,u=-1,l=-1,c=0,f=0,h=e,d=null;t:for(;;){for(var p;h!==n||0!==o&&3!==h.nodeType||(u=s+o),h!==a||0!==r&&3!==h.nodeType||(l=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)d=h,h=p;for(;;){if(h===e)break t;if(d===n&&++c===o&&(u=s),d===a&&++f===r&&(l=s),null!==(p=h.nextSibling))break;d=(h=d).parentNode}h=p}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(nf={focusedElem:e,selectionRange:n},rh=!1,Eu=t;null!==Eu;)if(e=(t=Eu).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,Eu=e;else for(;null!==Eu;){switch(a=(t=Eu).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==a){e=void 0,n=t,o=a.memoizedProps,a=a.memoizedState,r=n.stateNode;try{var v=ms(n.type,o,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(v,a),r.__reactInternalSnapshotBeforeUpdate=e}catch(g){cc(n,n.return,g)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))mf(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":mf(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(i(163))}if(null!==(e=t.sibling)){e.return=t.return,Eu=e;break}Eu=t.return}}(e,t)}finally{nl=s,F.p=o,M.T=r}}kl=1,rc(),oc(),ac()}}function rc(){if(1===kl){kl=0;var e=Rl,t=Il,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=M.T,M.T=null;var r=F.p;F.p=2;var o=nl;nl|=4;try{Mu(t,e);var a=nf,i=er(e.containerInfo),s=a.focusedElem,u=a.selectionRange;if(i!==s&&s&&s.ownerDocument&&Zn(s.ownerDocument.documentElement,s)){if(null!==u&&tr(s)){var l=u.start,c=u.end;if(void 0===c&&(c=l),"selectionStart"in s)s.selectionStart=l,s.selectionEnd=Math.min(c,s.value.length);else{var f=s.ownerDocument||document,h=f&&f.defaultView||window;if(h.getSelection){var d=h.getSelection(),p=s.textContent.length,v=Math.min(u.start,p),m=void 0===u.end?v:Math.min(u.end,p);!d.extend&&v>m&&(i=m,m=v,v=i);var g=Jn(s,v),y=Jn(s,m);if(g&&y&&(1!==d.rangeCount||d.anchorNode!==g.node||d.anchorOffset!==g.offset||d.focusNode!==y.node||d.focusOffset!==y.offset)){var b=f.createRange();b.setStart(g.node,g.offset),d.removeAllRanges(),v>m?(d.addRange(b),d.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),d.addRange(b))}}}}for(f=[],d=s;d=d.parentNode;)1===d.nodeType&&f.push({element:d,left:d.scrollLeft,top:d.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<f.length;s++){var x=f[s];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}rh=!!tf,nf=tf=null}finally{nl=o,F.p=r,M.T=n}}e.current=t,kl=2}}function oc(){if(2===kl){kl=0;var e=Rl,t=Il,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=M.T,M.T=null;var r=F.p;F.p=2;var o=nl;nl|=4;try{Su(e,t.alternate,t)}finally{nl=o,F.p=r,M.T=n}}kl=3}}function ac(){if(4===kl||3===kl){kl=0,ee();var e=Rl,t=Il,n=_l,r=Al;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?kl=5:(kl=0,Il=Rl=null,ic(e,e.pendingLanes));var o=e.pendingLanes;if(0===o&&(Sl=null),Ne(n),t=t.stateNode,fe&&"function"===typeof fe.onCommitFiberRoot)try{fe.onCommitFiberRoot(ce,t,void 0,128===(128&t.current.flags))}catch(u){}if(null!==r){t=M.T,o=F.p,F.p=2,M.T=null;try{for(var a=e.onRecoverableError,i=0;i<r.length;i++){var s=r[i];a(s.value,{componentStack:s.stack})}}finally{M.T=t,F.p=o}}0!==(3&_l)&&sc(),Cc(e),o=e.pendingLanes,0!==(4194090&n)&&0!==(42&o)?e===Ol?Dl++:(Dl=0,Ol=e):Dl=0,Ec(0,!1)}}function ic(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Fo(t)))}function sc(e){return rc(),oc(),ac(),uc()}function uc(){if(5!==kl)return!1;var e=Rl,t=Nl;Nl=0;var n=Ne(_l),r=M.T,o=F.p;try{F.p=32>n?32:n,M.T=null,n=Tl,Tl=null;var a=Rl,s=_l;if(kl=0,Il=Rl=null,_l=0,0!==(6&nl))throw Error(i(331));var u=nl;if(nl|=4,Qu(a.current),ju(a,a.current,s,n),nl=u,Ec(0,!1),fe&&"function"===typeof fe.onPostCommitFiberRoot)try{fe.onPostCommitFiberRoot(ce,a)}catch(l){}return!0}finally{F.p=o,M.T=r,ic(e,t)}}function lc(e,t,n){t=Sr(n,t),null!==(e=ia(e,t=Es(e.stateNode,t,2),2))&&(ke(e,2),Cc(e))}function cc(e,t,n){if(3===e.tag)lc(e,e,n);else for(;null!==t;){if(3===t.tag){lc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Sl||!Sl.has(r))){e=Sr(n,e),null!==(r=ia(t,n=Ss(2),2))&&(ks(n,r,t,e),ke(r,2),Cc(r));break}}t=t.return}}function fc(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new tl;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(cl=!0,o.add(n),e=hc.bind(null,e,t,n),t.then(e,e))}function hc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,rl===e&&(al&n)===n&&(4===hl||3===hl&&(62914560&al)===al&&300>te()-wl?0===(2&nl)&&jl(e,0):vl|=n,gl===al&&(gl=0)),Cc(e)}function dc(e,t){0===t&&(t=Ee()),null!==(e=Ar(e,t))&&(ke(e,t),Cc(e))}function pc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),dc(e,n)}function vc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(i(314))}null!==r&&r.delete(t),dc(e,n)}var mc=null,gc=null,yc=!1,bc=!1,xc=!1,wc=0;function Cc(e){e!==gc&&null===e.next&&(null===gc?mc=gc=e:gc=gc.next=e),bc=!0,yc||(yc=!0,hf(function(){0!==(6&nl)?Q(re,Sc):kc()}))}function Ec(e,t){if(!xc&&bc){xc=!0;do{for(var n=!1,r=mc;null!==r;){if(!t)if(0!==e){var o=r.pendingLanes;if(0===o)var a=0;else{var i=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-de(42|e)+1)-1,a=201326741&(a&=o&~(i&~s))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,_c(r,a))}else a=al,0===(3&(a=be(r,r===rl?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||xe(r,a)||(n=!0,_c(r,a));r=r.next}}while(n);xc=!1}}function Sc(){kc()}function kc(){bc=yc=!1;var e=0;0!==wc&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==uf&&(uf=e,!0);return uf=null,!1}()&&(e=wc),wc=0);for(var t=te(),n=null,r=mc;null!==r;){var o=r.next,a=Rc(r,t);0===a?(r.next=null,null===n?mc=o:n.next=o,null===o&&(gc=n)):(n=r,(0!==e||0!==(3&a))&&(bc=!0)),r=o}Ec(e,!1)}function Rc(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var i=31-de(a),s=1<<i,u=o[i];-1===u?0!==(s&n)&&0===(s&r)||(o[i]=we(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}if(n=al,n=be(e,e===(t=rl)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===il||9===il)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&J(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&J(r),Ne(n)){case 2:case 8:n=oe;break;case 32:default:n=ae;break;case 268435456:n=se}return r=Ic.bind(null,e),n=Q(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&J(r),e.callbackPriority=2,e.callbackNode=null,2}function Ic(e,t){if(0!==kl&&5!==kl)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(sc()&&e.callbackNode!==n)return null;var r=al;return 0===(r=be(e,e===rl?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Ll(e,r,t),Rc(e,te()),null!=e.callbackNode&&e.callbackNode===n?Ic.bind(null,e):null)}function _c(e,t){if(sc())return null;Ll(e,t,!0)}function Nc(){return 0===wc&&(wc=Ce()),wc}function Tc(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Nt(""+e)}function Ac(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Dc=0;Dc<wr.length;Dc++){var Oc=wr[Dc];Cr(Oc.toLowerCase(),"on"+(Oc[0].toUpperCase()+Oc.slice(1)))}Cr(dr,"onAnimationEnd"),Cr(pr,"onAnimationIteration"),Cr(vr,"onAnimationStart"),Cr("dblclick","onDoubleClick"),Cr("focusin","onFocus"),Cr("focusout","onBlur"),Cr(mr,"onTransitionRun"),Cr(gr,"onTransitionStart"),Cr(yr,"onTransitionCancel"),Cr(br,"onTransitionEnd"),$e("onMouseEnter",["mouseout","mouseover"]),$e("onMouseLeave",["mouseout","mouseover"]),$e("onPointerEnter",["pointerout","pointerover"]),$e("onPointerLeave",["pointerout","pointerover"]),Xe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xe("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fc=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Mc));function Pc(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&o.isPropagationStopped())break e;a=s,o.currentTarget=l;try{a(o)}catch(c){gs(c)}o.currentTarget=null,a=u}else for(i=0;i<r.length;i++){if(u=(s=r[i]).instance,l=s.currentTarget,s=s.listener,u!==a&&o.isPropagationStopped())break e;a=s,o.currentTarget=l;try{a(o)}catch(c){gs(c)}o.currentTarget=null,a=u}}}}function Lc(e,t){var n=t[Fe];void 0===n&&(n=t[Fe]=new Set);var r=e+"__bubble";n.has(r)||(Uc(t,e,2,!1),n.add(r))}function Bc(e,t,n){var r=0;t&&(r|=4),Uc(n,e,r,t)}var zc="_reactListening"+Math.random().toString(36).slice(2);function Wc(e){if(!e[zc]){e[zc]=!0,qe.forEach(function(t){"selectionchange"!==t&&(Fc.has(t)||Bc(t,!1,e),Bc(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zc]||(t[zc]=!0,Bc("selectionchange",!1,t))}}function Uc(e,t,n,r){switch(ch(t)){case 2:var o=oh;break;case 8:o=ah;break;default:o=ih}n=o.bind(null,t,n,e),o=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Vc(e,t,n,r,o){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o)break;if(4===i)for(i=r.return;null!==i;){var l=i.tag;if((3===l||4===l)&&i.stateNode.containerInfo===o)return;i=i.return}for(;null!==s;){if(null===(i=Ue(s)))return;if(5===(l=i.tag)||6===l||26===l||27===l){r=a=i;continue e}s=s.parentNode}}r=r.return}Pt(function(){var r=a,o=At(n),i=[];e:{var s=xr.get(e);if(void 0!==s){var l=Zt,c=e;switch(e){case"keypress":if(0===Ht(n))break e;case"keydown":case"keyup":l=vn;break;case"focusin":c="focus",l=an;break;case"focusout":c="blur",l=an;break;case"beforeblur":case"afterblur":l=an;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=gn;break;case dr:case pr:case vr:l=sn;break;case br:l=yn;break;case"scroll":case"scrollend":l=tn;break;case"wheel":l=bn;break;case"copy":case"cut":case"paste":l=un;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=mn;break;case"toggle":case"beforetoggle":l=xn}var f=0!==(4&t),h=!f&&("scroll"===e||"scrollend"===e),d=f?null!==s?s+"Capture":null:s;f=[];for(var p,v=r;null!==v;){var m=v;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===d||null!=(m=Lt(v,d))&&f.push(jc(v,m,p)),h)break;v=v.return}0<f.length&&(s=new l(s,c,null,n,o),i.push({event:s,listeners:f}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Tt||!(c=n.relatedTarget||n.fromElement)||!Ue(c)&&!c[Me])&&(l||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?Ue(c):null)&&(h=u(c),f=c.tag,c!==h||5!==f&&27!==f&&6!==f)&&(c=null)):(l=null,c=r),l!==c)){if(f=rn,m="onMouseLeave",d="onMouseEnter",v="mouse","pointerout"!==e&&"pointerover"!==e||(f=mn,m="onPointerLeave",d="onPointerEnter",v="pointer"),h=null==l?s:je(l),p=null==c?s:je(c),(s=new f(m,v+"leave",l,n,o)).target=h,s.relatedTarget=p,m=null,Ue(o)===r&&((f=new f(d,v+"enter",c,n,o)).target=p,f.relatedTarget=h,m=f),h=m,l&&c)e:{for(d=c,v=0,p=f=l;p;p=Hc(p))v++;for(p=0,m=d;m;m=Hc(m))p++;for(;0<v-p;)f=Hc(f),v--;for(;0<p-v;)d=Hc(d),p--;for(;v--;){if(f===d||null!==d&&f===d.alternate)break e;f=Hc(f),d=Hc(d)}f=null}else f=null;null!==l&&qc(i,s,l,f,!1),null!==c&&null!==h&&qc(i,h,c,f,!0)}if("select"===(l=(s=r?je(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Bn;else if(Dn(s))if(zn)g=Xn;else{g=qn;var y=Hn}else!(l=s.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?r&&Rt(r.elementType)&&(g=Bn):g=Kn;switch(g&&(g=g(e,r))?On(i,g,n,o):(y&&y(e,s,r),"focusout"===e&&r&&"number"===s.type&&null!=r.memoizedProps.value&&yt(s,"number",s.value)),y=r?je(r):window,e){case"focusin":(Dn(y)||"true"===y.contentEditable)&&(rr=y,or=r,ar=null);break;case"focusout":ar=or=rr=null;break;case"mousedown":ir=!0;break;case"contextmenu":case"mouseup":case"dragend":ir=!1,sr(i,n,o);break;case"selectionchange":if(nr)break;case"keydown":case"keyup":sr(i,n,o)}var b;if(Cn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Tn?_n(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(kn&&"ko"!==n.locale&&(Tn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Tn&&(b=Gt()):(Vt="value"in(Ut=o)?Ut.value:Ut.textContent,Tn=!0)),0<(y=Gc(r,x)).length&&(x=new ln(x,e,null,n,o),i.push({event:x,listeners:y}),b?x.data=b:null!==(b=Nn(n))&&(x.data=b))),(b=Sn?function(e,t){switch(e){case"compositionend":return Nn(t);case"keypress":return 32!==t.which?null:(In=!0,Rn);case"textInput":return(e=t.data)===Rn&&In?null:e;default:return null}}(e,n):function(e,t){if(Tn)return"compositionend"===e||!Cn&&_n(e,t)?(e=Gt(),jt=Vt=Ut=null,Tn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return kn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=Gc(r,"onBeforeInput")).length&&(y=new ln("onBeforeInput","beforeinput",null,n,o),i.push({event:y,listeners:x}),y.data=b)),function(e,t,n,r,o){if("submit"===t&&n&&n.stateNode===o){var a=Tc((o[Oe]||null).action),i=r.submitter;i&&null!==(t=(t=i[Oe]||null)?Tc(t.formAction):i.getAttribute("formAction"))&&(a=t,i=null);var s=new Zt("action","action",null,r,o);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==wc){var e=i?Ac(o,i):new FormData(o);Ai(n,{pending:!0,data:e,method:o.method,action:a},null,e)}}else"function"===typeof a&&(s.preventDefault(),e=i?Ac(o,i):new FormData(o),Ai(n,{pending:!0,data:e,method:o.method,action:a},a,e))},currentTarget:o}]})}}(i,e,r,n,o)}Pc(i,t)})}function jc(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gc(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;if(5!==(o=o.tag)&&26!==o&&27!==o||null===a||(null!=(o=Lt(e,n))&&r.unshift(jc(e,o,a)),null!=(o=Lt(e,t))&&r.push(jc(e,o,a))),3===e.tag)return r;e=e.return}return[]}function Hc(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function qc(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(s=s.tag,null!==u&&u===r)break;5!==s&&26!==s&&27!==s||null===l||(u=l,o?null!=(l=Lt(n,a))&&i.unshift(jc(n,l,u)):o||null!=(l=Lt(n,a))&&i.push(jc(n,l,u))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Kc=/\r\n?/g,Xc=/\u0000|\uFFFD/g;function $c(e){return("string"===typeof e?e:""+e).replace(Kc,"\n").replace(Xc,"")}function Yc(e,t){return t=$c(t),$c(e)===t}function Qc(){}function Jc(e,t,n,r,o,a){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||Ct(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&Ct(e,""+r);break;case"className":nt(e,"class",r);break;case"tabIndex":nt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,r);break;case"style":kt(e,r,a);break;case"data":if("object"!==t){nt(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Nt(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof a&&("formAction"===n?("input"!==t&&Jc(e,t,"name",o.name,o,null),Jc(e,t,"formEncType",o.formEncType,o,null),Jc(e,t,"formMethod",o.formMethod,o,null),Jc(e,t,"formTarget",o.formTarget,o,null)):(Jc(e,t,"encType",o.encType,o,null),Jc(e,t,"method",o.method,o,null),Jc(e,t,"target",o.target,o,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Nt(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Qc);break;case"onScroll":null!=r&&Lc("scroll",e);break;case"onScrollEnd":null!=r&&Lc("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(i(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=Nt(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Lc("beforetoggle",e),Lc("toggle",e),tt(e,"popover",r);break;case"xlinkActuate":rt(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":rt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":rt(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":rt(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":rt(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":rt(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":rt(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":rt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":rt(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":tt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=It.get(n)||n,r)}}function Zc(e,t,n,r,o,a){switch(n){case"style":kt(e,r,a);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(i(60));e.innerHTML=n}}break;case"children":"string"===typeof r?Ct(e,r):("number"===typeof r||"bigint"===typeof r)&&Ct(e,""+r);break;case"onScroll":null!=r&&Lc("scroll",e);break;case"onScrollEnd":null!=r&&Lc("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Qc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ke.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(o=n.endsWith("Capture"),t=n.slice(2,o?n.length-7:void 0),"function"===typeof(a=null!=(a=e[Oe]||null)?a[n]:null)&&e.removeEventListener(t,a,o),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):tt(e,n,r):("function"!==typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,o)))}}function ef(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Lc("error",e),Lc("load",e);var r,o=!1,a=!1;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(null!=s)switch(r){case"src":o=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:Jc(e,t,r,s,n,null)}}return a&&Jc(e,t,"srcSet",n.srcSet,n,null),void(o&&Jc(e,t,"src",n.src,n,null));case"input":Lc("invalid",e);var u=r=s=a=null,l=null,c=null;for(o in n)if(n.hasOwnProperty(o)){var f=n[o];if(null!=f)switch(o){case"name":a=f;break;case"type":s=f;break;case"checked":l=f;break;case"defaultChecked":c=f;break;case"value":r=f;break;case"defaultValue":u=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(i(137,t));break;default:Jc(e,t,o,f,n,null)}}return gt(e,r,u,l,c,s,a,!1),void ft(e);case"select":for(a in Lc("invalid",e),o=s=r=null,n)if(n.hasOwnProperty(a)&&null!=(u=n[a]))switch(a){case"value":r=u;break;case"defaultValue":s=u;break;case"multiple":o=u;default:Jc(e,t,a,u,n,null)}return t=r,n=s,e.multiple=!!o,void(null!=t?bt(e,!!o,t,!1):null!=n&&bt(e,!!o,n,!0));case"textarea":for(s in Lc("invalid",e),r=a=o=null,n)if(n.hasOwnProperty(s)&&null!=(u=n[s]))switch(s){case"value":o=u;break;case"defaultValue":a=u;break;case"children":r=u;break;case"dangerouslySetInnerHTML":if(null!=u)throw Error(i(91));break;default:Jc(e,t,s,u,n,null)}return wt(e,o,a,r),void ft(e);case"option":for(l in n)if(n.hasOwnProperty(l)&&null!=(o=n[l]))if("selected"===l)e.selected=o&&"function"!==typeof o&&"symbol"!==typeof o;else Jc(e,t,l,o,n,null);return;case"dialog":Lc("beforetoggle",e),Lc("toggle",e),Lc("cancel",e),Lc("close",e);break;case"iframe":case"object":Lc("load",e);break;case"video":case"audio":for(o=0;o<Mc.length;o++)Lc(Mc[o],e);break;case"image":Lc("error",e),Lc("load",e);break;case"details":Lc("toggle",e);break;case"embed":case"source":case"link":Lc("error",e),Lc("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&null!=(o=n[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:Jc(e,t,c,o,n,null)}return;default:if(Rt(t)){for(f in n)n.hasOwnProperty(f)&&(void 0!==(o=n[f])&&Zc(e,t,f,o,n,void 0));return}}for(u in n)n.hasOwnProperty(u)&&(null!=(o=n[u])&&Jc(e,t,u,o,n,null))}var tf=null,nf=null;function rf(e){return 9===e.nodeType?e:e.ownerDocument}function of(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function af(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function sf(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var uf=null;var lf="function"===typeof setTimeout?setTimeout:void 0,cf="function"===typeof clearTimeout?clearTimeout:void 0,ff="function"===typeof Promise?Promise:void 0,hf="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ff?function(e){return ff.resolve(null).then(e).catch(df)}:lf;function df(e){setTimeout(function(){throw e})}function pf(e){return"head"===e}function vf(e,t){var n=t,r=0,o=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0<r&&8>r){n=r;var i=e.ownerDocument;if(1&n&&Cf(i.documentElement),2&n&&Cf(i.body),4&n)for(Cf(n=i.head),i=n.firstChild;i;){var s=i.nextSibling,u=i.nodeName;i[ze]||"SCRIPT"===u||"STYLE"===u||"LINK"===u&&"stylesheet"===i.rel.toLowerCase()||n.removeChild(i),i=s}}if(0===o)return e.removeChild(a),void _h(t);o--}else"$"===n||"$?"===n||"$!"===n?o++:r=n.charCodeAt(0)-48;else r=0;n=a}while(n);_h(t)}function mf(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":mf(n),We(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gf(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function yf(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var bf=null;function xf(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function wf(e,t,n){switch(t=rf(n),e){case"html":if(!(e=t.documentElement))throw Error(i(452));return e;case"head":if(!(e=t.head))throw Error(i(453));return e;case"body":if(!(e=t.body))throw Error(i(454));return e;default:throw Error(i(451))}}function Cf(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);We(e)}var Ef=new Map,Sf=new Set;function kf(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Rf=F.d;F.d={f:function(){var e=Rf.f(),t=Ul();return e||t},r:function(e){var t=Ve(e);null!==t&&5===t.tag&&"form"===t.type?Oi(t):Rf.r(e)},D:function(e){Rf.D(e),_f("dns-prefetch",e,null)},C:function(e,t){Rf.C(e,t),_f("preconnect",e,t)},L:function(e,t,n){Rf.L(e,t,n);var r=If;if(r&&e&&t){var o='link[rel="preload"][as="'+vt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(o+='[imagesrcset="'+vt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(o+='[imagesizes="'+vt(n.imageSizes)+'"]')):o+='[href="'+vt(e)+'"]';var a=o;switch(t){case"style":a=Tf(e);break;case"script":a=Of(e)}Ef.has(a)||(e=h({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Ef.set(a,e),null!==r.querySelector(o)||"style"===t&&r.querySelector(Af(a))||"script"===t&&r.querySelector(Mf(a))||(ef(t=r.createElement("link"),"link",e),He(t),r.head.appendChild(t)))}},m:function(e,t){Rf.m(e,t);var n=If;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",o='link[rel="modulepreload"][as="'+vt(r)+'"][href="'+vt(e)+'"]',a=o;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=Of(e)}if(!Ef.has(a)&&(e=h({rel:"modulepreload",href:e},t),Ef.set(a,e),null===n.querySelector(o))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Mf(a)))return}ef(r=n.createElement("link"),"link",e),He(r),n.head.appendChild(r)}}},X:function(e,t){Rf.X(e,t);var n=If;if(n&&e){var r=Ge(n).hoistableScripts,o=Of(e),a=r.get(o);a||((a=n.querySelector(Mf(o)))||(e=h({src:e,async:!0},t),(t=Ef.get(o))&&Bf(e,t),He(a=n.createElement("script")),ef(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}},S:function(e,t,n){Rf.S(e,t,n);var r=If;if(r&&e){var o=Ge(r).hoistableStyles,a=Tf(e);t=t||"default";var i=o.get(a);if(!i){var s={loading:0,preload:null};if(i=r.querySelector(Af(a)))s.loading=5;else{e=h({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Ef.get(a))&&Lf(e,n);var u=i=r.createElement("link");He(u),ef(u,"link",e),u._p=new Promise(function(e,t){u.onload=e,u.onerror=t}),u.addEventListener("load",function(){s.loading|=1}),u.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Pf(i,t,r)}i={type:"stylesheet",instance:i,count:1,state:s},o.set(a,i)}}},M:function(e,t){Rf.M(e,t);var n=If;if(n&&e){var r=Ge(n).hoistableScripts,o=Of(e),a=r.get(o);a||((a=n.querySelector(Mf(o)))||(e=h({src:e,async:!0,type:"module"},t),(t=Ef.get(o))&&Bf(e,t),He(a=n.createElement("script")),ef(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}}};var If="undefined"===typeof document?null:document;function _f(e,t,n){var r=If;if(r&&"string"===typeof t&&t){var o=vt(t);o='link[rel="'+e+'"][href="'+o+'"]',"string"===typeof n&&(o+='[crossorigin="'+n+'"]'),Sf.has(o)||(Sf.add(o),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(o)&&(ef(t=r.createElement("link"),"link",e),He(t),r.head.appendChild(t)))}}function Nf(e,t,n,r){var o,a,s,u,l=(l=G.current)?kf(l):null;if(!l)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Tf(n.href),(r=(n=Ge(l).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Tf(n.href);var c=Ge(l).hoistableStyles,f=c.get(e);if(f||(l=l.ownerDocument||l,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,f),(c=l.querySelector(Af(e)))&&!c._p&&(f.instance=c,f.state.loading=5),Ef.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Ef.set(e,n),c||(o=l,a=e,s=n,u=f.state,o.querySelector('link[rel="preload"][as="style"]['+a+"]")?u.loading=1:(a=o.createElement("link"),u.preload=a,a.addEventListener("load",function(){return u.loading|=1}),a.addEventListener("error",function(){return u.loading|=2}),ef(a,"link",s),He(a),o.head.appendChild(a))))),t&&null===r)throw Error(i(528,""));return f}if(t&&null!==r)throw Error(i(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Of(n),(r=(n=Ge(l).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Tf(e){return'href="'+vt(e)+'"'}function Af(e){return'link[rel="stylesheet"]['+e+"]"}function Df(e){return h({},e,{"data-precedence":e.precedence,precedence:null})}function Of(e){return'[src="'+vt(e)+'"]'}function Mf(e){return"script[async]"+e}function Ff(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+vt(n.href)+'"]');if(r)return t.instance=r,He(r),r;var o=h({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return He(r=(e.ownerDocument||e).createElement("style")),ef(r,"style",o),Pf(r,n.precedence,e),t.instance=r;case"stylesheet":o=Tf(n.href);var a=e.querySelector(Af(o));if(a)return t.state.loading|=4,t.instance=a,He(a),a;r=Df(n),(o=Ef.get(o))&&Lf(r,o),He(a=(e.ownerDocument||e).createElement("link"));var s=a;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),ef(a,"link",r),t.state.loading|=4,Pf(a,n.precedence,e),t.instance=a;case"script":return a=Of(n.src),(o=e.querySelector(Mf(a)))?(t.instance=o,He(o),o):(r=n,(o=Ef.get(a))&&Bf(r=h({},n),o),He(o=(e=e.ownerDocument||e).createElement("script")),ef(o,"link",r),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(i(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Pf(r,n.precedence,e));return t.instance}function Pf(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=r.length?r[r.length-1]:null,a=o,i=0;i<r.length;i++){var s=r[i];if(s.dataset.precedence===t)a=s;else if(a!==o)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Lf(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Bf(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var zf=null;function Wf(e,t,n){if(null===zf){var r=new Map,o=zf=new Map;o.set(n,r)}else(r=(o=zf).get(n))||(r=new Map,o.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),o=0;o<n.length;o++){var a=n[o];if(!(a[ze]||a[De]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var i=a.getAttribute(t)||"";i=e+i;var s=r.get(i);s?s.push(a):r.set(i,[a])}}return r}function Uf(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Vf(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var jf=null;function Gf(){}function Hf(){if(this.count--,0===this.count)if(this.stylesheets)Kf(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var qf=null;function Kf(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,qf=new Map,t.forEach(Xf,e),qf=null,Hf.call(e))}function Xf(e,t){if(!(4&t.state.loading)){var n=qf.get(e);if(n)var r=n.get(null);else{n=new Map,qf.set(e,n);for(var o=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<o.length;a++){var i=o[a];"LINK"!==i.nodeName&&"not all"===i.getAttribute("media")||(n.set(i.dataset.precedence,i),r=i)}r&&n.set(null,r)}i=(o=t.instance).getAttribute("data-precedence"),(a=n.get(i)||r)===r&&n.set(null,o),n.set(i,o),this.count++,r=Hf.bind(this),o.addEventListener("load",r),o.addEventListener("error",r),a?a.parentNode.insertBefore(o,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(o,e.firstChild),t.state.loading|=4}}var $f={$$typeof:w,Provider:null,Consumer:null,_currentValue:P,_currentValue2:P,_threadCount:0};function Yf(e,t,n,r,o,a,i,s){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Se(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Se(0),this.hiddenUpdates=Se(null),this.identifierPrefix=r,this.onUncaughtError=o,this.onCaughtError=a,this.onRecoverableError=i,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function Qf(e,t,n,r,o,a,i,s,u,l,c,f){return e=new Yf(e,t,n,i,s,u,l,f),t=1,!0===a&&(t|=24),a=Pr(3,null,null,t),e.current=a,a.stateNode=e,(t=Mo()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},ra(a),e}function Jf(e){return e?e=Mr:Mr}function Zf(e,t,n,r,o,a){o=Jf(o),null===r.context?r.context=o:r.pendingContext=o,(r=aa(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=ia(e,r,t))&&(Pl(n,0,t),sa(n,e,t))}function eh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function th(e,t){eh(e,t),(e=e.alternate)&&eh(e,t)}function nh(e){if(13===e.tag){var t=Ar(e,67108864);null!==t&&Pl(t,0,67108864),th(e,67108864)}}var rh=!0;function oh(e,t,n,r){var o=M.T;M.T=null;var a=F.p;try{F.p=2,ih(e,t,n,r)}finally{F.p=a,M.T=o}}function ah(e,t,n,r){var o=M.T;M.T=null;var a=F.p;try{F.p=8,ih(e,t,n,r)}finally{F.p=a,M.T=o}}function ih(e,t,n,r){if(rh){var o=sh(r);if(null===o)Vc(e,t,r,uh,n),bh(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return hh=xh(hh,e,t,n,r,o),!0;case"dragenter":return dh=xh(dh,e,t,n,r,o),!0;case"mouseover":return ph=xh(ph,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return vh.set(a,xh(vh.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,mh.set(a,xh(mh.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(bh(e,r),4&t&&-1<yh.indexOf(e)){for(;null!==o;){var a=Ve(o);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var i=ye(a.pendingLanes);if(0!==i){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;i;){var u=1<<31-de(i);s.entanglements[1]|=u,i&=~u}Cc(a),0===(6&nl)&&(Cl=te()+500,Ec(0,!1))}}break;case 13:null!==(s=Ar(a,2))&&Pl(s,0,2),Ul(),th(a,2)}if(null===(a=sh(r))&&Vc(e,t,r,uh,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Vc(e,t,r,null,n)}}function sh(e){return lh(e=At(e))}var uh=null;function lh(e){if(uh=null,null!==(e=Ue(e))){var t=u(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=l(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return uh=e,null}function ch(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case re:return 2;case oe:return 8;case ae:case ie:return 32;case se:return 268435456;default:return 32}default:return 32}}var fh=!1,hh=null,dh=null,ph=null,vh=new Map,mh=new Map,gh=[],yh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bh(e,t){switch(e){case"focusin":case"focusout":hh=null;break;case"dragenter":case"dragleave":dh=null;break;case"mouseover":case"mouseout":ph=null;break;case"pointerover":case"pointerout":vh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":mh.delete(t.pointerId)}}function xh(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=Ve(t))&&nh(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function wh(e){var t=Ue(e.target);if(null!==t){var n=u(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=l(n)))return e.blockedOn=t,void function(e,t){var n=F.p;try{return F.p=e,t()}finally{F.p=n}}(e.priority,function(){if(13===n.tag){var e=Ml();e=_e(e);var t=Ar(n,e);null!==t&&Pl(t,0,e),th(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ch(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=sh(e.nativeEvent);if(null!==n)return null!==(t=Ve(n))&&nh(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Tt=r,n.target.dispatchEvent(r),Tt=null,t.shift()}return!0}function Eh(e,t,n){Ch(e)&&n.delete(t)}function Sh(){fh=!1,null!==hh&&Ch(hh)&&(hh=null),null!==dh&&Ch(dh)&&(dh=null),null!==ph&&Ch(ph)&&(ph=null),vh.forEach(Eh),mh.forEach(Eh)}function kh(e,t){e.blockedOn===t&&(e.blockedOn=null,fh||(fh=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Sh)))}var Rh=null;function Ih(e){Rh!==e&&(Rh=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Rh===e&&(Rh=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],o=e[t+2];if("function"!==typeof r){if(null===lh(r||n))continue;break}var a=Ve(n);null!==a&&(e.splice(t,3),t-=3,Ai(a,{pending:!0,data:o,method:n.method,action:r},r,o))}}))}function _h(e){function t(t){return kh(t,e)}null!==hh&&kh(hh,e),null!==dh&&kh(dh,e),null!==ph&&kh(ph,e),vh.forEach(t),mh.forEach(t);for(var n=0;n<gh.length;n++){var r=gh[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<gh.length&&null===(n=gh[0]).blockedOn;)wh(n),null===n.blockedOn&&gh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var o=n[r],a=n[r+1],i=o[Oe]||null;if("function"===typeof a)i||Ih(n);else if(i){var s=null;if(a&&a.hasAttribute("formAction")){if(o=a,i=a[Oe]||null)s=i.formAction;else if(null!==lh(o))continue}else s=i.action;"function"===typeof s?n[r+1]=s:(n.splice(r,3),r-=3),Ih(n)}}}function Nh(e){this._internalRoot=e}function Th(e){this._internalRoot=e}Th.prototype.render=Nh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Zf(t.current,Ml(),e,t,null,null)},Th.prototype.unmount=Nh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Zf(e.current,2,null,e,null,null),Ul(),t[Me]=null}},Th.prototype.unstable_scheduleHydration=function(e){if(e){var t=Te();e={blockedOn:null,target:e,priority:t};for(var n=0;n<gh.length&&0!==t&&t<gh[n].priority;n++);gh.splice(n,0,e),0===n&&wh(e)}};var Ah=o.version;if("19.1.1"!==Ah)throw Error(i(527,Ah,"19.1.1"));F.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=u(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return c(o),e;if(a===r)return c(o),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=o,r=a;else{for(var s=!1,l=o.child;l;){if(l===n){s=!0,n=o,r=a;break}if(l===r){s=!0,r=o,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,r=o;break}if(l===r){s=!0,r=a,n=o;break}l=l.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?f(e):null)?null:e.stateNode};var Dh={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:M,reconcilerVersion:"19.1.1"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Oh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Oh.isDisabled&&Oh.supportsFiber)try{ce=Oh.inject(Dh),fe=Oh}catch(Fh){}}t.createRoot=function(e,t){if(!s(e))throw Error(i(299));var n=!1,r="",o=ys,a=bs,u=xs;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(u=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Qf(e,1,!1,null,0,n,r,o,a,u,0,null),e[Me]=t.current,Wc(e),new Nh(t)}},29:function(e,t,n){var r;r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),o=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)},i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function s(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(n,r){t.call(navigator,e,n,r)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.requestUserMediaId=0,n.unmounted=!1,n.state={hasUserMedia:!1},n}return o(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;this.unmounted=!1,s()?(e.hasUserMedia||this.requestUserMedia(),t.children&&"function"!=typeof t.children&&console.warn("children must be a function")):t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(s()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),o=e.minScreenshotWidth!==t.minScreenshotWidth,a=e.minScreenshotHeight!==t.minScreenshotHeight;(r||o||a)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var r=this.getCanvas(e);return r&&r.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var r=this.video.videoWidth,o=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var a=r/o;o=(r=n.minScreenshotWidth||this.video.clientWidth)/a,n.minScreenshotHeight&&o<n.minScreenshotHeight&&(r=(o=n.minScreenshotHeight)*a)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||r,this.canvas.height=(null===e||void 0===e?void 0:e.height)||o,this.ctx=this.canvas.getContext("2d")}var i=this.ctx,s=this.canvas;return i&&s&&(s.width=(null===e||void 0===e?void 0:e.width)||s.width,s.height=(null===e||void 0===e?void 0:e.height)||s.height,n.mirrored&&(i.translate(s.width,0),i.scale(-1,1)),i.imageSmoothingEnabled=n.imageSmoothing,i.drawImage(this.video,0,0,(null===e||void 0===e?void 0:e.width)||s.width,(null===e||void 0===e?void 0:e.height)||s.height),n.mirrored&&(i.scale(-1,1),i.translate(-s.width,0))),s},t.prototype.requestUserMedia=function(){var e=this,n=this.props,r=function(r,o){var a={video:"undefined"===typeof o||o};n.audio&&(a.audio="undefined"===typeof r||r),e.requestUserMediaId++;var i=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(a).then(function(n){e.unmounted||i!==e.requestUserMediaId?t.stopMediaStream(n):e.handleUserMedia(null,n)}).catch(function(t){e.handleUserMedia(t)})};if("mediaDevices"in navigator)r(n.audioConstraints,n.videoConstraints);else{var o=function(e){return{optional:[{sourceId:e}]}},a=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources(function(e){var t=null,i=null;e.forEach(function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(i=e.id)});var s=a(n.audioConstraints);s&&(t=s);var u=a(n.videoConstraints);u&&(i=u),r(o(t),o(i))})}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(r){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,o=n.audio,s=(n.forceScreenshotSourceSize,n.disablePictureInPicture),u=(n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),l=n.style,c=void 0===l?{}:l,f=n.children,h=i(n,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),d=u?a(a({},c),{transform:(c.transform||"")+" scaleX(-1)"}):c,p={getScreenshot:this.getScreenshot.bind(this)};return r.createElement(r.Fragment,null,r.createElement("video",a({autoPlay:!0,disablePictureInPicture:s,src:t.src,muted:!o,playsInline:!0,ref:function(t){e.video=t},style:d},h)),f&&f(p))},t.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(r.Component);t.default=u},react:function(t,n){t.exports=e}}).default},e.exports=r(n(43))},43:(e,t,n)=>{"use strict";e.exports=n(288)},184:()=>{},288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),d=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,v(x,g.prototype),x.isPureReactComponent=!0;var w=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},E=Object.prototype.hasOwnProperty;function S(e,t,r,o,a,i){return r=i.ref,{$$typeof:n,type:e,key:t,ref:void 0!==r?r:null,props:i}}function k(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function _(){}function N(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u,l,c=!1;if(null===e)c=!0;else switch(s){case"bigint":case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0;break;case h:return N((c=e._init)(e._payload),t,o,a,i)}}if(c)return i=i(e),c=""===a?"."+I(e,0):a,w(i)?(o="",null!=c&&(o=c.replace(R,"$&/")+"/"),N(i,t,o,"",function(e){return e})):null!=i&&(k(i)&&(u=i,l=o+(null==i.key||e&&e.key===i.key?"":(""+i.key).replace(R,"$&/")+"/")+c,i=S(u.type,l,void 0,0,0,u.props)),t.push(i)),1;c=0;var f,p=""===a?".":a+":";if(w(e))for(var v=0;v<e.length;v++)c+=N(a=e[v],t,o,s=p+I(a,v),i);else if("function"===typeof(v=null===(f=e)||"object"!==typeof f?null:"function"===typeof(f=d&&f[d]||f["@@iterator"])?f:null))for(e=v.call(e),v=0;!(a=e.next()).done;)c+=N(a=a.value,t,o,s=p+I(a,v++),i);else if("object"===s){if("function"===typeof e.then)return N(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(_,_):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,o,a,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return c}function T(e,t,n){if(null==e)return e;var r=[],o=0;return N(e,r,"","",function(e){return t.call(n,e,o++)}),r}function A(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function O(){}t.Children={map:T,forEach:function(e,t,n){T(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return T(e,function(){t++}),t},toArray:function(e){return T(e,function(e){return e})||[]},only:function(e){if(!k(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=o,t.Profiler=i,t.PureComponent=b,t.StrictMode=a,t.Suspense=c,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return C.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=v({},e.props),o=e.key;if(null!=t)for(a in void 0!==t.ref&&void 0,void 0!==t.key&&(o=""+t.key),t)!E.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var i=Array(a),s=0;s<a;s++)i[s]=arguments[s+2];r.children=i}return S(e.type,o,void 0,0,0,r)},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var r,o={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)E.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(o[r]=t[r]);var i=arguments.length-2;if(1===i)o.children=n;else if(1<i){for(var s=Array(i),u=0;u<i;u++)s[u]=arguments[u+2];o.children=s}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===o[r]&&(o[r]=i[r]);return S(e,a,void 0,0,0,o)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=C.T,n={};C.T=n;try{var r=e(),o=C.S;null!==o&&o(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(O,D)}catch(a){D(a)}finally{C.T=t}},t.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},t.use=function(e){return C.H.use(e)},t.useActionState=function(e,t,n){return C.H.useActionState(e,t,n)},t.useCallback=function(e,t){return C.H.useCallback(e,t)},t.useContext=function(e){return C.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return C.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var r=C.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},t.useId=function(){return C.H.useId()},t.useImperativeHandle=function(e,t,n){return C.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return C.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return C.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return C.H.useMemo(e,t)},t.useOptimistic=function(e,t){return C.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return C.H.useReducer(e,t,n)},t.useRef=function(e){return C.H.useRef(e)},t.useState=function(e){return C.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return C.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return C.H.useTransition()},t.version="19.1.1"},367:()=>{},391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},531:()=>{},579:(e,t,n)=>{"use strict";e.exports=n(799)},672:(e,t,n)=>{"use strict";var r=n(43);function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var i={d:{f:a,r:function(){throw Error(o(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},s=Symbol.for("react.portal");var u=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(o(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=u.T,n=i.p;try{if(u.T=null,i.p=2,e)return e()}finally{u.T=t,i.p=n,i.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,i.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&i.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin),o="string"===typeof t.integrity?t.integrity:void 0,a="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?i.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:o,fetchPriority:a}):"script"===n&&i.d.X(e,{crossOrigin:r,integrity:o,fetchPriority:a,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);i.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&i.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin);i.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=l(t.as,t.crossOrigin);i.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else i.d.m(e)},t.requestFormReset=function(e){i.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return u.H.useFormState(e,t,n)},t.useFormStatus=function(){return u.H.useHostTransitionStatus()},t.version="19.1.1"},799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element");function r(e,t,r){var o=null;if(void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),"key"in t)for(var a in r={},t)"key"!==a&&(r[a]=t[a]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:o,ref:void 0!==t?t:null,props:r}}Symbol.for("react.fragment"),t.jsx=r,t.jsxs=r},853:(e,t,n)=>{"use strict";e.exports=n(896)},896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>a(u,n))l<o&&0>a(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<o&&0>a(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],f=1,h=null,d=3,p=!1,v=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(c);null!==t;){if(null===t.callback)o(c);else{if(!(t.startTime<=e))break;o(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function C(e){if(m=!1,w(e),!v)if(null!==r(l))v=!0,S||(S=!0,E());else{var t=r(c);null!==t&&D(C,t.startTime-e)}}var E,S=!1,k=-1,R=5,I=-1;function _(){return!!g||!(t.unstable_now()-I<R)}function N(){if(g=!1,S){var e=t.unstable_now();I=e;var n=!0;try{e:{v=!1,m&&(m=!1,b(k),k=-1),p=!0;var a=d;try{t:{for(w(e),h=r(l);null!==h&&!(h.expirationTime>e&&_());){var i=h.callback;if("function"===typeof i){h.callback=null,d=h.priorityLevel;var s=i(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){h.callback=s,w(e),n=!0;break t}h===r(l)&&o(l),w(e)}else o(l);h=r(l)}if(null!==h)n=!0;else{var u=r(c);null!==u&&D(C,u.startTime-e),n=!1}}break e}finally{h=null,d=a,p=!1}n=void 0}}finally{n?E():S=!1}}}if("function"===typeof x)E=function(){x(N)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,A=T.port2;T.port1.onmessage=N,E=function(){A.postMessage(null)}}else E=function(){y(N,0)};function D(e,n){k=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_requestPaint=function(){g=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:f++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(c,e),null===r(l)&&e===r(c)&&(m?(b(k),k=-1):m=!0,D(C,a-i))):(e.sortIndex=s,n(l,e),v||p||(v=!0,S||(S=!0,E()))),e},t.unstable_shouldYield=_,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{AnchorPosition:()=>lk,DrawBox:()=>mk,DrawBoxOptions:()=>vk,DrawTextField:()=>pk,DrawTextFieldOptions:()=>dk});var t={};n.r(t),n.d(t,{DrawFaceLandmarks:()=>ER,DrawFaceLandmarksOptions:()=>CR,drawContour:()=>Jk,drawDetections:()=>nR,drawFaceExpressions:()=>gR,drawFaceLandmarks:()=>SR});var r=n(43),o=n(391);const a=[{id:"tired_dramatic",mood:"Tired but dramatic",emoji:"\ud83d\ude35\u200d\ud83d\udcab",suggestions:[{title:"Maggi \xe0 la Chocolate",desc:"Instant noodles drenched in chocolate sauce. Comfort meets dramatic flair.",img:"https://images.unsplash.com/photo-1604908177522-3a3a2f3a07b1?auto=format&fit=crop&w=800&q=60",chaos:8},{title:"Sleepy Caramel Toast",desc:"Buttered toast with caramel drizzle and a sprinkle of instant coffee.",img:"https://images.unsplash.com/photo-1551218808-94e220e084d2?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Cotton Candy Soup",desc:"Hot chicken broth with cotton candy dissolving into sweet confusion.",img:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?auto=format&fit=crop&w=800&q=60",chaos:9},{title:"Gummy Bear Omelette",desc:"Fluffy eggs with melted gummy bears creating fruity pockets of weirdness.",img:"https://images.unsplash.com/photo-1525351484163-7529414344d8?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Dorito Crusted Fish Fingers",desc:"Fish sticks coated in crushed Doritos because why not double the orange?",img:"https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=800&q=60",chaos:6}]},{id:"productively_lazy",mood:"Productively lazy",emoji:"\ud83e\udd71",suggestions:[{title:"Microwave Pizza With Honey",desc:"Microwaved pizza slice + honey. Efficient & questionable.",img:"https://images.unsplash.com/photo-1548365328-8a8e3c2fa56f?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Cereal & Masala Powder",desc:"Cereal, milk, and a dash of masala for *energy* (maybe).",img:"https://images.unsplash.com/photo-1498804103079-a6351b050096?auto=format&fit=crop&w=800&q=60",chaos:5},{title:"Instant Ramen Smoothie",desc:"Blend cooked ramen with fruit juice. Liquid lunch taken literally.",img:"https://images.unsplash.com/photo-1553979459-d2229ba7433a?auto=format&fit=crop&w=800&q=60",chaos:8},{title:"Cookie Dough Burrito",desc:"Raw cookie dough wrapped in a tortilla with chocolate chips.",img:"https://images.unsplash.com/photo-1578985545062-69928b1d9587?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Energy Drink Jello Shots",desc:"Non-alcoholic jello made with energy drinks. Bouncy caffeine delivery.",img:"https://images.unsplash.com/photo-1544787219-7f47ccb76574?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Pickle Juice Ice Cubes",desc:"Frozen pickle juice cubes in your regular drink. Salty surprise every sip.",img:"https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?auto=format&fit=crop&w=800&q=60",chaos:5}]},{id:"angry_hungry",mood:"Angry but hungry",emoji:"\ud83d\ude24",suggestions:[{title:"Spicy Chocolate Curry",desc:"Chocolate + curry powder over rice \u2014 rage on a plate.",img:"https://images.unsplash.com/photo-1604908177563-5e1c7b7c3d7f?auto=format&fit=crop&w=800&q=60",chaos:9},{title:"Wasabi Ice Cream Sandwich",desc:"Sweet, cold, and aggressively nasal.",img:"https://images.unsplash.com/photo-1542362567-b07e54358753?auto=format&fit=crop&w=800&q=60",chaos:10},{title:"Ghost Pepper Mac and Cheese",desc:"Creamy comfort food with enough heat to make you question life choices.",img:"https://images.unsplash.com/photo-1559847844-5315695dadae?auto=format&fit=crop&w=800&q=60",chaos:10},{title:"Sriracha Cereal Bowl",desc:"Your favorite breakfast cereal swimming in sriracha instead of milk.",img:"https://images.unsplash.com/photo-1517686469429-8bdb88b9f907?auto=format&fit=crop&w=800&q=60",chaos:8},{title:"Jalape\xf1o Cotton Candy",desc:"Spun sugar infused with jalape\xf1o extract. Sweet burn in every bite.",img:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Carolina Reaper Yogurt",desc:"Creamy yogurt meets the world's hottest pepper. Cool down? Think again.",img:"https://images.unsplash.com/photo-1571212515416-eb2c0934c87b?auto=format&fit=crop&w=800&q=60",chaos:10}]},{id:"peaceful_chaotic",mood:"Peacefully chaotic",emoji:"\ud83d\ude0c",suggestions:[{title:"Green Tea Jelly with Samosa Crumbs",desc:"Serene tea flavors with crunchy chaos.",img:"https://images.unsplash.com/photo-1559628235-ec3d9f29a1d8?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Cucumber Ice Cream Toast",desc:"Cool cucumber notes on hot toast. Surprisingly balanced?",img:"https://images.unsplash.com/photo-1499636136210-6f4ee915583e?auto=format&fit=crop&w=800&q=60",chaos:4},{title:"Lavender Fish Tacos",desc:"Zen vibes meet Mexican cuisine with floral fish tacos that shouldn't work but do.",img:"https://images.unsplash.com/photo-1565299585323-38174c8a9977?auto=format&fit=crop&w=800&q=60",chaos:5},{title:"Matcha Spaghetti",desc:"Green tea powder mixed into pasta for an oddly calming carb experience.",img:"https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Rose Water Meatballs",desc:"Traditional meatballs infused with rose water. Floral protein confusion.",img:"https://images.unsplash.com/photo-1529042410759-befb1204b468?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Chamomile Fried Rice",desc:"Peaceful chamomile tea brewed rice with vegetables. Sleep-inducing stir fry.",img:"https://images.unsplash.com/photo-1603133872878-684f208fb84b?auto=format&fit=crop&w=800&q=60",chaos:4}]},{id:"single_and_starving",mood:"Single and starving",emoji:"\ud83e\udd79",suggestions:[{title:"Ramen Mug Cake",desc:"Noodles + cake in one mug. For emotional efficiency.",img:"https://images.unsplash.com/photo-1604908177554-c5e0ef8f4b8f?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Chocolate Butter Chapati",desc:"Wrap your sadness in butter and cocoa.",img:"https://images.unsplash.com/photo-1551782450-a2132b4ba21d?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Ice Cream Sandwich Grilled Cheese",desc:"Two slices of bread with ice cream in between, grilled like a sandwich. Hot, cold, confused.",img:"https://images.unsplash.com/photo-1528736235302-52922df5c122?auto=format&fit=crop&w=800&q=60",chaos:8},{title:"Cereal Milk Cocktail",desc:"Non-alcoholic drink made from leftover cereal milk with fruit garnish. Childhood in a glass.",img:"https://images.unsplash.com/photo-1544737151156-6e4737518e38?auto=format&fit=crop&w=800&q=60",chaos:5},{title:"Marshmallow Sushi",desc:"Rice crispy treats shaped like sushi with fruit leather 'fish'. Sweet deception.",img:"https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Peanut Butter Pickle Sandwich",desc:"The classic weird combo that somehow works. Salty, sweet, crunchy confusion.",img:"https://images.unsplash.com/photo-1528736235302-52922df5c122?auto=format&fit=crop&w=800&q=60",chaos:7}]},{id:"chaotically_creative",mood:"Chaotically creative",emoji:"\ud83c\udfa8",suggestions:[{title:"Paint Palette Pancakes",desc:"Rainbow pancakes with edible paint made from natural food coloring. Art you can eat.",img:"https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Backwards Burger",desc:"Burger with the bun on the inside and meat on the outside. Logic not included.",img:"https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=800&q=60",chaos:8},{title:"Alphabet Soup Pizza",desc:"Pizza topped with alphabet pasta spelling random words. Edible literature.",img:"https://images.unsplash.com/photo-1574071318508-1cdbab80d002?auto=format&fit=crop&w=800&q=60",chaos:7}]},{id:"nostalgically_confused",mood:"Nostalgically confused",emoji:"\ud83e\udd2a",suggestions:[{title:"Adult Baby Food Gourmet",desc:"Pureed gourmet meals served in baby food jars. Childhood regression meets fine dining.",img:"https://images.unsplash.com/photo-1570197788417-0e82375c9371?auto=format&fit=crop&w=800&q=60",chaos:9},{title:"Cereal Bar Cocktail",desc:"Liquid granola bar mixed with milk. Breakfast drink confusion.",img:"https://images.unsplash.com/photo-1544737151156-6e4737518e38?auto=format&fit=crop&w=800&q=60",chaos:5},{title:"Lunchable Sushi",desc:"Sushi made with lunchable crackers, cheese, and ham. Corporate childhood meets Japan.",img:"https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?auto=format&fit=crop&w=800&q=60",chaos:8}]},{id:"mysteriously_adventurous",mood:"Mysteriously adventurous",emoji:"\ud83d\udd75\ufe0f",suggestions:[{title:"Black Garlic Ice Cream",desc:"Dark, mysterious ice cream that tastes like sweet soy sauce. Trust the process.",img:"https://images.unsplash.com/photo-1542362567-b07e54358753?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Edible Dirt Cake",desc:"Chocolate cake that looks and feels like actual dirt with gummy worms. Garden surprise.",img:"https://images.unsplash.com/photo-1578985545062-69928b1d9587?auto=format&fit=crop&w=800&q=60",chaos:6},{title:"Invisible Sandwich",desc:"Clear gelatin sheets with hidden ingredients suspended inside. See-through confusion.",img:"https://images.unsplash.com/photo-1528736235302-52922df5c122?auto=format&fit=crop&w=800&q=60",chaos:9}]},{id:"rebelliously_hungry",mood:"Rebelliously hungry",emoji:"\ud83d\ude08",suggestions:[{title:"Breakfast Pizza for Dinner",desc:"Pizza with eggs, bacon, and maple syrup at 8 PM. Rules are meant to be broken.",img:"https://images.unsplash.com/photo-1574071318508-1cdbab80d002?auto=format&fit=crop&w=800&q=60",chaos:5},{title:"Ice Cream Soup",desc:"Melted ice cream served hot as soup with cookie croutons. Dessert anarchy.",img:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?auto=format&fit=crop&w=800&q=60",chaos:8},{title:"Spaghetti and Meatball Sandwich",desc:"Entire spaghetti dinner crammed between two slices of bread. Carb rebellion.",img:"https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=800&q=60",chaos:7},{title:"Backwards Cake",desc:"Cake that looks like a savory dish but tastes sweet. Visual confusion guaranteed.",img:"https://images.unsplash.com/photo-1578985545062-69928b1d9587?auto=format&fit=crop&w=800&q=60",chaos:9}]}];var i=n(29),s=n.n(i),u=function(e,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},u(e,t)};function l(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var c=function(){return c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},c.apply(this,arguments)};function f(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(cf){a(cf)}}function s(e){try{u(r.throw(e))}catch(cf){a(cf)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})}function h(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(cf){a=[6,cf],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function d(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}var p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function v(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var m=function(){return(m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function g(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function y(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var b={},x={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function w(e){e in b||(b[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete b[e]},!1),1===e?t.getContext("webgl",x)||t.getContext("experimental-webgl",x):t.getContext("webgl2",x)}(e));var t=b[e];return t.isContextLost()?(delete b[e],w(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),b[e])}function C(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function E(e,t,n){return Math.max(e,Math.min(t,n))}function S(e){return e%2==0?e:e+1}function k(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function R(e,t){var n=Math.random();return t*n+(1-n)*e}function I(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function _(e,t,n){void 0===n&&(n=""),I(D(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function N(e){I(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function T(e,t){if(void 0===t&&(t=[]),null==t&&(t=[]),Array.isArray(e)||q(e))for(var n=0;n<e.length;++n)T(e[n],t);else t.push(e);return t}function A(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function D(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function O(e){return e%1==0}function M(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function F(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function P(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function L(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{var s=t(++a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function B(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function z(e,t){var n=t.length;return I((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),I(e.every(function(e){return O(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function W(e,t){for(var n=[],r=[],o=null==t?null:z(t,e).sort(),a=0,i=0;i<e.length;++i){if(null!=o){if(o[a]===i&&1!==e[i])throw new Error("Can't squeeze axis "+i+" since its dim '"+e[i]+"' is not 1");(null==o[a]||o[a]>i)&&1===e[i]&&(n.push(e[i]),r.push(i)),o[a]<=i&&a++}1!==e[i]&&(n.push(e[i]),r.push(i))}return{newShape:n,keptDims:r}}function U(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function V(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function j(e,t,n){if("float32"===t)for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+n+"' is "+o+".")}}function G(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function H(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function q(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function K(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function X(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=2*e.length}),t}function $(e){return"string"==typeof e||e instanceof String}function Y(e){return"boolean"==typeof e}function Q(e){return"number"==typeof e}function J(e){return Array.isArray(e)?J(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Q(e)?"float32":$(e)?"string":Y(e)?"bool":"float32"}function Z(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ee(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function te(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function ne(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=T(e)),n&&G(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function re(e,t,n){var r=new Array;if(1===t.length)for(var o=t[0],a=0;a<o;a++)r[a]=n[e+a];else{o=t[0];var i=t.slice(1),s=i.reduce(function(e,t){return e*t});for(a=0;a<o;a++)r[a]=re(e+a*s,i,n)}return r}function oe(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return re(0,e,t)}function ae(e,t){for(var n=ie(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ie(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function se(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof process){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function ue(e){e.forEach(function(t){I(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}Object.freeze({shuffle:C,clamp:E,nearestLargerEven:S,sum:k,randUniform:R,distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:I,assertShapesMatch:_,assertNonNull:N,flatten:T,sizeFromShape:A,isScalarShape:function(e){return 0===e.length},arraysEqual:D,isInt:O,tanh:M,sizeToSquarishShape:F,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return C(t),t},rightPad:P,repeatedTry:L,inferFromImplicitShape:B,parseAxisParam:z,squeezeShape:W,getTypedArrayFromDType:U,getArrayFromDType:V,checkComputationForErrors:j,checkConversionForErrors:G,hasEncodingLoss:H,isTypedArray:q,bytesPerElement:K,bytesFromStringArray:X,isString:$,isBoolean:Y,isNumber:Q,inferDtype:J,isFunction:Z,nearestDivisor:ee,computeStrides:te,toTypedArray:ne,toNestedArray:oe,makeOnesTypedArray:ae,makeZerosTypedArray:ie,now:se,assertNonNegativeIntegerDimensions:ue});var le=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new ce)}return e.prototype.profileKernel=function(e,t){var n,r=this,o=this.backendTimer.time(function(){n=t()});return(Array.isArray(n)?n:[n]).forEach(function(t){var n=t.dataSync();j(n,t.dtype,e),o.then(function(o){var a="";null!=o.getExtraProfileInfo&&(a=o.getExtraProfileInfo()),r.logger.logKernelProfile(e,t,n,o.kernelMs,a)})}),n},e}(),ce=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o){var a=P(r+"ms",9),i=P(e,25),s=t.rank,u=t.size,l=P(t.shape.toString(),14);console.log("%c"+i+"\t%c"+a+"\t%c"+s+"D "+l+"\t%c"+u+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},e}();function fe(e,t,n,r){var o=te(t),a=function(e,t,n,r){var o=A(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?ve(e):e;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,f=0;f<a;f++)i[f]=Math.max(i[f],he(u[c+f],0,n).length);return i}(e,t,n,o),i=t.length,s=pe(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}function he(e,t,n){return P(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":$(e)?"'"+e+"'":"bool"===n?de(e):parseFloat(e.toFixed(7)).toString(),t)}function de(e){return 0===e?"false":"true"}function pe(e,t,n,r,o,a){void 0===a&&(a=!0);var i="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[he(ve(e)[0],0,n)]:"bool"===n?[de(e[0])]:[e[0].toString()];if(1===u){if(s>20){var l=3*i,c=Array.from(e.slice(0,l)),f=Array.from(e.slice(s-3*i,s));return"complex64"===n&&(c=ve(c),f=ve(f)),["["+c.map(function(e,t){return he(e,o[t],n)}).join(", ")+", ..., "+f.map(function(e,t){return he(e,o[s-3+t],n)}).join(", ")+"]"]}return["["+("complex64"===n?ve(e):Array.from(e)).map(function(e,t){return he(e,o[t],n)}).join(", ")+"]"]}var h=t.slice(1),d=r.slice(1),p=r[0]*i,v=[];if(s>20){for(var m=0;m<3;m++){var g=(y=m*p)+p;v.push.apply(v,pe(e.slice(y,g),h,n,d,o,!1))}for(v.push("..."),m=s-3;m<s;m++)g=(y=m*p)+p,v.push.apply(v,pe(e.slice(y,g),h,n,d,o,m===s-1))}else for(m=0;m<s;m++){var y;g=(y=m*p)+p,v.push.apply(v,pe(e.slice(y,g),h,n,d,o,m===s-1))}var b=2===u?",":"";for(v[0]="["+v[0]+b,m=1;m<v.length-1;m++)v[m]=" "+v[m]+b;var x=",\n";for(m=2;m<u;m++)x+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(a?"":x),v}function ve(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var me=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=A(e),null!=n){var o=n.length;I(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||V(t,this.size),this.strides=te(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),I(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return xe.make(this.shape,{values:this.values},this.dtype)},e}(),ge=null,ye=null,be=null;var xe=function(){function e(e,t,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=A(e),this.strides=te(e),this.dataId=null!=r?r:{},this.id=ge().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",ge().registerTensor(this,o),null!=n&&ge().write(this.dataId,n)}return e.make=function(t,n,r,o){return new e(t,r,n.values,n.dataId,o)},e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),I(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),ye.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return g(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ye.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return ye.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return g(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,oe(this.shape,e)]}})})},e.prototype.arraySync=function(){return oe(this.shape,this.dataSync())},e.prototype.data=function(){return g(this,void 0,void 0,function(){return y(this,function(e){return this.throwIfDisposed(),[2,ge().read(this.dataId)]})})},e.prototype.dataSync=function(){return this.throwIfDisposed(),ge().readSync(this.dataId)},e.prototype.dispose=function(){this.isDisposed||(ge().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ye.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ye.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ye.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ye.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ye.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ye.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),ye.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),fe(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),ye.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ye.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ye.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ye.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ye.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ye.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ye.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ye.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ye.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ye.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ye.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),ye.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),be("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.batchNorm=function(e,t,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),ye.batchNorm(this,e,t,n,r,o)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ye.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ye.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ye.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ye.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),ye.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ye.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ye.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ye.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ye.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ye.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ye.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ye.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ye.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),ye.div(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ye.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ye.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ye.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ye.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ye.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ye.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ye.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ye.modStrict(this,e)},e.prototype.squaredDifference=function(e){return this.throwIfDisposed(),ye.squaredDifference(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ye.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),ye.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ye.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ye.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ye.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ye.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ye.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ye.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ye.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ye.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ye.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ye.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ye.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ye.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ye.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ye.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ye.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ye.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ye.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ye.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ye.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ye.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ye.sign(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ye.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ye.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ye.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ye.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ye.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ye.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ye.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ye.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ye.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ye.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ye.relu(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ye.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ye.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ye.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ye.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ye.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ye.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ye.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ye.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ye.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ye.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ye.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ye.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ye.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ye.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ye.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ye.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ye.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ye.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ye.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ye.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ye.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ye.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ye.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ye.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ye.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ye.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ye.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ye.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),ye.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ye.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),ye.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ye.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),ye.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ye.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ye.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ye.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),ye.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),we.variable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ye.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ye.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ye.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ye.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),ye.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ye.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ye.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ye.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ye.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ye.spectral.irfft(this)},e}();Object.defineProperty(xe,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var we=function(e){function t(t,n,r){void 0===n&&(n=!0);var o=e.call(this,t.shape,t.dtype,null,t.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=ge().nextVariableId().toString());try{ge().registerVariable(o)}catch(e){throw ge().disposeTensor(o),e}return o}return v(t,e),t.variable=function(e,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==e.dtype&&(e=e.asType(o)),new t(e,n,r)},t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!D(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");ge().disposeTensor(this),this.dataId=e.dataId,ge().registerTensor(this)},t}(xe);Object.defineProperty(we,Symbol.hasInstance,{value:function(e){return e instanceof xe&&null!=e.assign&&e.assign instanceof Function}});var Ce,Ee,Se,ke,Re;we.variable;!function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ce||(Ce={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ee||(Ee={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Se||(Se={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(ke||(ke={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Re||(Re={}));var Ie={float32:ke,int32:Ee,bool:Se,complex64:Re};function _e(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Ie[e][t]}function Ne(e){return _e(e,"int32")}function Te(e,t){if(e.dtype===t.dtype)return[e,t];var n=_e(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ae(e,t){I(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function De(e){var t=[];return Oe(e,t,new Set),t}function Oe(e,t,n){if(null!=e)if(e instanceof xe)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var o in r){var a=r[o];n.has(a)||(n.add(a),Oe(a,t,n))}}}Object.freeze({makeTypesMatch:Te,assertTypesMatch:Ae,isTensorInList:function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1},getTensorsInContainer:De});var Me,Fe=function(){function e(e,t,n){this.backend=e,this.safeMode=t,this.debugMode=n,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new le(e),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.moveData=function(e){this.write(e,this.readSync(e))},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=xe.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(e){return[e.toFloat()]}),t},e.prototype.runKernel=function(e,t,n){var r,o=this,a=[],i=this.isTapeOn(),s=null!=this.activeScope?this.activeScope.name:"",u=function(e){i&&(a=e.map(function(e){return o.keep(o.clone(e))}))},l=this.numBytes,c=this.numTensors;if(this.scopedRun(function(){return o.kernelDepth++},function(){return o.kernelDepth--},function(){r=o.debugMode()?o.profiler.profileKernel(s,function(){return e(o.backend,u)}):e(o.backend,u)}),i){var f={id:this.nextTapeNodeId++,name:s,inputs:t,outputs:Array.isArray(r)?r:[r],saved:a};null!=n&&(f.gradient=function(e){return n(e,a)}),this.activeTape.push(f)}return this.profiling&&this.activeProfile.kernels.push({name:s,bytesAdded:this.numBytes-l,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-c,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShape:Array.isArray(r)?r.map(function(e){return e.shape}):r.shape}),r},e.prototype.registerTensor=function(e,t){var n=this.tensorInfo.has(e.dataId)?this.tensorInfo.get(e.dataId).refCount:0;if(this.numTensors++,"string"===e.dtype&&this.numStringTensors++,0===n){this.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*K(e.dtype)),this.tensorInfo.set(e.dataId,{backend:null!=t?t:this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.numBytes+=r,null!=t?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.tensorInfo.get(e.dataId).refCount++,e instanceof we||this.track(e)},e.prototype.registerVariable=function(e){if(null!=this.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},e.prototype.disposeTensor=function(e){if(this.tensorInfo.has(e.dataId)){this.numTensors--,"string"===e.dtype&&this.numStringTensors--;var t=this.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.numBytes-=t.bytes),this.numDataBuffers--,t.backend.disposeData(e.dataId),this.tensorInfo.delete(e.dataId)):this.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.registeredVariables){var t=this.registeredVariables[e];this.disposeTensor(t),delete this.registeredVariables[e]}},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,this.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return g(this,void 0,void 0,function(){var t,n;return y(this,function(r){return this.profiling=!0,t=this.numBytes,n=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=e(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-t,this.activeProfile.newTensors=this.numTensors-n,[2,this.activeProfile]})})},e.prototype.isTapeOn=function(){return this.gradientDepth>0&&0===this.kernelDepth},e.prototype.addTapeNode=function(e,t,n){var r={};e.forEach(function(e,t){r[t]=e});var o={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,outputs:[t],gradient:function(e){var t={};return n(e).forEach(function(e,n){t[n]=function(){return e}}),t}};this.activeTape.push(o)},e.prototype.keep=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return e.kept=!0,e},e.prototype.startTape=function(){0===this.gradientDepth&&(this.activeTape=[]),this.gradientDepth++},e.prototype.endTape=function(){this.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.nextScopeId++};e&&(t.name=e),this.scopeStack.push(t),this.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=De(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.activeScope.track.length;o++){var a=this.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?null:this.scopeStack[this.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==i.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),I(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});I(a instanceof xe,function(){return"The result y returned by f() must be a tensor."});var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(p=e[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){p.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,o[p.id]=!0;break}if(l)break}}var f={};f[n.id]=!0;var h={};for(a=e.length-1;a>=0;a--)for(i=(p=e[a]).inputs,c=0;c<p.outputs.length;c++)if(f[p.outputs[c].id]){for(var s in i)f[i[s].id]=!0,h[p.id]=!0;break}var d=[];for(a=0;a<e.length;a++){var p;if(o[(p=e[a]).id]&&h[p.id]){var v={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,d.push(g)}}return d}(this.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e={};e[a.id]=null==n?function(e){var t=ae(A(e),"float32");return xe.make(e,{values:t})}(a.shape):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach(function(t){var n=e[t.id];if(null!=n)a.push(n);else{var r=xe.make(t.shape,{values:ie(t.size,t.dtype)},t.dtype);a.push(r)}}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var i=o.gradient(1===o.outputs.length?a[0]:a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n(function(){return i[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.name+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!D(r.shape,a.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(e,i,function(e){return o.tidy(e)});var r=t.map(function(t){return e[t.id]});return 0===o.gradientDepth&&(o.activeTape.forEach(function(e){for(var t in e.saved)e.saved[t].dispose()}),o.activeTape=null),{value:a,grads:r}})},e.prototype.customGrad=function(e){var t=this;return I(Z(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];I(r.every(function(e){return e instanceof xe}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return r.forEach(function(e,t){a[t]=e}),t.runKernel(function(t,o){return I((n=e.apply(void 0,r.concat([o]))).value instanceof xe,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),I(Z(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];I(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),I(a.every(function(e){return e instanceof xe}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(e,t){i[t]=function(){return e}}),i})}},e.prototype.write=function(e,t){var n=this.tensorInfo.get(e);if("string"===n.dtype){var r=X(t);this.numBytes+=r-n.bytes,n.bytes=r}this.backend!==n.backend&&(n.backend.disposeData(e),n.backend=this.backend,this.backend.register(e,n.shape,n.dtype)),this.backend.write(e,t)},e.prototype.readSync=function(e){return this.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.tensorInfo.get(e).backend.read(e)},e.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},e.prototype.time=function(e){return g(this,void 0,void 0,function(){var t,n;return y(this,function(r){switch(r.label){case 0:return t=se(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=se()-t,[2,n]}})})},e.prototype.track=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return null!=this.activeScope&&(e.scopeId=this.activeScope.id,this.activeScope.track.push(e)),e},e.nextTensorId=0,e.nextVariableId=0,e}();!function(e){e[e.NUMBER=0]="NUMBER",e[e.BOOLEAN=1]="BOOLEAN",e[e.STRING=2]="STRING"}(Me||(Me={}));var Pe,Le,Be=[{name:"DEBUG",type:Me.BOOLEAN},{name:"IS_BROWSER",type:Me.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:Me.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:Me.BOOLEAN},{name:"WEBGL_PACK",type:Me.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:Me.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:Me.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:Me.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:Me.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:Me.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:Me.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:Me.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:Me.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:Me.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:Me.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:Me.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Me.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Me.BOOLEAN},{name:"WEBGL_VERSION",type:Me.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:Me.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:Me.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:Me.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:Me.NUMBER},{name:"BACKEND",type:Me.STRING},{name:"EPSILON",type:Me.NUMBER},{name:"PROD",type:Me.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:Me.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:Me.BOOLEAN}];function ze(e){try{if(null!=w(e))return!0}catch(e){return!1}return!1}var We="tfjsflags";function Ue(){var e={};if("undefined"==typeof window||void 0===window.location||void 0===window.location.search)return e;var t=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")}),t}(window.location.search);if(We in t){var n={};t[We].split(",").forEach(function(e){var t=e.split(":"),r=t[0],o=t[1];n[r]=o}),Be.forEach(function(t){t.name in n&&(console.log("Setting feature override from URL "+t.name+": "+n[t.name]),t.type===Me.NUMBER?e[t.name]=+n[t.name]:t.type===Me.BOOLEAN?e[t.name]="true"===n[t.name]:t.type===Me.STRING?e[t.name]=n[t.name]:console.warn("Unknown URL param: "+t.name+"."))})}return e}function Ve(e,t){return null!=e.getExtension(t)}function je(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var o=2===t?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,o,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(n),a}var Ge,He=1e-4,qe=function(){function e(e){this.features={},this.registry={},this.registryFactory={},null!=e&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(e,t){if(void 0===t&&(t=!1),!(e in $e.registry))throw new Error("Backend name '"+e+"' not found in registry");$e.engine.backend=$e.findBackend(e),$e.backendName=e},e.getBackend=function(){return $e.initEngine(),$e.backendName},e.disposeVariables=function(){$e.engine.disposeVariables()},e.memory=function(){return $e.engine.memory()},e.profile=function(e){return $e.engine.profile(e)},e.tidy=function(e,t){return $e.engine.tidy(e,t)},e.dispose=function(e){De(e).forEach(function(e){return e.dispose()})},e.keep=function(e){return $e.engine.keep(e)},e.time=function(e){return $e.engine.time(e)},e.prototype.get=function(e){return e in this.features||(this.features[e]=this.evaluateFeature(e)),this.features[e]},e.prototype.getFeatures=function(){return this.features},e.prototype.set=function(e,t){this.features[e]=t},e.prototype.getBestBackendName=function(){var e=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(t){return{name:t,entry:e.registry[t]}}).sort(function(e,t){return t.entry.priority-e.entry.priority})[0].name},e.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("IS_BROWSER"===e)return"undefined"!=typeof window;if("IS_NODE"===e)return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node;if("IS_CHROME"===e)return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if("WEBGL_CPU_FORWARD"===e)return!0;if("WEBGL_PACK"===e)return 0!==this.get("WEBGL_VERSION");if("WEBGL_PACK_BATCHNORMALIZATION"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_CLIP"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_DEPTHWISECONV"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_BINARY_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_ARRAY_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_IMAGE_OPERATIONS"===e)return this.get("WEBGL_PACK");if("WEBGL_PACK_REDUCE"===e)return this.get("WEBGL_PACK");if("WEBGL_LAZILY_UNPACK"===e)return this.get("WEBGL_PACK");if("WEBGL_CONV_IM2COL"===e)return this.get("WEBGL_PACK");if("WEBGL_NUM_MB_BEFORE_PAGING"===e)return this.get("PROD")||!this.get("IS_BROWSER")?Number.POSITIVE_INFINITY:window.screen.height*window.screen.width*window.devicePixelRatio*600/1024;if("WEBGL_MAX_TEXTURE_SIZE"===e)return function(e){if(null==Pe){var t=w(e);Pe=t.getParameter(t.MAX_TEXTURE_SIZE)}return Pe}(this.get("WEBGL_VERSION"));if("WEBGL_MAX_TEXTURES_IN_SHADER"===e)return function(e){if(null==Le){var t=w(e);Le=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Le)}(this.get("WEBGL_VERSION"));if("IS_TEST"===e)return!1;if("BACKEND"===e)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var t=this.get("WEBGL_VERSION");return 0===t?0:function(e){if(0===e)return 0;var t=w(e);return Ve(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Ve(t,"EXT_disjoint_timer_query")?1:0}(t)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}();if("HAS_WEBGL"===e)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===e)return ze(2)?2:ze(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===e)return function(e){if(0===e)return!1;var t=w(e);if(1===e){if(!Ve(t,"OES_texture_float"))return!1}else if(!Ve(t,"EXT_color_buffer_float"))return!1;return je(t,e)}(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===e)return function(e){if(0===e)return!1;var t=w(e);if(1===e){if(!Ve(t,"OES_texture_float"))return!1;if(!Ve(t,"WEBGL_color_buffer_float"))return!1}else if(!Ve(t,"EXT_color_buffer_float"))return!1;return je(t,e)}(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===e)return function(e){return 2===e&&null!=w(e).fenceSync}(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===e)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if("TEST_EPSILON"===e)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===e)return 32===this.backend.floatPrecision()?1e-7:He;if("PROD"===e)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===e)return!this.get("PROD");if("DEPRECATION_WARNINGS_ENABLED"===e)return!0;throw new Error("Unknown feature "+e+".")},e.prototype.setFeatures=function(e){this.features=Object.assign({},e)},e.prototype.reset=function(){this.features=Ue(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(e.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),e.prototype.findBackend=function(e){return e in this.registry?this.registry[e].backend:null},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e]:null},e.prototype.registerBackend=function(e,t,n){var r=this;if(void 0===n&&(n=1),e in this.registry)return console.warn(e+" backend was already registered. Reusing existing backend"),!1;try{var o=t();return o.setDataMover({moveData:function(e){return r.engine.moveData(e)}}),this.registry[e]={backend:o,priority:n},this.registryFactory[e]=t,!0}catch(t){return console.warn("Registration of backend "+e+" failed"),console.warn(t.stack||t.message),!1}},e.prototype.removeBackend=function(e){if(!(e in this.registry))throw new Error(e+" backend not found in registry");this.registry[e].backend.dispose(),delete this.registry[e]},Object.defineProperty(e.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initEngine=function(){var e=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var t=this.findBackend(this.backendName);this.globalEngine=new Fe(t,!1,function(){return e.get("DEBUG")})}},Object.defineProperty(e.prototype,"global",{get:function(){return Ke()},enumerable:!0,configurable:!0}),e}();function Ke(){if(null==Ge){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else{if("undefined"==typeof process)throw new Error("Could not find a global object");e=process}Ge=e}return Ge}function Xe(e){$e.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}!function(e){be=e}(Xe);var $e=function(){var e=Ke();return null==e.ENV&&(e.ENV=new qe(Ue())),function(e){ge=e}(function(){return e.ENV.engine}),e.ENV}();Object.freeze({EPSILON_FLOAT16:He,EPSILON_FLOAT32:1e-7,Environment:qe,enableProdMode:function(){$e.set("PROD",!0)},enableDebugMode:function(){$e.set("DEBUG",!0)},disableDeprecationWarnings:function(){$e.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:Xe,ENV:$e});function Ye(e){var t=e;if(q(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];Array.isArray(t)||q(t);)n.push(t.length),t=t[0];return Array.isArray(e)&&$e.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Qe(e,n,[]),n}function Qe(e,t,n){if(n=n||[],Array.isArray(e)||q(e)){I(t.length>0,function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),I(e.length===t[0],function(){return"Element arr["+n.join("][")+"] should have "+t[0]+" elements, but has "+e.length+" elements"});for(var r=t.slice(1),o=0;o<e.length;++o)Qe(e[o],r,n.concat(o))}else I(0===t.length,function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"})}function Je(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function Ze(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof xe)return Je(r,e.dtype,t,n),e;var o=J(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Je(r,o,t,n),null==e||!q(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=Ye(e);q(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?ne(e,o,$e.get("DEBUG")):T(e);return xe.make(i,{values:s},o)}function et(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return Ze(e,t+"["+r+"]",n)},r)}function tt(e){return $e.engine.customGrad(e)}var nt=qe.tidy,rt=qe.keep,ot=qe.dispose;qe.time,qe.profile;function at(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];$e.get("IS_TEST")||console.warn.apply(console,e)}function it(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function st(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function ut(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function lt(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function ct(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function ft(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function ht(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function dt(e,t){return function(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}(e,t.map(function(e){return 1}),t)}function pt(e,t,n){I(ft(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function vt(e,t){if(ft(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function mt(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function gt(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function yt(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function bt(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=te(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,l]}function xt(e){return e<=30?e:ee(e,Math.floor(Math.sqrt(e)))}function wt(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}(n,t,e)}function Ct(e,t,n){for(var r=t.rank>1?t.shape[t.rank-1]:1,o=n.length,a=1,i=r;i<o;++i)a*=n[i];var s=r<1?1:r;return{sliceRank:r,numUpdates:t.size/s,sliceSize:a,strides:te(n.slice(0,r)).concat([1]),outputSize:A(n)}}function Et(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==i)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],f=[],h=0;h<e.length;h++)l[h]=St(o,t,r,e,h),c[h]=kt(a,n,r,e,h),u&1<<h&&(c[h]=l[h]+1,f.push(h));var d=new Array(e.length).fill(0);return d=d.map(function(e,t){for(var n=0,o=r[t]||1,a=l[t];!(o>0?a>=c[t]:a<=c[t]);a+=o)n+=1;return n}),[l,d,f]}function St(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),E(0,a,s-1)}function kt(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?E(0,a,s):E(-1,a,s-1)}function Rt(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function It(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function _t(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];$e.engine.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),$e.engine.endScope(o),o}catch(e){throw $e.engine.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}var Nt=_t({softmax_:function(e,t){void 0===t&&(t=-1);var n=Ze(e,"logits","softmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return tt(function(e,n){var r=e.logSumExp([t],!0),o=e.toFloat().sub(r).exp();return n([o]),{value:o,gradFunc:function(e,n){var r=n[0],o=e.mul(r);return o.sub(o.sum([t],!0).mul(r))}}})(n)}}),Tt=_t({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=Ze(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return tt(function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}});var At=_t({complex_:function(e,t){var n=Ze(e,"real","complex"),r=Ze(t,"imag","complex");return _(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),$e.engine.runKernel(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),Dt=_t({real_:function(e){var t=Ze(e,"input","real");return $e.engine.runKernel(function(e){return e.real(t)},{$input:t})}}),Ot=_t({imag_:function(e){var t=Ze(e,"input","imag");return $e.engine.runKernel(function(e){return e.imag(t)},{$input:t})}});function Mt(e,t,n){if(null==n&&(n=J(e)),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!q(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=Ye(e);if(null!=t){ue(t);var o=A(t),a=A(r);I(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<r.length;++i){var s=r[i],u=i!==r.length-1||s!==A(t.slice(i));I(r[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "})}}return q(e)||Array.isArray(e)||(e=[e]),t=t||r,e="string"!==n?ne(e,n,$e.get("DEBUG")):T(e),xe.make(t,{values:e},n)}function Ft(e,t){if((q(e)||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return Mt(e,[],t)}function Pt(e,t){N(e);var n=Ye(e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Mt(e,n,t)}function Lt(e,t,n){if(N(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ye(e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Mt(e,t=t||r,n)}function Bt(e,t,n){if(N(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ye(e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Mt(e,t=t||r,n)}function zt(e,t,n){if(N(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Ye(e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Mt(e,t=t||r,n)}function Wt(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Wt(e,"float32"),r=Wt(e,"float32");return At(n,r)}var o=ae(A(e),t);return xe.make(e,{values:o},t)}function Ut(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Ut(e,"float32"),r=Ut(e,"float32");return At(n,r)}var o=ie(A(e),t);return xe.make(e,{values:o},t)}function Vt(e,t,n){return $e.engine.runKernel(function(r){return r.fill(e,t,n)},{})}function jt(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Ut([0],r);var o=ie(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return Pt(o,r)}var Gt=_t({onesLike_:function(e){var t=Ze(e,"x","onesLike");if("complex64"===t.dtype){var n=Gt(Dt(t)),r=Ht(Ot(t));return At(n,r)}return $e.engine.runKernel(function(e){return e.onesLike(t)},{$x:t},null)}}),Ht=_t({zerosLike_:function(e){var t=Ze(e,"x","zerosLike");return $e.engine.runKernel(function(e){return e.zerosLike(t)},{$x:t},null)}}),qt=function(){function e(e){this.dataMover=e,this.data=new WeakMap}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(e),this.data.get(e)},e.prototype.set=function(e,t){this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.data.delete(e)},e}();!function(){function e(){}e.prototype.time=function(e){throw new Error("Not yet implemented.")},e.prototype.read=function(e){throw new Error("Not yet implemented.")},e.prototype.readSync=function(e){throw new Error("Not yet implemented.")},e.prototype.disposeData=function(e){throw new Error("Not yet implemented.")},e.prototype.write=function(e,t){throw new Error("Not yet implemented.")},e.prototype.fromPixels=function(e,t){throw new Error("Not yet implemented.")},e.prototype.register=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.memory=function(){throw new Error("Not yet implemented.")},e.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},e.prototype.batchMatMul=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.slice=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){throw new Error("Not yet implemented")},e.prototype.unstack=function(e,t){throw new Error("Not yet implemented")},e.prototype.reverse=function(e,t){throw new Error("Not yet implemented")},e.prototype.concat=function(e,t){throw new Error("Not yet implemented")},e.prototype.neg=function(e){throw new Error("Not yet implemented")},e.prototype.add=function(e,t){throw new Error("Not yet implemented")},e.prototype.addN=function(e){throw new Error("Not yet implemented")},e.prototype.subtract=function(e,t){throw new Error("Not yet implemented")},e.prototype.multiply=function(e,t){throw new Error("Not yet implemented")},e.prototype.realDivide=function(e,t){throw new Error("Not yet implemented")},e.prototype.floorDiv=function(e,t){throw new Error("Not yet implemented")},e.prototype.sum=function(e,t){throw new Error("Not yet implemented")},e.prototype.prod=function(e,t){throw new Error("Not yet implemented")},e.prototype.unsortedSegmentSum=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.argMin=function(e,t){throw new Error("Not yet implemented")},e.prototype.argMax=function(e,t){throw new Error("Not yet implemented")},e.prototype.equal=function(e,t){throw new Error("Not yet implemented")},e.prototype.notEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.less=function(e,t){throw new Error("Not yet implemented")},e.prototype.lessEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.greater=function(e,t){throw new Error("Not yet implemented")},e.prototype.greaterEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalNot=function(e){throw new Error("Not yet implemented")},e.prototype.logicalAnd=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalOr=function(e,t){throw new Error("Not yet implemented")},e.prototype.where=function(e){throw new Error("Not yet implemented")},e.prototype.select=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.topk=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.min=function(e,t){throw new Error("Not yet implemented")},e.prototype.minimum=function(e,t){throw new Error("Not yet implemented")},e.prototype.mod=function(e,t){throw new Error("Not yet implemented")},e.prototype.max=function(e,t){throw new Error("Not yet implemented")},e.prototype.maximum=function(e,t){throw new Error("Not yet implemented")},e.prototype.all=function(e,t){throw new Error("Not yet implemented")},e.prototype.any=function(e,t){throw new Error("Not yet implemented")},e.prototype.squaredDifference=function(e,t){throw new Error("Not yet implemented")},e.prototype.ceil=function(e){throw new Error("Not yet implemented")},e.prototype.floor=function(e){throw new Error("Not yet implemented")},e.prototype.round=function(e){throw new Error("Not yet implemented")},e.prototype.sign=function(e){throw new Error("Not yet implemented")},e.prototype.isNaN=function(e){throw new Error("Not yet implemented")},e.prototype.isInf=function(e){throw new Error("Not yet implemented")},e.prototype.isFinite=function(e){throw new Error("Not yet implemented")},e.prototype.pow=function(e,t){throw new Error("Not yet implemented")},e.prototype.exp=function(e){throw new Error("Not yet implemented")},e.prototype.expm1=function(e){throw new Error("Not yet implemented")},e.prototype.log=function(e){throw new Error("Not yet implemented")},e.prototype.log1p=function(e){throw new Error("Not yet implemented")},e.prototype.sqrt=function(e){throw new Error("Not yet implemented")},e.prototype.rsqrt=function(e){throw new Error("Not yet implemented")},e.prototype.square=function(e){throw new Error("Not yet implemented")},e.prototype.reciprocal=function(e){throw new Error("Not yet implemented")},e.prototype.relu=function(e){throw new Error("Not yet implemented")},e.prototype.prelu=function(e,t){throw new Error("Not yet implemented")},e.prototype.elu=function(e){throw new Error("Not yet implemented")},e.prototype.eluDer=function(e,t){throw new Error("Not yet implemented")},e.prototype.selu=function(e){throw new Error("Not yet implemented")},e.prototype.int=function(e){throw new Error("Not yet implemented")},e.prototype.clip=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.abs=function(e){throw new Error("Not yet implemented")},e.prototype.complexAbs=function(e){throw new Error("Not yet implemented")},e.prototype.sigmoid=function(e){throw new Error("Not yet implemented")},e.prototype.softplus=function(e){throw new Error("Not yet implemented")},e.prototype.sin=function(e){throw new Error("Not yet implemented")},e.prototype.cos=function(e){throw new Error("Not yet implemented")},e.prototype.tan=function(e){throw new Error("Not yet implemented")},e.prototype.asin=function(e){throw new Error("Not yet implemented")},e.prototype.acos=function(e){throw new Error("Not yet implemented")},e.prototype.atan=function(e){throw new Error("Not yet implemented")},e.prototype.atan2=function(e,t){throw new Error("Not yet implemented")},e.prototype.sinh=function(e){throw new Error("Not yet implemented")},e.prototype.cosh=function(e){throw new Error("Not yet implemented")},e.prototype.tanh=function(e){throw new Error("Not yet implemented")},e.prototype.asinh=function(e){throw new Error("Not yet implemented")},e.prototype.acosh=function(e){throw new Error("Not yet implemented")},e.prototype.atanh=function(e){throw new Error("Not yet implemented")},e.prototype.erf=function(e){throw new Error("Not yet implemented")},e.prototype.step=function(e,t){throw new Error("Not yet implemented")},e.prototype.conv2d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2D=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.maxPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.maxPoolBackprop=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.avgPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.avgPoolBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.reshape=function(e,t){throw new Error("Not yet implemented")},e.prototype.cast=function(e,t){throw new Error("Not yet implemented")},e.prototype.tile=function(e,t){throw new Error("Not yet implemented")},e.prototype.pad=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.transpose=function(e,t){throw new Error("Not yet implemented")},e.prototype.gather=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.gatherND=function(e,t){throw new Error("Not yet implemented")},e.prototype.scatterND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchToSpaceND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.spaceToBatchND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeBilinear=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeBilinearBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchNormalization=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){throw new Error("Not yet implemented")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){throw new Error("Not yet implemented")},e.prototype.multinomial=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.oneHot=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.cumsum=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){throw new Error("Not yet implemented")},e.prototype.fft=function(e){throw new Error("Not yet implemented")},e.prototype.ifft=function(e){throw new Error("Not yet implemented")},e.prototype.complex=function(e,t){throw new Error("Not yet implemented")},e.prototype.real=function(e){throw new Error("Not yet implemented")},e.prototype.imag=function(e){throw new Error("Not yet implemented")},e.prototype.cropAndResize=function(e,t,n,r,o,a){throw new Error("Not yet implemented")},e.prototype.depthToSpace=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.split=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.sparseToDense=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fill=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.onesLike=function(e){throw new Error("Not yet implemented")},e.prototype.zerosLike=function(e){throw new Error("Not yet implemented")},e.prototype.setDataMover=function(e){throw new Error("Not yet implemented")},e.prototype.dispose=function(){throw new Error("Not yet implemented")}}();function Kt(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Ut(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!H(e.dtype,t))return xe.make(e.shape,{dataId:e.dataId},t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=Ft(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: unknown dtype argument ("+t+")")}function Xt(e,t){return xe.make(t,{dataId:e.dataId},e.dtype)}function $t(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Yt(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Qt(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Jt(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Zt(e,t,n,r,o){for(var a=Array.from(t).map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),i=[],s=0;s<a.length;s++){var u=a[s],l=u.score,c=u.boxIndex;if(l<o)break;for(var f=!1,h=i.length-1;h>=0;--h)if(en(e,c,i[h])>=r){f=!0;break}if(!f&&(i.push(c),i.length>=n))break}return Pt(i,"int32")}function en(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),d=(s-a)*(u-i),p=(f-l)*(h-c);if(d<=0||p<=0)return 0;var v=Math.max(a,l),m=Math.max(i,c),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function tn(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a})}function nn(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=U(n,s*r),c=U("int32",s*r),f=0;f<s;f++){for(var h=f*u,d=e.subarray(h,h+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort(function(e,t){return t.value-e.value});var m=f*r,g=l.subarray(m,m+r),y=c.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var b=t.slice();return b[b.length-1]=r,[Mt(l,b,n),Mt(c,b,"int32")]}var rn=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function on(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function an(e,t){return 1===t?[e]:on(e,t)}function sn(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function un(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function ln(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function cn(){var e,t,n,r,o,a,i,s,u,l;return 2===$e.get("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      const float NAN = uintBitsToFloat(uint(0x7fc00000));\n    ",u="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      uniform float NAN;\n\n      bool isnan(float val) {\n        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n      }\n      bvec4 isnan(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function fn(e,t,n){void 0===n&&(n="index");var r=te(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function hn(e){return 1===e.length?""+e[0]:"vec"+e.length+"("+e.join(",")+")"}function dn(e,t,n,r){var o=[];e.forEach(function(e){var t=A(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var a,i,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?vn(e):pn(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=sn(e.shapeInfo.logicalShape,t.logicalShape),l=Cn(s),c=s-i,f=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+f[e+c]+" = 0;"}).join("\n");var h="";h=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+c]}).join(", ");var d="return outputValue;";if(1===i&&s>1)d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";else if(0===i&&s>0)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var p=i-2,v=i-1;u.indexOf(p)>-1&&u.indexOf(v)>-1?d="return vec4(outputValue.x);":u.indexOf(p)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(v)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+h+");\n      "+d+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&D(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l=Cn(u),c=sn(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,h=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&c.length>=1?"coords = 0;":c.map(function(e){return"coords."+h[e+f]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+h[t+f]}).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,c=cn(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),h=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+mn+"\n    "+gn+"\n    "+yn+"\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(D(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}}(t.logicalShape,l),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return D(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return function(e,t){var n=fn(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec3(r, c, d);\n    }\n  "}(e,t);case 4:return function(e,t){var n=fn(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=fn(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=fn(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}}(t.logicalShape,l),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(h+=bn),[h,f,i,s,a,u,n].join("\n")}function pn(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+xn(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+wn(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=xn(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&D(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=W(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n      "+pn(En(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+Sn(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+wn(e)+"\n      }\n    ";var c=o[0],f=o[1],h=xn(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+h+";\n    vec2 uv = uvFromFlat("+c+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=W(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n        "+pn(En(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+Sn(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+wn(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,f=c[0],h=c[1],d=e.shapeInfo.flatOffset;return h===o&&null==d?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+h+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":h===a&&null==d?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+h+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+xn(n)+";\n        vec2 uv = uvFromFlat("+f+", "+h+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=W(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return"\n      "+pn(En(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+Sn(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+wn(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1];return d===i&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":d===o&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+h+", "+d+", index + "+xn(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=W(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return"\n      "+pn(En(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+Sn(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+wn(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];return p===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+xn(n)+";\n      vec2 uv = uvFromFlat("+d+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=W(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+pn(En(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+Sn(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,f=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+c+", "+l+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+wn(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1];return v===f&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+l+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":v===s&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+xn(n)+";\n      vec2 uv = uvFromFlat("+p+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function vn(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name;return"\n    vec4 get"+t.charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+cn().texture2D+"("+t+", halfCR);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=cn();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=cn();if(null!=o&&D(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+vn(En(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+Sn(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+cn().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),f="int b, int row, int col",h="b * "+c+" + (row / 2) * "+l+" + (col / 2)",d=2;d<n-1;d++)f="int b"+d+", "+f,h="b"+d+" * "+(c*=t[n-d-1])+" + "+h;return"\n    vec4 "+o+"("+f+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+cn().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var mn="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",gn="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",yn="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",bn="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function xn(e){return"offset"+e}function wn(e){var t=e.name,n=A(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function Cn(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function En(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Sn(e,t){return t.map(function(t){return e[t]}).join(", ")}var kn=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,I(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=Cn(l),f=an("coords",l);if(1===a){var h=Cn(s=l+1);i="\n        "+h+" sourceLocR = "+h+"("+f.join()+", 0);\n        ++"+f[l-1]+";\n        "+h+" sourceLocG = "+h+"("+f.join()+", 0);\n        ++"+f[l-2]+";\n        "+h+" sourceLocA = "+h+"("+f.join()+", 0);\n        --"+f[l-1]+";\n        "+h+" sourceLocB = "+h+"("+f.join()+", 0);\n        --"+f[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+f[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+f[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+f[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+f[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,s),p="."+d[s-1],v=d.map(function(e){return"int "+e}),m=an("sourceLocR",s-1).concat("inIdx.r"),g=an("sourceLocG",s-1).concat("inIdx.g"),y=an("sourceLocB",s-1).concat("inIdx.b"),b=an("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",C="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",E=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+d.join()+"),\n                                          vec2("+d.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+d.join()+"),\n                               vec2("+d.slice(-2).join()+"));\n      }\n      "+E+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+f[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+f[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+C+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+C+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Rn=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},In=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],ln(e,t),ln(e,n);var i="0.0";null!=r&&(ln(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(ln(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},_n=function(e,t,n,r,o,a){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],ln(e,t),ln(e,n);var i="vec4(0.0)";null!=r&&(ln(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(ln(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Nn="return areal * breal - aimag * bimag;",Tn="return areal * bimag + aimag * breal;",An=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ln(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Dn="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",On="return a + b;",Mn="return a - b;",Fn="return a * b;",Pn="return (a - b) * (a - b);",Ln=Dn+"\n  return max(a, b);\n",Bn=Dn+"\n  return min(a, b);\n",zn=Dn+"\n  return atan(a, b);\n",Wn=function(e,t,n){this.variableNames=["A","B"],this.outputShape=ln(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Un="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n",Vn="\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+Un+"\n  return result;\n",jn="\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Un+"\n  return result;\n",Gn="\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Un+"\n  return result;\n",Hn="\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Un+"\n  return result;\n",qn="\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+Un+"\n  return result;\n",Kn=function(e,t,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=ln(t,n),this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Xn=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),$n=function(){function e(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Yn=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Qn=function(e){this.outputShape=[],this.outputShape=yt(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Jn=function(e,t){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=yt(e,t);var n=this.outputShape,r=n.length,o=Cn(r),a=an("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c="vec2("+i.slice(-2).join()+")",f=i.join(),h="if ("+l+" < "+s[0]+")\n          return getChannel(getT0("+f+"), "+c+");";for(u=1;u<s.length;u++){var d=s[u-1];h+="\n        else if ("+l+" < "+s[u]+") {\n          "+l+" -= "+d+";\n          return getChannel(getT"+u+"("+f+"), "+c+");\n        }"}var p=s.length;h+="\n        else {\n          "+l+" -= "+s[s.length-1]+";\n          return getChannel(getT"+p+"("+f+"), "+c+");\n        }",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n        if (++"+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n        if (++"+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            --"+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "},Zn=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},er=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},tr=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},nr=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},rr=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},or=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ar=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.filterHeight,u=e.filterWidth,l=4*Math.floor(e.inChannels/4),c=e.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+t+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+a+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+i+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ir=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,f=e.filterHeight,h=e.filterWidth,d=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sr=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ur=function(e){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=e.outShape;for(var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=c,h="int xR; int xC; int xCOffset;",d=0;d<l;d++)for(var p=0;p<c;p++)h+="\n          vec4 xTexelR"+d+"C"+2*p+" = vec4(0.);\n          vec4 wR"+d+"C"+p+" = vec4(0.);\n          vec4 xR"+d+"C"+p+" = vec4(0.);";for(d=0;d<l;d++)for(var v=0;v<f;v++){if(h+="\n          xR = xRCorner + "+d*s+";\n          xC = xCCorner + "+(p=2*v)*u+";\n        ",1===i){if(p<c&&(h+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+d+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+d+"C"+p+" = vec4(previous.zw, xTexelR"+d+"C"+p+".xy);\n                } else {\n                  xR"+d+"C"+p+" = vec4(0, 0, xTexelR"+d+"C"+p+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+t+" && xC >= 0 && xC < "+n+") {\n                  xTexelR"+d+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+d+"C"+p+" = vec4(0.);\n                }\n\n                xR"+d+"C"+p+" = xTexelR"+d+"C"+p+";\n              ",p+1<c)){var m=o%2==0?S(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(h+="\n                  xCOffset = xC + "+o%2+" + "+m+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+d+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",u>1&&(h+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+t+" &&\n                      xCOffset >= 0 && xCOffset < "+n+") {\n                      xTexelR"+d+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+d+"C"+p+" = vec4(0.);\n                    }\n                  "),h+="\n                  xR"+d+"C"+(p+1)+" = vec4(\n                    xTexelR"+d+"C"+p+".zw, xTexelR"+d+"C"+(p+2)+".xy);\n                "):h+="\n                  xCOffset = xC + "+m+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+d+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+d+"C"+(p+1)+" = xTexelR"+d+"C"+(p+2)+";\n                "}}else p<c&&(h+="\n              if(xR >= 0 && xR < "+t+") {\n            ",o%2==1?(h+="\n                xCOffset = xC + 1 - "+i+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+d+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+p+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+n+") {\n                  xTexelR"+d+"C"+(p+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+d+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+d+"C"+p+" = vec4(\n                  xTexelR"+d+"C"+p+".zw, xTexelR"+d+"C"+(p+2)+".zw);\n              ",p+1<c&&(h+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+i+";\n                  if(xCOffset >= 0 && xCOffset < "+n+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+d+"C"+(p+1)+" = vec4(xTexelR"+d+"C"+(p+2)+".xy, final.xy);\n                ")):(h+="\n                if(xC >= 0 && xC < "+n+") {\n                  xTexelR"+d+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+d+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+i+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+d+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+d+"C"+p+" = vec4(\n                  xTexelR"+d+"C"+p+".xy, xTexelR"+d+"C"+(p+2)+".xy);\n              ",p+1<c&&(h+="\n                  xR"+d+"C"+(p+1)+" = vec4(\n                    xTexelR"+d+"C"+p+".zw, xTexelR"+d+"C"+(p+2)+".zw);\n                ")),h+="}");p<c&&(h+="\n            vec4 wTexelR"+d+"C"+p+" = getW("+d+", "+p+", d1, q);\n            wR"+d+"C"+p+" = vec4(wTexelR"+d+"C"+p+".xz, wTexelR"+d+"C"+p+".xz);\n          ",p+1<c&&(h+="\n              vec4 wTexelR"+d+"C"+(p+1)+" = getW("+d+", "+(p+1)+", d1, q);\n              wR"+d+"C"+(p+1)+" =\n                vec4(wTexelR"+d+"C"+(p+1)+".xz, wTexelR"+d+"C"+(p+1)+".xz);"))}for(d=0;d<l;d++)for(p=0;p<c;p++)h+="result += xR"+d+"C"+p+" * wR"+d+"C"+p+";";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},lr=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],f=n[1];this.outputShape=[l,c,f,u];var h="bilinear"===r?1:0,d=[i-1+".0",s-1+".0"],p=d[0],v=d[1],m=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],y=m[1],b=m[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=x[0],C=x[1],E=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+C+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+E+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+h+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},cr=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Cn(r)+" coords = getOutputCoords();\n        int end = "+fr(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+fr(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function fr(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var hr=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),dr=function(e){this.variableNames=["A"];var t=cn();this.outputShape=e,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isnan(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},pr="return real * expR - imag * expI;",vr="return real * expI + imag * expR;",mr=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},gr=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),yr=function(e){this.variableNames=["A"];var t=cn(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},br=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=Cn(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "};var xr,wr,Cr=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Cn(t.length),o=Cn(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Er(e,t){return[t,e]}function Sr(e,t){return e*t}function kr(e,t,n){var r=function(e,t){if(e%t!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+t);return e/t}(e.length,n);if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var o=0,a=0;a<e.length;a+=n)t[o++]=e[a]}function Rr(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Ir(e,t){var n=Rr(e,t);return n[0]*n[1]*4}function _r(e,t,n,r,o){var a=n*r;if(o.length<a)throw new Error("matrix length ("+o.length+") must be >= "+a);for(var i=r%2==1,s=n%2==1,u=Math.floor(r/2),l=Math.floor(n/2),c=Math.ceil(r/2),f=c*Math.ceil(n/2),h=S(n)*S(r),d=0;d<t;d++){for(var p=d*n*r,v=d*h,m=i?4:0,g=r+(i?1:0),y=v,b=p,x=p+r,w=0;w<l;++w){for(var C=0;C<u;++C)o[b++]=e[y++],o[b++]=e[y++],o[x++]=e[y++],o[x++]=e[y++];y+=m,b+=g,x+=g}if(i){y=v+4*(c-1);var E=p+r-1;for(m=4*c,g=2*r,w=0;w<l;++w)o[E]=e[y],o[E+r]=e[y+2],y+=m,E+=g}if(s){for(y=v+4*(f-c),E=p+(n-1)*r,C=0;C<u;++C)o[E++]=e[y++],o[E++]=e[y++],y+=2;i&&(o[p+n*r-1]=e[y])}}return o}function Nr(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Ar(e,t))}(e),r}!function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(xr||(xr={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(wr||(wr={}));function Tr(e){return!!($e.get("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Ar(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Dr(e,t,n){return eo(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Or(e,t,n){var r=eo(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Nr(e,t,function(){return e.shaderSource(r,n)}),Nr(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Mr(e,t,n){var r=eo(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Nr(e,t,function(){return e.shaderSource(r,n)}),Nr(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=Fr.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map(function(e,t){return P((t+1).toString(),a)+e}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),f=i.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+P(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Fr=/ERROR: [0-9]+:([0-9]+):/g;function Pr(e,t){return eo(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function Lr(e,t,n){if(Nr(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Br(e,t,n){if(Nr(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function zr(e,t,n){var r=eo(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Nr(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Nr(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Wr(e,t,n){var r=eo(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Nr(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),Nr(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Ur(){return 2===$e.get("WEBGL_VERSION")?1:4}function Vr(e,t){return eo(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function jr(e,t){var n=$e.get("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Gr(e,t){return eo(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Hr(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Nr(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),Nr(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),Nr(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function qr(e,t,n,r){to(e,r),Nr(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),Nr(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function Kr(e,t,n,r){return eo(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function Xr(e,t,n){return e.getUniformLocation(t,n)}function $r(e,t,n,r,o,a){Nr(e,t,function(){return qr(e,t,r,a)}),Nr(e,t,function(){return e.uniform1i(o,a)})}function Yr(e,t,n,r){Nr(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),Nr(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function Qr(e,t,n){Nr(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),Nr(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Jr(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Zr(e,t))}function Zr(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function eo(e,t,n,r){var o=Nr(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function to(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function no(e,t){return void 0===t&&(t=2),A(e.slice(0,e.length-t))}function ro(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function oo(e,t){var n;void 0===t&&(t=!1);var r=$e.get("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?S(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=W(e);e=o.newShape}var a=A(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=no(e),s=2,u=2;return e.length&&(s=(n=ro(e))[0],u=n[1]),F(a=i*(s/2)*(u/2)).map(function(e){return 2*e})}return F(a)}function ao(e){return e%2==0}function io(e,t){if(D(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(ao(n)&&ao(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&ao(e[0])&&ao(t[0])}var so=Object.freeze({callAndCheck:Nr,canBeRepresented:Tr,getWebGLErrorMessage:Ar,getExtensionOrThrow:Dr,createVertexShader:Or,createFragmentShader:Mr,createProgram:Pr,linkProgram:Lr,validateProgram:Br,createStaticVertexBuffer:zr,createStaticIndexBuffer:Wr,getNumChannels:Ur,createTexture:Vr,validateTextureSize:jr,createFramebuffer:Gr,bindVertexBufferToProgramAttribute:Hr,bindTextureUnit:qr,unbindTextureUnit:function(e,t,n){to(e,n),Nr(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),Nr(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Kr,getProgramUniformLocation:Xr,bindTextureToProgramUniformSampler:$r,bindCanvasToFramebuffer:function(e,t){Nr(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Nr(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),Nr(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:Yr,unbindColorTextureFromFramebuffer:Qr,validateFramebuffer:Jr,getFramebufferErrorMessage:Zr,getBatchDim:no,getRowsCols:ro,getTextureShapeFromLogicalShape:oo,isReshapeFree:io});function uo(e,t){var n=cn();return Or(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function lo(e,t){return zr(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function co(e,t){return Wr(e,t,new Uint16Array([0,1,2,2,1,3]))}function fo(e,t){var n,r,o,a,i,s,u,l,c=e;return 2===$e.get("WEBGL_VERSION")?(n=c.R32F,r=c.R16F,o=c.RGBA16F,a=c.RGBA32F,i=c.RED,s=4,u=1,l=c.HALF_FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=c.RGBA,i=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function ho(e,t,n,r,o,a,i){jr(n,r);var s=Vr(e,t),u=e.TEXTURE_2D;return Nr(e,t,function(){return e.bindTexture(u,s)}),Nr(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),Nr(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),Nr(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),Nr(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),Nr(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),Nr(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function po(e,t,n,r,o){var a=Er(n,r);return ho(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function vo(e,t,n,r,o){var a=Er(n,r);return ho(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function mo(e,t,n,r,o){var a=Er(n,r);return ho(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function go(e,t,n,r,o){var a=Rr(n,r);return ho(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function yo(e,t,n,r,o){var a=Rr(n,r);return ho(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function bo(e,t,n,r){return Nr(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Hr(e,t,n,"clipSpacePos",r,3,20,0)&&Hr(e,t,n,"uv",r,2,20,12)}function xo(e,t,n,r){Nr(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),Nr(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),Nr(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function wo(e,t,n,r,o,a,i){jr(r,o),Nr(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),Nr(e,t,function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,o,i,e.FLOAT,a)}),Nr(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function Co(e,t,n,r,o,a,i,s){var u,l=Er(r,o),c=l[0],f=l[1],h=r*o;1===s.defaultNumChannels&&h===a.length?u=a:function(e,t,n){var r=Sr(e.length,n);if(t.length<r)throw new Error("unpackedArray length ("+t.length+") must be >= "+r);for(var o=0,a=0;a<e.length;++a)t[o]=e[a],o+=n}(a,u=new Float32Array(h*i),i),wo(e,t,n,c,f,u,s.textureFormatFloat)}function Eo(e,t,n,r,o,a,i,s,u,l){var c=Rr(i,s),f=c[0],h=c[1],d=new Float32Array(Ir(i,s));(function(e,t,n,r,o){for(var a=r%2==1,i=n%2==1,s=Math.floor(r/2),u=Math.floor(n/2),l=Math.ceil(r/2),c=l*Math.ceil(n/2),f=S(n)*S(r),h=0;h<t;h++){for(var d=h*n*r,p=h*f,v=a?4:0,m=r,g=p,y=0;y<u;++y){for(var b=2*y*r,x=0;x<s;++x){var w=d+b+2*x;o[g]=e[w],o[g+1]=e[w+1],o[g+2]=e[w+m],o[g+3]=e[w+m+1],g+=4}g+=v}if(a){w=d+r-1,g=p+4*(l-1);var C=2*r;for(v=4*l,y=0;y<u;++y)o[g]=e[w],o[g+2]=e[w+r],w+=C,g+=v}if(i){for(w=d+(n-1)*r,g=p+4*(c-l),x=0;x<s;++x)o[g++]=e[w++],o[g++]=e[w++],g+=2;a&&i&&(o[p+f-4]=e[w])}}})(u,r,o,a,d),wo(e,t,n,f,h,d,e.RGBA)}function So(e,t,n,r,o,a){var i=n;if(2===$e.get("WEBGL_VERSION")){var s=e,u=s.createBuffer();Nr(e,t,function(){return e.bindBuffer(s.PIXEL_PACK_BUFFER,u)});var l=4*Sr(r*o,a.downloadUnpackNumChannels);Nr(e,t,function(){return e.bufferData(s.PIXEL_PACK_BUFFER,l,s.STREAM_READ)}),Nr(e,t,function(){return s.readPixels(0,0,o,r,e.RGBA,e.FLOAT,0)}),Nr(e,t,function(){return e.bindBuffer(s.PIXEL_PACK_BUFFER,null)}),i=u}return i}function ko(e,t,n,r,o){var a=e,i=new Float32Array(Sr(n*r,o.downloadUnpackNumChannels));a.bindBuffer(a.PIXEL_PACK_BUFFER,t),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,i),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var s=new Float32Array(n*r);return kr(i,s,o.downloadUnpackNumChannels),s}function Ro(e,t,n,r,o){var a=Er(n,r),i=a[0],s=a[1],u=new Float32Array(Sr(n*r,o.downloadUnpackNumChannels));Nr(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.FLOAT,u)});var l=new Float32Array(n*r);return kr(u,l,o.downloadUnpackNumChannels),l}function Io(e,t,n,r,o){var a=Er(n,r),i=a[0],s=a[1],u=new Uint8Array(Sr(n*r,4));return Nr(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function _o(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(Ir(a,i));u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null);var c=new Float32Array(A([n,r,o]));return _r(l,n,r,o,c),c}function No(e,t,n,r,o,a,i,s){var u=Rr(a,i),l=u[0],c=u[1],f=new Float32Array(Ir(a,i));Nr(e,t,function(){return e.readPixels(0,0,l,c,e.RGBA,e.FLOAT,f)});var h=new Float32Array(A([n,r,o]));return _r(f,n,r,o,h)}var To=Object.freeze({createVertexShader:uo,createVertexBuffer:lo,createIndexBuffer:co,getTextureConfig:fo,createFloat32MatrixTexture:po,createFloat16MatrixTexture:vo,createUnsignedBytesMatrixTexture:mo,createPackedMatrixTexture:go,createFloat16PackedMatrixTexture:yo,bindVertexProgramAttributeStreams:bo,uploadPixelDataToTexture:xo,uploadMatrixToTexture:Co,uploadMatrixToPackedTexture:Eo,maybeCreateBufferFromOutputTexture:So,downloadFloat32MatrixFromBuffer:ko,downloadFloat32MatrixFromOutputTexture:Ro,downloadByteEncodedFloatMatrixFromOutputTexture:Io,downloadPackedMatrixFromBuffer:_o,downloadMatrixFromPackedOutputTexture:No}),Ao=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=$e.get("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){b[e]=t}(t,e)):this.gl=w(t),1===$e.get("WEBGL_VERSION")?(this.textureFloatExtension=Dr(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),$e.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Dr(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Dr(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=lo(this.gl,this.debug),this.indexBuffer=co(this.gl,this.debug),this.framebuffer=Gr(this.gl,this.debug),this.textureConfig=fo(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return $e.get("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Nr(t,this.debug,function(){return t.finish()}),Nr(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Nr(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Nr(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Nr(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Nr(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),po(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),vo(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),mo(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),xo(this.gl,this.debug,e,t)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),yo(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),go(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Qr(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Nr(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.uploadMatrixToTexture=function(e,t,n,r){this.throwIfDisposed();var o=Ur();return Co(this.gl,this.debug,e,t,n,r,o,this.textureConfig)},e.prototype.uploadMatrixToPackedTexture=function(e,t,n,r,o,a,i){return this.throwIfDisposed(),Eo(this.gl,this.debug,e,t,n,r,o,a,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Ro(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Io(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return _o(this.gl,e,t,n,r,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t,n){return ko(this.gl,e,t,n,this.textureConfig)},e.prototype.maybeCreateBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=So(this.gl,this.debug,e,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if($e.get("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else $e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,$e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n,r,o,a){var i=this;return this.downloadMatrixDriver(e,function(){return No(i.gl,i.debug,t,n,r,o,a,i.textureConfig)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=Mr(t,this.debug,e),r=uo(t,this.debug),o=Pr(t,this.debug);return Nr(t,this.debug,function(){return t.attachShader(o,r)}),Nr(t,this.debug,function(){return t.attachShader(o,n)}),Lr(t,this.debug,o),this.debug&&Br(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=bo(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Nr(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Br(this.gl,this.debug,this.program),Nr(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Kr(this.gl,this.debug,e,t):Xr(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Nr(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),$r(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Rr(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&Br(this.gl,this.debug,this.program),Jr(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Nr(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Nr(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Dr(this.gl,this.debug,2===$e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===$e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==$e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return g(this,void 0,void 0,function(){var t=this;return y(this,function(n){switch(n.label){case 0:return[4,L(function(){return t.disposed||t.isQueryAvailable(e,$e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,$e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||L(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Yr(this.gl,this.debug,e,this.framebuffer),this.debug&&Jr(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Yr(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Jr(this.gl)):Qr(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Yr(r,this.debug,e,this.framebuffer),this.debug&&Jr(r),this.outputTexture=e,Nr(r,this.debug,function(){return r.viewport(0,0,t,n)}),Nr(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),Nr(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Do(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!D(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!D(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var Oo=function(e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,f=s.left,h=s.top,d=o*r,p=cn();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+e[1]+" || pos >= "+e[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+u+")) * "+i+" - "+h+";\n            int d0 = offsetY + "+c+" * (pos / "+d+");\n\n            if(d0 >= "+t[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+f+".);\n            int d1 = offsetX + "+l+" * (int(mod(float(pos), "+d+".) / "+o+".));\n\n            if(d1 >= "+t[1]+" || d1 < 0) continue;\n\n            vec2 innerDims = vec2(d1, int(mod(float(pos), "+o+".)));\n            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),\n                                              int(innerDims.y)), innerDims);\n          }\n        }\n\n        "+p.output+" = result;\n      }\n    "},Mo=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Fo=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Po=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Lo=function(e,t,n,r,o,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=t;var i=n?e[1]:e[2],s=Math.ceil(i/2),u=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",d="";a&&(h="vec4 activation(vec4 x) {\n        "+a+"\n      }",d="result = activation(result);");var p=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          result += ("+c[0]+" * "+f[0]+") + ("+c[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+p+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},Bo=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),zo=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},Wo=function(e){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=an("rc",t),r=Cn(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}};var Uo=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=Cn(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Vo=function(e,t,n){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=Cn(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=an("rc",r),u=an("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=1===r?2:4;p<v;p++)d+="\n        "+f[p]+"\n        if ("+h+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";d+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+d+"\n        setOutput(result);\n      }\n    "},jo=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var h="avg"===t,d="0.0";if(h||(d="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+c+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+c+", "+f+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Go=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===t?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var d="";o%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},Ho=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      "+function(e){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+fn(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  "}(t)+"\n      "+function(e){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+function(e,t){if(e.length!==t.length)throw new Error("Vectors to be dotted must be of the same length -got "+e.length+" and "+t.length);for(var n=[],r=Math.floor(e.length/4),o=e.length%4,a=0;a<r;a++){var i=e.slice(4*a,4*a+4),s=t.slice(4*a,4*a+4);n.push(hn(i)+", "+hn(s))}return 0!==o&&(i=e.slice(4*r),s=t.slice(4*r),1===i.length&&(i=i.map(function(e){return"float("+e+")"}),s=s.map(function(e){return"float("+e+")"})),n.push(hn(i)+", "+hn(s))),n.map(function(e,t){return"dot("+e+")"}).join("+")}(["coords.x","coords.y","coords.z"],te(e).map(function(e){return e.toString()}).concat(["1."]))+");\n    }\n  "}(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "};var qo=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],h=l[1]/c[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Ko=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Xo=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+"; \n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},$o=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],h=l[1]/c[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Yo=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Qo=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=Cn(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},Jo=function(e,t){this.variableNames=["x"],this.usesPackedTextures=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=an("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=Cn(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1), rc);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1), rc + 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Zo=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=Cn(o.length),u=Cn(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices("+l+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var h="getUpdates("+f+")",d=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+d+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+h+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},ea=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},ta=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=Cn(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},na=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Cn(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return ra.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+ra[t]+" = start["+t+"] + coords."+ra[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),ra=["x","y","z","w","u","v"];var oa=function(){function e(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=Cn(this.rank),n=an("coords",this.rank),r=an("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+" \n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),aa=function(e,t,n,r){this.variableNames=["x"];var o=n.filter(function(e,t){return-1===r.indexOf(t)});this.outputShape=o;var a=n.length,i=Cn(n.length),s=Cn(o.length),u="";if(1===a)u="coords * strides + begin";else{var l=0;u=n.map(function(e,t){return-1===r.indexOf(t)?(l++,1===o.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(l-1)+"] * strides["+t+"] + begin["+t+"]"):"begin["+t+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},ia=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=sa(t,n),a=ua(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===wr.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===wr.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===wr.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===wr.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===wr.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=ua(t,sa(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function sa(e,t){if(e===xr.UPLOAD)return t?wr.PACKED_2X2_FLOAT32:wr.UNPACKED_FLOAT32;if(e===xr.RENDER||null==e)return t?$e.get("WEBGL_RENDER_FLOAT32_ENABLED")?wr.PACKED_2X2_FLOAT32:wr.PACKED_2X2_FLOAT16:$e.get("WEBGL_RENDER_FLOAT32_ENABLED")?wr.UNPACKED_FLOAT32:wr.UNPACKED_FLOAT16;if(e===xr.DOWNLOAD||e===xr.PIXELS)return wr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function ua(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var la=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=Cn(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "};var ca=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=Cn(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "};var fa=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Cn(this.rank),a=on("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},ha=.3275911,da=.254829592,pa=-.284496736,va=1.421413741,ma=-1.453152027,ga=1.061405429,ya=1.7580993408473768,ba=1.0507009873554805,xa=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},wa="if (isnan(x)) return x;",Ca=wa+"\n  return (x < 0.0) ? 0.0 : x;\n",Ea="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+ya+";\n  float scale = "+ba+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n";var Sa="return exp(x);",ka=wa+"\n  return sin(x);\n",Ra=wa+"\n  return cos(x);\n",Ia=wa+"\n  return atan(x);\n",_a=wa+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",Na=wa+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Ta='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+ha+";\n  float a1 = "+da+";\n  float a2 = "+pa+";\n  float a3 = "+va+";\n  float a4 = "+ma+";\n  float a5 = "+ga+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n",Aa="return x;",Da="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Oa=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Ma=function(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var t=e.length,n=an("rc",t),r=Cn(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "};var Fa=_t({concat_:function(e,t){void 0===t&&(t=0),I(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=et(e,"tensors","concat");t=z(t,n[0].shape)[0];var r=yt(n.map(function(e){return e.shape}),t);if(0===A(r))return Mt([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});!function(e,t){var n=e[0].length;e.forEach(function(e,t){I(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),I(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var a=0;a<n;a++)I(a===t||e[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}(o,t);var a=n;return $e.engine.runKernel(function(e){return e.concat(n,t)},a,function(e){var n=o.map(function(e){return e[t]});return Wa(e,n,t).map(function(e){return function(){return e}})})}}),Pa=_t({concat1d_:function(e){return Fa(e,0)}}),La=_t({concat2d_:function(e,t){return Fa(e,t)}}),Ba=_t({concat3d_:function(e,t){return Fa(e,t)}}),za=_t({concat4d_:function(e,t){return Fa(e,t)}}),Wa=_t({split_:function(e,t,n){void 0===n&&(n=0);var r,o=Ze(e,"x","split");return n=z(n,o.shape)[0],"number"==typeof t?(I(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(I(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),$e.engine.runKernel(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return Fa(e,n)}}})}});"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;function Ua(e,t){return e(t={exports:{}},t.exports),t.exports}var Va=Ua(function(e){!function(e,t){function n(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function r(e,t){var r=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),o=t&&t.state,a=r.next;return a.int32=function(){return 4294967296*r.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.alea=r}(0,e)}),ja=Ua(function(e){!function(e,t){function n(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function r(e,t){var r=new function(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xor128=r}(0,e)}),Ga=Ua(function(e){!function(e,t){function n(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function r(e,t){var r=new function(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xorwow=r}(0,e)}),Ha=Ua(function(e){!function(e,t){function n(e,t){return t.x=e.x.slice(),t.i=e.i,t}function r(e,t){null==e&&(e=+new Date);var r=new function(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&(o.x&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xorshift7=r}(0,e)}),qa=Ua(function(e){!function(e,t){function n(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function r(e,t){null==e&&(e=+new Date);var r=new function(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&(o.X&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.xor4096=r}(0,e)}),Ka=Ua(function(e){!function(e,t){function n(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function r(e,t){var r=new function(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),o=t&&t.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&n(o,r),a.state=function(){return n(r,{})}),a}t&&t.exports?t.exports=r:this.tychei=r}(0,e)}),Xa=Ua(function(e){!function(t,r){var o,a=this,i=256,s="random",u=r.pow(i,6),l=r.pow(2,52),c=2*l,f=255;function h(e,n,h){var m=[],g=p(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),v(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,v(t)]}}():e,3),m),y=new function(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=f&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=f&o+1],n=n*i+s[f&(s[o]=s[a=f&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}(m),b=function(){for(var e=y.g(6),t=u,n=0;e<l;)e=(e+n)*i,t*=i,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,p(v(y.S),t),(n.pass||h||function(e,t,n,o){return o&&(o.S&&d(o,y),e.state=function(){return d(y,{})}),n?(r[s]=e,t):e})(b,g,"global"in n?n.global:this==r,n.state)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){for(var n,r=e+"",o=0;o<r.length;)t[f&o]=f&(n^=19*t[f&o])+r.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=h,p(r.random(),t),e.exports){e.exports=h;try{o=n(Object(function(){var e=new Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(e){}}}([],Math)});Xa.alea=Va,Xa.xor128=ja,Xa.xorwow=Ga,Xa.xorshift7=Ha,Xa.xor4096=qa,Xa.tychei=Ka;var $a=Xa.alea,Ya=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=$a(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}();function Qa(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",ue(e),new me(e,t,n)}var Ja=_t({batchToSpaceND_:function(e,t,n){var r=Ze(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return I(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),I(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),I(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),$e.engine.runKernel(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),Za=_t({cast_:function(e,t){var n=Ze(e,"x","cast");return $e.engine.runKernel(function(e){return e.cast(n,t)},{$x:n},function(e){return{$x:function(){return e.clone()}}})}}),ei=_t({clone_:function(e){var t=Ze(e,"x","clone",null);return $e.engine.runKernel(function(e){return xe.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),ti=_t({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=Ze(e,"x","cumsum"),a=vt([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=gt(1,o.rank)[0],u=$e.engine.runKernel(function(e){return e.cumsum(i,s,n,r)},{permutedX:i},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=a&&(u=u.transpose(a)),u}}),ni=_t({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=Ze(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return I(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),I(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),I(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),$e.engine.runKernel(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),ri=_t({expandDims_:function(e,t){void 0===t&&(t=0);var n=Ze(e,"x","expandDims");I(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(I(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),vi(n,r)}}),oi=_t({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=Qa([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return bi(ri(s,0),[n[0],1,1]);if(2===n.length)return bi(ri(ri(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return bi(ri(ri(ri(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),ai=_t({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=Ze(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=$e.engine.runKernel(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===i?u.as1D():u}}),ii=_t({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=Ze(e,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),$e.engine.runKernel(function(e){return e.oneHot(o,t,n,r)},{$indices:o},function(e){return{$indices:function(){return Ut(o.shape,"float32")}}}).reshape(a)}}),si=_t({pad_:function(e,t,n){void 0===n&&(n=0);var r=Ze(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=t.map(function(e){return e[0]});return $e.engine.runKernel(function(e){return e.pad(r,t,n)},{$x:r},function(e){return{$x:function(){return e.slice(o,r.shape)}}})}}),ui=_t({pad1d_:function(e,t,n){return void 0===n&&(n=0),I(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),si(e,[t],n)}}),li=_t({pad2d_:function(e,t,n){return void 0===n&&(n=0),I(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),si(e,t,n)}}),ci=_t({pad3d_:function(e,t,n){return void 0===n&&(n=0),I(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),si(e,t,n)}}),fi=_t({pad4d_:function(e,t,n){return void 0===n&&(n=0),I(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),si(e,t,n)}}),hi=_t({rand_:function(e,t,n){var r=A(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return xe.make(e,{values:o},n)}}),di=_t({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Ya(t,n,r,!1,o),i=Qa(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),pi=_t({randomUniform_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var o=Qa(e,r),a=0;a<o.values.length;a++)o.values[a]=R(t,n);return o.toTensor()}}),vi=_t({reshape_:function(e,t){var n=Ze(e,"x","reshape",null);return t=B(t,n.size),I(n.size===A(t),function(){return"new shape and old shape must have the same number of elements."}),$e.engine.runKernel(function(e){return e.reshape(n,t)},{$x:n},function(e){return{$x:function(){return e.reshape(n.shape)}}})}}),mi=_t({spaceToBatchND_:function(e,t,n){var r=Ze(e,"x","spaceToBatchND");return I(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),I(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),I(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),$e.engine.runKernel(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),gi=_t({squeeze_:function(e,t){var n=Ze(e,"x","squeeze");return vi(n,W(n.shape,t).newShape)}}),yi=_t({stack_:function(e,t){void 0===t&&(t=0);var n=et(e,"tensors","stack");if(I(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;I(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){_(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){I(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(e){return e.expandDims(t)});return Fa(i,t)}}),bi=_t({tile_:function(e,t){var n=Ze(e,"x","tile");return I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}),$e.engine.runKernel(function(e,r){var o=e.tile(n,t);return r([n]),o},{$x:n},function(e,n){var r=n[0];return{$x:function(){var n=Ht(r);if(1===r.rank)for(var o=0;o<t[0];++o)n=n.add(e.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<t[0];++o)for(var a=0;a<t[1];++a)n=n.add(e.slice([o*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(var i=0;i<t[2];++i)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(i=0;i<t[2];++i)for(var s=0;s<t[3];++s)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}})}}),xi=_t({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Ya(t,n,r,!0,o),i=Qa(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),wi=_t({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=Ze(e,"x","unstack");return I(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length),$e.engine.runKernel(function(e){return e.unstack(n,t)},{$x:n},function(e){return{$x:function(){return yi(e,t)}}})}}),Ci=function(e,t){return g(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f;return y(this,function(h){switch(h.label){case 0:return n=Ze(e,"x","setdiff1d"),r=Ze(t,"y","setdiff1d"),I(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),I(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),I(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(a=h.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new me([s],n.dtype),l=new me([s],"int32"),c=0,f=0;c<o.length;c++)i.has(o[c])||(u.values[f]=o[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Ei(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Qa(e,"int32"),a=Qa([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var Si={};var ki=function(){function e(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,$e.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(null==e){var t=w($e.get("WEBGL_VERSION"));this.binaryCache=function(e){return e in Si||(Si[e]={}),Si[e]}($e.get("WEBGL_VERSION")),this.gpgpu=new Ao(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new ia(this.gpgpu)}return e.prototype.register=function(e,t,n){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:n})},e.prototype.setDataMover=function(e){this.texData=new qt(e)},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[e.height,e.width],r=[e.height,e.width,t];if($e.get("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var o=this.makeTensorHandle(n,"int32");this.texData.get(o.dataId).usage=xr.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(o.dataId),e);var a=new yr(r),i=this.compileAndRun(a,[o]);return this.disposeData(o.dataId),i},e.prototype.makeTensorHandle=function(e,t){var n={};return this.register(n,e,t),{dataId:n,shape:e,dtype:t}},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");if($e.get("DEBUG"))for(var n=0;n<t.length;n++){var r=t[n];if(!Tr(r))throw Error("The value "+r+" cannot be represented on this device.")}var o=this.texData.get(e),a=o.texture,i=o.texShape,s=o.usage,u=o.dtype,l=o.isPacked;if("complex64"===u)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=a&&(this.releaseTexture(e,a,i,s,u,l),o.texture=null,o.texShape=null),o.usage=xr.UPLOAD,o.values=t},e.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape;if(null!=a){var s=new xa(i,Aa),u=this.compileAndRun(s,[{dataId:e,shape:i,dtype:r}]),l=this.readSync(u.dataId);return u.dispose(),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var c,f,h=null!=this.activeTimers;return h&&(c=performance.now()),f="complex64"===r?$t(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=performance.now()-c),this.convertAndCacheOnCPU(e,f)},e.prototype.read=function(e){return g(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f,h,d,p,v,m,g,b,x,w,C,E,S,k;return y(this,function(y){switch(y.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(e){return r.push(e)})];if(o=this.texData.get(e),a=o.texture,i=o.values,s=o.texShape,u=o.isPacked,l=o.shape,c=o.slice,f=o.dtype,null!=c)return h=new xa(l,Aa),d=this.compileAndRun(h,[{dataId:e,shape:l,dtype:f}]),p=this.read(d.dataId),d.dispose(),[2,p];if(null!=i)return[2,this.convertAndCacheOnCPU(e)];if(this.pendingRead.set(e,[]),!$e.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===$e.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return v=s[1],m=s[0],u&&(t=Rr(s[0],s[1]),v=t[0],m=t[1]),g=this.gpgpu.maybeCreateBufferFromTexture(a,m,v),[4,this.gpgpu.createAndWaitForFence()];case 1:return y.sent(),g instanceof WebGLTexture?b=this.getValuesFromTexture(e):(x=A(l),u?(w=no(l),C=1,E=1,l.length&&(n=ro(l),C=n[0],E=n[1]),b=this.gpgpu.downloadPackedMatrixFromBuffer(g,w,C,E,s[0],s[1]).subarray(0,x)):b=this.gpgpu.downloadFloat32MatrixFromBuffer(g,s[0],s[1]).subarray(0,x)),S=this.convertAndCacheOnCPU(e,b),k=this.pendingRead.get(e),this.pendingRead.delete(e),k.forEach(function(e){return e(S)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,S]}})})},e.prototype.getValuesFromTexture=function(e){var t,n=this,r=this.texData.get(e),o=r.shape,a=r.dtype,i=r.texture,s=r.texShape,u=A(o);if($e.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(e).isPacked){var l=no(o),c=1,f=1;return o.length&&(c=(t=ro(o))[0],f=t[1]),this.gpgpu.downloadMatrixFromPackedTexture(i,l,c,f,s[0],s[1]).subarray(0,u)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(i,s[0],s[1]).subarray(0,u)}var h=this.makeTensorHandle(o,"float32");h.size=A(o),this.texData.get(h.dataId).usage=xr.DOWNLOAD;var d=nt(function(){var t=new dr(o);return n.compileAndRun(t,[{shape:o,dtype:a,dataId:e}],h,null,!1)}),p=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,u);return this.disposeData(h.dataId),v},e.prototype.time=function(e){return g(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return y(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=T(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),a=T(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return i=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:k(i),getExtraProfileInfo:function(){return i.map(function(e,t){return{name:a[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return $e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return $e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},e.prototype.getQueryTime=function(e){return g(this,void 0,void 0,function(){var t;return y(this,function(n){return $e.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},e.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e))if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.complexTensors,s=t.isPacked,u=t.slice;if(null!=n){var l=u&&u.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),this.releaseTexture(e,n,o,a,r,s),this.texData.delete(e))}null!=i&&(i.real.dispose(),i.imag.dispose())}},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getCPUBackend=function(){return $e.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=$e.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&e.size<t})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.getCanvas=function(){return this.canvas},e.prototype.complex=function(e,t){var n=this.makeOutputArray(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:$e.engine.keep(e.clone()),imag:$e.engine.keep(t.clone())},n},e.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},e.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);var r=this.texData.get(e.dataId).isPacked,o=Rt(e.shape,t,n);if(r||!o){var a=$e.get("WEBGL_PACK_ARRAY_OPERATIONS")?new oa(n):new na(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},e.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=xe.make(n,{},e.dtype,this),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=It(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r,o,a,i,s,u);var l=Et(e.shape,t,n,r,o,a,i,s,u),c=l[0],f=l[1],h=l[2],d=f.filter(function(e,t){return-1===h.indexOf(t)});if(d.some(function(e){return 0===e}))return Mt([],d);var p=new aa(c,r,f,h);return this.compileAndRun(p,[e])},e.prototype.reverse=function(e,t){var n=$e.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Jo(e.shape,t):new Qo(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>$e.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),r=this.concat(e.slice(0,n),t),o=this.concat(e.slice(n),t);return this.concat([r,o],t)}if($e.get("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new Jn(e.map(function(e){return e.shape}),t);return this.compileAndRun(a,e)}var i=yt(e.map(function(e){return e.shape}),t),s=e.map(function(e){return e.as2D(-1,A(e.shape.slice(t)))}),u=new Qn(s.map(function(e){return e.shape}));return this.compileAndRun(u,s).reshape(i)},e.prototype.neg=function(e){var t=new xa(e.shape,"return -x;");return this.compileAndRun(t,[e])},e.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,i,1),l=1===a?2:1,c=1===a?t.as3D(s,1,i):t;return this.multiply(u,c).sum(l,!0)}var f=_e(e.dtype,t.dtype),h=new Lo(e.shape,[s,o,a],n,r),d=this.makePackedTensor(h.outputShape,f);return this.compileAndRun(h,[e,t],d)},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){var i=n?e.shape[2]:e.shape[1],s=r?t.shape[1]:t.shape[2],u=e.shape[0],l=_e(e.dtype,t.dtype),c=new Lo(e.shape,[u,i,s],n,r,!!o,a?function(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?Da:Ca;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}(a,!0):null),f=this.makePackedTensor(c.outputShape,l),h=[e,t];return o&&h.push(o),this.compileAndRun(c,h,f)},e.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new An(Nn,e.shape,t.shape),a=new An(Tn,e.shape,t.shape),i=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag),this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Fn,e.dtype);var c=new Wn(Fn,e.shape,t.shape),f=this.makeOutputArray(c.outputShape,e.dtype);return this.compileAndRun(c,[e,t],f)},e.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),$e.get("WEBGL_PACK_BATCHNORMALIZATION")){var l=new _n(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)}var c=new In(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=new Mo(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new Fo(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},e.prototype.tile=function(e,t){var n=new la(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.pad=function(e,t,n){var r=$e.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Vo(e.shape,t,n):new Uo(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=$e.get("WEBGL_PACK_ARRAY_OPERATIONS")?new fa(e.shape,t):new ca(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new br(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},e.prototype.batchToSpaceND=function(e,t,n){I(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=it(e.shape,t,r),a=st(o.length,t.length),i=ut(e.shape,t,r),s=lt(n,t.length),u=ct(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){I(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=it(i.shape,t,r,!1),u=st(s.length,t.length,!1),l=ut(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=xt(o),i=new Go({windowSize:a,inSize:o,batchSize:r},t),s=i.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],n);return this.compileAndRun(i,[e],c),1===c.shape[1]?c:this.reduce(c,t,n)},e.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=xt(o),i=new rn({windowSize:a,inSize:o,batchSize:r},t,null==n),s=i.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],"int32"),f=[e];return null!=n&&f.push(n),this.compileAndRun(i,f,c),1===c.shape[1]?c:this.argReduce(e,t,c)},e.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=xt(r[r.length-1]),a=new kn(r,o,t,null==n),i=this.makePackedTensor(a.outputShape,"int32"),s=null==n?[e]:[e,n];return this.compileAndRun(a,s,i),i.rank===e.rank?this.argReducePacked(e,t,i):i},e.prototype.sum=function(e,t){pt("sum",t,e.rank);var n=ht(e.shape,t),r=n[0],o=A(n[1]),a=e.as2D(-1,o),i=Ne(e.dtype);return this.reduce(a,"sum",i).reshape(r)},e.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=ht(e.shape,t),r=n[0],o=A(n[1]),a=e.as2D(-1,o),i=Ne(e.dtype);return this.reduce(a,"prod",i).reshape(r)},e.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=vt([r],e.rank),a=e;null!=o&&(a=e.transpose(o),r=gt(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=A([a.shape[r]]),u=a.as2D(-1,s),l=Ne(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(i);return null!=o&&(c=c.transpose(mt(o))),c},e.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=ee(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ee(e,n+1);return n}(i,o),u=new ea({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),l=u.outputShape,c=l[0],f=l[1],h=this.makeOutputArray([c,f],r);return this.compileAndRun(u,[e,n],h),h.shape[1]===o?h:(n=jt(0,o).tile([i/s]),this.segOpCompute(h,t,n,r,o))},e.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(pt("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!$e.get("WEBGL_PACK_REDUCE")||e.rank<=2){var o=ht(e.shape,r),a=o[0],i=A(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},e.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},e.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},e.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new cr(e.shape,n,r);return this.compileAndRun(o,[e])},e.prototype.equal=function(e,t){if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Wn("return float(a == b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.notEqual=function(e,t){if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Wn("return float(a != b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Wn("return float(a < b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.lessEqual=function(e,t){if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Wn("return float(a <= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Wn("return float(a > b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greaterEqual=function(e,t){if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Wn("return float(a >= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalNot=function(e){var t=new xa(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Wn("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalOr=function(e,t){if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Wn("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.select=function(e,t,n){var r=new ta(e.rank,t.shape,t.rank),o=this.makeOutputArray(r.outputShape,_e(t.dtype,n.dtype));return this.compileAndRun(r,[e,t,n],o)},e.prototype.where=function(e){at("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Ei(e.shape,t)},e.prototype.topk=function(e,t,n){return nn(e.dataSync(),e.shape,e.dtype,t)},e.prototype.min=function(e,t){pt("min",t,e.rank);var n=ht(e.shape,t),r=n[0],o=A(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS")?new Kn(Hn,e.shape,t.shape):new Wn(Bn,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.mod=function(e,t){var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS")?new Kn(qn,e.shape,t.shape):new Wn("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);pt("max",t,e.rank);var n=ht(e.shape,t),r=n[0],o=A(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS")?new Kn(Gn,e.shape,t.shape):new Wn(Ln,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.all=function(e,t){pt("all",t,e.rank);var n=ht(e.shape,t),r=n[0],o=A(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(e,t){pt("any",t,e.rank);var n=ht(e.shape,t),r=n[0],o=A(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.squaredDifference=function(e,t){var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS")?new Kn(Pn,e.shape,t.shape):new Wn(Pn,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.realDivide=function(e,t){var n=new Wn("if (a == b) return 1.0;\n  return a / b;",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e,t],r)},e.prototype.floorDiv=function(e,t){if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  vec4 resultSign = sign(a) * sign(b);\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  ivec4 result = ia / ib;\n  ivec4 amodb = ia - ib * result;\n\n  // Vectorize INT_DIV\n  // if (resultSign < 0.0 && amodb != 0) result -= 1;\n  // return float(result);\n  return vec4(result -\n     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));\n","int32");var n=new Wn("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[e,t],r)},e.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,On);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=_e(e.dtype,t.dtype);if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,On,n);var r=new Wn(On,e.shape,t.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],o)},e.prototype.packedBinaryOp=function(e,t,n,r){var o=new Kn(n,e.shape,t.shape),a=this.makePackedTensor(o.outputShape,r);return this.compileAndRun(o,[e,t],a)},e.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorHandle(e,a),u=r.makeComplexComponentTensorHandle(t,i),l=new Wn(n,e.shape,t.shape),c=r.makeOutputArray(l.outputShape,_e(a.dtype,i.dtype));return r.compileAndRun(l,[s,u],c)}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},e.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},e.prototype.addN=function(e){for(var t=e[0],n=1;n<e.length;n++)t=this.add(t,e[n]);return t},e.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Mn);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=_e(e.dtype,t.dtype);if($e.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Mn,e.dtype);var r=new Wn(Mn,e.shape,t.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],o)},e.prototype.pow=function(e,t){var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS"),r=n?new Kn(Vn,e.shape,t.shape):new Wn("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),o=_e(e.dtype,t.dtype),a=n?this.makePackedTensor(r.outputShape,o):this.makeOutputArray(r.outputShape,o);return this.compileAndRun(r,[e,t],a)},e.prototype.ceil=function(e){var t=new xa(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new xa(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},e.prototype.sign=function(e){var t=new xa(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},e.prototype.isNaN=function(e){var t=new xa(e.shape,"return float(isnan(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isInf=function(e){var t=new xa(e.shape,"return float(isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isFinite=function(e){var t=new xa(e.shape,"return float(!isnan(x) && !isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.round=function(e){var t=new xa(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t;return t=$e.get("WEBGL_PACK")?new Oa(e.shape,Sa):new xa(e.shape,Sa),this.compileAndRun(t,[e])},e.prototype.expm1=function(e){var t=new xa(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t;return t=$e.get("WEBGL_PACK")?new Oa(e.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new xa(e.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(t,[e])},e.prototype.log1p=function(e){var t=new xa(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new xa(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},e.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new xa(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new xa(e.shape,"return x * x;");return this.compileAndRun(t,[e])},e.prototype.reciprocal=function(e){var t=new xa(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t;return t=$e.get("WEBGL_PACK")?new Oa(e.shape,Da):new xa(e.shape,Ca),this.compileAndRun(t,[e])},e.prototype.prelu=function(e,t){var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS")?new Kn("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",e.shape,t.shape):new Wn("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.elu=function(e){var t=new xa(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e,t){var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS")?new Kn("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Wn("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.selu=function(e){var t=new xa(e.shape,Ea);return this.compileAndRun(t,[e])},e.prototype.int=function(e){var t=new xa(e.shape,"return float(int(x));"),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],n)},e.prototype.clip=function(e,t,n){var r,o=(r=$e.get("WEBGL_PACK_CLIP")?new $n(e.shape):new Xn(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},e.prototype.abs=function(e){var t=new xa(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},e.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Yn(e.shape),r=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(e){var t=new xa(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},e.prototype.softplus=function(e){var t=new xa(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new xa(e.shape,ka);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new xa(e.shape,Ra);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new xa(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new xa(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new xa(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new xa(e.shape,Ia);return this.compileAndRun(t,[e])},e.prototype.atan2=function(e,t){var n=$e.get("WEBGL_PACK_BINARY_OPERATIONS")?new Kn(jn,e.shape,t.shape):new Wn(zn,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.sinh=function(e){var t=new xa(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new xa(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new xa(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},e.prototype.asinh=function(e){var t=new xa(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},e.prototype.acosh=function(e){var t=new xa(e.shape,_a);return this.compileAndRun(t,[e])},e.prototype.atanh=function(e){var t=new xa(e.shape,Na);return this.compileAndRun(t,[e])},e.prototype.erf=function(e){var t=new xa(e.shape,Ta);return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var n=new xa(e.shape,function(e){return void 0===e&&(e=0),wa+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},e.prototype.conv2dByMatMul=function(e,t,n){var r=e.shape,o=this.texData.get(e.dataId),a=n.inChannels,i=r[0]*r[1]*r[2],s=n.outChannels,u=(1===i||1===s)&&a>1e3,l=r[2]%2!=0&&!!o.isPacked;if(u||!$e.get("WEBGL_LAZILY_UNPACK")||!$e.get("WEBGL_PACK_BINARY_OPERATIONS")||!l){var c=this.reshape(e,[1,r[0]*r[1]*r[2],n.inChannels]),f=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(c,f,!1,!1),n.outShape)}var h=xe.make([1,r[0]*r[1]*(r[2]+1),n.inChannels],{dataId:e.dataId},e.dtype,this),d=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,I(io(o.shape,h.shape),function(){return"packed reshape "+o.shape+" to "+h.shape+" isn't free"});var p=this.reshape(t,[1,n.inChannels,n.outChannels]),v=this.batchMatMul(h,p,!1,!1),m=this.texData.get(v.dataId);return I(m.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=d,m.shape=n.outShape,xe.make(n.outShape,{dataId:v.dataId},v.dtype,this)},e.prototype.conv2dWithIm2Row=function(e,t,n){var r=n.filterWidth,o=n.filterHeight,a=n.inChannels,i=n.outWidth,s=n.outHeight,u=r*o*a,l=s*i,c=[u,l],f=e.squeeze([0]),h=t.reshape([1,u,-1]),d=new Oo(c,f.shape,n),p=this.compileAndRun(d,[f]).reshape([1,c[0],c[1]]),v=new Lo(p.shape,[1,l,n.outChannels],!0,!1);return this.compileAndRun(v,[p,h]).reshape([1,s,i,n.outChannels])},e.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if($e.get("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new ar(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerInput=function(e,t,n){var r=new er(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerFilter=function(e,t,n){var r=new Zn(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2D=function(e,t,n){var r;return $e.get("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new ur(n),this.compileAndRun(r,[e,t],this.makePackedTensor(n.outShape,e.dtype))):(r=new sr(n),this.compileAndRun(r,[e,t]))},e.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new or(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new rr(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3d=function(e,t,n){var r=new ir(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerInput=function(e,t,n){var r=new nr(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerFilter=function(e,t,n){var r=new tr(n);return this.compileAndRun(r,[e,t])},e.prototype.maxPool=function(e,t){var n=new jo(t,"max",!1),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[e],r)},e.prototype.avgPool=function(e,t){var n=new jo(t,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e],r)},e.prototype.maxPoolBackprop=function(e,t,n,r){var o=new jo(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Po(r),s=this.makeOutputArray(i.outputShape,t.dtype),u=this.compileAndRun(i,[e,a],s);return a.dispose(),u},e.prototype.avgPoolBackprop=function(e,t,n){var r=new Rn(n),o=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[e],o)},e.prototype.cast=function(e,t){return Kt(e,t,this)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},e.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);return!n.isPacked||io(e.shape,t)||null!==n.texture&&io(n.shape,t)?Xt(e,t):this.packedReshape(e,t)},e.prototype.resizeBilinear=function(e,t,n,r){var o=$e.get("WEBGL_PACK_IMAGE_OPERATIONS")?new Xo(e.shape,t,n,r):new Ko(e.shape,t,n,r);return this.compileAndRun(o,[e])},e.prototype.resizeBilinearBackprop=function(e,t,n){var r=new qo(e,t,n);return this.compileAndRun(r,[e])},e.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new Yo(e.shape,t,n,r);return this.compileAndRun(o,[e])},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new $o(e,t,n);return this.compileAndRun(r,[e])},e.prototype.multinomial=function(e,t,n,r){var o=t?e:Nt(e),a=o.shape[0],i=o.shape[1],s=new Bo(a,i,n),u=this.makeOutputArray(s.outputShape,"int32"),l=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],u,l)},e.prototype.oneHot=function(e,t,n,r){var o=new zo(e.size,t,n,r);return this.compileAndRun(o,[e])},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return at("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Zt(e.dataSync(),t.dataSync(),n,r,o)},e.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new lr(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n])},e.prototype.depthToSpace=function(e,t,n){I(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,l=i/(t*t),c=new hr("NHWC"===n?[r,s,u,l]:[r,l,s,u],t,n);return this.compileAndRun(c,[e])},e.prototype.split=function(e,t,n){return tn(e,t,n)},e.prototype.scatterND=function(e,t,n){var r=Ct(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/i,i],c=e.reshape([a,o]),f=t.reshape([a,i]);if(0===u)return Xt(Mt([]),n);var h=Ft(0),d=new Zo(a,o,c.rank,f.rank,s,l);return this.compileAndRun(d,[f,c,h]).reshape(n)},e.prototype.sparseToDense=function(e,t,n,r){var o=Ct(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new Zo(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},e.prototype.fft=function(e){return this.fftImpl(e,!1)},e.prototype.ifft=function(e){return this.fftImpl(e,!0)},e.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new mr(pr,e.shape,t),o=new mr(vr,e.shape,t),a=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=bt(e,t),a=o[0],i=o[1],s=o[2],u=o[3],l=t.reshape([i,r]),c=e.reshape([e.size/s,s]),f=new Cr(r,u,[i,s]);return this.compileAndRun(f,[c,l]).reshape(a)},e.prototype.fill=function(e,t,n){if("string"===(n=n||J(t))){var r=V(n,A(e));return r.fill(t),xe.make(e,{values:r},n)}var o=new gr(e,t),a=o.getCustomSetupFunc(t),i=this.makeOutputArray(e,n);return this.compileAndRun(o,[],i,a)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},e.prototype.makeOutputArray=function(e,t){return xe.make(e,{},t,this)},e.prototype.makePackedTensor=function(e,t){var n=xe.make(e,{},t,this);return this.texData.get(n.dataId).isPacked=!0,n},e.prototype.unpackTensor=function(e){var t=new Ma(e.shape);return this.compileAndRun(t,[e],xe.make(t.outputShape,{},e.dtype,this))},e.prototype.packTensor=function(e){var t=new Wo(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype))},e.prototype.packedReshape=function(e,t){var n=e.reshape([no(e.shape)].concat(ro(e.shape))),r=[no(t)].concat(ro(t)),o=new Ho(r,n.shape);return this.compileAndRun(o,[n]).reshape(t)},e.prototype.compileAndRun=function(e,t,n,r,o){var a=this;if(void 0===o&&(o=!0),null==n&&(n=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=U(n.dtype,0),n;var i=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.usesPackedTextures&&A(t.shape)<=$e.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:a.readSync(t.dataId)};e.usesPackedTextures&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.usesPackedTextures)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!io(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,u={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},l=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,i,u),c=this.getAndSaveBinary(l,function(){return function(e,t,n,r){var o=t.userCode,a=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=dn(a,s,o,t.usesPackedTextures),l=e.createProgram(u),c=null,f=null;1===$e.get("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1),f=e.getUniformLocation(l,"NAN",!1));for(var h={},d=0;d<t.variableNames.length;d++){var p=t.variableNames[d];h[p]=e.getUniformLocation(l,p,!1),h["offset"+p]=e.getUniformLocation(l,"offset"+p,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:h,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:f}}(a.gpgpu,e,i,u)}),f=null!=this.activeTimers;f&&(s=this.startTimer()),function(e,t,n,r,o){Do(t.inShapeInfos,n),Do([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===$e.get("WEBGL_VERSION")&&(null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN)),n.forEach(function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(A(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,c,i,u,r);var h=1024*$e.get("WEBGL_NUM_MB_BEFORE_PAGING");if(o&&this.numBytesInGPU>h)for(var d=this.numBytesInGPU-h;d>0&&this.lruDataGPU.length>0;){var p=this.lruDataGPU.shift(),v=this.texData.get(p),m=v.texShape,g=v.dtype;d-=this.computeBytes(m,g),this.read(p)}return f&&(s=this.endTimer(s),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(s)})),$e.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(n.dataId).isPacked||e.isPackShader?n:this.unpackTensor(n)},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var e=this;return nt(function(){var t=$e.get("DEBUG");$e.set("DEBUG",!1);var n=e.abs(Ft(1e-8)).dataSync()[0];return $e.set("DEBUG",t),n>0?32:16})},e.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=performance.now());var f=oo(r,u);n.texShape=f;var h=this.acquireTexture(e,f,s,o,u);if(n.texture=h,null!=a){if(u){var d=no(r),p=1,v=1;r.length&&(p=(t=ro(r))[0],v=t[1]),this.gpgpu.uploadMatrixToPackedTexture(h,d,p,v,f[0],f[1],Ri(a))}else this.gpgpu.uploadMatrixToTexture(h,f[0],f[1],Ri(a));n.values=null,c&&(this.uploadWaitMs+=performance.now()-l)}}else $e.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.indexOf(e)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(e),1),this.lruDataGPU.push(e))},e.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.texture,o=n.texShape,a=n.dtype,i=n.usage,s=n.isPacked;return null!=r&&(this.releaseTexture(e,r,o,i,a,s),n.texture=null,n.texShape=null,n.isPacked=!1),n.usage=xr.UPLOAD,null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,a)),n.values},e.prototype.releaseTexture=function(e,t,n,r,o,a){if($e.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY){var i=this.lruDataGPU.indexOf(e);i>=0&&this.lruDataGPU.splice(i,1)}this.numBytesInGPU-=this.computeBytes(n,o),this.textureManager.releaseTexture(t,n,r,a)},e.prototype.acquireTexture=function(e,t,n,r,o){return $e.get("WEBGL_NUM_MB_BEFORE_PAGING")<Number.POSITIVE_INFINITY&&this.lruDataGPU.push(e),this.numBytesInGPU+=this.computeBytes(t,r),this.textureManager.acquireTexture(t,n,o)},e.prototype.computeBytes=function(e,t){return e[0]*e[1]*K(t)},e}();function Ri(e){return e instanceof Float32Array?e:new Float32Array(e)}$e.get("IS_BROWSER")&&$e.registerBackend("webgl",function(){return new ki},2);var Ii=_t({abs_:function(e){var t=Ze(e,"x","abs");return"complex64"===t.dtype?$e.engine.runKernel(function(e){return e.complexAbs(t)},{$x:t}):$e.engine.runKernel(function(e,n){var r=e.abs(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().step(-1))}}})}}),_i=_t({acos_:function(e){var t=Ze(e,"x","acos");return $e.engine.runKernel(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Ft(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Ni=_t({acosh_:function(e){var t=Ze(e,"x","acosh");return $e.engine.runKernel(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Ti=_t({asin_:function(e){var t=Ze(e,"x","asin");return $e.engine.runKernel(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Ft(1).sub(n.toFloat().square()).sqrt())}}})}}),Ai=_t({asinh_:function(e){var t=Ze(e,"x","asinh");return $e.engine.runKernel(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Ft(1).add(n.toFloat().square()).sqrt())}}})}}),Di=_t({atan_:function(e){var t=Ze(e,"x","atan");return $e.engine.runKernel(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),Oi=_t({atanh_:function(e){var t=Ze(e,"x","atanh");return $e.engine.runKernel(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(Ft(1).sub(n.toFloat().square()))}}})}}),Mi=_t({ceil_:function(e){var t=Ze(e,"x","ceil");return $e.engine.runKernel(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ht(e)}}})}}),Fi=_t({clipByValue_:function(e,t,n){var r=Ze(e,"x","clipByValue");return I(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}),$e.engine.runKernel(function(e,o){var a=e.clip(r,t,n);return o([r]),a},{$x:r},function(e,r){var o=r[0];return{$x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),Ht(e))}}})}}),Pi=_t({cos_:function(e){var t=Ze(e,"x","cos");return $e.engine.runKernel(function(e,n){var r=e.cos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sin().neg().mul(e)}}})}}),Li=_t({cosh_:function(e){var t=Ze(e,"x","cosh");return $e.engine.runKernel(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),Bi=_t({erf_:function(e){var t=Ze(e,"x","erf");return I("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),$e.engine.runKernel(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),zi=_t({exp_:function(e){var t=Ze(e,"x","exp");return $e.engine.runKernel(function(e,n){var r=e.exp(t);return n([r]),r},{$x:t},function(e,t){return{$x:function(){return e.mulStrict(t[0])}}})}}),Wi=_t({expm1_:function(e){var t=Ze(e,"x","expm1");return $e.engine.runKernel(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),Ui=_t({floor_:function(e){var t=Ze(e,"x","floor");return $e.engine.runKernel(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ht(e)}}})}}),Vi=_t({log_:function(e){var t=Ze(e,"x","log");return $e.engine.runKernel(function(e,n){var r=e.log(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat())}}})}}),ji=_t({log1p_:function(e){var t=Ze(e,"x","log1p");return $e.engine.runKernel(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),Gi=_t({logSigmoid_:function(e){var t=Ze(e,"x","logSigmoid");return $e.engine.runKernel(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),Hi=_t({neg_:function(e){var t=Ze(e,"x","neg");return $e.engine.runKernel(function(e){return e.neg(t)},{$x:t},function(e){return{$x:function(){return e.neg()}}})}}),qi=_t({reciprocal_:function(e){var t=Ze(e,"x","reciprocal");return $e.engine.runKernel(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),Ki=_t({round_:function(e){var t=Ze(e,"x","round");return $e.engine.runKernel(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ht(e)}}})}}),Xi=_t({rsqrt_:function(e){var t=Ze(e,"x","rsqrt");return $e.engine.runKernel(function(e,n){var r=e.rsqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}})}}),$i=_t({sigmoid_:function(e){var t=Ze(e,"x","sigmoid");return $e.engine.runKernel(function(e,n){var r=e.sigmoid(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.mul(Ft(1).sub(n)))}}})}}),Yi=_t({sign_:function(e){var t=Ze(e,"x","sign");return $e.engine.runKernel(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ht(e)}}})}}),Qi=_t({isNaN_:function(e){var t=Ze(e,"x","isNaN");return $e.engine.runKernel(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ht(e)}}})}}),Ji=_t({isInf_:function(e){var t=Ze(e,"x","isInf");return $e.engine.runKernel(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ht(e)}}})}}),Zi=_t({isFinite_:function(e){var t=Ze(e,"x","isFinite");return $e.engine.runKernel(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ht(e)}}})}}),es=_t({sin_:function(e){var t=Ze(e,"x","sin");return $e.engine.runKernel(function(e,n){var r=e.sin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cos().mul(e)}}})}}),ts=_t({sinh_:function(e){var t=Ze(e,"x","sinh");return $e.engine.runKernel(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),ns=_t({softplus_:function(e){var t=Ze(e,"x","softplus");return $e.engine.runKernel(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),rs=_t({sqrt_:function(e){var t=Ze(e,"x","sqrt");return $e.engine.runKernel(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),os=_t({square_:function(e){var t=Ze(e,"x","square");return $e.engine.runKernel(function(e,n){return n([t]),e.square(t)},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().mul(2))}}})}}),as=_t({step_:function(e,t){void 0===t&&(t=0);var n=Ze(e,"x","step");return $e.engine.runKernel(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return Ht(e)}}})}}),is=_t({tan_:function(e){var t=Ze(e,"x","tan");return $e.engine.runKernel(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),ss=_t({tanh_:function(e){var t=Ze(e,"x","tanh");return $e.engine.runKernel(function(e,n){var r=e.tanh(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return Ft(1).sub(n.square()).mulStrict(e)}}})}});function us(e,t,n,r,o,a){var i,s,u=Ze(e,"x","batchNorm"),l=Ze(t,"mean","batchNorm"),c=Ze(n,"variance","batchNorm");return null!=o&&(i=Ze(o,"scale","batchNorm")),null!=r&&(s=Ze(r,"offset","batchNorm")),I(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),I(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&I(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&I(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),fs(u,l,c,s,i,a)}function ls(e,t,n,r,o,a){var i,s,u=Ze(e,"x","batchNorm"),l=Ze(t,"mean","batchNorm"),c=Ze(n,"variance","batchNorm");return null!=o&&(i=Ze(o,"scale","batchNorm")),null!=r&&(s=Ze(r,"offset","batchNorm")),I(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),I(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&I(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&I(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),fs(u,l,c,s,i,a)}function cs(e,t,n,r,o,a){var i,s,u=Ze(e,"x","batchNorm"),l=Ze(t,"mean","batchNorm"),c=Ze(n,"variance","batchNorm");return null!=o&&(i=Ze(o,"scale","batchNorm")),null!=r&&(s=Ze(r,"offset","batchNorm")),I(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),I(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),I(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&I(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&I(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),fs(u,l,c,s,i,a)}function fs(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u,l=Ze(e,"x","batchNorm"),c=Ze(t,"mean","batchNorm"),f=Ze(n,"variance","batchNorm");return null!=o&&(i=Ze(o,"scale","batchNorm")),null!=r&&(s=Ze(r,"offset","batchNorm")),I(c.rank===f.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),I(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),I(null==i||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,$e.engine.runKernel(function(e,t){var n=e.batchNormalization(u,hs(c),hs(f),a,hs(i),hs(s));return t([l,c,f,i]),n},{$x:l,$mean:c,$variance:f,$scale:i,$offset:s},function(e,t){var n=t[0],r=t[1],o=t[2],i=t[3],s=null==i?Ft(1):i,l=un(r.shape,u.shape),c=[];if(1===r.rank){for(var f=0;f<u.shape.length-1;++f)c.push(u.shape[f]);c.push(1)}var h=n.sub(r),d=e.mul(s),p=Xi(o.add(Ft(a))),v=p.mul(p).mul(p).mul(Ft(-.5));return{$x:function(){return 1===r.rank?e.mul(bi(p.as4D(1,1,1,r.shape[0]),c)).mul(s).reshape(n.shape):e.mul(p).mul(s).reshape(n.shape)},$mean:function(){var e=p.mul(Ft(-1)).mul(d);return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)},$variance:function(){var e=v.mul(h).mul(d);return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)},$scale:function(){var t=h.mul(p),n=e.mul(t);return 1===r.rank&&(n=n.sum(l)),n.reshape(r.shape)},$offset:function(){var t=e;return 1===r.rank&&(t=t.sum(l)),t.reshape(r.shape)}}}).reshape(l.shape)}function hs(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function ds(){Xe("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var ps=_t({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),ds(),us(e,t,n,a,o,r)}}),vs=_t({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),ds(),ls(e,t,n,a,o,r)}}),ms=_t({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),ds(),cs(e,t,n,a,o,r)}}),gs=_t({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),ds(),fs(e,t,n,a,o,r)}}),ys=_t({batchNorm_:fs}),bs=_t({batchNorm2d_:us}),xs=_t({batchNorm3d_:ls}),ws=_t({batchNorm4d_:cs});function Cs(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=ks(t),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return Es(e,s,n,r,o,a,!1,i)}function Es(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],h=u[3];if("channelsLast"===s)l=e[0],c=e[1],f=e[2],h=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],h=e[1],c=e[2],f=e[3]}var d,p=t[0],v=t[1],m=t[3],g=ks(n),y=g[0],b=g[1],x=ks(r),w=x[0],C=x[1],E=Is(p,w),S=Is(v,C),k=function(e,t,n,r,o,a,i,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,o,a){null==o&&(o=function(e,t,n,r){void 0===r&&(r=1);var o=Is(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}(e,t,r));var i=e[0],s=e[1],u=_s((i-t+2*o)/r+1,a);I(O(u),function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=_s((s-t+2*o)/r+1,a);return I(O(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,n]}([t,n,1],a,1,r,e,s);l=f[0],c=f[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/o);var h=Math.max(0,(l-1)*r+a-t),d=Math.max(0,(c-1)*o+i-n),p=Math.floor(h/2),v=h-p,m=Math.floor(d/2);u={top:p,bottom:v,left:m,right:d-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,f,y,b,E,S,a),R=k.padInfo,_=k.outHeight,N=k.outWidth,T=i?m*h:m;return"channelsFirst"===s?d=[l,T,_,N]:"channelsLast"===s&&(d=[l,_,N,T]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:f,inChannels:h,outHeight:_,outWidth:N,outChannels:T,padInfo:R,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:C,inShape:e,outShape:d,filterShape:t}}function Ss(e,t,n,r,o,a,i){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],f=s[3],h=s[4];if("channelsLast"===i)u=e[0],l=e[1],c=e[2],f=e[3],h=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);u=e[0],h=e[1],l=e[2],c=e[3],f=e[4]}var d,p=t[0],v=t[1],m=t[2],g=t[4],y=Rs(n),b=y[0],x=y[1],w=y[2],C=Rs(r),E=C[0],S=C[1],k=C[2],R=function(e,t,n,r,o,a,i,s,u,l){var c,f,h,d;if("same"===e){var p=((f=Math.ceil(t/o))-1)*o+s-t,v=((h=Math.ceil(n/a))-1)*a+u-n,m=((d=Math.ceil(r/i))-1)*i+l-r,g=Math.floor(p/2),y=p-g,b=Math.floor(v/2),x=v-b,w=Math.floor(m/2);c={top:b,bottom:x,left:w,right:m-w,front:g,back:y,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/o),h=Math.ceil((n-u+1)/a),d=Math.ceil((r-l+1)/i)}return{padInfo:c,outDepth:f,outHeight:h,outWidth:d}}(o,l,c,f,b,x,w,Is(p,E),Is(v,S),Is(m,k)),I=R.padInfo,_=R.outDepth,N=R.outHeight,T=R.outWidth,A=a?g*h:g;return"channelsFirst"===i?d=[u,A,_,N,T]:"channelsLast"===i&&(d=[u,_,N,T,A]),{batchSize:u,dataFormat:i,inDepth:l,inHeight:c,inWidth:f,inChannels:h,outDepth:_,outHeight:N,outWidth:T,outChannels:A,padInfo:I,strideDepth:b,strideHeight:x,strideWidth:w,filterDepth:p,filterHeight:v,filterWidth:m,dilationDepth:E,dilationHeight:S,dilationWidth:k,inShape:e,outShape:d,filterShape:t}}function ks(e){return"number"==typeof e?[e,e]:e}function Rs(e){return"number"==typeof e?[e,e,e]:e}function Is(e,t){return t<=1?e:e+(e-1)*(t-1)}function _s(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Ns(e){var t=ks(e),n=t[0],r=t[1];return 1===n&&1===r}function Ts(e,t){return Ns(e)||Ns(t)}function As(e,t,n,r,o,a){I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,s=t,u=!1;3===t.rank&&(u=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),i=[1,e[0],e[1],e[2]]);var l=i[3],c=s.shape[3];I(4===i.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+i.length+"."}),I(4===s.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),I(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}),I(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),I(c===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&I(O(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=Es(i,n.shape,r,1,o,a),h=$e.engine.runKernel(function(e,t){var r=e.conv2dDerInput(s,n,f);return t([n,s]),r},{dy4D:s,filter:n},function(e,t){var n=t[0],i=t[1];return{dy4D:function(){return Fs(e,n,r,o,"NHWC",1,a)},filter:function(){return Ls(e,i,n.shape,r,o,a)}}});return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Ds(e,t,n,r,o,a){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=t;3===s.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),I(4===i.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+i.shape+"."}),I(4===s.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),I(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}),I(i.shape[3]===n[2],function(){return"Error in conv2dDerFilter: depth of input "+i.shape[3]+") must match input depth in filter ("+n[2]+"."}),I(s.shape[3]===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."}),null!=a&&I(O(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var u=Es(i.shape,n,r,1,o,a);return $e.engine.runKernel(function(e){return e.conv2dDerFilter(i,s,u)},{x4D:i,dy4D:s})}function Os(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}var Ms=_t({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=Ze(e,"x","conv1d"),u=Ze(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),I(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),I(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&I(O(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),I(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),I(Ts(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),I("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=Fs(h,f,[1,n],r,"NHWC",[1,a],i);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),Fs=_t({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Ze(e,"x","conv2d"),u=Ze(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),I(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&I(O(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),I(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),I(Ts(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),I("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var f=Es(l.shape,u.shape,n,a,r,i),h=$e.engine.runKernel(function(e,t){var n=e.conv2d(l,u,f);return t([u,l]),n},{x:l,$filter:u},function(e,t){var o=t,i=o[0],s=o[1];return I(Ns(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return As(s.shape,e,i,n,r)},$filter:function(){return Ds(s,e,i.shape,n,r)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Ps=_t({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1,1]);var i=Ze(e,"x","conv3d"),s=Ze(t,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),I(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),I(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),I(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),I(function(e,t){return Os(e)||Os(t)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),I("NHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported."});var c=Ss(u.shape,s.shape,n,a,r),f=$e.engine.runKernel(function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n},{x:u,$filter:s},function(e,t){I(Os(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=t[0],i=t[1];return{x:function(){return function(e,t,n,r,o){I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];I(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),I(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),I(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),I(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),I(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Ss(a,n.shape,r,1,o),f=$e.engine.runKernel(function(e){return e.conv3dDerInput(i,n,c)},{dy5D:i});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),I(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),I(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),I(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),I(a.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."}),I(i.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=Ss(a.shape,n,r,1,o);return $e.engine.runKernel(function(e){return e.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Ls=_t({conv2dDerFilter_:Ds}),Bs=_t({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Ze(e,"x","depthwiseConv2d"),u=Ze(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),I(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),I(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),I(Ts(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&I(O(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f=Es(l.shape,u.shape,n,a,r,i,!0),h=$e.engine.runKernel(function(e,t){var n=e.depthwiseConv2D(l,u,f);return t([l,u]),n},{x:l,$filter:u},function(e,t){I(Ns(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var n=t[0],r=t[1];return{x:function(){return function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=$e.engine.runKernel(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}(n.shape,e,r,f)},$filter:function(){return function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),$e.engine.runKernel(function(e){return e.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}(n,e,r.shape,f)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),zs=_t({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=Ze(e,"x","separableConv2d"),u=Ze(t,"depthwiseFilter","separableConv2d"),l=Ze(n,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(3===s.rank&&(f=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");I(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),I(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),I(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),I(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),I(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],d=u.shape[3];I(l.shape[2]===h*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*d+", but got "+l.shape[2]+"."});var p=Bs(c,u,r,o,i,a),v=Fs(p,l,1,"valid",i);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Ws=_t({conv2dTranspose_:function(e,t,n,r,o,a){return As(n,Ze(e,"x","conv2dTranspose"),Ze(t,"filter","conv2dTranspose"),r,o,a)}});var Us=_t({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=Ze(e,"a","matMul"),i=Ze(t,"b","matMul");o=Te(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],f=a.shape.slice(0,-2),h=i.shape.slice(0,-2),d=A(f),p=A(h);I(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),I(D(f,h),function(){return"Error in matMul: outer dimensions ("+f+") and ("+h+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),I(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=a.shape.slice(0,-2).concat([l,c]),m=n?a.as3D(d,s,l):a.as3D(d,l,s),g=r?i.as3D(p,c,u):i.as3D(p,u,c);return $e.engine.runKernel(function(e,t){var o=e.batchMatMul(m,g,n,r);return t([m,g]),o},{$a:m,$b:g},function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{$a:function(){return e.matMul(i,!1,!1)},$b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{$a:function(){return i.matMul(e,!1,!0)},$b:function(){return a.matMul(e,!1,!1)}}:{$a:function(){return i.matMul(e,!0,!0)},$b:function(){return e.matMul(a,!0,!0)}}:{$a:function(){return e.matMul(i,!1,!0)},$b:function(){return a.matMul(e,!0,!1)}}}).reshape(v)}}),Vs=_t({dot_:function(e,t){var n=Ze(e,"t1","dot"),r=Ze(t,"t2","dot");I(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return I(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),js=_t({outerProduct_:function(e,t){var n=Ze(e,"v1","outerProduct"),r=Ze(t,"v2","outerProduct");return I(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}});var Gs=_t({reverse_:function(e,t){var n=Ze(e,"x","reverse");if(0===n.rank)return n.clone();var r=z(t,n.shape);return $e.engine.runKernel(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),Hs=_t({reverse1d_:function(e){var t=Ze(e,"x","reverse");return I(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Gs(t,0)}}),qs=_t({reverse2d_:function(e,t){var n=Ze(e,"x","reverse");return I(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Gs(n,t)}}),Ks=_t({reverse3d_:function(e,t){var n=Ze(e,"x","reverse");return I(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Gs(n,t)}}),Xs=_t({reverse4d_:function(e,t){var n=Ze(e,"x","reverse");return I(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Gs(n,t)}});function $s(e,t,n,r,o,a){var i=Ze(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),I(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),I(Ts(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=a&&I(O(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Cs(s.shape,t,n,r,o,a),c=$e.engine.runKernel(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=Ze(e,"dy","maxPoolBackprop"),l=Ze(t,"input","maxPoolBackprop"),c=Ze(n,"output","maxPoolBackprop");I(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),I(Ts(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),I(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),I(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."}),null!=s&&I(O(i),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var f=Cs(l.shape,r,o,a,i,s);return $e.engine.runKernel(function(e){return e.maxPoolBackprop(u,l,c,f)},{$dy:u,$input:l})}(e,i,s,t,n,r,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Ys(e,t,n,r,o,a){var i=Ze(e,"x","avgPool","float32");null==r&&(r=[1,1]),I(Ts(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),I(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&I(O(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Cs(s.shape,t,n,r,o,a),c=$e.engine.runKernel(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,a){var i=Ze(e,"dy","avgPoolBackprop"),s=Ze(t,"input","avgPoolBackprop");I(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),I(Ts(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),I(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),I(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var f=Cs(u.shape,n,r,o,a),h=$e.engine.runKernel(function(e){return e.avgPoolBackprop(l,u,f)},{dy4D:l,input4D:u});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(e,s,t,n,r,o)}}});return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Qs=_t({maxPool_:function(e,t,n,r,o){return $s(e,t,n,1,r,o)}}),Js=_t({avgPool_:function(e,t,n,r,o){return Ys(e,t,n,1,r,o)}}),Zs=_t({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=Ze(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),I(Ts(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=Cs(s.shape,t,a,o,r),f=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([c.filterHeight,c.filterWidth],f):[[0,0],[0,0]];var h=1===f[0]&&1===f[1],d=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),a=e.concat(r,o),i=t.map(function(e,t){return(e-a[t]%e)%e}),s=o.map(function(e,t){return e+i[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,i[t]]})]}([c.inHeight,c.inWidth],f,l),p=d[0],v=d[1],m=h?r:"valid",g=h?s:mi(s,f,p),y=("avg"===n?function(){return Ys(g,t,a,1,m)}:function(){return $s(g,t,a,1,m)})(),b=h?y:Ja(y,f,v);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}});var eu=_t({slice_:function(e,t,n){var r,o,a=Ze(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice(),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(I(-1===e,function(){return"Bad value in size"}),a.shape[t]-r[t])}),function(e,t,n){I(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),I(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){I(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}(a,r,o);var i=a.shape;return $e.engine.runKernel(function(e){return e.slice(a,r,o)},{$x:a},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{$x:function(){return e.pad(t)}}})}}),tu=_t({slice1d_:function(e,t,n){var r=Ze(e,"x","slice1d");return I(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),eu(r,[t],[n])}}),nu=_t({slice2d_:function(e,t,n){var r=Ze(e,"x","slice2d");return I(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),eu(r,t,n)}}),ru=_t({slice3d_:function(e,t,n){var r=Ze(e,"x","slice3d");return I(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),eu(r,t,n)}}),ou=_t({slice4d_:function(e,t,n){var r=Ze(e,"x","slice4d");return I(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),eu(r,t,n)}});function au(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(dt(t.shape,r))),e.rank<n.rank&&(e=e.reshape(dt(e.shape,r))),{$x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var iu=_t({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","all","bool"),o=z(t,r.shape),a=o,i=vt(a,r.rank);null!=i&&(r=r.transpose(i),a=gt(a.length,r.rank));var s=$e.engine.runKernel(function(e){return e.all(r,a)},{$x:r});if(n){var u=dt(s.shape,o);return s.reshape(u)}return s}}),su=_t({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","any","bool"),o=z(t,r.shape),a=o,i=vt(a,r.rank);null!=i&&(r=r.transpose(i),a=gt(a.length,r.rank));var s=$e.engine.runKernel(function(e){return e.any(r,a)},{$x:r});if(n){var u=dt(s.shape,o);return s.reshape(u)}return s}}),uu=_t({argMax_:function(e,t){void 0===t&&(t=0);var n=Ze(e,"x","argMax");null==t&&(t=0);var r=z(t,n.shape),o=vt(r,n.rank);return null!=o&&(n=n.transpose(o),r=gt(r.length,n.rank)),$e.engine.runKernel(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Ht(n)}}})}}),lu=_t({argMin_:function(e,t){void 0===t&&(t=0);var n=Ze(e,"x","argMin");null==t&&(t=0);var r=z(t,n.shape),o=vt(r,n.rank);return null!=o&&(n=n.transpose(o),r=gt(r.length,n.rank)),$e.engine.runKernel(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Ht(n)}}})}}),cu=_t({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","logSumExp"),o=z(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=dt(s.shape,o);return s.reshape(u)}return s}}),fu=_t({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","max"),o=r,a=z(t,r.shape),i=a,s=vt(i,r.rank);null!=s&&(r=r.transpose(s),i=gt(i.length,r.rank));var u=$e.engine.runKernel(function(e,t){var n=e.max(r,i);return t([o,n]),n},{$x:r},function(e,t){return au(e,t[1],t[0],a,s)});if(n){var l=dt(u.shape,a);u=u.reshape(l)}return u}}),hu=_t({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","mean"),o=z(t,r.shape),a=A(ht(r.shape,o)[1]);return tt(function(e){var r=Ft(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Wt(e.shape,"float32")).div(a)}}})(r)}}),du=_t({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","min"),o=r,a=z(t,r.shape),i=a,s=vt(i,r.rank);null!=s&&(r=r.transpose(s),i=gt(i.length,r.rank));var u=$e.engine.runKernel(function(e,t){var n=e.min(r,i);return t([o,n]),n},{$x:r},function(e,t){return au(e,t[1],t[0],a,s)});if(n){var l=dt(u.shape,a);u=u.reshape(l)}return u}}),pu=_t({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=z(t,(e=Ze(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;return n||(a=dt(o.shape,r)),{mean:o,variance:e.toFloat().sub(o.reshape(a)).square().mean(r,n)}}}),vu=_t({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=z(t,r.shape);return tt(function(e){var t=vt(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=gt(r.length,e.rank));var i=$e.engine.runKernel(function(e){return e.sum(a,r)},{permutedX:a});if(n){var s=dt(i.shape,o);i=i.reshape(s)}return{value:i,gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Wt(e.shape,"float32"))}}})(r)}}),mu=_t({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ze(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=z(t,r.shape),a=vt(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=gt(i.length,r.rank));var u=$e.engine.runKernel(function(e){return e.prod(s,i)},{permutedX:s});if(n){var l=dt(u.shape,o);u=u.reshape(l)}return u}});var gu=_t({equal_:function(e,t){var n,r=Ze(e,"a","equal"),o=Ze(t,"b","equal");return n=Te(r,o),r=n[0],o=n[1],ln(r.shape,o.shape),$e.engine.runKernel(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),yu=_t({equalStrict_:function(e,t){var n=Ze(e,"a","equalStrict"),r=Ze(t,"b","equalStrict");return _(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),bu=_t({greater_:function(e,t){var n,r=Ze(e,"a","greater"),o=Ze(t,"b","greater");return n=Te(r,o),r=n[0],o=n[1],ln(r.shape,o.shape),$e.engine.runKernel(function(e){return e.greater(r,o)},{$a:r,$b:o})}}),xu=_t({greaterEqual_:function(e,t){var n,r=Ze(e,"a","greaterEqual"),o=Ze(t,"b","greaterEqual");return n=Te(r,o),r=n[0],o=n[1],ln(r.shape,o.shape),$e.engine.runKernel(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return Ht(n)},$b:function(){return Ht(r)}}})}}),wu=_t({greaterEqualStrict_:function(e,t){var n=Ze(e,"a","greaterEqualStrict"),r=Ze(t,"b","greaterEqualStrict");return _(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Cu=_t({greaterStrict_:function(e,t){var n=Ze(e,"a","greaterStrict"),r=Ze(t,"b","greaterStrict");return _(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Eu=_t({less_:function(e,t){var n,r=Ze(e,"a","less"),o=Ze(t,"b","less");return n=Te(r,o),r=n[0],o=n[1],ln(r.shape,o.shape),$e.engine.runKernel(function(e){return e.less(r,o)},{$a:r,$b:o})}}),Su=_t({lessEqual_:function(e,t){var n,r=Ze(e,"a","lessEqual"),o=Ze(t,"b","lessEqual");return n=Te(r,o),r=n[0],o=n[1],ln(r.shape,o.shape),$e.engine.runKernel(function(e){return e.lessEqual(r,o)},{$a:r,$b:o})}}),ku=_t({lessEqualStrict_:function(e,t){var n=Ze(e,"a","lessEqualStrict"),r=Ze(t,"b","lessEqualStrict");return _(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Ru=_t({lessStrict_:function(e,t){var n=Ze(e,"a","lessStrict"),r=Ze(t,"b","lessStrict");return _(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Iu=_t({notEqual_:function(e,t){var n,r=Ze(e,"a","notEqual"),o=Ze(t,"b","notEqual");return n=Te(r,o),r=n[0],o=n[1],ln(r.shape,o.shape),$e.engine.runKernel(function(e){return e.notEqual(r,o)},{$a:r,$b:o})}}),_u=_t({notEqualStrict_:function(e,t){var n=Ze(e,"a","notEqualStrict"),r=Ze(t,"b","notEqualStrict");return _(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});var Nu=_t({add_:function(e,t){var n,r=Ze(e,"a","add"),o=Ze(t,"b","add");n=Te(r,o),r=n[0],o=n[1];var a=ln(r.shape,o.shape);return $e.engine.runKernel(function(e){return e.add(r,o)},{$a:r,$b:o},function(e){return{$a:function(){var t=e,n=un(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=un(o.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)}}})}}),Tu=_t({addN_:function(e){I(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),I(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return Ze(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!D(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return $e.engine.runKernel(function(e){return e.addN(t)},r,function(e){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n})}}),Au=_t({addStrict_:function(e,t){var n=Ze(e,"a","addStrict"),r=Ze(t,"b","addStrict");return _(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Du=_t({atan2_:function(e,t){var n,r=Ze(e,"a","atan2"),o=Ze(t,"b","atan2");n=Te(r,o),r=n[0],o=n[1];var a=ln(r.shape,o.shape);return $e.engine.runKernel(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Nu(n.square(),r.square()),o=e.mul(r.div(t)),i=un(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=Nu(n.square(),r.square()),o=Hi(e.mul(n.div(t))),i=un(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),Ou=_t({div_:function(e,t){var n,r=Ze(e,"a","div"),o=Ze(t,"b","div");if(n=Te(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return Fu(r,o);var a=ln(r.shape,o.shape);return $e.engine.runKernel(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),o=un(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=un(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}})}}),Mu=_t({divStrict_:function(e,t){var n=Ze(e,"a","div"),r=Ze(t,"b","div");return _(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Fu=_t({floorDiv_:function(e,t){var n,r=Ze(e,"a","floorDiv"),o=Ze(t,"b","floorDiv");n=Te(r,o),r=n[0],o=n[1];var a=ln(r.shape,o.shape);return $e.engine.runKernel(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),o=un(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=un(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}})}}),Pu=_t({maximum_:function(e,t){var n,r=Ze(e,"a","maximum"),o=Ze(t,"b","maximum");return n=Te(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),ln(r.shape,o.shape),$e.engine.runKernel(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.greaterEqual(r).toFloat())},$b:function(){return e.mul(n.less(r).toFloat())}}})}}),Lu=_t({maximumStrict_:function(e,t){var n=Ze(e,"a","maximumStrict"),r=Ze(t,"b","maximumStrict");return _(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Bu=_t({minimum_:function(e,t){var n,r=Ze(e,"a","minimum"),o=Ze(t,"b","minimum");return n=Te(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),ln(r.shape,o.shape),$e.engine.runKernel(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.lessEqual(r).toFloat())},$b:function(){return e.mul(n.greater(r).toFloat())}}})}}),zu=_t({minimumStrict_:function(e,t){var n=Ze(e,"a","minimumStrict"),r=Ze(t,"b","minimumStrict");return _(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Wu=_t({mod_:function(e,t){var n,r=Ze(e,"a","mod"),o=Ze(t,"b","mod");n=Te(r,o),r=n[0],o=n[1];var a=ln(r.shape,o.shape);return $e.engine.runKernel(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=un(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=un(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),Uu=_t({modStrict_:function(e,t){var n=Ze(e,"a","modStrict"),r=Ze(t,"b","modStrict");return _(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Vu=_t({mul_:function(e,t){var n,r=Ze(e,"a","mul"),o=Ze(t,"b","mul");n=Te(r,o),r=n[0],o=n[1];var a=ln(r.shape,o.shape);return $e.engine.runKernel(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.mul(r.toFloat()),o=un(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),o=un(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),ju=_t({mulStrict_:function(e,t){var n=Ze(e,"a","mul"),r=Ze(t,"b","mul");return _(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Gu=_t({pow_:function(e,t){var n=Ze(e,"base","pow"),r=Ze(t,"exp","pow"),o=ln(n.shape,r.shape);return e=n.cast(_e(n.dtype,r.dtype)),t=r.cast(_e(n.dtype,r.dtype)),$e.engine.runKernel(function(e,t){var o=e.pow(n,r);return t([n,r,o]),o},{$base:n,$exp:r},function(e,t){var n=t[0],r=t[1],a=t[2];return{$base:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(Ft(1))))),i=un(n.shape,o);return i.length>0&&(a=a.sum(i)),a.reshape(n.shape)},$exp:function(){var t=n.greater(0),i=n.log().where(t,Ht(n)),s=e.mul(a.mul(i)),u=un(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}})}}),Hu=_t({powStrict_:function(e,t){return _(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),qu=_t({squaredDifference_:function(e,t){var n,r=Ze(e,"a","squaredDifference"),o=Ze(t,"b","squaredDifference");return n=Te(r,o),r=n[0],o=n[1],ln(r.shape,o.shape),$e.engine.runKernel(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1],o=Ft(2);return{$a:function(){return e.mul(n.sub(r).mul(o))},$b:function(){return e.mul(r.sub(n).mul(o))}}})}}),Ku=_t({squaredDifferenceStrict_:function(e,t){var n=Ze(e,"a","squaredDifferenceStrict"),r=Ze(t,"b","squaredDifferenceStrict");return _(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Xu=_t({sub_:function(e,t){var n,r=Ze(e,"a","sub"),o=Ze(t,"b","sub");n=Te(r,o),r=n[0],o=n[1];var a=ln(r.shape,o.shape);return $e.engine.runKernel(function(e){return e.subtract(r,o)},{$a:r,$b:o},function(e){return{$a:function(){var t=e,n=un(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=un(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}})}}),$u=_t({subStrict_:function(e,t){var n=Ze(e,"a","subStrict"),r=Ze(t,"b","subStrict");return _(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}});var Yu=_t({logicalAnd_:function(e,t){var n=Ze(e,"a","logicalAnd","bool"),r=Ze(t,"b","logicalAnd","bool");return ln(n.shape,r.shape),$e.engine.runKernel(function(e){return e.logicalAnd(n,r)},{$a:n,$b:r})}}),Qu=_t({logicalNot_:function(e){var t=Ze(e,"x","logicalNot","bool");return $e.engine.runKernel(function(e){return e.logicalNot(t)},{$x:t})}}),Ju=_t({logicalOr_:function(e,t){var n=Ze(e,"a","logicalOr","bool"),r=Ze(t,"b","logicalOr","bool");return ln(n.shape,r.shape),$e.engine.runKernel(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),Zu=_t({logicalXor_:function(e,t){var n=Ze(e,"a","logicalXor","bool"),r=Ze(t,"b","logicalXor","bool");return ln(n.shape,r.shape),Ju(e,t).logicalAnd(Yu(e,t).logicalNot())}}),el=_t({where_:function(e,t,n){var r=Ze(t,"a","where"),o=Ze(n,"b","where"),a=Ze(e,"condition","where","bool");return _(r.shape,o.shape,"Error in where: "),1===a.rank?I(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):_(a.shape,o.shape,"Error in where: "),$e.engine.runKernel(function(e,t){var n=e.select(a,r,o);return t([a]),n},{$condition:a,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return Ht(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),tl=function(e){return g(this,void 0,void 0,function(){var t,n,r;return y(this,function(o){switch(o.label){case 0:return[4,(t=Ze(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=Ei(t.shape,n),e!==t&&t.dispose(),[2,r]}})})};var nl=_t({elu_:function(e){var t=Ze(e,"x","elu");return $e.engine.runKernel(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return $e.engine.runKernel(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),rl=_t({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=Ze(e,"x","leakyRelu");return Pu(Ft(t).mul(n),n)}}),ol=_t({prelu_:function(e,t){var n=Ze(e,"x","prelu"),r=Ze(t,"alpha","prelu");return $e.engine.runKernel(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{$x:n,$alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{$x:function(){return el(o,e,e.mul(r))},$alpha:function(){var t=el(o,Ht(e),e.mul(n)),a=un(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}})}}),al=_t({relu_:function(e){var t=Ze(e,"x","relu");return"bool"===t.dtype?t.toInt():$e.engine.runKernel(function(e,n){var r=e.relu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n.step().toFloat())}}})}}),il=_t({selu_:function(e){var t=Ze(e,"x","selu");return $e.engine.runKernel(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(Ft(0)),r=Ft(ya),o=Ft(ba),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return el(t,a,i)}}})}});var sl=_t({transpose_:function(e,t){var n=Ze(e,"x","transpose");return null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){I(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1?n.clone():$e.engine.runKernel(function(e){return e.transpose(n,t)},{$x:n},function(e){var n=mt(t);return{$x:function(){return e.transpose(n)}}})}});var ul=_t({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=Ze(e,"x","localResponseNormalization");I(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),I(O(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=$e.engine.runKernel(function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return $e.engine.runKernel(function(a){return a.LRNGrad(e,i,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}});function ll(e,t,n){if(void 0===n&&(n=null),0===e.rank)return e.abs();if(1!==e.rank&&null===n)return ll(e.reshape([-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return e.abs().sum(n);if(t===1/0)return e.abs().max(n);if(t===-1/0)return e.abs().min(n);if("euclidean"===t||2===t)return e.abs().pow(Ft(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}if(Array.isArray(n)&&2===n.length){if(1===t)return e.abs().sum(n[0]).max(n[1]-1);if(t===1/0)return e.abs().sum(n[1]).max(n[0]);if(t===-1/0)return e.abs().sum(n[1]).min(n[0]);if("fro"===t||"euclidean"===t)return e.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+n)}var cl=_t({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=ll(e=Ze(e,"x","norm"),t,n),a=o.shape;if(r){var i=z(n,e.shape);a=dt(o.shape,i)}return o.reshape(a)}});function fl(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function hl(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var dl=_t({gather_:function(e,t,n){void 0===n&&(n=0);var r=Ze(e,"x","gather"),o=Ze(t,"indices","gather","int32");n=z(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return $e.engine.runKernel(function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a},{$x:r},function(e,t){var o=t[0];return{$x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),l=u.length,c=fl(0,s),f=fl(s+1,s+1+l),h=hl([i,[a],u]),d=e.reshape(h),p=o.reshape([a]),v=hl([[s],c,f]),m=d.transpose(v),g=pl(m,p,r.shape[n]),y=mt(v);return g.transpose(y)}}}).reshape(a.outputShape)}}),pl=_t({unsortedSegmentSum_:function(e,t,n){var r=Ze(e,"x","unsortedSegmentSum"),o=Ze(t,"segmentIds","unsortedSegmentSum","int32");return I(O(n),function(){return"numSegments must be of dtype int"}),$e.engine.runKernel(function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Pu(t,Ht(t)),r=dl(e,n),o=xu(t,Ft(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=ri(o,i+1);o=Yu(o,Wt(r.shape,"bool"));var s=Ht(r);return el(o,r,s)}(e,n)}}})}});var vl=_t({basicLSTMCell_:function(e,t,n,r,o,a){var i=Ze(e,"forgetBias","basicLSTMCell"),s=Ze(t,"lstmKernel","basicLSTMCell"),u=Ze(n,"lstmBias","basicLSTMCell"),l=Ze(r,"data","basicLSTMCell"),c=Ze(o,"c","basicLSTMCell"),f=Ze(a,"h","basicLSTMCell"),h=l.concat(f,1).matMul(s).add(u),d=h.shape[0],p=h.shape[1]/4,v=[d,p],m=h.slice([0,0],v),g=h.slice([0,p],v),y=h.slice([0,2*p],v),b=h.slice([0,3*p],v),x=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(i.add(y).sigmoid()));return[x,x.tanh().mulStrict(b.sigmoid())]}}),ml=_t({multiRNNCell_:function(e,t,n,r){for(var o=Ze(t,"data","multiRNNCell"),a=et(n,"c","multiRNNCell"),i=et(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var f=[],h=[];for(l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}});var gl=_t({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=Ze(e,"v","movingAverage"),i=Ze(t,"x","movingAverage"),s=Ze(n,"decay","movingAverage");Ae(a,i),I(D(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=Ft(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){I(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=Ze(r,"step","movingAverage");c=c.div(u.sub(Gu(s,f)))}return a.add(c)}});var yl=_t({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==i)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var l=Ze(e,"x","stridedSlice");if(r.every(function(e){return 1===e})){var c=Et(l.shape,t,n,r,o,a,i,s,u),f=c[0],h=c[1],d=c[2],p=h.filter(function(e,t){return-1===d.indexOf(t)});return eu(l,f,h).reshape(p)}return $e.engine.runKernel(function(e){return e.stridedSlice(l,t,n,r,o,a,i,s,u)},{$x:l})}});var bl=_t({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=Ze(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=$e.engine.runKernel(function(e){return e.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}});var xl=_t({scatterND_:function(e,t,n){var r=Ze(e,"indices","scatterND","int32"),o=Ze(t,"updates","scatterND");return wt(o,r,n),$e.engine.runKernel(function(e){return e.scatterND(r,o,n)},{$indices:r,$updates:o})}});var wl=_t({fft_:function(e){I("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return $e.engine.runKernel(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),Cl=_t({ifft_:function(e){I("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return $e.engine.runKernel(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),El=_t({rfft_:function(e){I("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.zerosLike(),o=At(e,r).as2D(n,t),a=wl(o),i=Math.floor(t/2)+1,s=Dt(a),u=Ot(a),l=s.split([i,t-i],s.shape.length-1),c=u.split([i,t-i],u.shape.length-1),f=e.shape.slice();return f[e.shape.length-1]=i,At(l[0],c[0]).reshape(f)}}),Sl=_t({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=Cl(r);return Dt(o)}var a=[n,2*(t-1)],i=Dt(e).as2D(n,t),s=Ot(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(Ft(-1)),c=i.concat(u,1),f=s.concat(l,1);return r=At(c,f).as2D(a[0],a[1]),o=Cl(r),Dt(o)}}),kl=Object.freeze({fft:wl,ifft:Cl,rfft:El,irfft:Sl});var Rl=_t({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=Ze(e,"sparseIndices","sparseToDense","int32"),a=Ze(t,"sparseValues","sparseToDense"),i=Ze(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),$e.engine.runKernel(function(e){return e.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}});var Il,_l=_t({gatherND_:function(e,t){var n=Ze(t,"indices","gatherND","int32"),r=Ze(e,"x","gatherND");return $e.engine.runKernel(function(e){return e.gatherND(r,n)},{$x:r,$indices:n})}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Il||(Il={}));var Nl=_t({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Il.SUM_BY_NONZERO_WEIGHTS);var o=Ze(e,"labels","absoluteDifference"),a=Ze(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=Ze(n,"weights","absoluteDifference")),_(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return Tl(s,i,r)}}),Tl=_t({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Il.SUM_BY_NONZERO_WEIGHTS);var r=Ze(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=Ze(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===Il.NONE)return a;if(n===Il.SUM)return a.sum();if(n===Il.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(Ft(i)):s}if(n===Il.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(Ft(r.size));var u=o.mul(Wt(r.shape)).notEqual(Ft(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),Al=_t({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=Il.SUM_BY_NONZERO_WEIGHTS);var a=Ze(e,"labels","cosineDistance"),i=Ze(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Ze(r,"weights","cosineDistance")),_(a.shape,i.shape,"Error in cosineDistance: ");var u=Ft(1).sub(a.mul(i).sum(n,!0));return Tl(u,s,o)}}),Dl=_t({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Il.SUM_BY_NONZERO_WEIGHTS);var o=Ze(e,"labels","hingeLoss"),a=Ze(t,"predictions","hingeLoss"),i=null;null!=n&&(i=Ze(n,"weights","hingeLoss")),_(o.shape,a.shape,"Error in hingeLoss: ");var s=Ft(1);o=Ft(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return Tl(u,i,r)}}),Ol=_t({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=Il.SUM_BY_NONZERO_WEIGHTS);var a=Ze(e,"labels","huberLoss"),i=Ze(t,"predictions","huberLoss"),s=null;null!=n&&(s=Ze(n,"weights","huberLoss")),_(a.shape,i.shape,"Error in huberLoss: ");var u=Ft(r),l=i.sub(a).abs(),c=Bu(l,u),f=l.sub(c),h=Ft(.5).mul(c.square()).add(u.mul(f));return Tl(h,s,o)}}),Ml=_t({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Il.SUM_BY_NONZERO_WEIGHTS);var a=Ze(e,"labels","logLoss"),i=Ze(t,"predictions","logLoss"),s=null;null!=n&&(s=Ze(n,"weights","logLoss")),_(a.shape,i.shape,"Error in logLoss: ");var u=Ft(1),l=Ft(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return Tl(c,s,o)}}),Fl=_t({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Il.SUM_BY_NONZERO_WEIGHTS);var o=Ze(e,"labels","meanSquaredError"),a=Ze(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=Ze(n,"weights","meanSquaredError")),_(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return Tl(s,i,r)}}),Pl=_t({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Il.SUM_BY_NONZERO_WEIGHTS);var a=Ze(e,"multiClassLabels","sigmoidCrossEntropy"),i=Ze(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Ze(n,"weights","sigmoidCrossEntropy")),_(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Ft(r),l=Ft(1),c=Ft(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var f=function(e,t){var n=Ze(e,"labels","sigmoidCrossEntropyWithLogits"),r=Ze(t,"logits","sigmoidCrossEntropyWithLogits");_(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return Tl(f,s,o)}}),Ll=_t({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Il.SUM_BY_NONZERO_WEIGHTS);var a=Ze(e,"onehotLabels","softmaxCrossEntropy"),i=Ze(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Ze(n,"weights","softmaxCrossEntropy")),_(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Ft(r),l=Ft(1),c=Ft(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return tt(function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=dt(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(a,i);return Tl(f,s,o)}}),Bl=Object.freeze({get Reduction(){return Il},absoluteDifference:Nl,computeWeightedLoss:Tl,cosineDistance:Al,hingeLoss:Dl,huberLoss:Ol,logLoss:Ml,meanSquaredError:Fl,sigmoidCrossEntropy:Pl,softmaxCrossEntropy:Ll});function zl(e,t){return void 0===t&&(t=!1),$e.engine.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=oi(n),a=e.clone(),i=Lt([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=o;t=$e.engine.tidy(function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=l.sign().neg(),f=l.sub(c.mul(u)),h=t.div(f);s=1===h.shape[0]?i.clone():i.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var d=c.matMul(f).div(u).neg(),p=a.slice([e,0],[n-e,r]),v=d.mul(s);a=0===e?p.sub(v.matMul(s.transpose().matMul(p))):a.slice([0,0],[e,r]).concat(p.sub(v.matMul(s.transpose().matMul(p))),0);var m=o.slice([0,e],[n,o.shape[1]-e]);return o=0===e?m.sub(m.matMul(s).matMul(v.transpose())):o.slice([0,0],[n,e]).concat(m.sub(m.matMul(s).matMul(v.transpose())),1),[s,a,o]}),s=t[0],a=t[1],o=t[2],ot([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var Wl=_t({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,I(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){I(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=Wa(e,e.shape[0],0).map(function(e){return gi(e,[0])});I(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(e){a.push($e.engine.tidy(function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=vu(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(cl(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?yi(a,0):a}}),Ul=_t({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return zl(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=[],o=[];return wi(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0).forEach(function(e){var n=zl(e,t),a=n[0],i=n[1];r.push(a),o.push(i)}),[yi(r,0).reshape(e.shape),yi(o,0).reshape(e.shape)]}}),Vl=Object.freeze({gramSchmidt:Wl,qr:Ul});function jl(e,t,n,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var a=e.shape[0];return n=Math.min(n,a),I(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),I(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),I(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),I(1===t.rank,function(){return"scores must be a 1D tensor"}),I(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}var Gl=_t({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=Ze(e,"images","resizeBilinear");I(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=$e.engine.runKernel(function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return $e.engine.runKernel(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Hl=_t({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=Ze(e,"images","resizeNearestNeighbor");I(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),I("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=$e.engine.runKernel(function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return $e.engine.runKernel(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),ql=_t({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=Ze(e,"boxes","nonMaxSuppression"),i=Ze(t,"scores","nonMaxSuppression"),s=jl(a,i,n,r,o);return n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,$e.engine.runKernel(function(e){return e.nonMaxSuppression(a,i,n,r,o)},{$boxes:a})}}),Kl=function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),g(this,void 0,void 0,function(){var a,i,s,u,l,c;return y(this,function(f){switch(f.label){case 0:return a=Ze(e,"boxes","nonMaxSuppressionAsync"),i=Ze(t,"scores","nonMaxSuppressionAsync"),s=jl(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,a.data()];case 1:return u=f.sent(),[4,i.data()];case 2:return l=f.sent(),c=Zt(u,l,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,c]}})})},Xl=_t({cropAndResize_:function(e,t,n,r,o,a){var i=Ze(e,"image","cropAndResize","float32"),s=Ze(t,"boxes","cropAndResize","float32"),u=Ze(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return I(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),I(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),I(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),I(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),I(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),I("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),$e.engine.runKernel(function(e,t){return e.cropAndResize(i,s,u,r,o,a)},{$image:i,$boxes:s})}}),$l=Object.freeze({resizeBilinear:Gl,resizeNearestNeighbor:Hl,nonMaxSuppression:ql,nonMaxSuppressionAsync:Kl,cropAndResize:Xl});var Yl=_t({matMul_:function(e,t,n,r,o,a){var i;void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a="linear");var s=Ze(e,"a","fused matMul"),u=Ze(t,"b","fused matMul");i=Te(s,u),s=i[0],u=i[1];var l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],f=n?s.shape[s.rank-1]:s.shape[s.rank-2],h=r?u.shape[u.rank-2]:u.shape[u.rank-1],d=s.shape.slice(0,-2),p=u.shape.slice(0,-2),v=A(d),m=A(p);I(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),I(D(d,p),function(){return"Error in fused matMul: outer dimensions ("+d+") and ("+p+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),I(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var g,y=s.shape.slice(0,-2).concat([f,h]),b=n?s.as3D(v,l,f):s.as3D(v,f,l),x=r?u.as3D(m,h,c):u.as3D(m,c,h);null!=o&&ln(y,(g=Te(g=Ze(o,"bias","fused matMul"),s)[0]).shape);var w={$a:b,$b:x};return null!=o&&(w.$bias=g),$e.engine.runKernel(function(e,t){var o=e.fusedBatchMatMul(b,x,n,r,g,a);return t([b,x,o]),o},w,function(e,t){var i,s=t[0],u=t[1],l=t[2];if(null==a||"linear"===a)i=e;else{if("relu"!==a)throw new Error("Gradient for activation "+a+" has not been implemented yet.");i=e.mul(l.step())}var c={};return null!=o&&(c={$bias:function(){var e=i,t=un(g.shape,i.shape);return t.length>0&&(e=e.sum(t)),e.reshape(g.shape)}}),n||r?!n&&r?Object.assign({$a:function(){return i.matMul(u,!1,!1)},$b:function(){return i.matMul(s,!0,!1)}},c):n&&!r?Object.assign({$a:function(){return u.matMul(i,!1,!0)},$b:function(){return s.matMul(i,!1,!1)}},c):Object.assign({$a:function(){return u.matMul(i,!0,!0)},$b:function(){return i.matMul(s,!0,!0)}},c):Object.assign({$a:function(){return i.matMul(u,!1,!0)},$b:function(){return s.matMul(i,!0,!1)}},c)}).reshape(y)}}),Ql=Object.freeze({matMul:Yl}),Jl=Object.freeze({image:$l,linalg:Vl,losses:Bl,spectral:kl,fused:Ql,op:_t,batchNormalization2d:ps,batchNormalization3d:vs,batchNormalization4d:ms,batchNormalization:gs,batchNorm:ys,batchNorm2d:bs,batchNorm3d:xs,batchNorm4d:ws,complex:At,real:Dt,imag:Ot,concat:Fa,concat1d:Pa,concat2d:La,concat3d:Ba,concat4d:za,split:Wa,conv1d:Ms,conv2d:Fs,conv3d:Ps,conv2dDerFilter:Ls,depthwiseConv2d:Bs,separableConv2d:zs,conv2dTranspose:Ws,matMul:Us,dot:Vs,outerProduct:js,reverse:Gs,reverse1d:Hs,reverse2d:qs,reverse3d:Ks,reverse4d:Xs,maxPool:Qs,avgPool:Js,pool:Zs,slice:eu,slice1d:tu,slice2d:nu,slice3d:ru,slice4d:ou,abs:Ii,acos:_i,acosh:Ni,asin:Ti,asinh:Ai,atan:Di,atanh:Oi,ceil:Mi,clipByValue:Fi,cos:Pi,cosh:Li,erf:Bi,exp:zi,expm1:Wi,floor:Ui,log:Vi,log1p:ji,logSigmoid:Gi,neg:Hi,reciprocal:qi,round:Ki,rsqrt:Xi,sigmoid:$i,sign:Yi,isNaN:Qi,isInf:Ji,isFinite:Zi,sin:es,sinh:ts,softplus:ns,sqrt:rs,square:os,step:as,tan:is,tanh:ss,all:iu,any:su,argMax:uu,argMin:lu,logSumExp:cu,max:fu,mean:hu,min:du,moments:pu,sum:vu,prod:mu,equal:gu,equalStrict:yu,greater:bu,greaterEqual:xu,greaterEqualStrict:wu,greaterStrict:Cu,less:Eu,lessEqual:Su,lessEqualStrict:ku,lessStrict:Ru,notEqual:Iu,notEqualStrict:_u,add:Nu,addN:Tu,addStrict:Au,atan2:Du,div:Ou,divStrict:Mu,floorDiv:Fu,maximum:Pu,maximumStrict:Lu,minimum:Bu,minimumStrict:zu,mod:Wu,modStrict:Uu,mul:Vu,mulStrict:ju,pow:Gu,powStrict:Hu,squaredDifference:qu,squaredDifferenceStrict:Ku,sub:Xu,subStrict:$u,elu:nl,leakyRelu:rl,prelu:ol,relu:al,selu:il,logicalAnd:Yu,logicalNot:Qu,logicalOr:Ju,logicalXor:Zu,where:el,whereAsync:tl,buffer:Qa,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Ja,cast:Za,clone:ei,cumsum:ti,depthToSpace:ni,expandDims:ri,eye:oi,multinomial:ai,oneHot:ii,pad:si,pad1d:ui,pad2d:li,pad3d:ci,pad4d:fi,rand:hi,randomNormal:di,randomUniform:pi,reshape:vi,spaceToBatchND:mi,squeeze:gi,stack:yi,tile:bi,truncatedNormal:xi,unstack:wi,setdiff1dAsync:Ci,fill:Vt,linspace:function(e,t,n){if(0===n)throw new Error("Cannot request zero samples");var r=(t-e)/(n-1),o=ie(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return Pt(o,"float32")},ones:Wt,range:jt,scalar:Ft,tensor:Mt,tensor1d:Pt,tensor2d:Lt,tensor3d:Bt,tensor4d:zt,tensor5d:function(e,t,n){if(N(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Ye(e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Mt(e,t=t||r,n)},tensor6d:function(e,t,n){if(N(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Ye(e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Mt(e,t=t||r,n)},zeros:Ut,onesLike:Gt,zerosLike:Ht,transpose:sl,softmax:Nt,logSoftmax:Tt,localResponseNormalization:ul,norm:cl,gather:dl,unsortedSegmentSum:pl,basicLSTMCell:vl,multiRNNCell:ml,movingAverage:gl,stridedSlice:yl,topk:bl,scatterND:xl,fft:wl,ifft:Cl,rfft:El,irfft:Sl,sparseToDense:Rl,gatherND:_l});var Zl=function(){function e(){this.blockSize=48,this.firstUse=!0,$e.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return e.prototype.setDataMover=function(e){this.data=new qt(e)},e.prototype.register=function(e,t,n){if(this.firstUse&&(this.firstUse=!1,$e.get("IS_NODE")&&at("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:n})},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,r;if($e.get("IS_NODE")&&null==e.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=e.getContext)n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData)n=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),n=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(4===t)r=new Int32Array(n);else{var o=e.width*e.height;r=new Int32Array(o*t);for(var a=0;a<o;a++)for(var i=0;i<t;++i)r[a*t+i]=n[4*a+i]}return Bt(r,[e.height,e.width,t],"int32")},e.prototype.read=function(e){return g(this,void 0,void 0,function(){return y(this,function(t){return[2,this.readSync(e)]})})},e.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?$t(r.real.dataSync(),r.imag.dataSync()):this.data.get(e).values},e.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},e.prototype.time=function(e){return g(this,void 0,void 0,function(){var t;return y(this,function(n){return t=se(),e(),[2,{kernelMs:se()-t}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(e,t){var n=xe.make(e.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:$e.engine.keep(e.clone()),imag:$e.engine.keep(t.clone())},n},e.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},e.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&I("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})},e.prototype.slice=function(e,t,n){if(this.assertNotComplex(e,"slice"),Rt(e.shape,t,n)){var r=It(t,e.strides),o=A(n);return Mt(e.dataSync().subarray(r,r+o),n,e.dtype)}for(var a=Qa(n,e.dtype),i=e.bufferSync(),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(e,n){return e+t[n]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s,u){this.assertNotComplex(e,"stridedSlice");var l=Et(e.shape,t,n,r,o,a,i,s,u),c=l[0],f=l[1],h=l[2],d=f.filter(function(e,t){return-1===h.indexOf(t)});if(d.some(function(e){return 0===e}))return Mt([],d);for(var p=Qa(f,e.dtype),v=e.bufferSync(),m=0;m<p.size;m++){for(var g=p.indexToLoc(m),y=new Array(g.length),b=0;b<y.length;b++)y[b]=g[b]*r[b]+c[b];p.set.apply(p,[v.get.apply(v,y)].concat(g))}return p.toTensor().reshape(d)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},e.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var n=Qa(e.shape,e.dtype),r=e.bufferSync(),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},e.prototype.concat=function(e,t){this.assertNotComplex(e,"concat");var n=e.map(function(e){var n=A(e.shape.slice(t));return e.as2D(-1,n)}),r=yt(n.map(function(e){return e.shape}),1),o=Qa(r,e[0].dtype).values;if(1===n[0].shape[0]){var a=0;n.forEach(function(e){o.set(e.dataSync(),a),a+=e.size})}else{var i=0;n.forEach(function(e){for(var t=e.dataSync(),n=0,a=0;a<e.shape[0];++a)for(var s=a*r[1]+i,u=0;u<e.shape[1];++u)o[s+u]=t[n++];i+=e.shape[1]})}var s=yt(e.map(function(e){return e.shape}),t);return Mt(o,s,e[0].dtype)},e.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(Ft(-1),e)},e.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,_e(e.dtype,t.dtype),function(e,t){return e+t})},e.prototype.addN=function(e){this.assertNotComplex(e,"addN");for(var t=e.map(function(e){return e.dataSync()}),n=Qa(e[0].shape,e[0].dtype),r=n.values,o=0;o<e.length;o++)for(var a=t[o],i=0;i<r.length;i++)r[i]+=a[i];return n.toTensor()},e.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,_e(e.dtype,t.dtype),function(e,t){return e-t})},e.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},e.prototype.batchMatMul=function(e,t,n,r){this.assertNotComplex([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=e.dataSync(),l=t.dataSync(),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=c[0],h=c[1],d=c[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=p[0],m=p[1],g=p[2],y=a*i,b=Qa([s,a,i],e.dtype),x=b.values,w=this.blockSize,C=0;C<s;C++)for(var E=0;E<a;E+=w)for(var S=0;S<i;S+=w)for(var k=0;k<o;k+=w)for(var R=Math.min(E+w,a),I=Math.min(S+w,i),_=Math.min(k+w,o),N=E;N<R;N++)for(var T=S;T<I;T++){for(var A=0,D=k;D<_;D++)A+=u[C*f+N*h+D*d]*l[D*v+T*m+C*g];x[C*y+(N*i+T)]+=A}return b.toTensor()},e.prototype.fusedBatchMatMul=function(e,t,n,r,o,a){var i=this.batchMatMul(e,t,n,r);return o&&(i=this.add(i,o)),a&&(i=function(e,t,n){if("linear"===t)return e.linear(n);if("relu"===t)return e.relu(n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}(this,a,i)),i},e.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,_e(e.dtype,t.dtype),function(e,t){return e*t})},e.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},e.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},e.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),pt("sum",t,e.rank);for(var n=ht(e.shape,t),r=n[0],o=n[1],a=Ut(r,_e(e.dtype,"int32")),i=A(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=0,h=0;h<i;++h)f+=u[c+h];s[l]=f}return a},e.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var n=ht(e.shape,t),r=n[0],o=n[1],a=Ut(r,_e(e.dtype,"int32")),i=A(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=1,h=0;h<i;++h)f*=u[c+h];s[l]=f}return a},e.prototype.unsortedSegmentSum=function(e,t,n){this.assertNotComplex(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=Ft(a,"int32"),s=gu(i,t).asType("float32").mul(e).sum(0);r.push(s)}return yi(r)},e.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var n=[t];pt("argMin",n,e.rank);for(var r=ht(e.shape,n),o=r[0],a=r[1],i=Ut(o,"int32"),s=A(a),u=i.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var f=c*s,h=l[f],d=0,p=0;p<s;++p){var v=l[f+p];v<h&&(h=v,d=p)}u[c]=d}return i},e.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var n=[t];pt("argMax",n,e.rank);for(var r=ht(e.shape,n),o=r[0],a=r[1],i=Ut(o,"int32"),s=A(a),u=i.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var f=c*s,h=l[f],d=0,p=0;p<s;++p){var v=l[f+p];v>h&&(h=v,d=p)}u[c]=d}return i},e.prototype.cumsum=function(e,t,n,r){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=_e(e.dtype,"int32"),a=Ut(e.shape,o),i=a.dataSync(),s=e.dataSync(),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var f=0;f<u;f++){var h=l(c,f);if(0===f)i[h]=n?0:s[h];else{var d=l(c,f-1);i[h]=n?s[d]+i[d]:s[h]+i[d]}}return a},e.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},e.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},e.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},e.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},e.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},e.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},e.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return xe.make(e.shape,{values:n},"bool")},e.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},e.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},e.prototype.select=function(e,t,n){this.assertNotComplex([e,t,n],"select");for(var r=e.dataSync(),o=t.dataSync(),a=n.dataSync(),i=Ut(t.shape,_e(t.dtype,n.dtype)),s=i.dataSync(),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:t.shape[1],c=0;c<r.length;c++)for(var f=0;f<l;f++)1===r[c]?s[u++]=o[c]:s[u++]=a[c];return i},e.prototype.where=function(e){this.assertNotComplex([e],"where");var t=e.dataSync();return Ei(e.shape,t)},e.prototype.topk=function(e,t,n){return this.assertNotComplex(e,"topk"),nn(e.dataSync(),e.shape,e.dtype,t)},e.prototype.min=function(e,t){this.assertNotComplex(e,"min"),pt("min",t,e.rank);for(var n=ht(e.shape,t),r=n[0],o=n[1],a=Ut(r,e.dtype),i=A(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];d<f&&(f=d)}s[l]=f}return a},e.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},e.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},e.prototype.max=function(e,t){this.assertNotComplex(e,"max"),pt("max",t,e.rank);for(var n=ht(e.shape,t),r=n[0],o=n[1],a=Ut(r,e.dtype),i=A(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];d>f&&(f=d)}s[l]=f}return a},e.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},e.prototype.all=function(e,t){this.assertNotComplex(e,"all"),pt("all",t,e.rank);for(var n=ht(e.shape,t),r=n[0],o=n[1],a=Ut(r,e.dtype),i=A(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];f=f&&d}s[l]=f}return a},e.prototype.any=function(e,t){this.assertNotComplex(e,"any"),pt("any",t,e.rank);for(var n=ht(e.shape,t),r=n[0],o=n[1],a=Ut(r,e.dtype),i=A(o),s=a.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];f=f||d}s[l]=f}return a},e.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},e.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return xe.make(e.shape,{values:n})},e.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return xe.make(e.shape,{values:n})},e.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return xe.make(e.shape,{values:n})},e.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return xe.make(e.shape,{values:n},"bool")},e.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return xe.make(e.shape,{values:n},"bool")},e.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=e.dataSync(),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return xe.make(e.shape,{values:n},"bool")},e.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return xe.make(e.shape,{values:n})},e.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return xe.make(e.shape,{values:n})},e.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return xe.make(e.shape,{values:n})},e.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return xe.make(e.shape,{values:n})},e.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return xe.make(e.shape,{values:n})},e.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return xe.make(e.shape,{values:n})},e.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return xe.make(e.shape,{values:n})},e.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=o*o}return xe.make(e.shape,{values:n})},e.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return xe.make(e.shape,{values:n})},e.prototype.linear=function(e){return e},e.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=Ut(e.shape,e.dtype),n=t.dataSync(),r=e.dataSync(),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},e.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},e.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return xe.make(e.shape,{values:t})},e.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var n=new Float32Array(t.size),r=t.dataSync(),o=e.dataSync(),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return xe.make(t.shape,{values:n})},e.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=ya,n=ba,r=new Float32Array(e.size),o=e.dataSync(),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?n*i:t*(Math.exp(i)-1)}return xe.make(e.shape,{values:r})},e.prototype.clip=function(e,t,n){this.assertNotComplex(e,"clip");for(var r=new Float32Array(e.size),o=e.dataSync(),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return xe.make(e.shape,{values:r})},e.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return xe.make(e.shape,{values:t})},e.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return xe.make(e.shape,{values:t})},e.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=n[r];return xe.make(e.shape,{values:t},"int32")},e.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return xe.make(e.shape,{values:t})},e.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return xe.make(e.shape,{values:n})},e.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return xe.make(e.shape,{values:t})},e.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return xe.make(e.shape,{values:t})},e.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return xe.make(e.shape,{values:t})},e.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return xe.make(e.shape,{values:t})},e.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return xe.make(e.shape,{values:t})},e.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return xe.make(e.shape,{values:t})},e.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},e.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return xe.make(e.shape,{values:t})},e.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return xe.make(e.shape,{values:t})},e.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=M(n[r]);return xe.make(e.shape,{values:t})},e.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return xe.make(e.shape,{values:t})},e.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return xe.make(e.shape,{values:t})},e.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return xe.make(e.shape,{values:t})},e.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),n=e.dataSync(),r=ha,o=da,a=pa,i=va,s=ma,u=ga,l=0;l<n.length;++l){var c=n[l],f=1/(1+r*c);t[l]=1-((((u*f+s)*f+i)*f+a)*f+o)*f*Math.exp(-c*c)}return xe.make(e.shape,{values:t})},e.prototype.step=function(e,t){void 0===t&&(t=0),this.assertNotComplex(e,"step");for(var n=new Float32Array(e.size),r=e.dataSync(),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return xe.make(e.shape,{values:n})},e.prototype.conv2d=function(e,t,n){this.assertNotComplex([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=Qa(n.outShape,e.dtype),c=e.dataSync(),f=t.dataSync(),h=l.values,d=0;d<n.batchSize;++d)for(var p=d*e.strides[0],v=d*l.strides[0],m=0;m<n.outHeight;++m)for(var g=v+m*l.strides[1],y=m*n.strideHeight-s,b=0;b<r;b++){var x=y+b*a;if(!(x<0||x>=n.inHeight))for(var w=b*t.strides[0],C=p+x*e.strides[1],E=0;E<n.outWidth;++E)for(var S=g+E*n.outChannels,k=E*n.strideWidth-u,R=0;R<o;R++){var I=k+R*i;if(!(I<0||I>=n.inWidth))for(var _=w+R*t.strides[1],N=C+I*n.inChannels,T=_,A=0;A<n.inChannels;++A){for(var D=c[N+A],O=0;O<n.outChannels;++O)h[S+O]+=D*f[T+O];T+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,f=n.padInfo.top,h=Qa(n.outShape,e.dtype),d=e.dataSync(),p=t.dataSync(),v=h.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*h.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*h.strides[1],w=b*n.strideDepth-l,C=0;C<r;C++){var E=w+C*i;if(!(E<0||E>=n.inDepth))for(var S=C*t.strides[0],k=g+E*e.strides[1],R=0;R<n.outHeight;++R)for(var I=x+R*h.strides[2],_=R*n.strideHeight-f,N=0;N<o;N++){var T=_+N*s;if(!(T<0||T>=n.inHeight))for(var A=S+N*t.strides[1],D=k+T*e.strides[2],O=0;O<n.outWidth;++O)for(var M=I+O*n.outChannels,F=O*n.strideWidth-c,P=0;P<a;P++){var L=F+P*u;if(!(L<0||L>=n.inWidth))for(var B=A+P*t.strides[2],z=D+L*n.inChannels,W=B,U=0;U<n.inChannels;++U){for(var V=d[z+U],j=0;j<n.outChannels;++j)v[M+j]+=V*p[W+j];W+=n.outChannels}}}}return h.toTensor()},e.prototype.conv2dDerInput=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerInput");for(var r=Qa(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=e.dataSync(),c=e.strides,f=c[0],h=c[1],d=c[2],p=t.dataSync(),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,C=n.inChannels,E=n.inHeight,S=n.inWidth,k=n.outChannels,R=n.outHeight,I=n.outWidth,_=n.strideHeight,N=n.strideWidth,T=x-1-n.padInfo.top,A=w-1-n.padInfo.left,D=0;D<b;++D)for(var O=0;O<C;++O)for(var M=0;M<E;++M)for(var F=M-T,P=Math.max(0,Math.ceil(F/_)),L=Math.min(R,(x+F)/_),B=0;B<S;++B){for(var z=B-A,W=Math.max(0,Math.ceil(z/N)),U=Math.min(I,(w+z)/N),V=0,j=P;j<L;++j)for(var G=j*_-F,H=W;H<U;++H)for(var q=f*D+h*j+d*H,K=m*(x-1-G)+g*(w-1-(H*N-z))+y*O,X=0;X<k;++X)V+=l[q+X]*p[K+X];o[i*D+s*M+u*B+O]=V}return r.toTensor()},e.prototype.conv3dDerInput=function(e,t,n){for(var r=Qa(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=e.dataSync(),f=e.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=t.dataSync(),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],C=n.batchSize,E=n.filterDepth,S=n.filterHeight,k=n.filterWidth,R=n.inChannels,I=n.inDepth,_=n.inHeight,N=n.inWidth,T=n.outChannels,A=n.outDepth,D=n.outHeight,O=n.outWidth,M=n.strideDepth,F=n.strideHeight,P=n.strideWidth,L=E-1-n.padInfo.front,B=S-1-n.padInfo.top,z=k-1-n.padInfo.left,W=0;W<C;++W)for(var U=0;U<R;++U)for(var V=0;V<I;++V)for(var j=V-L,G=Math.max(0,Math.ceil(j/M)),H=Math.min(A,(E+j)/M),q=0;q<_;++q)for(var K=q-B,X=Math.max(0,Math.ceil(K/F)),$=Math.min(D,(S+K)/F),Y=0;Y<N;++Y){for(var Q=Y-z,J=Math.max(0,Math.ceil(Q/P)),Z=Math.min(O,(k+Q)/P),ee=0,te=G;te<H;++te)for(var ne=te*M-j,re=X;re<$;++re)for(var oe=re*F-K,ae=J;ae<Z;++ae)for(var ie=h*W+d*te+p*re+v*ae,se=y*(E-1-ne)+b*(S-1-oe)+x*(k-1-(ae*P-Q))+w*U,ue=0;ue<T;++ue)ee+=c[ie+ue]*m[se+ue];o[i*W+s*V+u*q+l*Y+U]=ee}return r.toTensor()},e.prototype.conv2dDerFilter=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Qa(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=e.bufferSync(),f=t.bufferSync(),h=0;h<a;++h)for(var d=Math.max(0,Math.ceil((l-h)/r)),p=Math.min(n.outHeight,(n.inHeight+l-h)/r),v=0;v<i;++v)for(var m=Math.max(0,Math.ceil((u-v)/o)),g=Math.min(n.outWidth,(n.inWidth+u-v)/o),y=0;y<n.inChannels;++y)for(var b=0;b<n.outChannels;++b){for(var x=0,w=0;w<n.batchSize;++w)for(var C=d;C<p;++C)for(var E=h+C*r-l,S=m;S<g;++S){var k=v+S*o-u;x+=c.get(w,E,k,y)*f.get(w,C,S,b)}s.set(x,h,v,y,b)}return s.toTensor()},e.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=Qa(n.filterShape,"float32"),c=l.values,f=l.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=t.dataSync(),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],C=e.dataSync(),E=e.strides,S=E[0],k=E[1],R=E[2],I=E[3],_=n.padInfo.front,N=n.padInfo.left,T=n.padInfo.top,A=0;A<i;++A)for(var D=Math.max(0,Math.ceil((_-A)/r)),O=Math.min(n.outDepth,(n.inDepth+_-A)/r),M=A*h,F=0;F<s;++F)for(var P=Math.max(0,Math.ceil((T-F)/o)),L=Math.min(n.outHeight,(n.inHeight+T-F)/o),B=F*d+M,z=0;z<u;++z)for(var W=Math.max(0,Math.ceil((N-z)/a)),U=Math.min(n.outWidth,(n.inWidth+N-z)/a),V=z*p+B,j=0;j<n.inChannels;++j)for(var G=j*v+V,H=0;H<n.outChannels;++H){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*S,$=K*y,Y=D;Y<O;++Y)for(var Q=(A+Y*r-_)*k+X,J=Y*b+$,Z=P;Z<L;++Z)for(var ee=(F+Z*o-T)*R+Q,te=Z*x+J,ne=W;ne<U;++ne){var re=ne*w+te;q+=C[(z+ne*a-N)*I+ee+j]*m[re+H]}c[G+H]=q}return l.toTensor()},e.prototype.depthwiseConv2D=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=Qa(n.outShape,e.dtype),f=e.dataSync(),h=t.dataSync(),d=c.values,p=0;p<n.batchSize;++p)for(var v=p*e.strides[0],m=p*c.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*c.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var C=x*t.strides[0],E=v+w*e.strides[1],S=0;S<n.outWidth;++S)for(var k=y+S*c.strides[2],R=S*n.strideWidth-u,I=0;I<o;++I){var _=R+I*i;if(!(_<0||_>=n.inWidth))for(var N=C+I*t.strides[1],T=E+_*n.inChannels,A=k,D=N,O=0;O<n.inChannels;++O){for(var M=f[T+O],F=0;F<l;++F)d[A+F]+=M*h[D+F];A+=l,D+=l}}}return c.toTensor()},e.prototype.depthwiseConv2DDerInput=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var r=Qa(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=e.dataSync(),c=e.strides,f=c[0],h=c[1],d=c[2],p=t.dataSync(),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,C=n.inChannels,E=n.inHeight,S=n.inWidth,k=n.outChannels,R=n.outHeight,I=n.outWidth,_=n.strideHeight,N=n.strideWidth,T=x-1-n.padInfo.top,A=w-1-n.padInfo.left,D=k/C,O=0;O<b;++O)for(var M=0;M<C;++M)for(var F=0;F<E;++F)for(var P=F-T,L=Math.max(0,Math.ceil(P/_)),B=Math.min(R,(x+P)/_),z=0;z<S;++z){for(var W=z-A,U=Math.max(0,Math.ceil(W/N)),V=Math.min(I,(w+W)/N),j=0,G=L;G<B;++G)for(var H=G*_-P,q=U;q<V;++q)for(var K=f*O+h*G+d*q,X=m*(x-1-H)+g*(w-1-(q*N-W))+y*M,$=0;$<D;++$)j+=l[K+(M*D+$)]*p[X+$];o[i*O+s*F+u*z+M]=j}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Qa(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,f=e.bufferSync(),h=t.bufferSync(),d=0;d<a;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),v=Math.min(n.outHeight,(n.inHeight+l-d)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/c),w=b%c,C=0,E=0;E<n.batchSize;++E)for(var S=p;S<v;++S)for(var k=d+S*r-l,R=g;R<y;++R){var I=m+R*o-u;C+=f.get(E,k,I,x)*h.get(E,S,R,b)}s.set(C,d,m,x,w)}return s.toTensor()},e.prototype.tile=function(e,t){this.assertNotComplex(e,"tile");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Qa(n,e.dtype),a=e.bufferSync();for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=i[u]%e.shape[u];var l=a.locToIndex(s);o.values[r]=a.values[l]}return o.toTensor()},e.prototype.pad=function(e,t,n){this.assertNotComplex(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),a=e.bufferSync(),i=Qa(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map(function(e,t){return e+o[t]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},e.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var o=e.dataSync(),a=Qa(n,e.dtype),i=e.bufferSync();for(r=0;r<e.size;++r){for(var s=i.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[t[l]];var c=a.locToIndex(u);a.values[c]=o[r]}return a.toTensor()},e.prototype.gather=function(e,t,n){this.assertNotComplex([e,t],"gather");var r=e.shape.slice(),o=t.dataSync();r[n]=o.length;for(var a=Qa(r,e.dtype),i=e.bufferSync(),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},e.prototype.batchToSpaceND=function(e,t,n){this.assertNotComplex([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=it(e.shape,t,r),a=st(o.length,t.length),i=ut(e.shape,t,r),s=lt(n,t.length),u=ct(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){this.assertNotComplex([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=it(i.shape,t,r,!1),u=st(s.length,t.length,!1),l=ut(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},e.prototype.pool=function(e,t,n){this.assertNotComplex(e,"pool");for(var r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=e.dataSync(),d=Qa(t.outShape,e.dtype),p=d.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*v,x=y*e.strides[0],w=0;w<t.inChannels;++w)for(var C=0;C<t.outHeight;++C)for(var E=C*r-l,S=Math.max(0,E),k=Math.min(t.inHeight,s+E),R=b+C*m,I=0;I<t.outWidth;++I){for(var _=I*o-c,N=Math.max(0,_),T=Math.min(t.inWidth,u+_),A=f,D=0,O=0,M=S;M<k;M+=a){for(var F=x+M*e.strides[1],P=N;P<T;P+=i){var L=h[F+P*e.strides[2]+w];"max"===n&&L>A?A=L:"avg"===n&&(D+=L,O++)}if(isNaN(A))break}p[R+I*g+w]="avg"===n?D/O:A}return d.toTensor()},e.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},e.prototype.maxPoolPositions=function(e,t){for(var n=Qa(t.outShape,"int32"),r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,f=e.bufferSync(),h=0;h<t.batchSize;++h)for(var d=0;d<t.inChannels;++d)for(var p=0;p<t.outHeight;++p){for(var v=p*r-l,m=v;m<0;)m+=a;for(var g=Math.min(t.inHeight,s+v),y=0;y<t.outWidth;++y){for(var b=y*o-c,x=b;x<0;)x+=i;for(var w=Math.min(t.inWidth,u+b),C=Number.NEGATIVE_INFINITY,E=-1,S=m;S<g;S+=a)for(var k=S-v,R=x;R<w;R+=i){var I=R-b,_=f.get(h,S,R,d);_>C&&(C=_,E=k*u+I)}n.set(E,h,p,y,d)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(e,t,n,r){this.assertNotComplex([t,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,r),a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,f=c-1-r.padInfo.left,h=l-1-r.padInfo.top,d=Qa(t.shape,"float32"),p=o.bufferSync(),v=e.bufferSync(),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-h,w=b-f,C=0,E=0;E<l;E+=s){var S=(x+E)/a;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var R=(w+k)/i;if(!(R<0||R>=r.outWidth||Math.floor(R)!==R)){var I=l*c-1-p.get(m,S,R,g)===E*c+k?1:0;0!==I&&(C+=v.get(m,S,R,g)*I)}}}d.set(C,m,y,b,g)}return d.toTensor()},e.prototype.avgPoolBackprop=function(e,t,n){this.assertNotComplex([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,f=c-1-n.padInfo.left,h=l-1-n.padInfo.top,d=Qa(t.shape,"float32"),p=1/(a*i),v=e.bufferSync(),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-h,w=b-f,C=0,E=0;E<l;E+=s){var S=(x+E)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var R=(w+k)/o;R<0||R>=n.outWidth||Math.floor(R)!==R||(C+=v.get(m,S,R,g))}}d.set(C*p,m,y,b,g)}return d.toTensor()},e.prototype.cast=function(e,t){return Kt(e,t,this)},e.prototype.reshape=function(e,t){return Xt(e,t)},e.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},e.prototype.resizeBilinear=function(e,t,n,r){this.assertNotComplex(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=e.dataSync(),c=new Float32Array(A([a,t,n,u])),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=0,p=f[0]/h[0],v=f[1]/h[1],m=0;m<a;m++)for(var g=0;g<t;g++)for(var y=p*g,b=Math.floor(y),x=y-b,w=Math.min(i-1,Math.ceil(y)),C=m*e.strides[0]+b*e.strides[1],E=m*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var k=v*S,R=Math.floor(k),I=k-R,_=Math.min(s-1,Math.ceil(k)),N=C+R*e.strides[2],T=E+R*e.strides[2],D=C+ +_*e.strides[2],O=E+_*e.strides[2],M=0;M<u;M++){var F=l[N+M],P=l[T+M],L=F+(l[D+M]-F)*I,B=L+(P+(l[O+M]-P)*I-L)*x;c[d++]=B}return Mt(c,[a,t,n,u])},e.prototype.resizeBilinearBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),h=[n&&l>1?a-1:a,n&&c>1?i-1:i],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],p=h[0]/d[0],v=h[1]/d[1],m=e.dataSync(),g=0,y=0;y<o;y++)for(var b=y*t.strides[0],x=0;x<l;x++)for(var w=x*p,C=Math.floor(w),E=Math.min(Math.ceil(w),a-1),S=b+C*t.strides[1],k=b+E*t.strides[1],R=w-C,I=1-R,_=0;_<c;_++)for(var N=_*v,T=Math.floor(N),A=Math.min(Math.ceil(N),i-1),D=N-T,O=1-D,M=S+T*t.strides[2],F=S+A*t.strides[2],P=k+T*t.strides[2],L=k+A*t.strides[2],B=I*O,z=I*D,W=R*O,U=R*D,V=0;V<s;V++){var j=m[g++];f[M+V]+=j*B,f[F+V]+=j*z,f[P+V]+=j*W,f[L+V]+=j*U}return zt(f,[o,i,a,s],t.dtype)},e.prototype.resizeNearestNeighbor=function(e,t,n,r){this.assertNotComplex(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=e.dataSync(),c=new Float32Array(a*t*n*u),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=f[0]/h[0],p=f[1]/h[1],v=0,m=0;m<a;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var b=d*y,x=g+Math.min(i-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var C=p*w,E=x+Math.min(s-1,r?Math.round(C):Math.floor(C))*e.strides[2],S=0;S<u;S++){var k=l[E+S];c[v++]=k}return Mt(c,[a,t,n,u],e.dtype)},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),h=e.dataSync(),d=[n&&l>1?a-1:a,n&&c>1?i-1:i],p=[n&&l>1?l-1:l,n&&c>1?c-1:c],v=d[0]/p[0],m=d[1]/p[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<o;w++)for(var C=w*t.strides[0],E=0;E<a;E++)for(var S=C+E*t.strides[1],k=Math.floor(E*g),R=Math.floor(k-b/2),I=0;I<i;I++)for(var _=S+I*t.strides[2],N=Math.floor(I*y),T=Math.floor(N-x/2),A=0;A<s;A++){for(var D=0,O=0;O<b;O++){var M=O+R;if(!(M<0||M>=l)){var F=C+M*e.strides[1],P=M*v;if(E===Math.min(a-1,n?Math.round(P):Math.floor(P)))for(var L=0;L<x;L++){var B=L+T;if(!(B<0||B>=c)){var z=F+B*e.strides[2],W=B*m;I===Math.min(i-1,n?Math.round(W):Math.floor(W))&&(D+=h[z+A])}}}}f[_+A]=D}return zt(f,t.shape,t.dtype)},e.prototype.batchNormalization=function(e,t,n,r,o,a){this.assertNotComplex([e,t,n,o,a],"batchNorm");for(var i=e.dataSync(),s=t.dataSync(),u=n.dataSync(),l=o?o.dataSync():new Float32Array([1]),c=a?a.dataSync():new Float32Array([0]),f=new Float32Array(i.length),h=c.length,d=l.length,p=u.length,v=s.length,m=0,g=0,y=0,b=0,x=0;x<i.length;++x)f[x]=c[m++]+(i[x]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),m>=h&&(m=0),g>=v&&(g=0),y>=d&&(y=0),b>=p&&(b=0);return zt(f,e.shape)},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=e.dataSync(),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var f=0;f<u;f++){var h=c(f),d=s[f]*Math.pow(n+r*h,-o);l[f]=d}return zt(l,e.shape)},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){this.assertNotComplex(e,"LRNGrad");for(var s=e.shape[3],u=e.dataSync(),l=t.dataSync(),c=n.dataSync(),f=new Float32Array(e.size),h=e.size,d=0;d<h;d++){for(var p=d%s,v=d-p+Math.max(0,p-r),m=d-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(l[y],2);for(g=a*g+o,y=v;y<m;y++){var b=-2*a*i*l[y]*c[d]/g;d===y&&(b+=Math.pow(g,-i)),b*=u[d],f[y]+=b}}return zt(f,e.shape)},e.prototype.multinomial=function(e,t,n,r){this.assertNotComplex(e,"multinomial");for(var o=t?e:Nt(e),a=o.shape[0],i=o.shape[1],s=Ut([a,n],"int32"),u=s.dataSync(),l=o.dataSync(),c=0;c<a;++c){var f=c*i,h=new Float32Array(i-1);h[0]=l[f];for(var d=1;d<h.length;++d)h[d]=h[d-1]+l[f+d];for(var p=$a(r.toString()),v=c*n,m=0;m<n;++m){var g=p();u[v+m]=h.length;for(var y=0;y<h.length;y++)if(g<h[y]){u[v+m]=y;break}}}return s},e.prototype.oneHot=function(e,t,n,r){this.assertNotComplex(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=e.dataSync(),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return Lt(o,[e.size,t],"int32")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return this.assertNotComplex(e,"nonMaxSuppression"),Zt(e.dataSync(),t.dataSync(),n,r,o)},e.prototype.fft=function(e){return this.fftBatch(e,!1)},e.prototype.ifft=function(e){return this.fftBatch(e,!0)},e.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=Qa(e.shape,"float32"),a=Qa(e.shape,"float32"),i=Dt(e).as2D(n,r),s=Ot(e).as2D(n,r),u=0;u<n;u++)for(var l=i.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),f=At(l,c),h=this.fftImpl(f,t).dataSync(),d=0;d<r;d++){var p=Yt(h,d);o.values[u*r+d]=p.real,a.values[u*r+d]=p.imag}return At(o.toTensor(),a.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=At(Dt(o).div(Ft(r)),Ot(o).div(Ft(r)))),o}var a=e.dataSync(),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return At(i.real,i.imag).as2D(e.shape[0],e.shape[1])},e.prototype.isExponentOf2=function(e){return 0==(e&e-1)},e.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=e.dataSync(),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=At(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=At(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=At(l.real,l.imag).mul(u),f=i.add(c),h=i.sub(c),d=Dt(f).concat(Dt(h)),p=Ot(f).concat(Ot(h));return At(d,p).as1D()},e.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=Jt(o*s,t,n),l=Yt(e,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}n&&(a/=t,i/=t),Qt(r,a,i,o)}return r},e.prototype.depthToSpace=function(e,t,n){I("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),I(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,l=i/(t*t),c=e.dataSync(),f=new Float32Array(r*s*u*l),h=0,d=0;d<r;++d)for(var p=0;p<s;++p)for(var v=Math.floor(p/t),m=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(m*t+g%t)*l,x=0;x<l;++x){var w=x+b+i*(y+a*(v+o*d));f[h++]=c[w]}return zt(f,[r,s,u,l])},e.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=ln(e.shape,t.shape),a=Qa(o,n),i=e.dataSync(),s=t.dataSync(),u=sn(e.shape,o),l=sn(t.shape,o),c=a.values;if(u.length+l.length===0)for(var f=0;f<c.length;++f)c[f]=r(i[f%i.length],s[f%s.length]);else{var h=e.bufferSync(),d=t.bufferSync(),p=function(n){var o=a.indexToLoc(n),f=o.slice(-e.rank);u.forEach(function(e){return f[e]=0});var p=h.locToIndex(f),v=o.slice(-t.rank);l.forEach(function(e){return v[e]=0});var m=d.locToIndex(v);c[n]=r(i[p],s[m])};for(f=0;f<c.length;++f)p(f)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=ln(e.shape,t.shape),o=Qa(r,"float32"),a=Qa(r,"float32"),i=e.dataSync(),s=t.dataSync(),u=sn(e.shape,r),l=sn(t.shape,r),c=o.values,f=a.values;if(u.length+l.length===0)for(var h=0;h<c.length;h++){var d=h%i.length,p=h%s.length,v=n(i[2*d],i[2*d+1],s[2*p],s[2*p+1]);c[h]=v.real,f[h]=v.imag}else{var m=this.data.get(e.dataId).complexTensors.real.bufferSync(),g=this.data.get(t.dataId).complexTensors.real.bufferSync(),y=function(r){var a=o.indexToLoc(r),h=a.slice(-e.rank);u.forEach(function(e){return h[e]=0});var d=m.locToIndex(h),p=a.slice(-t.rank);l.forEach(function(e){return p[e]=0});var v=g.locToIndex(p),y=n(i[2*d],i[2*d+1],s[2*v],s[2*v+1]);c[r]=y.real,f[r]=y.imag};for(h=0;h<c.length;h++)y(h)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(e,t,n){return tn(e,t,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],f=t.shape[0],h=r[0],d=r[1],p=Qa([f,h,d,c],e.dtype),v=t.dataSync(),m=n.dataSync(),g=e.dataSync(),y=e.strides,b=p.strides,x=0;x<f;x++){var w=4*x,C=v[w],E=v[w+1],S=v[w+2],k=v[w+3],R=m[x];if(!(R>=s))for(var I=h>1?(S-C)*(u-1)/(h-1):0,_=d>1?(k-E)*(l-1)/(d-1):0,N=0;N<h;N++){var T=h>1?C*(u-1)+N*I:.5*(C+S)*(u-1);if(T<0||T>u-1)for(var A=0;A<d;A++)for(var D=0;D<c;D++){var O=D+A*b[2]+N*b[1]+x*b[0];p.values[O]=a}else if("bilinear"===o){var M=Math.floor(T),F=Math.ceil(T),P=T-M;for(A=0;A<d;A++)if((H=d>1?E*(l-1)+A*_:.5*(E+k)*(l-1))<0||H>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],p.values[O]=a;else{var L=Math.floor(H),B=Math.ceil(H),z=H-L;for(D=0;D<c;D++){var W=g[O=D+L*y[2]+M*y[1]+R*y[0]],U=g[O=D+B*y[2]+M*y[1]+R*y[0]],V=g[O=D+L*y[2]+F*y[1]+R*y[0]],j=W+(U-W)*z,G=V+(g[O=D+B*y[2]+F*y[1]+R*y[0]]-V)*z;O=D+A*b[2]+N*b[1]+x*b[0],p.values[O]=j+(G-j)*P}}}else for(A=0;A<d;++A){var H;if((H=d>1?E*(l-1)+A*_:.5*(E+k)*(l-1))<0||H>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],p.values[O]=a;else{var q=Math.round(H),K=Math.round(T);for(D=0;D<c;D++){var X=D+q*y[2]+K*y[1]+R*y[0],$=D+A*b[2]+N*b[1]+x*b[0];p.values[$]=g[X]}}}}}return p.toTensor()},e.prototype.sparseToDense=function(e,t,n,r){var o=Ct(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(e,t,n,l,s,i,a,u,r,!1)},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=bt(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return Mt([],a,e.dtype);for(var l=new me([i,s],e.dtype),c=t.dataSync(),f=e.dataSync(),h=0;h<i;h++){for(var d=[],p=0,v=0;v<r;v++){var m=c[h*r+v];p+=m*u[v],d.push(m)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+d+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[h*s+g]=f[p*s+g]}return l.toTensor().reshape(a)},e.prototype.scatterND=function(e,t,n){var r=Ct(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=Ft(0);return this.scatter(e,t,n,u,i,a,o,s,l,!0)},e.prototype.fill=function(e,t,n){var r=V(n=n||J(t),A(e));return r.fill(t),xe.make(e,{values:r},n)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){var t=V(e.dtype,A(e.shape));return xe.make(e.shape,{values:t},e.dtype)},e.prototype.scatter=function(e,t,n,r,o,a,i,s,u,l){var c=[r/o,o],f=e.dataSync(),h=t.dataSync();if(0===r)return Mt([],n,t.dtype);var d=new me(c,t.dtype);d.values.fill(u.dataSync()[0]);for(var p=0;p<a;p++){for(var v=[],m=0,g=0;g<i;g++){var y=f[p*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<o;b++)l?d.values[m*o+b]+=h[p*o+b]:d.values[m*o+b]=0===t.rank?h[0]:h[p*o+b]}return d.toTensor().reshape(n)},e}();$e.registerBackend("cpu",function(){return new Zl},1);"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;var ec={float32:4,int32:4,uint16:2,uint8:1,bool:1};function tc(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=A(i),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=ec[l.dtype],f=e.slice(r,r+s*c),h="uint8"===l.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(h,function(e){return e*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(h,function(e){return Math.round(e*l.scale+l.min)})}r+=s*c}else{var d=ec[a];if(f=e.slice(r,r+s*d),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(f)}r+=s*d}var p=void 0;if("float32"===a)p=Mt(u,i,"float32");else if("int32"===a)p=Mt(u,i,"int32");else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);p=Mt(u,i,"bool")}n[o]=p},a=0,i=t;a<i.length;a++)o(i[a]);return n}function nc(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var rc="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function oc(e){return rc?Buffer.byteLength(e):new Blob([e]).size}function ac(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function ic(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function sc(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:oc(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:oc(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var uc=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),lc="://",cc=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){I(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(lc)&&(t=t.slice(0,t.indexOf(lc))),I(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();I(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function fc(e){if(-1===e.indexOf(lc))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+cc.getSchemes().join(","));return{scheme:e.split(lc)[0],path:e.split(lc)[1]}}function hc(e,t,n){return void 0===n&&(n=!1),g(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f;return y(this,function(h){switch(h.label){case 0:return I(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),I((r=uc.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),I(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],I((a=uc.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),I(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=fc(e).scheme,u=fc(e).path,l=s===fc(e).scheme,[4,o.load()];case 1:return c=h.sent(),n&&l?[4,cc.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,i.save(c)];case 4:return f=h.sent(),!n||l?[3,6]:[4,cc.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var dc="tensorflowjs",pc="models_store",vc="model_info_store";function mc(){if(!$e.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function gc(e){var t=e.result;t.createObjectStore(pc,{keyPath:"modelPath"}),t.createObjectStore(vc,{keyPath:"modelPath"})}var yc=function(){function e(e){if(this.indexedDB=mc(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return g(this,void 0,void 0,function(){return y(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return g(this,void 0,void 0,function(){return y(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open(dc,1);o.onupgradeneeded=function(){return gc(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(pc,"readonly"),s=i.objectStore(pc).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=sc(t),c=a.transaction(vc,"readwrite"),f=c.objectStore(vc),h=f.put({modelPath:n.modelPath,modelArtifactsInfo:l});h.onsuccess=function(){var o=(u=a.transaction(pc,"readwrite")).objectStore(pc).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});o.onsuccess=function(){return e({modelArtifactsInfo:l})},o.onerror=function(e){var t=(f=c.objectStore(vc)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},h.onerror=function(e){return a.close(),r(h.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),bc=function(e){return $e.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(yc.URL_SCHEME)?function(e){return new yc(e)}(e.slice(yc.URL_SCHEME.length)):null};uc.registerSaveRouter(bc),uc.registerLoadRouter(bc);var xc=function(){function e(){this.indexedDB=mc()}return e.prototype.listModels=function(){return g(this,void 0,void 0,function(){var e=this;return y(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open(dc,1);r.onupgradeneeded=function(){return gc(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(vc,"readonly"),a=o.objectStore(vc).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return g(this,void 0,void 0,function(){var t=this;return y(this,function(n){return e=function(e){return e.startsWith(yc.URL_SCHEME)?e.slice(yc.URL_SCHEME.length):e}(e),[2,new Promise(function(n,r){var o=t.indexedDB.open(dc,1);o.onupgradeneeded=function(){return gc(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(vc,"readwrite"),s=i.objectStore(vc),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(pc,"readwrite")).objectStore(pc).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if($e.get("IS_BROWSER"))try{cc.registerManager(yc.URL_SCHEME,new xc)}catch(cf){}var wc="/",Cc="tensorflowjs_models",Ec="info",Sc="model_topology",kc="weight_specs",Rc="weight_data",Ic="model_metadata";function _c(e){return{info:[Cc,e,Ec].join(wc),topology:[Cc,e,Sc].join(wc),weightSpecs:[Cc,e,kc].join(wc),weightData:[Cc,e,Rc].join(wc),modelMetadata:[Cc,e,Ic].join(wc)}}function Nc(e){var t=e.split(wc);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(wc)}var Tc=function(){function e(e){if(!$e.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=_c(this.modelPath)}return e.prototype.save=function(e){return g(this,void 0,void 0,function(){var t,n,r;return y(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=sc(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){return rc?Buffer.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return g(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return y(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(rc){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),Ac=function(e){return $e.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Tc.URL_SCHEME)?function(e){return new Tc(e)}(e.slice(Tc.URL_SCHEME.length)):null};uc.registerSaveRouter(Ac),uc.registerLoadRouter(Ac);var Dc=function(){function e(){I($e.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),I(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return g(this,void 0,void 0,function(){var e,t,n,r,o,a;return y(this,function(i){for(e={},t=Cc+wc,n=wc+Ec,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=Nc(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return g(this,void 0,void 0,function(){var t,n;return y(this,function(r){if(e=function(e){return e.startsWith(Tc.URL_SCHEME)?e.slice(Tc.URL_SCHEME.length):e}(e),t=_c(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if($e.get("IS_BROWSER"))try{cc.registerManager(Tc.URL_SCHEME,new Dc)}catch(cf){}var Oc=function(){function e(t){if(!$e.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return g(this,void 0,void 0,function(){var t,n,r,o,a,i;return y(this,function(s){if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,a.click(),null!=e.weightData&&((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,i.click()),[2,{modelArtifactsInfo:sc(e)}]})})},e.URL_SCHEME="downloads://",e}(),Mc=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return g(this,void 0,void 0,function(){var e,t,n=this;return y(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var c=[],f=[],h=[];u.forEach(function(e){e.paths.forEach(function(e){f.push(e),h.push(null)}),c.push.apply(c,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=f.indexOf(e);h[o]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:ac(h)})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return ic(e.name)}),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach(function(e){var a=ic(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function Fc(e,t,n,r){!function(e){I(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){I(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),I(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),I(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var i=n+ ++o/e.length*(r-n);return t(i),a}),a}))}function Pc(e,t){return g(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return y(this,function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit)}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=f.sent(),[3,4];case 2:return[4,Fc(r,t.onProgress,o,a)];case 3:i=f.sent(),f.label=4;case 4:return s=i.map(function(e){return e.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=f.sent(),[3,8];case 6:return[4,Fc(s,t.onProgress,u,l)];case 7:c=f.sent(),f.label=8;case 8:return[2,c]}})})}function Lc(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),g(t,void 0,void 0,function(){var t,a,i,s,u,l,c,f,h,d;return y(this,function(p){switch(p.label){case 0:if(t=n.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,l=ec[u]*A(e.shape),c=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=o?o.forEach(function(t,n){t===e.name&&(c(),i[n]=!0)}):c(),s.push(e.name),r+=l})}),!i.every(function(e){return e}))throw u=o.filter(function(e,t){return!i[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),c=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)})}),[4,e(c)];case 1:return f=p.sent(),h={},d=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=f[d+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,l=0;l<t;l++){var c=new Uint8Array(f[d+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(e){var t=tc(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]}),d+=t}),[2,h]}})})}}uc.registerSaveRouter(function(e){return $e.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Oc.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Oc(e)}(e.slice(Oc.URL_SCHEME.length)):null});var Bc=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null==t.fetchFunc){var n=$e.global.fetch;if(void 0===n)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");t.fetchFunc=n.bind($e.global)}else I("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(e,n){return t.fetchFunc(e,n).catch(function(t){throw new Error("Request for "+e+" failed due to error: "+t)})},I(null!=e&&e.length>0,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(e)&&I(2===e.length,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return g(this,void 0,void 0,function(){var t,n,r,o;return y(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:sc(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return g(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s;return y(this,function(u){switch(u.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(e=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,e.json()];case 3:return t=u.sent(),[3,5];case 4:throw u.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:s=u.sent(),a=s[0],i=s[1],u.label=7;case 7:return[2,{modelTopology:r,weightSpecs:a,weightData:i}]}})})},e.prototype.loadWeights=function(e){return g(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f;return y(this,function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,u=e;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],e.forEach(function(e){e.paths.forEach(function(e){c.push(a+e+o)})}),[4,Pc(c,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[i,ac(f)]]}})})},e.prototype.getFetchFunc=function(){return this.fetchFunc},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function zc(e){return null!=e.match(Bc.URL_SCHEME_REGEX)}var Wc=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return zc(e)}):zc(e))?Uc(e,{onProgress:t}):null};function Uc(e,t){return new Bc(e,t)}uc.registerSaveRouter(Wc),uc.registerLoadRouter(Wc);var Vc=function(){function e(e,t,n){this.modelTopology=e,this.weightSpecs=t,this.weightData=n}return e.prototype.load=function(){return g(this,void 0,void 0,function(){var e;return y(this,function(t){return e={},null!=this.modelTopology&&(e=m({modelTopology:this.modelTopology},e)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(e=m({weightSpecs:this.weightSpecs},e)),null!=this.weightData&&this.weightData.byteLength>0&&(e=m({weightData:this.weightData},e)),[2,e]})})},e}(),jc=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return g(this,void 0,void 0,function(){return y(this,function(t){return[2,this.saveHandler(e)]})})},e}();Object.freeze({browserFiles:function(e){return new Mc(e)},browserHTTPRequest:Uc,concatenateArrayBuffers:ac,decodeWeights:tc,encodeWeights:function(e){return g(this,void 0,void 0,function(){var t,n,r,o;return y(this,function(a){switch(a.label){case 0:for(r in t=[],n=[],e){if("float32"!==(o=e[r]).dtype&&"int32"!==o.dtype&&"bool"!==o.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+o.dtype);t.push({name:r,shape:o.shape,dtype:o.dtype}),n.push(o.data())}return[4,Promise.all(n)];case 1:return[2,{data:nc(a.sent()),specs:t}]}})})},fromMemory:function(e,t,n){return new Vc(e,t,n)},getLoadHandlers:function(e,t){return uc.getLoadHandlers(e)},getModelArtifactsInfoForJSON:sc,getSaveHandlers:function(e){return uc.getSaveHandlers(e)},isHTTPScheme:zc,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),g(this,void 0,void 0,function(){return y(this,function(o){return[2,Lc(function(e){return Pc(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return uc.registerLoadRouter(e)},registerSaveRouter:function(e){return uc.registerSaveRouter(e)},weightsLoaderFactory:Lc,withSaveHandler:function(e){return new jc(e)},copyModel:function(e,t){return g(this,void 0,void 0,function(){return y(this,function(n){switch(n.label){case 0:return[4,hc(e,t,!1)];case 1:return[2,n.sent()]}})})},listModels:function(){return g(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return y(this,function(s){switch(s.label){case 0:e=cc.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,cc.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+lc+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return g(this,void 0,void 0,function(){return y(this,function(n){switch(n.label){case 0:return[4,hc(e,t,!0)];case 1:return[2,n.sent()]}})})},removeModel:function(e){return g(this,void 0,void 0,function(){var t;return y(this,function(n){switch(n.label){case 0:return t=fc(e),[4,cc.getManager(t.scheme).removeModel(t.path)];case 1:return[2,n.sent()]}})})}});var Gc=_t({confusionMatrix_:function(e,t,n){var r=Ze(e,"labels","confusionMatrix"),o=Ze(t,"predictions","confusionMatrix");I(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),I(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),I(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),I(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),I(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=ii(r.asType("int32"),n),i=ii(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}});Object.freeze({confusionMatrix:Gc});var Hc=_t({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return $e.engine.fromPixels(e,t)}}),qc=Object.freeze({toPixels:function(e,t){return g(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,h,d,p,v,m,g,b,x,w,C;return y(this,function(y){switch(y.label){case 0:if(n=Ze(e,"img","toPixels"),e instanceof xe||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return s=n.min(),u=n.max(),[4,s.data()];case 1:return l=y.sent()[0],[4,u.data()];case 2:if(c=y.sent()[0],s.dispose(),u.dispose(),"float32"===n.dtype){if(l<0||c>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+l+" - "+c+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(l<0||c>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+l+" - "+c+"].")}return[4,n.data()];case 3:for(f=y.sent(),h="float32"===n.dtype?255:1,d=new Uint8ClampedArray(a*o*4),p=0;p<o*a;++p)v=void 0,m=void 0,g=void 0,b=void 0,1===i?(v=f[p]*h,m=f[p]*h,g=f[p]*h,b=255):3===i?(v=f[3*p]*h,m=f[3*p+1]*h,g=f[3*p+2]*h,b=255):4===i&&(v=f[4*p]*h,m=f[4*p+1]*h,g=f[4*p+2]*h,b=f[4*p+3]*h),d[0+(x=4*p)]=Math.round(v),d[x+1]=Math.round(m),d[x+2]=Math.round(g),d[x+3]=Math.round(b);return null!=t&&(t.width=a,t.height=o,w=t.getContext("2d"),C=new ImageData(d,a,o),w.putImageData(C,0,0)),n!==e&&n.dispose(),[2,d]}})})},fromPixels:Hc}),Kc=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),Xc=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function $c(e){I(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),I("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),I(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Xc.register(e)}Object.freeze({Serializable:Kc,SerializationMap:Xc,registerClass:$c});function Yc(e,t,n){return null==n&&(n=$e.get("TEST_EPSILON")),Qc(e,"number"==typeof t||"boolean"==typeof t?[t]:t,function(e,t){return Jc(e,Number(t),n)})}function Qc(e,t,n){if(e instanceof xe||t instanceof xe){if(e instanceof xe&&t instanceof xe){if(e.dtype!==t.dtype)throw new Error("Arrays are of different type actual: "+e.dtype+" vs expected: "+t.dtype+".");if(!D(e.shape,t.shape))throw new Error("Arrays are of different shape actual: "+e.shape+" vs expected: "+t.shape+".")}}else{var r=e.constructor.name,o=t.constructor.name;if(r!==o)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+o)}var a,i;if(a=e instanceof xe?e.dataSync():e,i=t instanceof xe?t.dataSync():t,a.length!==i.length)throw new Error("Arrays have different lengths actual: "+a.length+" vs expected: "+i.length+".\nActual:   "+a+".\nExpected: "+i+".");for(var s=0;s<i.length;++s){var u=a[s],l=i[s];if(!n(u,l))throw new Error("Arrays differ: actual["+s+"] = "+u+", expected["+s+"] = "+l+".\nActual:   "+a+".\nExpected: "+i+".")}}function Jc(e,t,n){return!(!isNaN(e)||!isNaN(t))||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({WEBGL_ENVS:{HAS_WEBGL:!0},PACKED_ENVS:{WEBGL_PACK:!0},NODE_ENVS:{IS_NODE:!0},CHROME_ENVS:{IS_CHROME:!0},BROWSER_ENVS:{IS_BROWSER:!0},CPU_ENVS:{HAS_WEBGL:!1},ALL_ENVS:{},expectArraysClose:Yc,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return e instanceof xe&&"string"===e.dtype||t instanceof xe&&"string"===t.dtype||Array.isArray(e)&&$(e[0])||Array.isArray(t)&&$(t[0])?Qc(e,n,function(e,t){return e==t}):Yc(e,t,0)},expectNumbersClose:function(e,t,n){if(null==n&&(n=$e.get("TEST_EPSILON")),!Jc(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){var r;r=e instanceof xe?e.dataSync():e;for(var o=0;o<r.length;o++)if(r[o]<t||r[o]>n)throw new Error("Value out of range:"+r[o]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:To,webgl_util:so,MathBackendWebGL:ki,GPGPUContext:Ao});var Zc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return v(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;return this.applyGradients(a),Object.keys(a).forEach(function(e){return a[e].dispose()}),t?o:(o.dispose(),null)},t.prototype.computeGradients=function(e,t){return function(e,t){if(I(Z(e),function(){return"The f passed in variableGrads(f) must be a function"}),I(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof we}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),null==t)for(var n in t=[],$e.engine.registeredVariables)t.push($e.engine.registeredVariables[n]);var r=t.length;I((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable."});var o=$e.engine.gradients(e,t,null,!0),a=o.value,i=o.grads;I(i.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),I(0===a.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var s={};return t.forEach(function(e,t){null!=i[t]&&(s[e.name]=i[t])}),{value:a,grads:s}}(e,t)},t.prototype.dispose=function(){},t}(Kc);Object.defineProperty(Zc,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var ef=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads={},o.accumulatedUpdates={},o.c=rt(Ft(-t)),o.rhoScalar=rt(Ft(n)),o.oneMinusRho=rt(Ft(1-n)),null===r&&(r=$e.get("EPSILON")),o.epsilonScalar=rt(Ft(r)),o}return v(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=$e.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&nt(function(){t.accumulatedGrads[n]=Ht(o).variable(!1)}),null==r.accumulatedUpdates[n]&&nt(function(){t.accumulatedUpdates[n]=Ht(o).variable(!1)});var a=e[n],i=r.accumulatedGrads[n],s=r.accumulatedUpdates[n];nt(function(){var e=t.rhoScalar.mul(i).add(t.oneMinusRho.mul(a.square())),r=s.add(t.epsilonScalar).sqrt().div(i.add(t.epsilonScalar).sqrt()).mul(a),u=t.rhoScalar.mul(s).add(t.oneMinusRho.mul(r.square()));t.accumulatedGrads[n].assign(e),t.accumulatedUpdates[n].assign(u);var l=t.c.mul(r).add(o);o.assign(l)})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(t){return e.accumulatedUpdates[t].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(t){return e.accumulatedGrads[t].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="AdadeltaOptimizer",t}(Zc);$c(ef);var tf=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads={},r.c=rt(Ft(-t)),r.epsilon=rt(Ft($e.get("EPSILON"))),r}return v(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=$e.engine.registeredVariables[n];null==r.accumulatedGrads[n]&&nt(function(){t.accumulatedGrads[n]=Vt(o.shape,t.initialAccumulatorValue).variable(!1)});var a=e[n],i=r.accumulatedGrads[n];nt(function(){var e=i.add(a.square());t.accumulatedGrads[n].assign(e);var r=t.c.mul(a.div(e.add(t.epsilon).sqrt())).add(o);o.assign(r)})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){var e=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(t){return e.accumulatedGrads[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="AdagradOptimizer",t}(Zc);$c(tf);var nf=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment={},a.accumulatedSecondMoment={},a.c=rt(Ft(-t)),a.beta1Scalar=rt(Ft(n)),a.beta2Scalar=rt(Ft(r)),nt(function(){a.accBeta1=Ft(n).variable(),a.accBeta2=Ft(r).variable()}),a.oneMinusBeta1=rt(Ft(1-n)),a.oneMinusBeta2=rt(Ft(1-r)),a.one=rt(Ft(1)),null===o&&(o=$e.get("EPSILON")),a.epsScalar=rt(Ft(o)),a}return v(t,e),t.prototype.applyGradients=function(e){var t=this;nt(function(){var n=t.one.sub(t.accBeta1),r=t.one.sub(t.accBeta2);for(var o in e){var a=$e.engine.registeredVariables[o];if(null==t.accumulatedFirstMoment[o]){var i=!1;t.accumulatedFirstMoment[o]=Ht(a).variable(i)}null==t.accumulatedSecondMoment[o]&&(i=!1,t.accumulatedSecondMoment[o]=Ht(a).variable(i));var s=e[o],u=t.accumulatedFirstMoment[o],l=t.accumulatedSecondMoment[o],c=t.beta1Scalar.mul(u).add(t.oneMinusBeta1.mul(s)),f=t.beta2Scalar.mul(l).add(t.oneMinusBeta2.mul(s.square())),h=c.div(n),d=f.div(r);t.accumulatedFirstMoment[o].assign(c),t.accumulatedSecondMoment[o].assign(f);var p=t.c.mul(h.div(t.epsScalar.add(d.sqrt()))).add(a);a.assign(p)}t.accBeta1.assign(t.accBeta1.mul(t.beta1Scalar)),t.accBeta2.assign(t.accBeta2.mul(t.beta2Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(t){return e.accumulatedFirstMoment[t].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(t){return e.accumulatedSecondMoment[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="AdamOptimizer",t}(Zc);$c(nf);var rf=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment={},i.accumulatedWeightedInfNorm={},i.c=rt(Ft(-t)),i.beta1Scalar=rt(Ft(n)),i.beta2Scalar=rt(Ft(r)),i.decayScalar=rt(Ft(a)),nt(function(){i.iteration=Ft(0).variable(),i.accBeta1=Ft(n).variable()}),i.oneMinusBeta1=rt(Ft(1-n)),i.one=rt(Ft(1)),null===o&&(o=$e.get("EPSILON")),i.epsScalar=rt(Ft(o)),i}return v(t,e),t.prototype.applyGradients=function(e){var t=this;nt(function(){var n=t.one.sub(t.accBeta1),r=t.c.div(t.one.add(t.decayScalar.mul(t.iteration)));for(var o in e){var a=$e.engine.registeredVariables[o];if(null==t.accumulatedFirstMoment[o]){var i=!1;t.accumulatedFirstMoment[o]=Ht(a).variable(i)}null==t.accumulatedWeightedInfNorm[o]&&(i=!1,t.accumulatedWeightedInfNorm[o]=Ht(a).variable(i));var s=e[o],u=t.accumulatedFirstMoment[o],l=t.accumulatedWeightedInfNorm[o],c=t.beta1Scalar.mul(u).add(t.oneMinusBeta1.mul(s)),f=t.beta2Scalar.mul(l),h=s.abs(),d=f.maximum(h);t.accumulatedFirstMoment[o].assign(c),t.accumulatedWeightedInfNorm[o].assign(d);var p=r.div(n).mul(c.div(t.epsScalar.add(d))).add(a);a.assign(p)}t.iteration.assign(t.iteration.add(t.one)),t.accBeta1.assign(t.accBeta1.mul(t.beta1Scalar))})},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(t){return e.accumulatedFirstMoment[t].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(t){return e.accumulatedWeightedInfNorm[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="AdamaxOptimizer",t}(Zc);$c(rf);var of=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return v(t,e),t.prototype.applyGradients=function(e){var t=this;Object.keys(e).forEach(function(n){var r=e[n],o=$e.engine.registeredVariables[n];nt(function(){var e=t.c.mul(r).add(o);o.assign(e)})})},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=rt(Ft(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGDOptimizer",t}(Zc);$c(of);var af=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.m=Ft(o.momentum),o.accumulations={},o}return v(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=$e.engine.registeredVariables[n];null==r.accumulations[n]&&nt(function(){t.accumulations[n]=Ht(o).variable(!1)});var a=r.accumulations[n],i=e[n];nt(function(){var e,r=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(r.mul(t.m))).add(o):t.c.mul(r).add(o),t.accumulations[n].assign(r),o.assign(e)})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){if(e.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var t in this.accumulations)this.accumulations[t].dispose()},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="MomentumOptimizer",t}(of);$c(af);var sf=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;return i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares={},i.accumulatedMeanGrads={},i.accumulatedMoments={},i.c=rt(Ft(t)),i.decayScalar=rt(Ft(n)),i.momentumScalar=rt(Ft(r)),i.oneMinusDecay=rt(Ft(1-n)),i.centered=a,null===o&&(o=$e.get("EPSILON")),i.epsilonScalar=rt(Ft(o)),i}return v(t,e),t.prototype.applyGradients=function(e){var t=this,n=function(n){var o=$e.engine.registeredVariables[n];null==r.accumulatedMeanSquares[n]&&nt(function(){t.accumulatedMeanSquares[n]=Ht(o).variable(!1)}),null==r.accumulatedMeanGrads[n]&&r.centered&&nt(function(){t.accumulatedMeanGrads[n]=Ht(o).variable(!1)}),null==r.accumulatedMoments[n]&&nt(function(){t.accumulatedMoments[n]=Ht(o).variable(!1)});var a=r.accumulatedMeanSquares[n],i=r.accumulatedMeanGrads[n],s=r.accumulatedMoments[n],u=e[n];nt(function(){var e=t.decayScalar.mul(a).add(t.oneMinusDecay.mul(u.square()));if(t.centered){var r=t.decayScalar.mul(i).add(t.oneMinusDecay.mul(u)),l=t.momentumScalar.mul(s).add(t.c.mul(u).div(e.sub(r.square().add(t.epsilonScalar)).sqrt()));t.accumulatedMeanSquares[n].assign(e),t.accumulatedMeanGrads[n].assign(r),t.accumulatedMoments[n].assign(l);var c=o.sub(l);o.assign(c)}else{var f=t.decayScalar.mul(a).add(t.oneMinusDecay.mul(u.square()));l=t.momentumScalar.mul(s).add(t.c.mul(u).div(f.add(t.epsilonScalar).sqrt())),t.accumulatedMeanSquares[n].assign(f),t.accumulatedMoments[n].assign(l),c=o.sub(l),o.assign(c)}})},r=this;for(var o in e)n(o)},t.prototype.dispose=function(){var e=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(t){return e.accumulatedMeanSquares[t].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(t){return e.accumulatedMeanGrads[t].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(t){return e.accumulatedMoments[t].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSPropOptimizer",t}(Zc);$c(sf);var uf=function(){function e(){}return e.sgd=function(e){return new of(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new af(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new sf(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new nf(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new ef(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new rf(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new tf(e,t)},e}();uf.sgd,uf.momentum,uf.adadelta,uf.adagrad,uf.rmsprop,uf.adamax,uf.adam,qe.setBackend,qe.getBackend,qe.disposeVariables,qe.memory;!function(e){ye=e}(Jl);var lf=function(e,t){return(lf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function cf(e,t){function n(){this.constructor=e}lf(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ff(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function hf(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var df=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],o=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,o)})}},e}();function pf(){return vf}var vf=null,mf=new Map,gf=new Map;function yf(e,t){var n=Ef(e,t);return mf.get(n)}function bf(e){return gf.get(e)}function xf(e){for(var t=mf.entries(),n=[];;){var r=t.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===e&&n.push(s)}return n}function wf(e){var t=e.kernelName,n=e.backendName,r=Ef(t,n);if(mf.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");mf.set(r,e)}function Cf(e){var t=e.kernelName;gf.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),gf.set(t,e)}function Ef(e,t){return t+"_"+e}function Sf(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function kf(e,t,n){return Math.max(e,Math.min(t,n))}function Rf(e){return e%2==0?e:e+1}function If(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function _f(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Nf(e,t,n){void 0===n&&(n=""),_f(Of(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function Tf(e){_f(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function Af(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||Kf(e)&&!n)for(var r=0;r<e.length;++r)Af(e[r],t,n);else t.push(e);return t}function Df(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Of(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Mf(e){return e%1==0}function Ff(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Pf(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Lf(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Bf(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function zf(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function Wf(e,t){var n=t.length;return _f((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),_f(e.every(function(e){return Mf(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function Uf(e,t){for(var n=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||o?null:Wf(t,e).sort(),i=0,s=0;s<e.length;++s){if(null!=a){if(a[i]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[i]<=s&&i++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Vf(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function jf(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Gf(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Hf(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function qf(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function Kf(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Xf(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function $f(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}function Yf(e){return"string"==typeof e||e instanceof String}function Qf(e){return"boolean"==typeof e}function Jf(e){return"number"==typeof e}function Zf(e){return Array.isArray(e)?Zf(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Jf(e)?"float32":Yf(e)?"string":Qf(e)?"bool":"float32"}function eh(e){return!!(e&&e.constructor&&e.call&&e.apply)}function th(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function nh(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function rh(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Af(e)),n&&Gf(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function oh(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[t+i];else{a=n[0];var s=n.slice(1),u=s.reduce(function(e,t){return e*t});for(i=0;i<a;i++)o[i]=e(t+i*u,s,r)}return o}(0,e,t)}function ah(e,t){for(var n=ih(e,t),r=0;r<n.length;r++)n[r]=1;return n}function ih(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function sh(){return pf().platform.now()}function uh(e){e.forEach(function(t){_f(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function lh(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",pf().platform.encode(e,t)}function ch(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",pf().platform.decode(e,t)}function fh(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function hh(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}Object.freeze({shuffle:Sf,clamp:kf,nearestLargerEven:Rf,sum:If,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:_f,assertShapesMatch:Nf,assertNonNull:Tf,flatten:Af,sizeFromShape:Df,isScalarShape:function(e){return 0===e.length},arraysEqual:Of,isInt:Mf,tanh:Ff,sizeToSquarishShape:Pf,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return Sf(t),t},rightPad:Lf,repeatedTry:Bf,inferFromImplicitShape:zf,parseAxisParam:Wf,squeezeShape:Uf,getTypedArrayFromDType:Vf,getArrayFromDType:jf,checkConversionForErrors:Gf,isValidDtype:Hf,hasEncodingLoss:qf,isTypedArray:Kf,bytesPerElement:Xf,bytesFromStringArray:$f,isString:Yf,isBoolean:Qf,isNumber:Jf,inferDtype:Zf,isFunction:eh,nearestDivisor:th,computeStrides:nh,toTypedArray:rh,toNestedArray:oh,makeOnesTypedArray:ah,makeZerosTypedArray:ih,now:sh,assertNonNegativeIntegerDimensions:uh,fetch:function(e,t){return pf().platform.fetch(e,t)},encodeString:lh,decodeString:ch,locToIndex:fh,indexToLoc:hh});var dh=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new ph)}return e.prototype.profileKernel=function(e,t,n){var r,o=this,a=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then(function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(e,n,r,a.kernelMs,t,i)})})}),r},e}(),ph=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o,a){var i="number"==typeof r?Lf(r+"ms",9):r.error,s=Lf(e,25),u=t.rank,l=t.size,c=Lf(t.shape.toString(),14),f="";for(var h in o){var d=o[h].shape||t.shape,p=d.length;f+=h+": "+p+"D "+(p>0?d:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function vh(e,t,n){return Lf(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Yf(e)?"'"+e+"'":"bool"===n?mh(e):parseFloat(e.toFixed(7)).toString(),t)}function mh(e){return 0===e?"false":"true"}function gh(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var yh=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=Df(e),null!=n){var o=n.length;_f(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||jf(t,this.size),this.strides=nh(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),_f(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return bh().makeTensor(this.values,this.shape,this.dtype)},e}(),bh=null,xh=null,wh=null,Ch=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Df(e),this.strides=nh(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),_f(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),xh.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return ff(this,void 0,void 0,function(){var e;return hf(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,xh.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return xh.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return ff(this,void 0,void 0,function(){var e;return hf(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,oh(this.shape,e)]}})})},e.prototype.arraySync=function(){return oh(this.shape,this.dataSync())},e.prototype.data=function(){return ff(this,void 0,void 0,function(){var e,t;return hf(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=bh().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(e){return ch(e)})]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=bh().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return ch(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return ff(this,void 0,void 0,function(){var e;return hf(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,bh().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(bh().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),xh.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),xh.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),xh.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),xh.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),xh.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),xh.clone(this)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var o=nh(t),a=function(e,t,n,r){var o=Df(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?gh(e):e;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,f=0;f<a;f++)i[f]=Math.max(i[f],vh(u[c+f],0,n).length);return i}(e,t,n,o),i=t.length,s=function e(t,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[vh(gh(t)[0],0,r)]:"bool"===r?[mh(t[0])]:[t[0].toString()];if(1===l){if(u>20){var c=3*s,f=Array.from(t.slice(0,c)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(f=gh(f),h=gh(h)),["["+f.map(function(e,t){return vh(e,a[t],r)}).join(", ")+", ..., "+h.map(function(e,t){return vh(e,a[u-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?gh(t):Array.from(t)).map(function(e,t){return vh(e,a[t],r)}).join(", ")+"]"]}var d=n.slice(1),p=o.slice(1),v=o[0]*s,m=[];if(u>20){for(var g=0;g<3;g++){var y=(b=g*v)+v;m.push.apply(m,e(t.slice(b,y),d,r,p,a,!1))}for(m.push("..."),g=u-3;g<u;g++)y=(b=g*v)+v,m.push.apply(m,e(t.slice(b,y),d,r,p,a,g===u-1))}else for(g=0;g<u;g++){var b;y=(b=g*v)+v,m.push.apply(m,e(t.slice(b,y),d,r,p,a,g===u-1))}var x=2===l?",":"";for(m[0]="["+m[0]+x,g=1;g<m.length-1;g++)m[g]=" "+m[g]+x;var w=",\n";for(g=2;g<l;g++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":w),m}(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),xh.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),xh.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),xh.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),xh.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),xh.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),xh.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),xh.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),xh.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),xh.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),xh.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),wh("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),xh.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),xh.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),xh.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),xh.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),xh.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),xh.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),xh.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),xh.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),xh.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),xh.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),xh.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),xh.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),xh.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),xh.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),xh.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),xh.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),xh.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),xh.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),xh.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),xh.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),xh.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),xh.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),xh.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),xh.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),xh.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),xh.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),xh.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),xh.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),xh.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),xh.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),xh.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),xh.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),xh.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),xh.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),xh.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),xh.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),xh.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),xh.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),xh.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),xh.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),xh.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),xh.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),xh.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),xh.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),xh.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),xh.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),xh.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),xh.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),xh.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),xh.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),xh.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),xh.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),xh.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),xh.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),xh.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),xh.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),xh.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),xh.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),xh.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),xh.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),xh.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),xh.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),xh.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),xh.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),xh.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),xh.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),xh.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),xh.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),xh.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),xh.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),xh.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),xh.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),xh.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),xh.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),xh.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),xh.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),xh.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),xh.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),xh.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),xh.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),xh.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),xh.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),xh.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),xh.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),xh.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),xh.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),xh.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),xh.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),xh.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),xh.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),xh.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),xh.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),xh.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),xh.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),bh().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),xh.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),xh.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),xh.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),xh.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),xh.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),xh.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),xh.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),xh.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),xh.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),xh.spectral.irfft(this)},e}();Object.defineProperty(Ch,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Eh,Sh,kh,Rh,Ih,_h=function(e){function t(t,n,r,o){var a=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=n,a.name=r,a}return cf(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Of(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");bh().disposeTensor(this),this.dataId=e.dataId,bh().incRef(this,null)},t.prototype.dispose=function(){bh().disposeVariable(this),this.isDisposedInternal=!0},t}(Ch);Object.defineProperty(_h,Symbol.hasInstance,{value:function(e){return e instanceof Ch&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Eh||(Eh={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Sh||(Sh={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(kh||(kh={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Rh||(Rh={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ih||(Ih={}));var Nh={float32:Rh,int32:Sh,bool:kh,complex64:Ih};function Th(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Nh[e][t]}function Ah(e){return Th(e,"int32")}function Dh(e,t){if(e.dtype===t.dtype)return[e,t];var n=Th(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Oh(e,t){_f(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function Mh(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Ch)n.push(t);else if(o=t,Array.isArray(o)||"object"==typeof o){var o,a=t;for(var i in a){var s=a[i];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:Dh,assertTypesMatch:Oh,isTensorInList:function(e,t){return t.some(function(t){return t.id===e.id})},getTensorsInContainer:Mh});var Fh,Ph=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Lh=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ph}return e.prototype.ready=function(){return ff(this,void 0,void 0,function(){var e,t,n;return hf(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return ff(this,void 0,void 0,function(){var t,n,r;return hf(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new dh(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;xf(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;xf(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then(function(n){return!(o<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)}).catch(function(n){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,o=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(e){return{x:function(){return e.toFloat()}}},[],{}),t},e.prototype.runKernel=function(e,t,n,r,o){return this.runKernelFunc(null,t,null,e,n,r,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),o=0;n.forEach(function(e){o+="complex64"===e.dtype?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-t-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,o,a,i){var s,u=this,l=[],c=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,h=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,v=yf(r,this.backendName);if(null!=v)f=function(){var e=u.backend.numDataIds();p=v.kernelFunc({inputs:t,attrs:o,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map(function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)});if(c){var f=u.getTensorsForGradient(r,t,s);if(null==f){null==i&&(i=[]);var h=s.filter(function(e,t){return i[t]});f=(a||[]).slice().concat(h)}l=u.saveTensorsForBackwardMode(f)}return s};else{var m=function(e){c&&(l=e.map(function(e){return u.keep(u.clone(e))}))};f=function(){var t=u.backend.numDataIds();p=u.tidy(function(){return e(u.backend,m)});var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,function(){return f()}):f()}),c&&this.addTapeNode(r,t,s,n,l,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShapes:s.map(function(e){return e.shape})}),Array.isArray(p)?s:s[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map(function(e){return t.keep(t.clone(e))})},e.prototype.getTensorsForGradient=function(e,t,n){var r=bf(e);if(null!=r){var o=r.inputsToSave||[],a=r.outputsToSave||[],i=void 0;r.saveAllInputs?(_f(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),i=Object.keys(t).map(function(e){return t[e]})):i=o.map(function(e){return t[e]});var s=n.filter(function(e,t){return a[t]});return i.concat(s)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=e;"string"===n&&Yf(e[0])&&(o=e.map(function(e){return lh(e)}));var a=r.write(o,t,n),i=new Ch(t,n,a,this.nextTensorId());if(this.incRef(i,r),"string"===n){var s=this.state.tensorInfo.get(a),u=$f(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},e.prototype.makeTensorFromDataId=function(e,t,n,r){var o=new Ch(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,r),o},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var o=new _h(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Xf(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof _h||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return ff(this,void 0,void 0,function(){var t,n;return hf(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,o,a){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},u=bf(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],o=ih(r.size,r.dtype);return i.makeTensor(o,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],o,a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Mh(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==i.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),_f(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});_f(a instanceof Ch,function(){return"The result y returned by f() must be a tensor."});var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(p=e[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){p.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,o[p.id]=!0;break}if(l)break}}var f={};f[n.id]=!0;var h={};for(a=e.length-1;a>=0;a--)for(i=(p=e[a]).inputs,c=0;c<p.outputs.length;c++)if(f[p.outputs[c].id]){for(var s in i)f[i[s].id]=!0,h[p.id]=!0;break}var d=[];for(a=0;a<e.length;a++){var p;if(o[(p=e[a]).id]&&h[p.id]){var v={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,d.push(g)}}return d}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[a.id]=null==n?(r=ah(Df(e=a.shape),"float32"),Bh.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach(function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var i=o.gradient(a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n(function(){return i[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!Of(r.shape,a.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(s,i,function(e){return o.tidy(e)});var u=t.map(function(e){return s[e.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()}),o.state.activeTape=null),{value:a,grads:u}})},e.prototype.customGrad=function(e){var t=this;return _f(eh(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];_f(r.every(function(e){return e instanceof Ch}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return r.forEach(function(e,t){a[t]=e}),t.runKernelFunc(function(t,o){return _f((n=e.apply(void 0,r.concat([o]))).value instanceof Ch,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),_f(eh(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];_f(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),_f(a.every(function(e){return e instanceof Ch}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(e,t){i[t]=function(){return e}}),i})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return ff(this,void 0,void 0,function(){var t,n;return hf(this,function(r){switch(r.label){case 0:return t=sh(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=sh()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ph,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),Bh=function(){var e=function(){if(null==Fh){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Fh=e}return Fh}();if(null==e._tfengine){var t=new df(e);e._tfengine=new Lh(t)}return function(e){vf=e}(e._tfengine.ENV),bh=function(){return e._tfengine},e._tfengine}();function zh(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Wh=pf();Wh.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Wh.registerFlag("IS_BROWSER",function(){return zh()}),Wh.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Wh.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Wh.registerFlag("PROD",function(){return!1}),Wh.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Wh.getBool("DEBUG")}),Wh.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Wh.registerFlag("IS_TEST",function(){return!1});var Uh,Vh,jh,Gh={},Hh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qh(e,t){Gh[e]=t}function Kh(e){e in Gh||(Gh[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Gh[e]},!1),1===e?t.getContext("webgl",Hh)||t.getContext("experimental-webgl",Hh):t.getContext("webgl2",Hh)}(e));var t=Gh[e];return t.isContextLost()?(delete Gh[e],Kh(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Gh[e])}function Xh(e,t){return[t,e]}function $h(e){var t=Df(e);return Pf(Math.ceil(t/4))}function Yh(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Qh(e,t){var n,r,o,a,i,s,u,l,c,f=e;return 2===pf().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,o=f.RGBA16F,a=f.RGBA32F,i=f.RED,s=4,u=1,l=f.HALF_FLOAT,c=f.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=f.RGBA,i=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function Jh(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+ed(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Uh||(Uh={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Vh||(Vh={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(jh||(jh={}));function Zh(e){return!!(pf().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function ed(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function td(e,t,n){return Sd(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function nd(e,t,n){var r=Sd(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Jh(e,t,function(){return e.shaderSource(r,n)}),Jh(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function rd(e,t,n){var r=Sd(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Jh(e,t,function(){return e.shaderSource(r,n)}),Jh(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=id.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map(function(e,t){return Lf((t+1).toString(),a)+e}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),f=i.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+Lf(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var od,ad,id=/ERROR: [0-9]+:([0-9]+):/g;function sd(e,t){return Sd(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function ud(e,t,n){if(Jh(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function ld(e,t,n){if(Jh(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function cd(e,t,n){var r=Sd(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Jh(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Jh(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function fd(e,t,n){var r=Sd(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Jh(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),Jh(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function hd(e,t){return Sd(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function dd(e,t){var n=pf().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function pd(e,t){return Sd(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function vd(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Jh(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),Jh(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),Jh(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function md(e,t,n,r){kd(e,r),Jh(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),Jh(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function gd(e,t,n,r){return Sd(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function yd(e,t,n){return e.getUniformLocation(t,n)}function bd(e,t,n,r,o,a){Jh(e,t,function(){return md(e,t,r,a)}),Jh(e,t,function(){return e.uniform1i(o,a)})}function xd(e,t,n,r){Jh(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),Jh(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function wd(e,t,n){Jh(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),Jh(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Cd(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Ed(e,t))}function Ed(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Sd(e,t,n,r){var o=Jh(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function kd(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Rd(e,t){return void 0===t&&(t=2),Df(e.slice(0,e.length-t))}function Id(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function _d(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Rd(e)].concat(Id(e))),t}function Nd(e,t){var n;void 0===t&&(t=!1);var r=pf().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?Rf(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=Uf(e);e=o.newShape}var a=Df(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=Rd(e),s=2,u=2;return e.length&&(s=(n=Id(e))[0],u=n[1]),Pf(a=i*(s/2)*(u/2)).map(function(e){return 2*e})}return Pf(a)}function Td(e){return e%2==0}function Ad(e,t){if(Of(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Td(n)&&Td(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Td(e[0])&&Td(t[0])}function Dd(e){if(null==od){var t=Kh(e);od=t.getParameter(t.MAX_TEXTURE_SIZE)}return od}function Od(e){if(null==ad){var t=Kh(e);ad=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ad)}function Md(e){if(0===e)return 0;var t=Kh(e);return Fd(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Fd(t,"EXT_disjoint_timer_query")?1:0}function Fd(e,t){return null!=e.getExtension(t)}function Pd(e){try{if(null!=Kh(e))return!0}catch(e){return!1}return!1}function Ld(e){if(0===e)return!1;var t=Kh(e);if(1===e){if(!Fd(t,"OES_texture_float"))return!1}else if(!Fd(t,"EXT_color_buffer_float"))return!1;return zd(t)}function Bd(e){if(0===e)return!1;var t=Kh(e);if(1!==e){if(Fd(t,"EXT_color_buffer_float"))return zd(t);if(Fd(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=Qh(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}(t,n)}return!1}return!!Fd(t,"OES_texture_float")&&!!Fd(t,"WEBGL_color_buffer_float")&&zd(t)}function zd(e){var t=Qh(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function Wd(e){return 2===e&&null!=Kh(e).fenceSync}var Ud=Object.freeze({callAndCheck:Jh,canBeRepresented:Zh,getWebGLErrorMessage:ed,getExtensionOrThrow:td,createVertexShader:nd,createFragmentShader:rd,createProgram:sd,linkProgram:ud,validateProgram:ld,createStaticVertexBuffer:cd,createStaticIndexBuffer:fd,getNumChannels:function(){return 2===pf().getNumber("WEBGL_VERSION")?1:4},createTexture:hd,validateTextureSize:dd,createFramebuffer:pd,bindVertexBufferToProgramAttribute:vd,bindTextureUnit:md,unbindTextureUnit:function(e,t,n){kd(e,n),Jh(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),Jh(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:gd,getProgramUniformLocation:yd,bindTextureToProgramUniformSampler:bd,bindCanvasToFramebuffer:function(e,t){Jh(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Jh(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),Jh(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:xd,unbindColorTextureFromFramebuffer:wd,validateFramebuffer:Cd,getFramebufferErrorMessage:Ed,getBatchDim:Rd,getRowsCols:Id,getShapeAs3D:_d,getTextureShapeFromLogicalShape:Nd,isReshapeFree:Ad,getWebGLMaxTextureSize:Dd,resetMaxTextureSize:function(){od=null},resetMaxTexturesInShader:function(){ad=null},getMaxTexturesInShader:Od,getWebGLDisjointQueryTimerVersion:Md,hasExtension:Fd,isWebGLVersionEnabled:Pd,isCapableOfRenderingToFloatTexture:Ld,isDownloadFloatTextureEnabled:Bd,isWebGLFenceEnabled:Wd}),Vd=pf();function jd(e){pf().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Gd(e,t){return Bh.tidy(e,t)}function Hd(e){Mh(e).forEach(function(e){return e.dispose()})}function qd(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];pf().getBool("IS_TEST")||console.warn.apply(console,e)}function Kd(e,t){var n=e;if(Kf(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Kf(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&pf().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Kf(t)){_f(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),_f(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var o=n.slice(1),a=0;a<t.length;++a)e(t[a],o,r.concat(a))}else _f(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,r,[]),r}function Xd(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function $d(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Ch)return Xd(r,e.dtype,t,n),e;var o=Zf(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Xd(r,o,t,n),null==e||!Kf(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=Kd(e,o);Kf(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?rh(e,o,pf().getBool("DEBUG")):Af(e,[],!0);return Bh.makeTensor(s,i,o)}function Yd(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return $d(e,t+"["+r+"]",n)},r)}function Qd(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Jd(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}function Zd(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function ep(e,t){return Jd(e,t.map(function(e){return 1}),t)}function tp(e,t,n){_f(Qd(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function np(e,t){if(Qd(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function rp(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function op(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function ap(e,t){var n=e[0].length;e.forEach(function(e,t){_f(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),_f(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var a=0;a<n;a++)_f(a===t||e[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function ip(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function sp(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Bh.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Bh.endScope(o),o}catch(e){throw Bh.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Vd.registerFlag("HAS_WEBGL",function(){return Vd.getNumber("WEBGL_VERSION")>0}),Vd.registerFlag("WEBGL_VERSION",function(){return Pd(2)?2:Pd(1)?1:0}),Vd.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Vd.get("WEBGL_VERSION")}),Vd.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Vd.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Vd.registerFlag("WEBGL_PACK",function(){return Vd.getBool("HAS_WEBGL")}),Vd.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_PACK_CLIP",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Vd.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_PACK_REDUCE",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_CONV_IM2COL",function(){return Vd.getBool("WEBGL_PACK")}),Vd.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Dd(Vd.getNumber("WEBGL_VERSION"))}),Vd.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Od(Vd.getNumber("WEBGL_VERSION"))}),Vd.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=Vd.getNumber("WEBGL_VERSION");return 0===e?0:Md(e)}),Vd.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Vd.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),Vd.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Ld(Vd.getNumber("WEBGL_VERSION"))}),Vd.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Vd.getBool("WEBGL_FORCE_F16_TEXTURES")&&Vd.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Vd.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Bd(Vd.getNumber("WEBGL_VERSION"))}),Vd.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Wd(Vd.getNumber("WEBGL_VERSION"))}),Vd.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Vd.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),wh=jd;var up=sp({complex_:function(e,t){var n=$d(e,"real","complex"),r=$d(t,"imag","complex");return Nf(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Bh.runKernelFunc(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),lp=sp({real_:function(e){var t=$d(e,"input","real");return Bh.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),cp=sp({imag_:function(e){var t=$d(e,"input","imag");return Bh.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function fp(e,t,n){return hp(e,t,Kd(e,n),n)}function hp(e,t,n,r){if(null==r&&(r=Zf(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Kf(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){uh(t);var o=Df(t),a=Df(n);_f(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==Df(t.slice(i));_f(n[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return Kf(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?rh(e,r,pf().getBool("DEBUG")):Af(e,[],!0),Bh.makeTensor(e,t,r)}function dp(e,t){if((Kf(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Kf(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return hp(e,[],[],t)}function pp(e,t){Tf(e);var n=Kd(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return hp(e,null,n,t)}function vp(e,t,n){if(Tf(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Kd(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return hp(e,t,r,n)}function mp(e,t,n){if(Tf(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Kd(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return hp(e,t,r,n)}function gp(e,t,n){if(Tf(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Kd(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return hp(e,t,r,n)}function yp(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=yp(e,"float32"),r=bp(e,"float32");return up(n,r)}var o=ah(Df(e),t);return Bh.makeTensor(o,e,t)}function bp(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=bp(e,"float32"),r=bp(e,"float32");return up(n,r)}var o=ih(Df(e),t);return Bh.makeTensor(o,e,t)}function xp(e,t,n){return Bh.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function wp(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return bp([0],r);var o=ih(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return pp(o,r)}var Cp=sp({onesLike_:function(e){var t=$d(e,"x","onesLike");if("complex64"===t.dtype){var n=Cp(lp(t)),r=Ep(cp(t));return up(n,r)}return Bh.runKernelFunc(function(e){return e.onesLike(t)},{x:t},function(e,t){return{x:function(){return Ep(e)}}},"OnesLike")}}),Ep=sp({zerosLike_:function(e){var t=$d(e,"x","zerosLike");return Bh.runKernelFunc(function(e){return e.zerosLike(t)},{x:t},function(e,t){return{x:function(){return Ep(e)}}},"ZerosLike")}}),Sp=sp({concat_:function(e,t){void 0===t&&(t=0),_f(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=Yd(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")}),t=Wf(t,n[0].shape)[0];var r=ip(n.map(function(e){return e.shape}),t);if(0===Df(r))return fp([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});ap(o,t);var a=n,i={axis:t};return Bh.runKernelFunc(function(e){return e.concat(n,t)},a,function(e){var n=o.map(function(e){return e[t]});return Np(e,n,t).map(function(e){return function(){return e}})},"Concat",i)}}),kp=sp({concat1d_:function(e){return Sp(e,0)}}),Rp=sp({concat2d_:function(e,t){return Sp(e,t)}}),Ip=sp({concat3d_:function(e,t){return Sp(e,t)}}),_p=sp({concat4d_:function(e,t){return Sp(e,t)}}),Np=sp({split_:function(e,t,n){void 0===n&&(n=0);var r,o=$d(e,"x","split");return n=Wf(n,o.shape)[0],"number"==typeof t?(_f(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(_f(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),Bh.runKernelFunc(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return Sp(e,n)}}})}});function Tp(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",uh(e),new yh(e,t,n)}var Ap=sp({batchToSpaceND_:function(e,t,n){var r=$d(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return _f(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),_f(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),_f(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),Bh.runKernelFunc(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),Dp=sp({cast_:function(e,t){var n=$d(e,"x","cast");if(!Hf(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return Bh.runKernelFunc(function(e){return e.cast(n,t)},{x:n},function(e){return{x:function(){return e.clone()}}},"Cast",r)}}),Op=sp({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=$d(e,"x","cumsum"),a=np([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=op(1,o.rank)[0],u=Bh.runKernelFunc(function(e){return e.cumsum(i,s,n,r)},{permutedX:i},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=a&&(u=u.transpose(a)),u}}),Mp=sp({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=$d(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return _f(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),_f(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),_f(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),Bh.runKernelFunc(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),Fp=sp({expandDims_:function(e,t){void 0===t&&(t=0);var n=$d(e,"x","expandDims",null);_f(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(_f(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Pp(n,r)}}),Pp=sp({reshape_:function(e,t){var n=$d(e,"x","reshape",null);t=zf(t,n.size),_f(n.size===Df(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return Bh.runKernelFunc(function(e){return e.reshape(n,t)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}},"Reshape",r)}}),Lp=sp({spaceToBatchND_:function(e,t,n){var r=$d(e,"x","spaceToBatchND");return _f(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),_f(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),_f(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),Bh.runKernelFunc(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),Bp=sp({squeeze_:function(e,t){var n=$d(e,"x","squeeze");return Pp(n,Uf(n.shape,t).newShape)}}),zp=sp({stack_:function(e,t){void 0===t&&(t=0);var n=Yd(e,"tensors","stack");if(_f(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;_f(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){Nf(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){_f(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(e){return e.expandDims(t)});return Sp(i,t)}}),Wp=sp({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=$d(e,"x","unstack");_f(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return Bh.runKernelFunc(function(e){return e.unstack(n,t)},{x:n},function(e){return{x:function(){return zp(e,t)}}},"Unpack",r)}});function Up(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function Vp(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function jp(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function Gp(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Hp(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}var qp="Div",Kp="SquaredDifference",Xp="BroadcastTo",$p="OneHot",Yp="Identity",Qp="Tile",Jp="PadV2",Zp=sp({add_:function(e,t){var n,r=$d(e,"a","add"),o=$d(t,"b","add");n=Dh(r,o),r=n[0],o=n[1];var a={a:r,b:o};return Bh.runKernelFunc(function(e,t){var n=e.add(r,o);return t([r,o]),n},a,null,"Add")}});function ev(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function tv(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function nv(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}var rv=sp({abs_:function(e){var t=$d(e,"x","abs");return"complex64"===t.dtype?Bh.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):Bh.runKernelFunc(function(e,n){var r=e.abs(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}},"Abs")}}),ov=sp({acos_:function(e){var t=$d(e,"x","acos");return Bh.runKernelFunc(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(dp(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),av=sp({acosh_:function(e){var t=$d(e,"x","acosh");return Bh.runKernelFunc(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),iv=sp({asin_:function(e){var t=$d(e,"x","asin");return Bh.runKernelFunc(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(dp(1).sub(n.toFloat().square()).sqrt())}}})}}),sv=sp({asinh_:function(e){var t=$d(e,"x","asinh");return Bh.runKernelFunc(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(dp(1).add(n.toFloat().square()).sqrt())}}})}}),uv=sp({atan_:function(e){var t=$d(e,"x","atan");return Bh.runKernelFunc(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),lv=sp({atanh_:function(e){var t=$d(e,"x","atanh");return Bh.runKernelFunc(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(dp(1).sub(n.toFloat().square()))}}})}}),cv=sp({ceil_:function(e){var t=$d(e,"x","ceil");return Bh.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Ep(e)}}})}}),fv=sp({clipByValue_:function(e,t,n){var r=$d(e,"x","clipByValue");_f(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],a={min:t,max:n};return Bh.runKernelFunc(function(e,o){var a=e.clip(r,t,n);return o([r]),a},{x:r},function(e,r){var o=r[0];return{x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),Ep(e))}}},"ClipByValue",a,o)}}),hv=sp({cos_:function(e){var t=$d(e,"x","cos"),n=[t];return Bh.runKernelFunc(function(e,n){var r=e.cos(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}},"Cos",{},n)}}),dv=sp({cosh_:function(e){var t=$d(e,"x","cosh");return Bh.runKernelFunc(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),pv=sp({erf_:function(e){var t=$d(e,"x","erf");return _f("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),Bh.runKernelFunc(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),vv=sp({exp_:function(e){var t=$d(e,"x","exp");return Bh.runKernelFunc(function(e,n){var r=e.exp(t);return n([r]),r},{x:t},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),mv=sp({expm1_:function(e){var t=$d(e,"x","expm1");return Bh.runKernelFunc(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),gv=sp({floor_:function(e){var t=$d(e,"x","floor");return Bh.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Ep(e)}}})}}),yv=sp({log_:function(e){var t=$d(e,"x","log"),n=[t];return Bh.runKernelFunc(function(e,n){var r=e.log(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}},"Log",{},n)}}),bv=sp({log1p_:function(e){var t=$d(e,"x","log1p");return Bh.runKernelFunc(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),xv=sp({logSigmoid_:function(e){var t=$d(e,"x","logSigmoid");return Bh.runKernelFunc(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),wv=sp({neg_:function(e){var t=$d(e,"x","neg"),n=[t];return Bh.runKernelFunc(function(e){return e.neg(t)},{x:t},function(e){return{x:function(){return e.neg()}}},"Neg",{},n)}}),Cv=sp({reciprocal_:function(e){var t=$d(e,"x","reciprocal");return Bh.runKernelFunc(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),Ev=sp({round_:function(e){var t=$d(e,"x","round");return Bh.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Ep(e)}}})}}),Sv=sp({rsqrt_:function(e){var t=$d(e,"x","rsqrt"),n=[t];return Bh.runKernelFunc(function(e,n){var r=e.rsqrt(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),kv=sp({sigmoid_:function(e){var t=$d(e,"x","sigmoid");return Bh.runKernelFunc(function(e,n){var r=e.sigmoid(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(dp(1).sub(n)))}}},"Sigmoid")}}),Rv=sp({sign_:function(e){var t=$d(e,"x","sign");return Bh.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Ep(e)}}})}}),Iv=sp({isNaN_:function(e){var t=$d(e,"x","isNaN");return Bh.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Ep(e)}}})}}),_v=sp({isInf_:function(e){var t=$d(e,"x","isInf");return Bh.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Ep(e)}}})}}),Nv=sp({isFinite_:function(e){var t=$d(e,"x","isFinite");return Bh.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Ep(e)}}})}}),Tv=sp({sin_:function(e){var t=$d(e,"x","sin"),n=[t];return Bh.runKernelFunc(function(e,n){var r=e.sin(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}},"Sin",{},n)}}),Av=sp({sinh_:function(e){var t=$d(e,"x","sinh");return Bh.runKernelFunc(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),Dv=sp({softplus_:function(e){var t=$d(e,"x","softplus");return Bh.runKernelFunc(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),Ov=sp({sqrt_:function(e){var t=$d(e,"x","sqrt");return Bh.runKernelFunc(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),Mv=sp({step_:function(e,t){void 0===t&&(t=0);var n=$d(e,"x","step");return Bh.runKernelFunc(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return Ep(e)}}})}}),Fv=sp({tan_:function(e){var t=$d(e,"x","tan");return Bh.runKernelFunc(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),Pv=sp({tanh_:function(e){var t=$d(e,"x","tanh");return Bh.runKernelFunc(function(e,n){var r=e.tanh(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return dp(1).sub(n.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}}),Lv=sp({addStrict_:function(e,t){var n=$d(e,"a","addStrict"),r=$d(t,"b","addStrict");return Nf(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Bv=sp({atan2_:function(e,t){var n,r=$d(e,"a","atan2"),o=$d(t,"b","atan2");n=Dh(r,o),r=n[0],o=n[1];var a=nv(r.shape,o.shape);return Bh.runKernelFunc(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Zp(n.square(),r.square()),o=e.mul(r.div(t)),i=tv(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=Zp(n.square(),r.square()),o=wv(e.mul(n.div(t))),i=tv(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),zv=sp({divStrict_:function(e,t){var n=$d(e,"a","div"),r=$d(t,"b","div");return Nf(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Wv=sp({floorDiv_:function(e,t){var n,r=$d(e,"a","floorDiv"),o=$d(t,"b","floorDiv");n=Dh(r,o),r=n[0],o=n[1];var a=nv(r.shape,o.shape);return Bh.runKernelFunc(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=tv(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=tv(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}},"FloorDiv")}}),Uv=sp({maximum_:function(e,t){var n,r=$d(e,"a","maximum"),o=$d(t,"b","maximum");return n=Dh(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),nv(r.shape,o.shape),Bh.runKernelFunc(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}},"Maximum")}}),Vv=sp({maximumStrict_:function(e,t){var n=$d(e,"a","maximumStrict"),r=$d(t,"b","maximumStrict");return Nf(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),jv=sp({minimum_:function(e,t){var n,r=$d(e,"a","minimum"),o=$d(t,"b","minimum");return n=Dh(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),nv(r.shape,o.shape),Bh.runKernelFunc(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}},"Minimum")}}),Gv=sp({minimumStrict_:function(e,t){var n=$d(e,"a","minimumStrict"),r=$d(t,"b","minimumStrict");return Nf(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Hv=sp({mod_:function(e,t){var n,r=$d(e,"a","mod"),o=$d(t,"b","mod");n=Dh(r,o),r=n[0],o=n[1];var a=nv(r.shape,o.shape);return Bh.runKernelFunc(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=tv(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=tv(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),qv=sp({modStrict_:function(e,t){var n=$d(e,"a","modStrict"),r=$d(t,"b","modStrict");return Nf(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Kv=sp({mul_:function(e,t){var n,r=$d(e,"a","mul"),o=$d(t,"b","mul");n=Dh(r,o),r=n[0],o=n[1];var a=nv(r.shape,o.shape);return Bh.runKernelFunc(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),o=tv(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=tv(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}},"Mul")}}),Xv=sp({mulStrict_:function(e,t){var n=$d(e,"a","mul"),r=$d(t,"b","mul");return Nf(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),$v=sp({pow_:function(e,t){var n,r=$d(e,"base","pow"),o=$d(t,"exp","pow");n=Dh(r,o),r=n[0],o=n[1];var a=nv(r.shape,o.shape),i=[r,o];return Bh.runKernelFunc(function(e,t){var n=e.pow(r,o);return t([r,o,n]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1],o=t[2];return{a:function(){var t=r.toFloat(),o=e.mul(t.mul(n.pow(t.sub(dp(1))))),i=tv(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},b:function(){var t=n.greater(0),i=n.log().where(t,Ep(n)),s=e.mul(o.mul(i)),u=tv(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},i,[!0])}}),Yv=sp({powStrict_:function(e,t){return Nf(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Qv=sp({squaredDifferenceStrict_:function(e,t){var n=$d(e,"a","squaredDifferenceStrict"),r=$d(t,"b","squaredDifferenceStrict");return Nf(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Jv=sp({sub_:function(e,t){var n,r=$d(e,"a","sub"),o=$d(t,"b","sub");n=Dh(r,o),r=n[0],o=n[1];var a=nv(r.shape,o.shape);return Bh.runKernelFunc(function(e){return e.subtract(r,o)},{a:r,b:o},function(e){return{a:function(){var t=e,n=tv(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=tv(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}},"Sub")}}),Zv=sp({subStrict_:function(e,t){var n=$d(e,"a","subStrict"),r=$d(t,"b","subStrict");return Nf(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),em=sp({div_:function(e,t){var n,r=$d(e,"a","div"),o=$d(t,"b","div");if(n=Dh(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return Wv(r,o);var a={a:r,b:o};return Bh.runKernelFunc(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},a,null,qp,{})}});function tm(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=nh(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,l]}Object.freeze({prepareAndValidate:tm});function nm(e){return e<=30?e:th(e,Math.floor(Math.sqrt(e)))}function rm(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}function om(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}rm(n,t,e)}function am(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:Df(t.shape)/u,sliceSize:i,strides:nh(n.slice(0,o)).concat([1]),outputSize:Df(n)}}Object.freeze({validateUpdateShape:rm,validateInput:om,calculateShapes:am});function im(e,t,n){_f(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),_f(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){_f(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}function sm(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function um(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function lm(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),kf(0,a,s-1)}function cm(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?kf(0,a,s):kf(-1,a,s-1)}function fm(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function hm(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:im,maskToAxes:sm,computeOutShape:um,startForAxis:lm,stopForAxis:cm,isSliceContinous:fm,computeFlatOffset:hm});function dm(e){return Bh.customGrad(e)}var pm=sp({softmax_:function(e,t){void 0===t&&(t=-1);var n=$d(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return Bh.runKernelFunc(function(e,r){var o=e.softmax(n,t);return r([o]),o},{logits:n},function(e,n){var r=n[0],o=e.mul(r);return{logits:function(){return o.sub(o.sum([t],!0).mul(r))}}},"Softmax",{dim:t},[],[!0])}}),vm=sp({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=$d(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return dm(function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),mm=sp({transpose_:function(e,t){var n=$d(e,"x","transpose");if(null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),_f(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){_f(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return Bh.runKernelFunc(function(e){return e.transpose(n,t)},{x:n},null,"Transpose",r)}}),gm=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),ym=function(){function e(){}return e.prototype.time=function(e){return bm("time")},e.prototype.read=function(e){return bm("read")},e.prototype.readSync=function(e){return bm("readSync")},e.prototype.numDataIds=function(){return bm("numDataIds")},e.prototype.disposeData=function(e){return bm("disposeData")},e.prototype.write=function(e,t,n){return bm("write")},e.prototype.move=function(e,t,n,r){return bm("move")},e.prototype.memory=function(){return bm("memory")},e.prototype.floatPrecision=function(){return bm("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return bm("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,bm("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return bm("slice")},e.prototype.stridedSlice=function(e,t,n,r){return bm("stridedSlice")},e.prototype.unstack=function(e,t){return bm("unstack")},e.prototype.reverse=function(e,t){return bm("reverse")},e.prototype.concat=function(e,t){return bm("concat")},e.prototype.neg=function(e){return bm("neg")},e.prototype.add=function(e,t){return bm("add")},e.prototype.addN=function(e){return bm("addN")},e.prototype.subtract=function(e,t){return bm("subtract")},e.prototype.multiply=function(e,t){return bm("multiply")},e.prototype.realDivide=function(e,t){return bm("realDivide")},e.prototype.floorDiv=function(e,t){return bm("floorDiv")},e.prototype.sum=function(e,t){return bm("sum")},e.prototype.prod=function(e,t){return bm("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return bm("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return bm("argMin")},e.prototype.argMax=function(e,t){return bm("argMax")},e.prototype.equal=function(e,t){return bm("equal")},e.prototype.notEqual=function(e,t){return bm("notEqual")},e.prototype.less=function(e,t){return bm("less")},e.prototype.lessEqual=function(e,t){return bm("lessEqual")},e.prototype.greater=function(e,t){return bm("greater")},e.prototype.greaterEqual=function(e,t){return bm("greaterEqual")},e.prototype.logicalNot=function(e){return bm("logicalNot")},e.prototype.logicalAnd=function(e,t){return bm("logicalAnd")},e.prototype.logicalOr=function(e,t){return bm("logicalOr")},e.prototype.where=function(e){return bm("where")},e.prototype.select=function(e,t,n){return bm("select")},e.prototype.topk=function(e,t,n){return bm("topk")},e.prototype.min=function(e,t){return bm("min")},e.prototype.minimum=function(e,t){return bm("minimum")},e.prototype.mod=function(e,t){return bm("mod")},e.prototype.max=function(e,t){return bm("max")},e.prototype.maximum=function(e,t){return bm("maximum")},e.prototype.all=function(e,t){return bm("all")},e.prototype.any=function(e,t){return bm("any")},e.prototype.squaredDifference=function(e,t){return bm("squaredDifference")},e.prototype.ceil=function(e){return bm("ceil")},e.prototype.floor=function(e){return bm("floor")},e.prototype.round=function(e){return bm("round")},e.prototype.sign=function(e){return bm("sign")},e.prototype.isNaN=function(e){return bm("isNaN")},e.prototype.isInf=function(e){return bm("isInf")},e.prototype.isFinite=function(e){return bm("isFinite")},e.prototype.pow=function(e,t){return bm("pow")},e.prototype.exp=function(e){return bm("exp")},e.prototype.expm1=function(e){return bm("expm1")},e.prototype.softmax=function(e,t){return bm("softmax")},e.prototype.log=function(e){return bm("log")},e.prototype.log1p=function(e){return bm("log1p")},e.prototype.sqrt=function(e){return bm("sqrt")},e.prototype.rsqrt=function(e){return bm("rsqrt")},e.prototype.square=function(e){return bm("square")},e.prototype.reciprocal=function(e){return bm("reciprocal")},e.prototype.relu=function(e){return bm("relu")},e.prototype.relu6=function(e){return bm("relu6")},e.prototype.prelu=function(e,t){return bm("prelu")},e.prototype.elu=function(e){return bm("elu")},e.prototype.eluDer=function(e,t){return bm("eluDer")},e.prototype.selu=function(e){return bm("selu")},e.prototype.int=function(e){return bm("int")},e.prototype.clip=function(e,t,n){return bm("clip")},e.prototype.abs=function(e){return bm("abs")},e.prototype.complexAbs=function(e){return bm("complexAbs")},e.prototype.sigmoid=function(e){return bm("sigmoid")},e.prototype.softplus=function(e){return bm("softplus")},e.prototype.sin=function(e){return bm("sin")},e.prototype.cos=function(e){return bm("cos")},e.prototype.tan=function(e){return bm("tan")},e.prototype.asin=function(e){return bm("asin")},e.prototype.acos=function(e){return bm("acos")},e.prototype.atan=function(e){return bm("atan")},e.prototype.atan2=function(e,t){return bm("atan2")},e.prototype.sinh=function(e){return bm("sinh")},e.prototype.cosh=function(e){return bm("cosh")},e.prototype.tanh=function(e){return bm("tanh")},e.prototype.asinh=function(e){return bm("asinh")},e.prototype.acosh=function(e){return bm("acosh")},e.prototype.atanh=function(e){return bm("atanh")},e.prototype.erf=function(e){return bm("erf")},e.prototype.step=function(e,t){return bm("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,bm("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return bm("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return bm("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return bm("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,bm("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return bm("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return bm("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return bm("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return bm("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return bm("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return bm("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return bm("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return bm("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return bm("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return bm("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return bm("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return bm("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return bm("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return bm("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return bm("reshape")},e.prototype.cast=function(e,t){return bm("cast")},e.prototype.tile=function(e,t){return bm("tile")},e.prototype.pad=function(e,t,n){return bm("pad")},e.prototype.transpose=function(e,t){return bm("transpose")},e.prototype.gather=function(e,t,n){return bm("gather")},e.prototype.gatherND=function(e,t){return bm("gatherND")},e.prototype.scatterND=function(e,t,n){return bm("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return bm("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return bm("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return bm("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return bm("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return bm("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return bm("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,o,a){return bm("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){return bm("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){return bm("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return bm("multinomial")},e.prototype.oneHot=function(e,t,n,r){return bm("oneHot")},e.prototype.cumsum=function(e,t,n,r){return bm("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return bm("nonMaxSuppression")},e.prototype.fft=function(e){return bm("fft")},e.prototype.ifft=function(e){return bm("ifft")},e.prototype.complex=function(e,t){return bm("complex")},e.prototype.real=function(e){return bm("real")},e.prototype.imag=function(e){return bm("imag")},e.prototype.cropAndResize=function(e,t,n,r,o,a){return bm("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return bm("depthToSpace")},e.prototype.split=function(e,t,n){return bm("split")},e.prototype.sparseToDense=function(e,t,n,r){return bm("sparseToDense")},e.prototype.diag=function(e){return bm("diag")},e.prototype.fill=function(e,t,n){return bm("fill")},e.prototype.onesLike=function(e){return bm("onesLike")},e.prototype.zerosLike=function(e){return bm("zerosLike")},e.prototype.linspace=function(e,t,n){return bm("linspace")},e.prototype.dispose=function(){return bm("dispose")},e}();function bm(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function xm(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=km(t),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return Cm(e,s,n,r,o,a,!1,i)}function wm(e,t,n,r,o,a,i){void 0===i&&(i="NDHWC");var s,u,l=Rm(t),c=l[0],f=l[1],h=l[2];if("NDHWC"===i)u="channelsLast",s=[c,f,h,e[4],e[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,f,h,e[1],e[1]]}return Em(e,s,n,r,o,!1,u,a)}function Cm(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],h=u[3];if("channelsLast"===s)l=e[0],c=e[1],f=e[2],h=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],h=e[1],c=e[2],f=e[3]}var d,p=t[0],v=t[1],m=t[3],g=km(n),y=g[0],b=g[1],x=km(r),w=x[0],C=x[1],E=Im(p,w),S=Im(v,C),k=function(e,t,n,r,o,a,i,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,o){null==r&&(r=Sm(e,t,n));var a=e[1],i=_m((e[0]-t+2*r)/n+1,o);_f(Mf(i),function(){return"The output # of rows ("+i+") must be an integer. Change the stride and/or zero pad parameters"});var s=_m((a-t+2*r)/n+1,o);return _f(Mf(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[i,s]}([t,n],a,r,e,s);l=f[0],c=f[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/o);var h=Math.max(0,(l-1)*r+a-t),d=Math.max(0,(c-1)*o+i-n),p=Math.floor(h/2),v=h-p,m=Math.floor(d/2);u={top:p,bottom:v,left:m,right:d-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,f,y,b,E,S,a),R=k.padInfo,I=k.outHeight,_=k.outWidth,N=i?m*h:m;return"channelsFirst"===s?d=[l,N,I,_]:"channelsLast"===s&&(d=[l,I,_,N]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:f,inChannels:h,outHeight:I,outWidth:_,outChannels:N,padInfo:R,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:C,inShape:e,outShape:d,filterShape:t}}function Em(e,t,n,r,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],f=u[2],h=u[3],d=u[4];if("channelsLast"===i)l=e[0],c=e[1],f=e[2],h=e[3],d=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);l=e[0],d=e[1],c=e[2],f=e[3],h=e[4]}var p,v=t[0],m=t[1],g=t[2],y=t[4],b=Rm(n),x=b[0],w=b[1],C=b[2],E=Rm(r),S=E[0],k=E[1],R=E[2],I=Im(v,S),_=Im(m,k),N=Im(g,R),T=function(e,t,n,r,o,a,i,s,u,l,c){var f,h,d,p;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,o,a){null==o&&(o=Sm(e,t,r));var i=e[1],s=e[2],u=_m((e[0]-t+2*o)/r+1,a);_f(Mf(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=_m((i-t+2*o)/r+1,a);_f(Mf(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var c=_m((s-t+2*o)/r+1,a);return _f(Mf(c),function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,c,1]}([t,n,r,1],s,0,o,e,c);h=v[0],d=v[1],p=v[2]}else if("same"===e){var m=((h=Math.ceil(t/o))-1)*o+s-t,g=((d=Math.ceil(n/a))-1)*a+u-n,y=((p=Math.ceil(r/i))-1)*i+l-r,b=Math.floor(m/2),x=m-b,w=Math.floor(g/2),C=g-w,E=Math.floor(y/2);f={top:w,bottom:C,left:E,right:y-E,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-s+1)/o),d=Math.ceil((n-u+1)/a),p=Math.ceil((r-l+1)/i)}return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}(o,c,f,h,x,w,C,I,_,N,s),A=T.padInfo,D=T.outDepth,O=T.outHeight,M=T.outWidth,F=a?y*d:y;return"channelsFirst"===i?p=[l,F,D,O,M]:"channelsLast"===i&&(p=[l,D,O,M,F]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:f,inWidth:h,inChannels:d,outDepth:D,outHeight:O,outWidth:M,outChannels:F,padInfo:A,strideDepth:x,strideHeight:w,strideWidth:C,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:_,effectiveFilterWidth:N,dilationDepth:S,dilationHeight:k,dilationWidth:R,inShape:e,outShape:p,filterShape:t}}function Sm(e,t,n,r){void 0===r&&(r=1);var o=Im(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function km(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Rm(e){return"number"==typeof e?[e,e,e]:e}function Im(e,t){return t<=1?e:e+(e-1)*(t-1)}function _m(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Nm(e){var t=km(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function Tm(e,t){return Nm(e)||Nm(t)}function Am(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Dm(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=bp(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!qf(e.dtype,t))return Bh.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=dp(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Om(e,t){return Bh.makeTensorFromDataId(e.dataId,t,e.dtype)}function Mm(e,t,n){var r=(t-e)/(n-1),o=ih(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return pp(o,"float32")}Object.freeze({castTensor:Dm,reshapeTensor:Om,linspaceImpl:Mm,upcastType:Th,axesAreInnerMostDims:Qd,combineLocations:Jd,computeOutAndReduceShapes:Zd,expandShapeToKeepDim:ep,assertAxesAreInnerMostDims:tp,getAxesPermutation:np,getUndoAxesPermutation:rp,getInnerMostAxes:op,getBroadcastDims:ev,getReductionAxes:tv,assertAndGetBroadcastShape:nv,assertParamsConsistent:ap,computeOutShape:ip,computePool2DInfo:xm,computePool3DInfo:wm,computeConv2DInfo:Cm,computeConv3DInfo:Em,computeDefaultPad:Sm,tupleValuesAreOne:Nm,eitherStridesOrDilationsAreOne:Tm,convertConv2DDataFormat:Am,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:nm});function Fm(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Pm(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Lm(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Bm(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function zm(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,o=e.length,a=0,i=!1;r<o;){var s=n(t,e[a=r+(o-r>>>1)]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}(e,t,n||Wm)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function Wm(e,t){return e>t?1:e<t?-1:0}function Um(e,t,n,r,o){return jm(e,t,n,r,o,0).selectedIndices}function Vm(e,t,n,r,o,a){var i=jm(e,t,n,r,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function jm(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map(function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}}).filter(function(e){return e.score>o}).sort(qm),l=a>0?-.5/a:0,c=[],f=[];c.length<n&&u.length>0;){var h=u.pop(),d=h.score,p=h.boxIndex,v=h.suppressBeginIndex;if(d<o)break;for(var m=!1,g=c.length-1;g>=v;--g){var y=Gm(e,p,c[g]);if(y>=r){m=!0;break}if(h.score=h.score*Hm(r,l,y),h.score<=o)break}h.suppressBeginIndex=c.length,m||(h.score===d?(c.push(p),f.push(h.score)):h.score>o&&zm(u,h,qm))}var b=c.length;return s&&(c.fill(0,b),f.fill(0,b)),{selectedIndices:pp(c,"int32"),selectedScores:pp(f,"float32"),numValidOutputs:dp(b,"int32")}}function Gm(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),d=(s-a)*(u-i),p=(f-l)*(h-c);if(d<=0||p<=0)return 0;var v=Math.max(a,l),m=Math.max(i,c),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function Hm(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function qm(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Km(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a})}function Xm(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Tp(n,e.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(e.rank),s=0;s<i.length;s++)i[s]=a[s]%e.shape[s];var u=e.locToIndex(i);o.values[r]=e.values[u]}return o.toTensor()}function $m(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=Vf(n,s*r),c=Vf("int32",s*r),f=0;f<s;f++){for(var h=f*u,d=e.subarray(h,h+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort(function(e,t){return t.value-e.value});var m=f*r,g=l.subarray(m,m+r),y=c.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var b=t.slice();return b[b.length-1]=r,[fp(l,b,n),fp(c,b,"int32")]}function Ym(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Tp(e,"int32"),a=Tp([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var Qm=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Jm=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Zm=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function eg(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function tg(e,t){return 1===t?[e]:eg(e,t)}function ng(){var e,t,n,r,o,a,i,s,u,l;return 2===pf().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function rg(e,t,n){void 0===n&&(n="index");var r=nh(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function og(e){var t=nh(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var ag="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function ig(e,t,n,r){var o=[];e.forEach(function(e){var t=Df(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var a,i,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?ug(e):sg(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=ev(e.shapeInfo.logicalShape,t.logicalShape),l=vg(s),c=s-i,f=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+f[e+c]+" = 0;"}).join("\n");var h;h=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+c]}).join(", ");var d="return outputValue;",p=1===Df(e.shapeInfo.logicalShape),v=1===Df(t.logicalShape);if(1!==i||p||v){if(p&&!v)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=i-2,g=i-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?d="return vec4(outputValue.x);":u.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+h+");\n      "+d+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Of(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l,c=vg(u),f=ev(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];l=0===s?"":u<2&&f.length>=1?"coords = 0;":f.map(function(e){return"coords."+d[e+h]+" = 0;"}).join("\n");var p;return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+d[t+h]}).join(", "),"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+l+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,c=ng(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),h=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+lg+"\n    "+cg+"\n    "+fg+"\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Of(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,o,a,i}(t.logicalShape,l),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return Of(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=rg(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=rg(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=rg(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=rg(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,l),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(h+=hg),[h,f,i,s,a,u,n].join("\n")}function sg(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+dg(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+pg(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=dg(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&Of(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=Uf(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n      "+sg(mg(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+gg(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+pg(e)+"\n      }\n    ";var c=o[0],f=o[1],h=dg(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+h+";\n    vec2 uv = uvFromFlat("+c+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=Uf(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n        "+sg(mg(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+gg(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+pg(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,f=c[0],h=c[1],d=e.shapeInfo.flatOffset;return h===o&&null==d?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+h+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":h===a&&null==d?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+h+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+dg(n)+";\n        vec2 uv = uvFromFlat("+f+", "+h+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=Uf(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return"\n      "+sg(mg(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+gg(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+pg(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1];return d===i&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":d===o&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+h+", "+d+", index + "+dg(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=Uf(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return"\n      "+sg(mg(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+gg(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+pg(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];return p===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+dg(n)+";\n      vec2 uv = uvFromFlat("+d+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Uf(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+sg(mg(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+gg(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,f=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+c+", "+l+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+pg(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1];return v===f&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+l+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":v===s&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+dg(n)+";\n      vec2 uv = uvFromFlat("+p+", "+v+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function ug(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+ng().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=ng();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=ng();if(null!=o&&Of(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+ug(mg(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+gg(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+ng().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),f="int b, int row, int col",h="b * "+c+" + (row / 2) * "+l+" + (col / 2)",d=2;d<n-1;d++)f="int b"+d+", "+f,h="b"+d+" * "+(c*=t[n-d-1])+" + "+h;return"\n    vec4 "+o+"("+f+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+ng().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var lg="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",cg="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",fg="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",hg="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function dg(e){return"offset"+e}function pg(e){var t=e.name,n=Df(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function vg(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function mg(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function gg(e,t){return t.map(function(t){return e[t]}).join(", ")}var yg=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,_f(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=vg(l),f=tg("coords",l);if(1===a){var h=vg(s=l+1);i="\n        "+h+" sourceLocR = "+h+"("+f.join()+", 0);\n        ++"+f[l-1]+";\n        "+h+" sourceLocG = "+h+"("+f.join()+", 0);\n        ++"+f[l-2]+";\n        "+h+" sourceLocA = "+h+"("+f.join()+", 0);\n        --"+f[l-1]+";\n        "+h+" sourceLocB = "+h+"("+f.join()+", 0);\n        --"+f[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+f[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+f[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+f[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+f[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,s),p="."+d[s-1],v=d.map(function(e){return"int "+e}),m=tg("sourceLocR",s-1).concat("inIdx.r"),g=tg("sourceLocG",s-1).concat("inIdx.g"),y=tg("sourceLocB",s-1).concat("inIdx.b"),b=tg("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",C="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",E=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+d.join()+"),\n                                          vec2("+d.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+d.join()+"),\n                               vec2("+d.slice(-2).join()+"));\n      }\n      "+E+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+f[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+f[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+C+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+C+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},bg=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},xg=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=c-1-e.padInfo.front,p=f-1-e.padInfo.top,v=h-1-e.padInfo.left,m=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+h+";\n                wC += "+l+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},wg=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],nv(e,t),nv(e,n);var i="0.0";null!=r&&(nv(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(nv(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Cg=function(e,t,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],nv(e,t),nv(e,n);var i="vec4(0.0)";null!=r&&(nv(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(nv(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Eg=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=nv(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Sg="return a + b;",kg="return a - b;",Rg="return a * b;",Ig="return (a < 0.) ? b * a : a;",_g=function(e,t,n){this.variableNames=["A","B"],this.outputShape=nv(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Ng="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Tg=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=nv(t,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===Df(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+vg(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=tg("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},Ag=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Dg=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Og=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Mg=function(e){this.outputShape=[],this.outputShape=ip(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Fg=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ip(e,t);var n=this.outputShape,r=n.length,o=vg(r),a=tg("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c=i.slice(-2),f=i.join(),h="if ("+l+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+c.join()+"));\n        }";for(u=1;u<s.length;u++){var d=s[u-1];h+="\n        if ("+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+Pg(i,l,d)+"),\n            vec2("+Pg(c,l,d)+"));\n        }"}var p=s.length,v=s[s.length-1];h+="\n        return getChannel(\n          getT"+p+"("+Pg(i,l,v)+"),\n          vec2("+Pg(c,l,v)+"));",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function Pg(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?e+" - "+n:e}).join()}var Lg=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Bg=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a="channelsLast"===e.dataFormat,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+c+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+l+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},zg=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wg=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ug=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Vg=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jg=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,a=e.padInfo.left,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,f=e.filterWidth,h=4*Math.floor(e.inChannels/4),d=e.inChannels%4,p="channelsLast"===e.dataFormat,v=p?1:2,m=p?2:3,g=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===d)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+h+") *\n                    getW(wR, wC, "+h+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+h+", xR, xC) *\n                    getW(wR, wC, "+h+", d2);\n              }\n\n            } else if ("+(2===d)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===d)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2),\n                getW(wR, wC, "+h+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1),\n                  getX(batch, xR, xC, "+h+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC),\n                  getX(batch, "+h+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},Gg=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,f=e.filterHeight,h=e.filterWidth,d=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Hg=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=e.outChannels/e.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+h+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},qg=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=d,v="int xR; int xC; int xCOffset;",m=0;m<h;m++)for(var g=0;g<d;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<h;m++)for(var y=0;y<p;y++){if(v+="\n          xR = xRCorner + "+m*c+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===l){if(g<d&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+m+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<d)){var b=s%2==0?Rf(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<d&&(v+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<d&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<d&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<d&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<d&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<h;m++)for(g=0;g<d;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+C+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Kg=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],f=n[1];this.outputShape=[l,c,f,u];var h="bilinear"===r?1:0,d=[i-1+".0",s-1+".0"],p=d[0],v=d[1],m=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],y=m[1],b=m[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=x[0],C=x[1],E=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+C+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+E+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+h+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Xg=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+vg(r)+" coords = getOutputCoords();\n        int end = "+$g(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+$g(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function $g(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var Yg=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Uh.DENSE;var t=$h(e),n=ng();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+rg(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Qg=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Uh.DENSE;var t=$h(e),n=ng();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+rg(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Jg=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),Zg=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},ey=function(e){this.variableNames=["A"],this.outTexUsage=Vh.DOWNLOAD;var t=ng();this.outputShape=e,this.userCode="\n      "+ag+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},ty=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Vh.DOWNLOAD;var t=ng();this.outputShape=e,this.userCode="\n      "+ag+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},ny=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=ng(),o=t[0],a=t[1];this.outputShape=e;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+og(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},ry=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=ng(),o=t[0],a=t[1];this.outputShape=e;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+e[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+og(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},oy=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},ay=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),iy=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=vg(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},sy=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=vg(t.length),o=vg(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function uy(e,t){var n=ng();return nd(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function ly(e,t){return cd(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function cy(e,t){return fd(e,t,new Uint16Array([0,1,2,2,1,3]))}function fy(e,t,n,r,o,a,i){dd(n,r);var s=hd(e,t),u=e.TEXTURE_2D;return Jh(e,t,function(){return e.bindTexture(u,s)}),Jh(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),Jh(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),Jh(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),Jh(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),Jh(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),Jh(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function hy(e,t,n,r,o){var a=Xh(n,r);return fy(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function dy(e,t,n,r,o){var a=Xh(n,r);return fy(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function py(e,t,n,r,o){var a=Xh(n,r);return fy(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function vy(e,t,n,r,o){var a=Yh(n,r);return fy(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function my(e,t,n,r,o){var a=Yh(n,r);return fy(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function gy(e,t,n,r){return Jh(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),vd(e,t,n,"clipSpacePos",r,3,20,0)&&vd(e,t,n,"uv",r,2,20,12)}function yy(e,t,n,r,o,a,i){var s,u,l;Jh(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),Jh(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),Jh(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function by(e,t,n,r){Jh(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Jh(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):Jh(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),Jh(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function xy(e,t,n,r,o){var a=e.createBuffer();Jh(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*n*r;return Jh(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),Jh(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),Jh(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}function wy(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Cy(e,t,n,r,o){var a=Xh(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return Jh(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Ey(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(function(e,t){var n=Yh(e,t);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function Sy(e,t,n,r){var o=new Float32Array(n*r*4);return Jh(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var ky=Object.freeze({createVertexShader:uy,createVertexBuffer:ly,createIndexBuffer:cy,createFloat32MatrixTexture:hy,createFloat16MatrixTexture:dy,createUnsignedBytesMatrixTexture:py,createPackedMatrixTexture:vy,createFloat16PackedMatrixTexture:my,bindVertexProgramAttributeStreams:gy,uploadDenseMatrixToTexture:yy,uploadPixelDataToTexture:by,createBufferFromOutputTexture:xy,downloadFloat32MatrixFromBuffer:wy,downloadByteEncodedFloatMatrixFromOutputTexture:Cy,downloadPackedMatrixFromBuffer:Ey,downloadMatrixFromPackedOutputTexture:Sy}),Ry=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=pf().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,qh(t,e)):this.gl=Kh(t);var n="WEBGL_color_buffer_float";if(1===pf().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=td(this.gl,this.debug,"OES_texture_float"),Fd(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=td(this.gl,this.debug,"OES_texture_half_float");else if(pf().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Fd(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=td(this.gl,this.debug,"EXT_color_buffer_half_float");else if(pf().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Fd(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Fd(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=ly(this.gl,this.debug),this.indexBuffer=cy(this.gl,this.debug),this.framebuffer=pd(this.gl,this.debug),this.textureConfig=Qh(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return pf().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Jh(t,this.debug,function(){return t.finish()}),Jh(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Jh(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Jh(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Jh(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Jh(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),hy(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),dy(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),py(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),by(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),yy(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),my(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),vy(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(wd(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Jh(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Cy(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return Ey(this.gl,e,0,0,0,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return wy(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=xy(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(pf().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Sy(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=rd(t,this.debug,e),r=uy(t,this.debug),o=sd(t,this.debug);return Jh(t,this.debug,function(){return t.attachShader(o,r)}),Jh(t,this.debug,function(){return t.attachShader(o,n)}),ud(t,this.debug,o),this.debug&&ld(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=gy(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Jh(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&ld(this.gl,this.debug,this.program),Jh(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?gd(this.gl,this.debug,e,t):yd(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Jh(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),bd(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Yh(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&ld(this.gl,this.debug,this.program),Cd(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Jh(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Jh(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=td(this.gl,this.debug,2===pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return ff(this,void 0,void 0,function(){var t=this;return hf(this,function(n){switch(n.label){case 0:return[4,Bf(function(){return t.disposed||t.isQueryAvailable(e,pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Bf(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),xd(this.gl,this.debug,e,this.framebuffer),this.debug&&Cd(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(xd(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Cd(this.gl)):wd(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;xd(r,this.debug,e,this.framebuffer),this.debug&&Cd(r),this.outputTexture=e,Jh(r,this.debug,function(){return r.viewport(0,0,t,n)}),Jh(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),Jh(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Iy(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!Of(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!Of(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var _y=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,f=n.dataFormat,h=s.left,d=s.top,p=o*r,v=ng(),m="channelsLast"===f,g=m?0:1,y=m?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+d+";\n            d0 = offsetY + "+c+" * (pos / "+p+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+h+".);\n              d1 = offsetX + "+l+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+v.output+" = result;\n      }\n    "},Ny=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Ty=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Ay=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},Dy=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Oy=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,f=u-1-e.padInfo.top,h=l-1-e.padInfo.left,d=s*u*l-1;this.userCode="\n      const ivec3 pads = ivec3("+c+", "+f+", "+h+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+d+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+l+" +\n                  wR * "+l+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},My=function(e,t,n,r,o,a,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";a&&(d=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+d+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+l+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+h[0]+");\n          result += ("+f[1]+" * "+h[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},Fy=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),Py=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},Ly=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=tg("rc",t),r=vg(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},By=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=vg(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},zy=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=vg(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=tg("rc",r),u=tg("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=1===r?2:4;p<v;p++)d+="\n        "+f[p]+"\n        if ("+h+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";d+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+d+"\n        setOutput(result);\n      }\n    "},Wy=function(e,t,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var p="avg"===t,v="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",m="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="0.0";if(p||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+s+");\n        const ivec2 pads = ivec2("+h+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+l+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?o?v:m:"wR * "+f+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(a/4),x=a%4,w="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+h+", "+d+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+u+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+b+"; wC += 4) {\n            int xC = xCCorner + wC * "+l+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              getValue(batch, xR, xC + 3 * "+l+", d)\n            );\n\n            "+w+"\n          }\n\n          int xC = xCCorner + "+b+";\n          if ("+(1===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(2===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(3===x)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              initializationValue\n            );\n\n            "+w+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},Uy=function(e,t,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,i=e.strideDepth,s=e.strideHeight,u=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,v=e.padInfo.front,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;var y="avg"===t,b="0.0";if(y||(b="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+s+", "+u+");\n        const ivec3 pads = ivec3("+v+", "+m+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+h+";\n              wD += "+l+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+c+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+f+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?o?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+d+" * "+p+" +\n                      wR * "+p+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(x="avgValue / count");var w=4*Math.floor(a/4),C=a%4,E="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+s+", "+u+");\n      const ivec3 pads = ivec3("+v+", "+m+", "+g+");\n      const float initializationValue = "+b+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+b+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+h+";\n            wD += "+l+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+f+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+f+", ch)\n              );\n\n              "+E+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+E+"\n            } else if ("+(2===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+E+"\n            } else if ("+(3===C)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+f+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+f+", ch),\n                initializationValue\n              );\n\n              "+E+"\n            }\n          }\n          setOutput("+x+");\n        }\n      }\n    "}},Vy=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===t?(i="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(i="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var d="";o%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},jy=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+rg(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+og(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Gy=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],h=l[1]/c[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Hy=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},qy=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Ky=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=l[0]/c[0],h=l[1]/c[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Xy=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},$y=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=vg(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},Yy=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=tg("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=vg(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Qy=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=vg(o.length),u=vg(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices("+l+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var h="getUpdates("+f+")",d=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+d+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+h+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Jy=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},Zy=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=vg(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},eb=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=vg(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return tb.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+tb[t]+" = start["+t+"] + coords."+tb[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),tb=["x","y","z","w","u","v"],nb=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=vg(this.rank),n=tg("coords",this.rank),r=tg("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),rb=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=vg(n.length),a=vg(n.length),i="";if(1===r)i="coords * strides + begin";else{var s=0;i=n.map(function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},ob=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=ab(t,n),a=ib(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===jh.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===jh.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===jh.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===jh.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===jh.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=ib(t,ab(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function ab(e,t){if(e===Vh.UPLOAD)return jh.PACKED_2X2_FLOAT32;if(e===Vh.RENDER||null==e)return function(e){return pf().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?jh.PACKED_2X2_FLOAT32:jh.UNPACKED_FLOAT32:e?jh.PACKED_2X2_FLOAT16:jh.UNPACKED_FLOAT16}(t);if(e===Vh.DOWNLOAD||e===Vh.PIXELS)return jh.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function ib(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var sb=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=vg(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},ub=1.7580993408473768,lb=1.0507009873554805,cb=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},fb="if (isnan(x)) return x;",hb="return abs(x);",db=fb+"\n  return (x < 0.0) ? 0.0 : x;\n",pb=fb+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",vb="return (x >= 0.0) ? x : (exp(x) - 1.0);",mb="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+ub+";\n  float scale = "+lb+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",gb="return -x;",yb="return ceil(x);",bb="return floor(x);",xb="return exp(x);",wb="return exp(x) - 1.0;",Cb=fb+"\n  return sin(x);\n",Eb=fb+"\n  return cos(x);\n",Sb=fb+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",kb=fb+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",Rb=fb+"\n  return atan(x);\n",Ib=fb+"return log(x + sqrt(x * x + 1.0));",_b=fb+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",Nb=fb+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Tb="return x;",Ab="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Db="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ob="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Mb=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Fb=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=tg("rc",t),r=vg(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},Pb={};function Lb(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?Ab:db;if("elu"===e)return t?Ob:vb;if("relu6"===e)return t?Db:pb;if("prelu"===e)return t?Ng:Ig;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var Bb=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!pf().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=Kh(pf().getNumber("WEBGL_VERSION"));r.binaryCache=((n=pf().getNumber("WEBGL_VERSION"))in Pb||(Pb[n]={}),Pb[n]),r.gpgpu=new Ry(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new ob(r.gpgpu),r.numMBBeforeWarning=null==pf().global.screen?1024:pf().global.screen.height*pf().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new gm(r,Bh),r}return cf(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(pf().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Vh.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(pf().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Vh.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new Mb(i,Tb):new cb(i,Tb);var l=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:r}],r),c=this.readSync(l.dataId);return this.disposeData(l.dataId),c}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,h,d=null!=this.activeTimers;return d&&(f=sh()),h="complex64"===r?Fm(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),d&&(this.downloadWaitMs+=sh()-f),this.convertAndCacheOnCPU(e,h)},t.prototype.read=function(e){return ff(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f,h,d,p,v,m,g,y,b,x,w,C;return hf(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(n=this.texData.get(e),r=n.values,o=n.shape,a=n.slice,i=n.dtype,s=n.complexTensors,u=n.isPacked,null!=a)return void 0,l=u?new Mb(o,Tb):new cb(o,Tb),c=this.runWebGLProgram(l,[{dataId:e,shape:o,dtype:i}],i),f=this.read(c.dataId),this.disposeData(c.dataId),[2,f];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!pf().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===pf().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return h=null,"complex64"!==i&&pf().get("WEBGL_BUFFER_SUPPORTED")&&(d=this.decode(e),p=this.texData.get(d.dataId),h=(C=this.gpgpu).createBufferFromTexture.apply(C,[p.texture].concat($h(o)))),this.pendingRead.set(e,[]),"complex64"===i?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return"complex64"!==i?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return m=E.sent(),g=m[0],y=m[1],v=Fm(g,y),[3,5];case 4:null==h?v=this.getValuesFromTexture(e):(b=Df(o),v=this.gpgpu.downloadFloat32MatrixFromBuffer(h,b)),E.label=5;case 5:return null!=d&&this.disposeData(d.dataId),x=this.convertAndCacheOnCPU(e,v),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach(function(e){return e(x)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,x]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Zh(n)){if(pf().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.isPacked,i=Df(r);if(pf().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat($h(r))).subarray(0,i);return this.disposeData(s.dataId),l}var c=pf().getBool("WEBGL_PACK")&&!0===a,f=c?_d(r):r,h=c?new ty(f):new ey(f),d=this.runWebGLProgram(h,[{shape:f,dtype:o,dataId:e}],"float32"),p=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeData(d.dataId),v},t.prototype.time=function(e){return ff(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return hf(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=Af(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),a=Af(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return s=u.sent(),i.kernelMs=If(s),i.getExtraProfileInfo=function(){return s.map(function(e,t){return{name:a[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:i.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:sh(),endMs:null}},t.prototype.endTimer=function(e){return pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=sh(),e)},t.prototype.getQueryTime=function(e){return ff(this,void 0,void 0,function(){var t;return hf(this,function(n){return pf().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.isPacked,s=t.slice,u=s&&s.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return pf().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Bh.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&Df(e.shape)<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Bh.keep(e.clone()),imag:Bh.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===Df(n))return fp([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,o=fm(e.shape,t,n);if(r||!o){var a=pf().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nb(n):new eb(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=this.makeOutput(n,e.dtype),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=hm(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var o=um(t,n,r);if(o.some(function(e){return 0===e}))return fp([],o);var a=new rb(t,r,o);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=pf().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Yy(e.shape,t):new $y(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map(function(e){return lp(e)}),r=e.map(function(e){return cp(e)});return up(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>pf().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),a=this.concat(e.slice(0,o),t),i=this.concat(e.slice(o),t);return this.concat([a,i],t)}if(pf().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new Fg(e.map(function(e){return e.shape}),t);return this.compileAndRun(s,e)}var u=ip(e.map(function(e){return e.shape}),t),l=e.map(function(e){return e.as2D(-1,Df(e.shape.slice(t)))}),c=new Mg(l.map(function(e){return e.shape}));return this.compileAndRun(c,l).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,gb,e.dtype);var t=new cb(e.shape,gb);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=mm(e,[0,2,1])),r&&(t=mm(t,[0,2,1]));var u=1===a?e:e.as3D(s,i,1),l=1===a?2:1,c=1===a?t.as3D(s,1,i):t;return this.multiply(u,c).sum(l,!0)}var f=Th(e.dtype,t.dtype),h=new My(e.shape,[s,o,a],n,r);return this.compileAndRun(h,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],l=o?n.shape[1]:n.shape[2],c=t.shape[0],f=Th(t.dtype,n.dtype),h=null!=a,d=null!=s,p=i?Lb(i,!0):null,v=new My(t.shape,[c,u,l],r,o,h,p,d),m=[t,n];return a&&m.push(a),s&&m.push(s),this.compileAndRun(v,m,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new Eg("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new Eg("return areal * bimag + aimag * breal;",e.shape,t.shape),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Rg,e.dtype);var c=new _g(Rg,e.shape,t.shape);return this.compileAndRun(c,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),pf().getBool("WEBGL_PACK_NORMALIZATION")){var l=new Cg(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)}var c=new wg(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=pf().getBool("WEBGL_PACK_NORMALIZATION")?new Ay(e.shape,t,n,r,o):new Ny(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new Ty(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map(function(e){return ch(e)});return Xm(Tp(e.shape,e.dtype,n),t)}var r=new sb(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=pf().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zy(e.shape,t,n):new By(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new iy(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){_f(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=Up(e.shape,t,r),a=Vp(o.length,t.length),i=jp(e.shape,t,r),s=Gp(n,t.length),u=Hp(i,n,t.length);return mm(e.reshape(o),a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){_f(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Up(i.shape,t,r,!1),u=Vp(s.length,t.length,!1),l=jp(i.shape,t,r,!1);return mm(i.reshape(s),u).reshape(l)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=nm(o),i=new Vy({windowSize:a,inSize:o,batchSize:r},t),s=this.compileAndRun(i,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=nm(o),i=new Zm({windowSize:a,inSize:o,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=nm(r[r.length-1]),a=new yg(r,o,t,null==n),i=null==n?[e]:[e,n],s=this.compileAndRun(a,i,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){tp("sum",t,e.rank);var n=Zd(e.shape,t),r=n[0],o=Df(n[1]),a=e.as2D(-1,o),i=Ah(e.dtype);return this.reduce(a,"sum",i).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=Zd(e.shape,t),r=n[0],o=Df(n[1]),a=e.as2D(-1,o),i=Ah(e.dtype);return this.reduce(a,"prod",i).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=np([r],e.rank),a=e;null!=o&&(a=mm(e,o),r=op(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=Df([a.shape[r]]),u=a.as2D(-1,s),l=Ah(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(i);return null!=o&&(c=mm(c,rp(o))),c},t.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=th(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=th(e,n+1);return n}(i,o),u=new Jy({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),l=this.compileAndRun(u,[e,n],r);return l.shape[1]===o?l:(n=wp(0,o).tile([i/s]),this.segOpCompute(l,t,n,r,o))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(tp("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!pf().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Zd(e.shape,r),a=o[0],i=Df(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new Xg(e.shape,n,r);return this.compileAndRun(o,[e])},t.prototype.equal=function(e,t){if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new _g("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new _g("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new _g("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new _g("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new _g("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new _g("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new cb(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new _g("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new _g("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new Zy(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Th(t.dtype,n.dtype))},t.prototype.where=function(e){qd("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Ym(e.shape,t)},t.prototype.topk=function(e,t,n){return $m(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){tp("min",t,e.rank);var n=Zd(e.shape,t),r=n[0],o=Df(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new _g("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new _g("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);tp("max",t,e.rank);var n=Zd(e.shape,t),r=n[0],o=Df(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new _g("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){tp("all",t,e.rank);var n=Zd(e.shape,t),r=n[0],o=Df(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){tp("any",t,e.rank);var n=Zd(e.shape,t),r=n[0],o=Df(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.floorDiv=function(e,t){if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new _g("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Sg);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Th(e.dtype,t.dtype);if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Sg,n);var r=new _g(Sg,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new Mb(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,o){void 0===o&&(o=!1);var a=new Tg(n,e.shape,t.shape,o);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,i),l=new _g(n,e.shape,t.shape);return r.compileAndRun(l,[s,u],Th(a.dtype,i.dtype))}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>pf().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var o=e.map(function(e){return e.dtype}).reduce(function(e,t){return Th(e,t)}),a=e.map(function(e){return e.shape}),i=pf().getBool("WEBGL_PACK")?new Jm(e[0].shape,a):new Qm(e[0].shape,a);return this.compileAndRun(i,e,o)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,kg);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Th(e.dtype,t.dtype);if(pf().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,kg,e.dtype);var r=new _g(kg,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new _g("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Th(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yb,e.dtype);var t=new cb(e.shape,yb);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,bb,e.dtype);var t=new cb(e.shape,bb);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new cb(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new cb(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new cb(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new cb(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new cb(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,xb,e.dtype);var t=new cb(e.shape,xb);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wb,e.dtype);var t=new cb(e.shape,wb);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=Wf([t],e.shape),r=this.max(e,n),o=ep(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return em(i,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new cb(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new cb(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new cb(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new cb(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new cb(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=pf().getBool("WEBGL_PACK")?new Mb(e.shape,Ab):new cb(e.shape,db),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=pf().getBool("WEBGL_PACK")?new Mb(e.shape,Db):new cb(e.shape,pb),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg(Ng,e.shape,t.shape):new _g(Ig,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ob,e.dtype);var t=new cb(e.shape,vb);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new _g("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new cb(e.shape,mb);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new cb(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,o=(r=pf().getBool("WEBGL_PACK_CLIP")?new Dg(e.shape):new Ag(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(pf().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,hb,e.dtype);var t=new cb(e.shape,hb);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Og(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new cb(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new cb(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new cb(e.shape,Cb);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new cb(e.shape,Eb);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new cb(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new cb(e.shape,Sb);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new cb(e.shape,kb);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new cb(e.shape,Rb);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new _g("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new cb(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new cb(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new cb(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new cb(e.shape,Ib);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new cb(e.shape,_b);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new cb(e.shape,Nb);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new cb(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new cb(e.shape,function(e){return void 0===e&&(e=0),fb+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,o,a){var i=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,l=i[0]*i[1]*i[2],c=n.outChannels,f="channelsLast"===n.dataFormat,h=(1===l||1===c)&&u>1e3,d=i[2]%2!=0&&!!s.isPacked;if(h||!pf().getBool("WEBGL_LAZILY_UNPACK")||!pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!d){var p=f?i[0]*i[1]*i[2]:i[0]*i[2]*i[3],v=this.reshape(e,[1,p,n.inChannels]),m=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:m,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),n.outShape)}var g=f?i[0]*i[1]*(i[2]+1):i[0]*i[2]*(i[3]+1),y={dataId:e.dataId,shape:[1,g,n.inChannels],dtype:e.dtype},b=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,_f(Ad(s.shape,y.shape),function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"});var x=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),C=this.texData.get(w.dataId);return _f(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=b,C.shape=n.outShape,Bh.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,o,a){var i=n.filterWidth,s=n.filterHeight,u=n.inChannels,l=n.outWidth,c=n.outHeight,f="channelsLast"===n.dataFormat,h=i*s*u,d=c*l,p=[h,d],v=e.squeeze([0]),m=t.reshape([1,h,-1]),g=new _y(p,v.shape,n),y=this.compileAndRun(g,[v]).reshape([1,p[0],p[1]]),b=null!=r,x=null!=a,w=o?Lb(o,!0):null,C=new My(y.shape,[1,d,n.outChannels],!0,!1,b,w,x),E=[y,m];r&&E.push(r),x&&E.push(a);var S=this.compileAndRun(C,E);return f?S.reshape([1,c,l,n.outChannels]):S.reshape([1,n.outChannels,c,l])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,o,a,i);if(pf().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,o,a,i);var s=null!=o,u=null!=i,l=a?Lb(a,!1):null,c=new jg(r,s,l,u),f=[t,n];return o&&f.push(o),i&&f.push(i),this.compileAndRun(c,f)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(pf().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new jg(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new Bg(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new Lg(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,o=e.convInfo,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=pf().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=i?Lb(i,u):null,c=[n,r],f=null!=a,h=null!=s;return f&&c.push(a),h&&c.push(s),u?(t=new qg(o,f,l,h),this.compileAndRun(t,c)):(t=new Hg(o,f,l,h),this.compileAndRun(t,c))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return pf().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new qg(n),this.compileAndRun(r,[e,t])):(r=new Hg(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new Vg(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new Ug(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new Gg(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new Wg(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new zg(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new Wy(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new Wy(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var o=new Wy(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Dy(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new bg(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return Dm(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new Uy(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new xg(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new Uy(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var o=new Uy(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Oy(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!Ad(e.shape,t)&&(null===n.texture||!Ad(n.shape,t))){var r=this.packedReshape(e,t);return Bh.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Om(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var o=pf().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new qy(e.shape,t,n,r):new Hy(e.shape,t,n,r);return this.compileAndRun(o,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new Gy(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new Xy(e.shape,t,n,r);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new Ky(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var o=t?e:pm(e),a=o.shape[0],i=o.shape[1],s=new Fy(a,i,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var o=new Py(e.size,t,n,r);return this.compileAndRun(o,[e])},t.prototype.diag=function(e){var t=new Zg(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return qd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Um(e.dataSync(),t.dataSync(),n,r,o)},t.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new Kg(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){_f(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,l=i/(t*t),c=new Jg("NHWC"===n?[r,s,u,l]:[r,l,s,u],t,n);return this.compileAndRun(c,[e])},t.prototype.split=function(e,t,n){return Km(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=am(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/i,i],c=e.reshape([a,o]),f=t.reshape([a,i]);if(0===u)return Om(fp([]),n);var h=dp(0),d=new Qy(a,o,c.rank,f.rank,s,l);return this.compileAndRun(d,[f,c,h]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var o=am(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new Qy(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new oy("return real * expR - imag * expI;",e.shape,t),o=new oy("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=tm(e,t),a=o[0],i=o[1],s=o[2],u=o[3],l=t.reshape([i,r]),c=e.reshape([e.size/s,s]),f=new sy(r,u,[i,s]);return this.compileAndRun(f,[c,l]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Zf(t))){var r=jf(n,Df(e));return r.fill(t),Bh.makeTensor(r,e,n,this)}var o=new ay(e,t),a=o.getCustomSetupFunc(t);return this.compileAndRun(o,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return Mm(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return Bh.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new Fb(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new Ly(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[Rd(e.shape)].concat(Id(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[Rd(t)].concat(Id(t)),a=new jy(o,n),i=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,o=n.shape,a=n.dtype,i=_d(o);return t=r?new Qg(i):new Yg(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(t,[{shape:i,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,o){var a=this;void 0===o&&(o=!1);var i=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(i.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Uh.DENSE){var u=$h(e.outputShape);s.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===Df(i.shape))return s.values=Vf(i.dtype,0),i;var l=[],c=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Df(t.shape)<=pf().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Ad(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),l.push(t),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(i.dataId);var f,h={shape:i.shape,texData:s,isUniform:!1},d=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,c,h),p=this.getAndSaveBinary(d,function(){return function(e,t,n,r){var o=t.userCode,a=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=ig(a,s,o,t.packedInputs),l=e.createProgram(u),c=null,f=e.getUniformLocation(l,"NAN",!1);1===pf().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var h={},d=0;d<t.variableNames.length;d++){var p=t.variableNames[d];h[p]=e.getUniformLocation(l,p,!1),h["offset"+p]=e.getUniformLocation(l,"offset"+p,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:h,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:f}}(a.gpgpu,e,c,h)}),v=null!=this.activeTimers;if(v&&(f=this.startTimer()),function(e,t,n,r,o){Iy(t.inShapeInfos,n),Iy([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===pf().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(Df(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,c,h,r),l.forEach(function(e){return a.disposeData(e.dataId)}),v&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!pf().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var m=this.unpackTensor(i);return this.disposeData(i.dataId),m}return i},t.prototype.compileAndRun=function(e,t,n,r,o){void 0===o&&(o=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,o);return Bh.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(pf().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Gd(function(){if(!pf().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=pf().getBool("DEBUG");pf().set("DEBUG",!1);var n=e.abs(dp(1e-8)).dataSync()[0];if(pf().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=sh());var f=n.texShape;if(null==f&&(f=Nd(r,u),n.texShape=f),null!=a){var h=_d(r),d=void 0,p=f[1],v=f[0],m=a instanceof Uint8Array;u?(p=(t=Yh(f[0],f[1]))[0],v=t[1],d=new ry(h,[v,p],m)):d=new ny(h,[v,p],m);var g=this.makeTensorInfo([v,p],o);this.texData.get(g.dataId).usage=m?Vh.PIXELS:Vh.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,v,a);var y=this.runWebGLProgram(d,[g],o,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,c&&(this.uploadWaitMs+=sh()-l)}else{var x=this.acquireTexture(f,s,o,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*Xf(t)},t}(ym);function zb(e,t){return e(t={exports:{}},t.exports),t.exports}zh()&&Bh.registerBackend("webgl",function(){return new Bb},2),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var Wb=zb(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var o=new n(e),a=t&&t.state,i=o.next;return i.int32=function(){return 4294967296*o.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.alea=o}(0,e)}),Ub=zb(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor128=o}(0,e)}),Vb=zb(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)}),jb=zb(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.x&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)}),Gb=zb(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.X&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)}),Hb=zb(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.tychei=o}(0,e)}),qb=zb(function(e){!function(t,r){var o,a=this,i=256,s="random",u=r.pow(i,6),l=r.pow(2,52),c=2*l,f=255;function h(e,n,f){var h=[],g=v(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,m(t)]}}():e,3),h),y=new d(h),b=function(){for(var e=y.g(6),t=u,n=0;e<l;)e=(e+n)*i,t*=i,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,v(m(y.S),t),(n.pass||f||function(e,t,n,o){return o&&(o.S&&p(o,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(b,g,"global"in n?n.global:this==r,n.state)}function d(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=f&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=f&o+1],n=n*i+s[f&(s[o]=s[a=f&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){for(var n,r=e+"",o=0;o<r.length;)t[f&o]=f&(n^=19*t[f&o])+r.charCodeAt(o++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=h,v(r.random(),t),e.exports){e.exports=h;try{o=n(367)}catch(e){}}}([],Math)});qb.alea=Wb,qb.xor128=Ub,qb.xorwow=Vb,qb.xorshift7=jb,qb.xor4096=Gb,qb.tychei=Hb;var Kb=qb.alea,Xb=sp({addN_:function(e){_f(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),_f(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return $d(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Of(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return Bh.runKernelFunc(function(e,n){return e.addN(t)},r,null,"AddN")}});function $b(){jd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Yb(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Qb(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u=$d(e,"x","batchNorm"),l=$d(t,"mean","batchNorm"),c=$d(n,"variance","batchNorm");null!=o&&(i=$d(o,"scale","batchNorm")),null!=r&&(s=$d(r,"offset","batchNorm")),_f(l.rank===c.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),_f(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),_f(null==i||l.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f={x:u,scale:i,offset:s,mean:l,variance:c},h={varianceEpsilon:a};return Bh.runKernelFunc(function(e,t){var n=Yb(u),r=e.batchNormalization(n,Jb(l),Jb(c),a,Jb(i),Jb(s));return t([u,l,c,i]),r},f,null,"FusedBatchNorm",h).reshape(u.shape)}function Jb(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var Zb=sp({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),$b(),Qb(e,t,n,a,o,r)}}),ex=sp({batchNorm_:Qb});function tx(e,t,n,r,o,a){var i,s,u=$d(e,"x","batchNorm"),l=$d(t,"mean","batchNorm"),c=$d(n,"variance","batchNorm");return null!=o&&(i=$d(o,"scale","batchNorm")),null!=r&&(s=$d(r,"offset","batchNorm")),_f(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),_f(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),_f(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&_f(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&_f(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),ex(u,l,c,s,i,a)}var nx=sp({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),$b(),tx(e,t,n,a,o,r)}}),rx=sp({batchNorm2d_:tx});function ox(e,t,n,r,o,a){var i,s,u=$d(e,"x","batchNorm"),l=$d(t,"mean","batchNorm"),c=$d(n,"variance","batchNorm");return null!=o&&(i=$d(o,"scale","batchNorm")),null!=r&&(s=$d(r,"offset","batchNorm")),_f(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),_f(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),_f(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&_f(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&_f(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),ex(u,l,c,s,i,a)}var ax=sp({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),$b(),ox(e,t,n,a,o,r)}}),ix=sp({batchNorm3d_:ox});function sx(e,t,n,r,o,a){var i,s,u=$d(e,"x","batchNorm"),l=$d(t,"mean","batchNorm"),c=$d(n,"variance","batchNorm");return null!=o&&(i=$d(o,"scale","batchNorm")),null!=r&&(s=$d(r,"offset","batchNorm")),_f(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),_f(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),_f(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&_f(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&_f(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),ex(u,l,c,s,i,a)}var ux=sp({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),$b(),sx(e,t,n,a,o,r)}}),lx=sp({batchNorm4d_:sx}),cx=sp({broadcastTo_:function(e,t){var n=$d(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var a=n.shape,i=Array.from(t),s=t.length-1;s>=0;s--)if(a[s]===t[s])i[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var u=i.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0});if(0===u.length)return n.clone();var l={x:n},c={shape:t,inputShape:a};return Bh.runKernelFunc(function(e){return e.tile(n,i)},l,function(e){return{x:function(){return e.sum(u,!0)}}},Xp,c)}}),fx=sp({clone_:function(e){var t=$d(e,"x","clone",null);return Bh.runKernelFunc(function(){return Bh.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{x:t},null,Yp)}}),hx=sp({logicalAnd_:function(e,t){var n=$d(e,"a","logicalAnd","bool"),r=$d(t,"b","logicalAnd","bool");return nv(n.shape,r.shape),Bh.runKernelFunc(function(e){return e.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),dx=sp({logicalNot_:function(e){var t=$d(e,"x","logicalNot","bool");return Bh.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),px=sp({logicalOr_:function(e,t){var n=$d(e,"a","logicalOr","bool"),r=$d(t,"b","logicalOr","bool");return nv(n.shape,r.shape),Bh.runKernelFunc(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),vx=sp({logicalXor_:function(e,t){var n=$d(e,"a","logicalXor","bool"),r=$d(t,"b","logicalXor","bool");return nv(n.shape,r.shape),px(e,t).logicalAnd(hx(e,t).logicalNot())}}),mx=sp({where_:function(e,t,n){var r=$d(t,"a","where"),o=$d(n,"b","where"),a=$d(e,"condition","where","bool");return Nf(r.shape,o.shape,"Error in where: "),1===a.rank?_f(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Nf(a.shape,o.shape,"Error in where: "),Bh.runKernelFunc(function(e,t){var n=e.select(a,r,o);return t([a]),n},{$condition:a,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return Ep(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),gx=function(e){return ff(this,void 0,void 0,function(){var t,n,r;return hf(this,function(o){switch(o.label){case 0:return[4,(t=$d(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=Ym(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},yx=sp({divNoNan_:function(e,t){var n,r=$d(e,"a","div"),o=$d(t,"b","div");r=(n=Dh(r,o))[0],o=n[1];var a=em(r,o),i=Ep(a),s=o.equal(i);return mx(s,i,a)}}),bx=sp({tile_:function(e,t){var n=$d(e,"x","tile",null);_f(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={x:n},a={reps:t};return Bh.runKernelFunc(function(e,r){var o=e.tile(n,t);return r([n]),o},o,null,Qp,a,r)}}),xx=sp({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=Tp([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return bx(Fp(s,0),[n[0],1,1]);if(2===n.length)return bx(Fp(Fp(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return bx(Fp(Fp(Fp(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),wx=sp({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=$d(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=Bh.runKernelFunc(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===i?u.as1D():u}}),Cx=sp({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=$d(e,"indices","oneHot","int32"),a=o.shape.concat([t]),i={indices:o=o.flatten()},s={depth:t,onValue:n,offValue:r};return Bh.runKernelFunc(function(e,a){return a([o]),e.oneHot(o,t,n,r)},i,null,$p,s).reshape(a)}}),Ex=sp({pad_:function(e,t,n){void 0===n&&(n=0);var r=$d(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n},a={x:r};return Bh.runKernelFunc(function(e,o){return o([r]),e.pad(r,t,n)},a,null,Jp,o)}}),Sx=sp({pad1d_:function(e,t,n){return void 0===n&&(n=0),_f(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),Ex(e,[t],n)}}),kx=sp({pad2d_:function(e,t,n){return void 0===n&&(n=0),_f(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ex(e,t,n)}}),Rx=sp({pad3d_:function(e,t,n){return void 0===n&&(n=0),_f(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ex(e,t,n)}}),Ix=sp({pad4d_:function(e,t,n){return void 0===n&&(n=0),_f(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ex(e,t,n)}}),_x=sp({rand_:function(e,t,n){var r=Df(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return Bh.makeTensor(o,e,n)}});function Nx(){return 32===Bh.backend.floatPrecision()?.001:.1}function Tx(e,t,n){var r=!0;if((Kf(e)||Kf(t))&&(r=!1),Kf(e)&&Kf(t)&&(r=!0),r){var o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var i=Kd(e),s=Kd(t);if(!Of(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=Kf(e)?e:Af(e),l=Kf(t)?t:Af(t);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var f=u[c],h=l[c];if(!n(f,h))throw new Error("Arrays differ: actual["+c+"] = "+f+", expected["+c+"] = "+h+".\nActual:   "+u+".\nExpected: "+l+".")}}function Ax(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=Nx()),Tx(e,t,function(e,t){return Ax(e,t,n)})},testEpsilon:Nx,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Yf(e)||Yf(e[0])||Yf(t)||Yf(t[0])?Tx(e,n,function(e,t){return e==t}):Tx(e,t,function(e,t){return Ax(e,t,0)})},expectNumbersClose:function(e,t,n){if(null==n&&(n=Nx()),!Ax(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}});var Dx=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Kb(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),Ox=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var o=r||Math.random();this.randu=Kb(o.toString()),this.randn=new Dx(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,o,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),Mx=function(){function e(e,t,n,r){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Kb(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}(),Fx=sp({randomGamma_:function(e,t,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new Ox(t,n,r,o),i=Tp(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Px=sp({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Dx(t,n,r,!1,o),i=Tp(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Lx=sp({randomUniform_:function(e,t,n,r,o){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Tp(e,r),i=new Mx(t,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Bx=sp({square_:function(e){var t=$d(e,"x","square"),n=[t];return Bh.runKernelFunc(function(e,n){return n([t]),e.square(t)},{x:t},null,"Square",{},n,[])}}),zx=sp({squaredDifference_:function(e,t){var n,r=$d(e,"a","squaredDifference"),o=$d(t,"b","squaredDifference");n=Dh(r,o),r=n[0],o=n[1],nv(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return Bh.runKernelFunc(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},a,function(e,t){var n=t[0],r=t[1],o=dp(2);return{a:function(){return e.mul(n.sub(r).mul(o))},b:function(){return e.mul(r.sub(n).mul(o))}}},Kp,{},i,[])}}),Wx=sp({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var a=new Dx(t,n,r,!0,o),i=Tp(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Ux=sp({equal_:function(e,t){var n,r=$d(e,"a","equal"),o=$d(t,"b","equal");return n=Dh(r,o),r=n[0],o=n[1],nv(r.shape,o.shape),Bh.runKernelFunc(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),Vx=sp({equalStrict_:function(e,t){var n=$d(e,"a","equalStrict"),r=$d(t,"b","equalStrict");return Nf(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),jx=sp({greater_:function(e,t){var n,r=$d(e,"a","greater"),o=$d(t,"b","greater");return n=Dh(r,o),r=n[0],o=n[1],nv(r.shape,o.shape),Bh.runKernelFunc(function(e){return e.greater(r,o)},{a:r,b:o},null,"Greater")}}),Gx=sp({greaterEqual_:function(e,t){var n,r=$d(e,"a","greaterEqual"),o=$d(t,"b","greaterEqual");return n=Dh(r,o),r=n[0],o=n[1],nv(r.shape,o.shape),Bh.runKernelFunc(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return Ep(n)},b:function(){return Ep(r)}}},"GreaterEqual")}}),Hx=sp({greaterEqualStrict_:function(e,t){var n=$d(e,"a","greaterEqualStrict"),r=$d(t,"b","greaterEqualStrict");return Nf(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),qx=sp({greaterStrict_:function(e,t){var n=$d(e,"a","greaterStrict"),r=$d(t,"b","greaterStrict");return Nf(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Kx=sp({less_:function(e,t){var n,r=$d(e,"a","less"),o=$d(t,"b","less");return n=Dh(r,o),r=n[0],o=n[1],nv(r.shape,o.shape),Bh.runKernelFunc(function(e){return e.less(r,o)},{a:r,b:o},null,"Less")}}),Xx=sp({lessEqual_:function(e,t){var n,r=$d(e,"a","lessEqual"),o=$d(t,"b","lessEqual");return n=Dh(r,o),r=n[0],o=n[1],nv(r.shape,o.shape),Bh.runKernelFunc(function(e,t){var n=e.lessEqual(r,o);return t([r,o]),n},{a:r,b:o},null,"LessEqual")}}),$x=sp({lessEqualStrict_:function(e,t){var n=$d(e,"a","lessEqualStrict"),r=$d(t,"b","lessEqualStrict");return Nf(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Yx=sp({lessStrict_:function(e,t){var n=$d(e,"a","lessStrict"),r=$d(t,"b","lessStrict");return Nf(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Qx=sp({notEqual_:function(e,t){var n,r=$d(e,"a","notEqual"),o=$d(t,"b","notEqual");return n=Dh(r,o),r=n[0],o=n[1],nv(r.shape,o.shape),Bh.runKernelFunc(function(e){return e.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),Jx=sp({notEqualStrict_:function(e,t){var n=$d(e,"a","notEqualStrict"),r=$d(t,"b","notEqualStrict");return Nf(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Zx(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function ew(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var tw=sp({gather_:function(e,t,n){void 0===n&&(n=0);var r=$d(e,"x","gather"),o=$d(t,"indices","gather","int32");n=Wf(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return Bh.runKernelFunc(function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a},{x:r,indices:o},function(e,t){var o=t[0];return{x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),l=u.length,c=Zx(0,s),f=Zx(s+1,s+1+l),h=ew([i,[a],u]),d=e.reshape(h),p=o.reshape([a]),v=ew([[s],c,f]),m=d.transpose(v),g=nw(m,p,r.shape[n]),y=rp(v);return g.transpose(y)},indices:function(){return o}}},"Gather",{axis:n}).reshape(a.outputShape)}}),nw=sp({unsortedSegmentSum_:function(e,t,n){var r=$d(e,"x","unsortedSegmentSum"),o=$d(t,"segmentIds","unsortedSegmentSum","int32");return _f(Mf(n),function(){return"numSegments must be of dtype int"}),Bh.runKernelFunc(function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Uv(t,Ep(t)),r=tw(e,n),o=Gx(t,dp(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=Fp(o,i+1);o=hx(o,yp(r.shape,"bool"));var s=Ep(r);return mx(o,r,s)}(e,n)}}})}});function rw(e,t,n,r,o,a,i){void 0===a&&(a="NHWC"),_f(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;3===t.rank&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),_f(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),_f(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),_f(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c="NHWC"===a?s[3]:s[1],f="NHWC"===a?u.shape[3]:u.shape[1];_f(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),_f(f===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."}),null!=i&&_f(Mf(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var h=Am(a),d=Cm(s,n.shape,r,1,o,i,!1,h),p=Bh.runKernelFunc(function(e,t){var r=e.conv2dDerInput(u,n,d);return t([n,u]),r},{dy4D:u,filter:n},function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return sw(e,n,r,o,a,1,i)},filter:function(){return lw(e,s,n.shape,r,o,a,i)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function ow(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function aw(e,t,n,r,o){_f(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];_f(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),_f(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),_f(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),_f(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),_f(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Em(a,n.shape,r,1,o),f=Bh.runKernelFunc(function(e){return e.conv3dDerInput(i,n,c)},{dy5D:i});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var iw=sp({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=$d(e,"x","conv1d"),u=$d(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),_f(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),_f(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&_f(Mf(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),_f(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),_f(Tm(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),_f("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=sw(h,f,[1,n],r,"NHWC",[1,a],i);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),sw=sp({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=$d(e,"x","conv2d"),u=$d(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),_f(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),_f(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&_f(Mf(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f="NHWC"===o?l.shape[3]:l.shape[1];_f(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."}),_f(Tm(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"});var h=Am(o),d=Cm(l.shape,u.shape,n,a,r,i,!1,h),p=[u,l],v=Bh.runKernelFunc(function(e,t){var n=e.conv2d(l,u,d);return t([u,l]),n},{x:l,filter:u},function(e,t){var i=t,s=i[0],u=i[1];return _f(Nm(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return cw(u.shape,e,s,n,r,o)},filter:function(){return lw(u,e,s.shape,n,r,o)}}},"Conv2D",d,p);return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),uw=sp({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=$d(e,"x","conv3d"),s=$d(t,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),_f(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),_f(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),_f(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),_f(function(e,t){return ow(e)||ow(t)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),_f("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=Em(u.shape,s.shape,n,a,r),f=Bh.runKernelFunc(function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n},{x:u,$filter:s},function(e,t){_f(ow(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=t[0],i=t[1];return{x:function(){return aw(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),_f(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),_f(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),_f(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),_f(a.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."}),_f(i.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=Em(a.shape,n,r,1,o);return Bh.runKernelFunc(function(e){return e.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),lw=sp({conv2dDerFilter_:function(e,t,n,r,o,a,i){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),_f(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),_f(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),_f(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];_f(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),_f(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),null!=i&&_f(Mf(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=Am(a),h=Cm(s.shape,n,r,1,o,i,!1,f);return Bh.runKernelFunc(function(e){return e.conv2dDerFilter(s,u,h)},{x4D:s,dy4D:u})}}),cw=sp({conv2dDerInput_:rw}),fw=sp({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=$d(e,"x","depthwiseConv2d"),u=$d(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),_f(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),_f(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),_f(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),_f(Tm(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&_f(Mf(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var f=Cm(l.shape,u.shape,n,a,r,i,!0),h=[l,u],d=Bh.runKernelFunc(function(e,t){var n=e.depthwiseConv2D(l,u,f);return t([l,u]),n},{x:l,filter:u},function(e,t){_f(Nm(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var n=t[0],r=t[1];return{x:function(){return hw(n.shape,e,r,f)},filter:function(){return dw(n,e,r.shape,f)}}},"DepthwiseConv2dNative",f,h);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),hw=sp({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=Bh.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),dw=sp({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Bh.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}}),pw=sp({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=$d(e,"x","separableConv2d"),u=$d(t,"depthwiseFilter","separableConv2d"),l=$d(n,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(3===s.rank&&(f=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");_f(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),_f(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),_f(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),_f(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),_f(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],d=u.shape[3];_f(l.shape[2]===h*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*d+", but got "+l.shape[2]+"."});var p=fw(c,u,r,o,i,a),v=sw(p,l,1,"valid",i);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),vw=sp({conv2dTranspose_:function(e,t,n,r,o,a){return rw(n,$d(e,"x","conv2dTranspose"),$d(t,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),mw=sp({conv3dTranspose_:function(e,t,n,r,o){return aw(n,$d(e,"x","conv3dTranspose"),$d(t,"filter","conv3dTranspose"),r,o)}}),gw=sp({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=$d(e,"a","matMul"),i=$d(t,"b","matMul");o=Dh(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],f=a.shape.slice(0,-2),h=i.shape.slice(0,-2),d=Df(f),p=Df(h);_f(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),_f(Of(f,h),function(){return"Error in matMul: outer dimensions ("+f+") and ("+h+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),_f(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=a.shape.slice(0,-2).concat([l,c]),m=n?a.as3D(d,s,l):a.as3D(d,l,s),g=r?i.as3D(p,c,u):i.as3D(p,u,c),y={transposeA:n,transposeB:r};return Bh.runKernelFunc(function(e,t){var o=e.batchMatMul(m,g,n,r);return t([m,g]),o},{a:m,b:g},function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{a:function(){return e.matMul(i,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return i.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return i.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(i,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}},"BatchMatMul",y).reshape(v)}}),yw=sp({dot_:function(e,t){var n=$d(e,"t1","dot"),r=$d(t,"t2","dot");_f(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return _f(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),bw=sp({outerProduct_:function(e,t){var n=$d(e,"v1","outerProduct"),r=$d(t,"v2","outerProduct");return _f(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),xw=sp({reverse_:function(e,t){var n=$d(e,"x","reverse");if(0===n.rank)return n.clone();var r=Wf(t,n.shape);return Bh.runKernelFunc(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),ww=sp({reverse1d_:function(e){var t=$d(e,"x","reverse");return _f(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),xw(t,0)}}),Cw=sp({reverse2d_:function(e,t){var n=$d(e,"x","reverse");return _f(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),xw(n,t)}}),Ew=sp({reverse3d_:function(e,t){var n=$d(e,"x","reverse");return _f(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),xw(n,t)}}),Sw=sp({reverse4d_:function(e,t){var n=$d(e,"x","reverse");return _f(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),xw(n,t)}});function kw(e,t,n,r,o,a){var i=$d(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),_f(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),_f(Tm(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=a&&_f(Mf(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=xm(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&Of(l.inShape,l.outShape))return i.clone();var c=[s],f=Bh.runKernelFunc(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=$d(e,"dy","maxPoolBackprop"),l=$d(t,"input","maxPoolBackprop"),c=$d(n,"output","maxPoolBackprop");_f(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),_f(Tm(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),_f(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),_f(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var f=xm(l.shape,r,o,a,i,s);return Bh.runKernelFunc(function(e){return e.maxPoolBackprop(u,l,c,f)},{$dy:u,$input:l})}(e,i,s,t,n,r,o)}}},"MaxPool",l,c);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function Rw(e,t,n,r,o,a){var i=$d(e,"x","avgPool","float32");null==r&&(r=[1,1]),_f(Tm(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),_f(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&_f(Mf(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=xm(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&Of(l.inShape,l.outShape))return i.clone();var c=Bh.runKernelFunc(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,a){var i=$d(e,"dy","avgPoolBackprop"),s=$d(t,"input","avgPoolBackprop");_f(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),_f(Tm(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),_f(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),_f(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var f=xm(u.shape,n,r,o,a),h=Bh.runKernelFunc(function(e){return e.avgPoolBackprop(l,u,f)},{dy4D:l,input4D:u});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(e,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Iw=sp({maxPool_:function(e,t,n,r,o){return kw(e,t,n,1,r,o)}}),_w=sp({avgPool_:function(e,t,n,r,o){return Rw(e,t,n,1,r,o)}}),Nw=sp({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=$d(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),_f(Tm(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=xm(s.shape,t,a,o,r),f=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([c.filterHeight,c.filterWidth],f):[[0,0],[0,0]];var h=1===f[0]&&1===f[1],d=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),a=e.concat(r,o),i=t.map(function(e,t){return(e-a[t]%e)%e}),s=o.map(function(e,t){return e+i[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,i[t]]})]}([c.inHeight,c.inWidth],f,l),p=d[0],v=d[1],m=h?r:"valid",g=h?s:Lp(s,f,p),y=("avg"===n?function(){return Rw(g,t,a,1,m)}:function(){return kw(g,t,a,1,m)})(),b=h?y:Ap(y,f,v);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Tw=sp({maxPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=$d(e,"x","maxPool3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),_f(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),_f("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),_f(Tm(n,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&_f(Mf(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=wm(u.shape,t,n,i,r,o,a),f=Bh.runKernelFunc(function(e,t){var n=e.maxPool3d(u,c);return t([u,n]),n},{x:u},function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=$d(e,"dy","maxPool3dBackprop"),l=$d(t,"input","maxPool3dBackprop"),c=$d(n,"output","maxPool3dBackprop"),f=u,h=l,d=c,p=!1;4===l.rank&&(p=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),_f(5===f.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."}),_f(5===h.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."}),_f(5===d.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+d.rank+"."}),null==a&&(a=[1,1,1]),_f(Tm(o,a),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),null!=s&&_f(Mf(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var v=wm(h.shape,r,o,a,i,s),m=Bh.runKernelFunc(function(e){return e.maxPool3dBackprop(f,h,d,v)},{dy5D:f,input5D:h});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(e,s,u,t,n,i,r,o)}}});return l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Aw=sp({avgPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=$d(e,"x","avgPool3d","float32"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),_f(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),_f("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),_f(Tm(n,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&_f(Mf(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=wm(u.shape,t,n,i,r,o,a),f=Bh.runKernelFunc(function(e){return e.avgPool3d(u,c)},{x:u},function(e){return{x:function(){return function(e,t,n,r,o,a,i){var s=$d(e,"dy","avgPool3dBackprop"),u=$d(t,"input","avgPool3dBackprop"),l=s,c=u,f=!1;4===u.rank&&(f=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),_f(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),_f(5===c.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),null==o&&(o=[1,1,1]),_f(Tm(r,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=i&&_f(Mf(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var h=wm(c.shape,n,r,o,a,i),d=Bh.runKernelFunc(function(e){return e.avgPool3dBackprop(l,c,h)},{dy5D:l,input5D:c});return f?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}(e,u,t,n,i,r,o)}}});return f=f.cast(u.dtype),l?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Dw=sp({maxPoolWithArgmax_:function(e,t,n,r,o){void 0===o&&(o=!1);var a=$d(e,"x","maxPoolWithArgmax"),i={filterSize:t,strides:n,pad:r,includeBatchInIndex:o},s=Bh.runKernel("MaxPoolWithArgmax",{x:a},i);return{result:s[0],indexes:s[1]}}}),Ow=sp({slice_:function(e,t,n){var r,o,a=$d(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach(function(e){_f(-1!==e,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(_f(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."}),a.shape[t]-r[t])}),im(a,r,o);var i=a.shape,s={begin:r,size:o};return Bh.runKernelFunc(function(e){return e.slice(a,r,o)},{x:a},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{x:function(){return Ex(e,t)}}},"Slice",s)}}),Mw=sp({slice1d_:function(e,t,n){var r=$d(e,"x","slice1d");return _f(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Ow(r,[t],[n])}}),Fw=sp({slice2d_:function(e,t,n){var r=$d(e,"x","slice2d");return _f(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Ow(r,t,n)}}),Pw=sp({slice3d_:function(e,t,n){var r=$d(e,"x","slice3d");return _f(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Ow(r,t,n)}}),Lw=sp({slice4d_:function(e,t,n){var r=$d(e,"x","slice4d");return _f(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Ow(r,t,n)}});function Bw(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(ep(t.shape,r))),e.rank<n.rank&&(e=e.reshape(ep(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var zw=sp({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","all","bool"),o=Wf(t,r.shape),a=o,i=np(a,r.rank);null!=i&&(r=r.transpose(i),a=op(a.length,r.rank));var s=Bh.runKernelFunc(function(e){return e.all(r,a)},{$x:r});if(n){var u=ep(s.shape,o);return s.reshape(u)}return s}}),Ww=sp({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","any","bool"),o=Wf(t,r.shape),a=o,i=np(a,r.rank);null!=i&&(r=r.transpose(i),a=op(a.length,r.rank));var s=Bh.runKernelFunc(function(e){return e.any(r,a)},{$x:r});if(n){var u=ep(s.shape,o);return s.reshape(u)}return s}}),Uw=sp({argMax_:function(e,t){void 0===t&&(t=0);var n=$d(e,"x","argMax");null==t&&(t=0);var r=Wf(t,n.shape),o=np(r,n.rank);null!=o&&(n=n.transpose(o),r=op(r.length,n.rank));var a={axis:r[0]},i=[n];return Bh.runKernelFunc(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{x:n},function(e,t){var n=t[0];return{x:function(){return Ep(n)}}},"ArgMax",a,i)}}),Vw=sp({argMin_:function(e,t){void 0===t&&(t=0);var n=$d(e,"x","argMin");null==t&&(t=0);var r=Wf(t,n.shape),o=np(r,n.rank);return null!=o&&(n=n.transpose(o),r=op(r.length,n.rank)),Bh.runKernelFunc(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Ep(n)}}})}}),jw=sp({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","logSumExp"),o=Wf(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=ep(s.shape,o);return s.reshape(u)}return s}}),Gw=sp({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","max"),o=r,a=Wf(t,r.shape),i=a,s=np(i,r.rank);null!=s&&(r=r.transpose(s),i=op(i.length,r.rank));var u=[r],l=Bh.runKernelFunc(function(e,t){var n=e.max(r,i);return t([o,n]),n},{x:r},function(e,t){return Bw(e,t[1],t[0],a,s)},"Max",{axes:i},u,[!0]);if(n){var c=ep(l.shape,a);l=l.reshape(c)}return l}}),Hw=sp({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","mean"),o=Wf(t,r.shape),a=Df(Zd(r.shape,o)[1]);return dm(function(e){var r=dp(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(yp(e.shape,"float32")).div(a)}}})(r)}}),qw=sp({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","min"),o=r,a=Wf(t,r.shape),i=a,s=np(i,r.rank);null!=s&&(r=r.transpose(s),i=op(i.length,r.rank));var u=[r],l=Bh.runKernelFunc(function(e,t){var n=e.min(r,i);return t([o,n]),n},{x:r},function(e,t){return Bw(e,t[1],t[0],a,s)},"Min",{axes:i},u,[!0]);if(n){var c=ep(l.shape,a);l=l.reshape(c)}return l}}),Kw=sp({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Wf(t,(e=$d(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;n||(a=ep(o.shape,r));var i=e.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),Xw=sp({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=Wf(t,r.shape);return dm(function(e){var t=np(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=op(r.length,e.rank));var i=function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(yp(e.shape,"float32"))},s={axes:r},u=Bh.runKernelFunc(function(e){return e.sum(a,r)},{x:a},function(e){return{x:function(){return i(e)}}},"Sum",s);if(n){var l=ep(u.shape,o);u=u.reshape(l)}return{value:u,gradFunc:i}})(r)}}),$w=sp({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=$d(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=Wf(t,r.shape),a=np(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=op(i.length,r.rank));var u=Bh.runKernelFunc(function(e){return e.prod(s,i)},{permutedX:s});if(n){var l=ep(u.shape,o);u=u.reshape(l)}return u}}),Yw=sp({elu_:function(e){var t=$d(e,"x","elu");return Bh.runKernelFunc(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return Bh.runKernelFunc(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),Qw=sp({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=$d(e,"x","leakyRelu");return Uv(dp(t).mul(n),n)}}),Jw=sp({prelu_:function(e,t){var n=$d(e,"x","prelu"),r=$d(t,"alpha","prelu");return Bh.runKernelFunc(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{x:n,alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{x:function(){return mx(o,e,e.mul(r))},alpha:function(){var t=mx(o,Ep(e),e.mul(n)),a=tv(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}},"Prelu")}}),Zw=sp({relu_:function(e){var t=$d(e,"x","relu");return"bool"===t.dtype?t.toInt():Bh.runKernelFunc(function(e,n){var r=e.relu(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}}),eC=sp({relu6_:function(e){var t=$d(e,"x","relu6");return"bool"===t.dtype?t.toInt():Bh.runKernelFunc(function(e,n){var r=e.relu6(t);return n([t]),r},{x:t},function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}},"Relu6")}}),tC=sp({selu_:function(e){var t=$d(e,"x","selu");return Bh.runKernelFunc(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(dp(0)),r=dp(ub),o=dp(lb),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return mx(t,a,i)}}})}}),nC=sp({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=$d(e,"x","localResponseNormalization");_f(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),_f(Mf(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=Bh.runKernelFunc(function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return Bh.runKernelFunc(function(a){return a.LRNGrad(e,i,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),rC=sp({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(dp(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=$d(e,"x","norm"),t,n),a=o.shape;if(r){var i=Wf(n,e.shape);a=ep(o.shape,i)}return o.reshape(a)}}),oC=sp({basicLSTMCell_:function(e,t,n,r,o,a){var i=$d(e,"forgetBias","basicLSTMCell"),s=$d(t,"lstmKernel","basicLSTMCell"),u=$d(n,"lstmBias","basicLSTMCell"),l=$d(r,"data","basicLSTMCell"),c=$d(o,"c","basicLSTMCell"),f=$d(a,"h","basicLSTMCell"),h=l.concat(f,1).matMul(s).add(u),d=h.shape[0],p=h.shape[1]/4,v=[d,p],m=h.slice([0,0],v),g=h.slice([0,p],v),y=h.slice([0,2*p],v),b=h.slice([0,3*p],v),x=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(i.add(y).sigmoid())),w=x.tanh().mulStrict(b.sigmoid());return[x,w]}}),aC=sp({multiRNNCell_:function(e,t,n,r){for(var o=$d(t,"data","multiRNNCell"),a=Yd(n,"c","multiRNNCell"),i=Yd(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var f=[],h=[];for(l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}}),iC=sp({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=$d(e,"v","movingAverage"),i=$d(t,"x","movingAverage"),s=$d(n,"decay","movingAverage");Oh(a,i),_f(Of(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=dp(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){_f(null!=r,function(){return"When using zeroDebias: true, step is required."});var f=$d(r,"step","movingAverage");c=c.div(u.sub($v(s,f)))}return a.add(c)}}),sC=sp({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var l=$d(e,"x","stridedSlice"),c=sm(s),f=l.shape.slice();c.forEach(function(e){t[e]=0,n[e]=1,f.splice(e,0,1)}),l=l.reshape(f);for(var h=0;h<l.rank;h++)t[h]=lm(o,t,r,l.shape,h),n[h]=cm(a,n,r,l.shape,h),r[h]=r[h]||1;var d=sm(u);d.forEach(function(e){n[e]=t[e]+1,r[e]=1});var p=um(t,n,r),v=p.filter(function(e,t){return-1===d.indexOf(t)});return r.every(function(e){return 1===e})?Ow(l,t,p).reshape(v):Bh.runKernelFunc(function(e){return e.stridedSlice(l,t,n,r)},{$x:l}).reshape(v)}}),uC=sp({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=$d(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=Bh.runKernelFunc(function(e){return e.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}}),lC=sp({scatterND_:function(e,t,n){var r=$d(e,"indices","scatterND","int32"),o=$d(t,"updates","scatterND");return om(o,r,n),Bh.runKernelFunc(function(e){return e.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),cC=sp({fft_:function(e){_f("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Bh.runKernelFunc(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),fC=sp({ifft_:function(e){_f("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Bh.runKernelFunc(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),hC=sp({rfft_:function(e,t){_f("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(null!=t&&t<r){var a=e.shape.map(function(e){return 0}),i=e.shape.map(function(e){return e});i[e.shape.length-1]=t,n=e.slice(a,i),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(bp(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=up(n,u).as2D(o,r),c=cC(l),f=Math.floor(r/2)+1,h=lp(c),d=cp(c),p=h.split([f,r-f],h.shape.length-1),v=d.split([f,r-f],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,up(p[0],v[0]).reshape(m)}}),dC=sp({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=fC(r);return lp(o)}var a=[n,2*(t-1)],i=lp(e).as2D(n,t),s=cp(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(dp(-1)),c=i.concat(u,1),f=s.concat(l,1);return r=up(c,f).as2D(a[0],a[1]),o=fC(r),lp(o)}}),pC=Object.freeze({fft:cC,ifft:fC,rfft:hC,irfft:dC}),vC=sp({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=$d(e,"sparseIndices","sparseToDense","int32"),a=$d(t,"sparseValues","sparseToDense"),i=$d(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),Bh.runKernelFunc(function(e){return e.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),mC=sp({gatherND_:function(e,t){var n=$d(t,"indices","gatherND","int32"),r=$d(e,"x","gatherND");return Bh.runKernelFunc(function(e){return e.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),gC=sp({diag_:function(e){var t=$d(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return Bh.runKernelFunc(function(e){return e.diag(t)},{$x:t}).reshape(n)}}),yC=sp({dropout_:function(e,t,n,r){var o=$d(e,"x","dropout");if(_f("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),_f(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof Ch?o.clone():o;var a=function(e,t){if(null==t)return e.shape.slice();if(Of(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(o,n),i=1-t,s=Lx(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function bC(e,t,n){for(var r=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var i=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(i)}return pp(o,"float32")}var xC,wC=sp({hannWindow_:function(e){return bC(e,.5,.5)}}),CC=sp({hammingWindow_:function(e){return bC(e,.54,.46)}}),EC=sp({frame_:function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+t<=e.size;)i.push(Ow(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=Sp([Ow(e,a,t-s),xp([s],o)]);i.push(u),a+=n}return 0===i.length?vp([],[0,t]):Sp(i).as2D(i.length,t)}}),SC=sp({stft_:function(e,t,n,r,o){var a;void 0===o&&(o=wC),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=EC(e,t,n),s=Kv(i,o(t)),u=[],l=0;l<i.shape[0];l++)u.push(hC(s.slice([l,0],[1,t]),r));return Sp(u)}}),kC=Object.freeze({hannWindow:wC,hammingWindow:CC,frame:EC,stft:SC});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(xC||(xC={}));var RC=sp({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=xC.SUM_BY_NONZERO_WEIGHTS);var o=$d(e,"labels","absoluteDifference"),a=$d(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=$d(n,"weights","absoluteDifference")),Nf(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return IC(s,i,r)}}),IC=sp({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=xC.SUM_BY_NONZERO_WEIGHTS);var r=$d(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=$d(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===xC.NONE)return a;if(n===xC.SUM)return a.sum();if(n===xC.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(dp(i)):s}if(n===xC.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(dp(r.size));var u=o.mul(yp(r.shape)).notEqual(dp(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),_C=sp({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=xC.SUM_BY_NONZERO_WEIGHTS);var a=$d(e,"labels","cosineDistance"),i=$d(t,"predictions","cosineDistance"),s=null;null!=r&&(s=$d(r,"weights","cosineDistance")),Nf(a.shape,i.shape,"Error in cosineDistance: ");var u=dp(1).sub(a.mul(i).sum(n,!0));return IC(u,s,o)}}),NC=sp({hingeLoss_:function(e,t,n,r){void 0===r&&(r=xC.SUM_BY_NONZERO_WEIGHTS);var o=$d(e,"labels","hingeLoss"),a=$d(t,"predictions","hingeLoss"),i=null;null!=n&&(i=$d(n,"weights","hingeLoss")),Nf(o.shape,a.shape,"Error in hingeLoss: ");var s=dp(1);o=dp(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return IC(u,i,r)}}),TC=sp({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=xC.SUM_BY_NONZERO_WEIGHTS);var a=$d(e,"labels","huberLoss"),i=$d(t,"predictions","huberLoss"),s=null;null!=n&&(s=$d(n,"weights","huberLoss")),Nf(a.shape,i.shape,"Error in huberLoss: ");var u=dp(r),l=i.sub(a).abs(),c=jv(l,u),f=l.sub(c),h=dp(.5).mul(c.square()).add(u.mul(f));return IC(h,s,o)}}),AC=sp({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=xC.SUM_BY_NONZERO_WEIGHTS);var a=$d(e,"labels","logLoss"),i=$d(t,"predictions","logLoss"),s=null;null!=n&&(s=$d(n,"weights","logLoss")),Nf(a.shape,i.shape,"Error in logLoss: ");var u=dp(1),l=dp(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return IC(c,s,o)}}),DC=sp({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=xC.SUM_BY_NONZERO_WEIGHTS);var o=$d(e,"labels","meanSquaredError"),a=$d(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=$d(n,"weights","meanSquaredError")),Nf(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return IC(s,i,r)}}),OC=sp({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=xC.SUM_BY_NONZERO_WEIGHTS);var a=$d(e,"multiClassLabels","sigmoidCrossEntropy"),i=$d(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=$d(n,"weights","sigmoidCrossEntropy")),Nf(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=dp(r),l=dp(1),c=dp(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var f=function(e,t){var n=$d(e,"labels","sigmoidCrossEntropyWithLogits"),r=$d(t,"logits","sigmoidCrossEntropyWithLogits");Nf(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return IC(f,s,o)}}),MC=sp({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=xC.SUM_BY_NONZERO_WEIGHTS);var a=$d(e,"onehotLabels","softmaxCrossEntropy"),i=$d(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=$d(n,"weights","softmaxCrossEntropy")),Nf(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=dp(r),l=dp(1),c=dp(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return dm(function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=ep(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(a,i);return IC(f,s,o)}}),FC=Object.freeze({get Reduction(){return xC},absoluteDifference:RC,computeWeightedLoss:IC,cosineDistance:_C,hingeLoss:NC,huberLoss:TC,logLoss:AC,meanSquaredError:DC,sigmoidCrossEntropy:OC,softmaxCrossEntropy:MC});function PC(e,t){return void 0===t&&(t=!1),Bh.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=xx(n),a=e.clone(),i=vp([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=o;t=Bh.tidy(function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=vp([[-1]]).where(l.greater(0),vp([[1]])),f=l.sub(c.mul(u)),h=t.div(f);s=1===h.shape[0]?i.clone():i.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var d=c.matMul(f).div(u).neg(),p=a.slice([e,0],[n-e,r]),v=d.mul(s),m=s.transpose();if(0===e)a=p.sub(v.matMul(m.matMul(p)));else{var g=p.sub(v.matMul(m.matMul(p)));a=a.slice([0,0],[e,r]).concat(g,0)}var y=v.transpose(),b=o.slice([0,e],[n,o.shape[1]-e]);if(0===e)o=b.sub(b.matMul(s).matMul(y));else{var x=b.sub(b.matMul(s).matMul(y));o=o.slice([0,0],[n,e]).concat(x,1)}return[s,a,o]}),s=t[0],a=t[1],o=t[2],Hd([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var LC=sp({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=$d(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),n<0&&(n=s);var u=wp(0,i,1,"int32").reshape([-1,1]),l=wp(0,s,1,"int32"),c=Jv(u,l),f=hx(c.lessEqual(dp(+t,"int32")),c.greaterEqual(dp(-n,"int32"))),h=bp([i,s],r.dtype);return zp(Wp(r.reshape([-1,i,s])).map(function(e){return mx(f,e,h)})).reshape(o)}}),BC=sp({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,_f(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){_f(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=Np(e,e.shape[0],0).map(function(e){return Bp(e,[0])});_f(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(e){a.push(Bh.tidy(function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=Xw(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(rC(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?zp(a,0):a}}),zC=sp({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return PC(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=Wp(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return r.forEach(function(e){var n=PC(e,t),r=n[0],i=n[1];o.push(r),a.push(i)}),[zp(o,0).reshape(e.shape),zp(a,0).reshape(e.shape)]}}),WC=Object.freeze({bandPart:LC,gramSchmidt:BC,qr:zC});function UC(e,t,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=e.shape[0];return n=Math.min(n,i),_f(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),_f(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),_f(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),_f(1===t.rank,function(){return"scores must be a 1D tensor"}),_f(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),_f(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var VC=sp({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=$d(e,"images","resizeBilinear");_f(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),_f(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Bh.runKernelFunc(function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)},{x:o},function(e,t){return{x:function(){return Bh.runKernelFunc(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),jC=sp({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=$d(e,"images","resizeNearestNeighbor");_f(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),_f(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),_f("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=Bh.runKernelFunc(function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return Bh.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),GC=sp({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=$d(e,"boxes","nonMaxSuppression"),i=$d(t,"scores","nonMaxSuppression"),s=UC(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return Bh.runKernelFunc(function(e){return e.nonMaxSuppression(a,i,n,r,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),HC=sp({nonMaxSuppressionWithScore_:function(e,t,n,r,o,a){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=$d(e,"boxes","nonMaxSuppression"),s=$d(t,"scores","nonMaxSuppression"),u=UC(i,s,n,r,o,a),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=Bh.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),qC=sp({cropAndResize_:function(e,t,n,r,o,a){var i=$d(e,"image","cropAndResize"),s=$d(t,"boxes","cropAndResize","float32"),u=$d(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return _f(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),_f(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),_f(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),_f(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),_f(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),_f("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),Bh.runKernelFunc(function(e,t){return e.cropAndResize(i,s,u,r,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),KC=Object.freeze({resizeBilinear:VC,resizeNearestNeighbor:jC,nonMaxSuppression:GC,nonMaxSuppressionAsync:function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),ff(this,void 0,void 0,function(){var a,i,s,u,l,c,f;return hf(this,function(h){switch(h.label){case 0:return a=$d(e,"boxes","nonMaxSuppressionAsync"),i=$d(t,"scores","nonMaxSuppressionAsync"),s=UC(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=h.sent(),l=u[0],c=u[1],f=Um(l,c,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,f]}})})},nonMaxSuppressionWithScore:HC,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,o,a){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),ff(this,void 0,void 0,function(){var i,s,u,l,c,f,h;return hf(this,function(d){switch(d.label){case 0:return i=$d(e,"boxes","nonMaxSuppressionAsync"),s=$d(t,"scores","nonMaxSuppressionAsync"),u=UC(i,s,n,r,o,a),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=d.sent(),c=l[0],f=l[1],h=Vm(c,f,n,r,o,a),i!==e&&i.dispose(),s!==t&&s.dispose(),[2,h]}})})},cropAndResize:qC}),XC=function(e,t){return!(e>0)||"linear"===t},$C=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},YC=function(e,t){var n=t,r=tv(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},QC=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Zw(e);if("elu"===t)return Yw(e);if("relu6"===t)return eC(e);if("prelu"===t)return Jw(e,n);throw new Error("Unknown fused activation "+t+".")},JC=sp({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,a=void 0!==o&&o,i=e.transposeB,s=void 0!==i&&i,u=e.bias,l=e.activation,c=void 0===l?"linear":l,f=e.preluActivationWeights;if(!1===XC(Bh.state.gradientDepth,c)){var h=gw(n,r,a,s);return null!=u&&(h=Zp(h,u)),QC(h,c,f)}var d=$d(n,"a","fused matMul"),p=$d(r,"b","fused matMul");t=Dh(d,p),d=t[0],p=t[1];var v=a?d.shape[d.rank-2]:d.shape[d.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=a?d.shape[d.rank-1]:d.shape[d.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=d.shape.slice(0,-2),x=p.shape.slice(0,-2),w=Df(b),C=Df(x);_f(d.rank>=2&&p.rank>=2&&d.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."}),_f(Of(b,x),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."}),_f(v===m,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var E,S,k=d.shape.slice(0,-2).concat([g,y]),R=a?d.as3D(w,v,g):d.as3D(w,g,v),I=s?p.as3D(C,y,m):p.as3D(C,m,y);null!=u&&nv(k,(E=Dh(E=$d(u,"bias","fused matMul"),d)[0]).shape),null!=f&&(S=$d(f,"prelu weights","fused matMul"));var _={a:R,b:I};null!=u&&(_.bias=E),null!=f&&(_.preluActivationWeights=S);var N=[R,I];return Bh.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:R,b:I,transposeA:a,transposeB:s,bias:E,activation:c,preluActivationWeights:S});return t([R,I,n]),n},_,function(e,t){var n=t[0],r=t[1],o=t[2],i=$C(e,o,c),l={};return null!=u&&(l={bias:function(){return YC(E,i)}}),a||s?!a&&s?Object.assign({a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}},l):a&&!s?Object.assign({a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}},l):Object.assign({a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}},l):Object.assign({a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},l)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:c},N,[!0]).reshape(k)}}),ZC=sp({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,h=void 0===f?"linear":f,d=e.preluActivationWeights;if(h=h||"linear",!1===XC(Bh.state.gradientDepth,h)){var p=sw(t,n,r,o,i,u,l);return null!=c&&(p=Zp(p,c)),QC(p,h,d)}var v=$d(t,"x","conv2d"),m=$d(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),_f(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),_f(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=l&&_f(Mf(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),_f(g.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),_f(Tm(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),_f("NHWC"===i,function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var b,x,w=Cm(g.shape,m.shape,r,u,o,l);null!=c&&(b=Dh(b=$d(c,"bias","fused conv2d"),v)[0],nv(w.outShape,b.shape)),null!=d&&(x=$d(d,"prelu weights","fused conv2d"));var C={x:g,filter:m};null!=c&&(C.bias=b),null!=d&&(C.preluActivationWeights=x);var E=[m,g],S=Bh.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:g,filter:m,convInfo:w,bias:b,activation:h,preluActivationWeights:x});return t([m,g,n]),n},C,function(e,t){var n=t,a=n[0],i=n[1],s=n[2],l=$C(e,s,h);_f(Nm(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var f={};return null!=c&&(f={bias:function(){return YC(b,l)}}),Object.assign({x:function(){return cw(i.shape,l,a,r,o)},filter:function(){return lw(i,l,a.shape,r,o)}},f)},"FusedConv2D",{convInfo:w,activation:h},E,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),eE=sp({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,f=e.activation,h=void 0===f?"linear":f,d=e.preluActivationWeights;if(!1===XC(Bh.state.gradientDepth,h)){var p=fw(t,n,r,o,i,u,l);return null!=c&&(p=Zp(p,c)),QC(p,h,d)}var v=$d(t,"x","depthwiseConv2d"),m=$d(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),_f(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),_f(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),_f(g.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==u&&(u=[1,1]),_f(Tm(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=l&&_f(Mf(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var b,x,w=Cm(g.shape,m.shape,r,u,o,l,!0);null!=c&&(b=Dh(b=$d(c,"bias","fused conv2d"),v)[0],nv(w.outShape,b.shape)),null!=d&&(x=$d(d,"prelu weights","fused depthwiseConv2d"));var C={x:g,filter:m};null!=c&&(C.bias=b),null!=d&&(C.preluActivationWeights=x);var E=[m,g],S=Bh.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:b,activation:h,preluActivationWeights:x});return t([m,g,n]),n},C,function(e,t){_f(Nm(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=t[0],r=t[1],o=t[2],a=$C(e,o,h),i={};return null!=c&&(i={bias:function(){return YC(b,a)}}),Object.assign({x:function(){return hw(r.shape,a,n,w)},filter:function(){return dw(r,a,n.shape,w)}},i)},"FusedDepthwiseConv2D",{convInfo:w,activation:h},E,[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),tE=Object.freeze({matMul:JC,conv2d:ZC,depthwiseConv2d:eE}),nE=Object.freeze({image:KC,linalg:WC,losses:FC,spectral:pC,fused:tE,signal:kC,add:Zp,addN:Xb,batchNorm:ex,batchNormalization:Zb,batchNorm2d:rx,batchNormalization2d:nx,batchNorm3d:ix,batchNormalization3d:ax,batchNorm4d:lx,batchNormalization4d:ux,broadcastTo:cx,clone:fx,div:em,divNoNan:yx,eye:xx,multinomial:wx,oneHot:Cx,pad:Ex,pad1d:Sx,pad2d:kx,pad3d:Rx,pad4d:Ix,rand:_x,randomGamma:Fx,randomNormal:Px,randomUniform:Lx,square:Bx,squaredDifference:zx,tile:bx,truncatedNormal:Wx,conv1d:iw,conv2d:sw,conv3d:uw,depthwiseConv2d:fw,separableConv2d:pw,conv2dTranspose:vw,conv3dTranspose:mw,op:sp,booleanMaskAsync:function(e,t,n){return ff(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,h,d,p,v;return hf(this,function(m){switch(m.label){case 0:for(r=$d(e,"tensor","boolMask"),o=$d(t,"mask","boolMask","bool"),a=null==n?0:n,i=o.rank,s=r.shape,_f(i>0,function(){return"mask cannot be scalar"}),Nf(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+i;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+i)),f=r.reshape(c),h=o.reshape([-1]),[4,gx(h)];case 1:return d=m.sent(),p=d.squeeze([1]),v=tw(f,p,a),e!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),f.dispose(),h.dispose(),d.dispose(),[2,v]}})})},complex:up,real:lp,imag:cp,concat:Sp,concat1d:kp,concat2d:Rp,concat3d:Ip,concat4d:_p,split:Np,matMul:gw,dot:yw,outerProduct:bw,reverse:xw,reverse1d:ww,reverse2d:Cw,reverse3d:Ew,reverse4d:Sw,maxPool:Iw,avgPool:_w,pool:Nw,maxPool3d:Tw,avgPool3d:Aw,maxPoolWithArgmax:Dw,slice:Ow,slice1d:Mw,slice2d:Fw,slice3d:Pw,slice4d:Lw,abs:rv,acos:ov,acosh:av,asin:iv,asinh:sv,atan:uv,atanh:lv,ceil:cv,clipByValue:fv,cos:hv,cosh:dv,erf:pv,exp:vv,expm1:mv,floor:gv,log:yv,log1p:bv,logSigmoid:xv,neg:wv,reciprocal:Cv,round:Ev,rsqrt:Sv,sigmoid:kv,sign:Rv,isNaN:Iv,isInf:_v,isFinite:Nv,sin:Tv,sinh:Av,softplus:Dv,sqrt:Ov,step:Mv,tan:Fv,tanh:Pv,all:zw,any:Ww,argMax:Uw,argMin:Vw,logSumExp:jw,max:Gw,mean:Hw,min:qw,moments:Kw,sum:Xw,prod:$w,equal:Ux,equalStrict:Vx,greater:jx,greaterEqual:Gx,greaterEqualStrict:Hx,greaterStrict:qx,less:Kx,lessEqual:Xx,lessEqualStrict:$x,lessStrict:Yx,notEqual:Qx,notEqualStrict:Jx,addStrict:Lv,atan2:Bv,divStrict:zv,floorDiv:Wv,maximum:Uv,maximumStrict:Vv,minimum:jv,minimumStrict:Gv,mod:Hv,modStrict:qv,mul:Kv,mulStrict:Xv,pow:$v,powStrict:Yv,squaredDifferenceStrict:Qv,sub:Jv,subStrict:Zv,elu:Yw,leakyRelu:Qw,prelu:Jw,relu:Zw,relu6:eC,selu:tC,logicalAnd:hx,logicalNot:dx,logicalOr:px,logicalXor:vx,where:mx,whereAsync:gx,buffer:Tp,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Ap,cast:Dp,cumsum:Op,depthToSpace:Mp,expandDims:Fp,reshape:Pp,spaceToBatchND:Lp,squeeze:Bp,stack:zp,unstack:Wp,setdiff1dAsync:function(e,t){return ff(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f;return hf(this,function(h){switch(h.label){case 0:return n=$d(e,"x","setdiff1d"),r=$d(t,"y","setdiff1d"),_f(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),_f(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),_f(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(a=h.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new yh([s],n.dtype),l=new yh([s],"int32"),c=0,f=0;c<o.length;c++)i.has(o[c])||(u.values[f]=o[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})},fill:xp,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Bh.runKernelFunc(function(r){return r.linspace(e,t,n)},{})},ones:yp,range:wp,scalar:dp,tensor:fp,tensor1d:pp,tensor2d:vp,tensor3d:mp,tensor4d:gp,tensor5d:function(e,t,n){if(Tf(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Kd(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return hp(e,t,r,n)},tensor6d:function(e,t,n){if(Tf(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Kd(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return hp(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),Bh.makeVariable(e,t,n,r)},zeros:bp,onesLike:Cp,zerosLike:Ep,transpose:mm,softmax:pm,logSoftmax:vm,localResponseNormalization:nC,norm:rC,gather:tw,unsortedSegmentSum:nw,basicLSTMCell:oC,multiRNNCell:aC,movingAverage:iC,stridedSlice:sC,topk:uC,scatterND:lC,fft:cC,ifft:fC,rfft:hC,irfft:dC,sparseToDense:vC,gatherND:mC,diag:gC,dropout:yC,hannWindow:wC,hammingWindow:CC,frame:EC,stft:SC,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),ff(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f,h,d,p,v,m;return hf(this,function(g){switch(g.label){case 0:return r=$d(e,"predictions","inTopK"),o=$d(t,"targets","inTopK"),_f(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),_f(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Nf(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],_f(n>0&&n<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n}),[4,r.data()];case 1:return i=g.sent(),[4,o.data()];case 2:for(s=g.sent(),u=[i.length/a,a],c=u[1],f=Vf("bool",l=u[0]),h=0;h<l;h++){for(d=h*c,p=i.subarray(d,d+c),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(e,t){return t.value-e.value}),f[h]=0,m=0;m<n;m++)if(v[m].index===s[h]){f[h]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,fp(f,o.shape,"bool")]}})})}});function rE(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&_f("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function oE(e,t,n,r,o,a){for(var i=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,l=o.dilationWidth,c=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=o.padInfo.top,d=o.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Tp(o.outShape,n),m=v.values,g=o.outShape[1]*o.outShape[2]*o.outShape[3],y=o.outShape[2]*o.outShape[3],b=o.outShape[3],x=0;x<o.batchSize;++x)for(var w=x*g,C=x*r[0],E=0;E<o.inChannels;++E)for(var S=0;S<o.outHeight;++S)for(var k=S*i-h,R=Math.max(0,k),I=Math.min(o.inHeight,c+k),_=w+S*y,N=0;N<o.outWidth;++N){for(var T=N*s-d,A=Math.max(0,T),D=Math.min(o.inWidth,f+T),O=p,M=0,F=0,P=R;P<I;P+=u){for(var L=C+P*r[1],B=A;B<D;B+=l){var z=e[L+B*r[2]+E];"max"===a&&z>O?O=z:"avg"===a&&(M+=z,F++)}if(isNaN(O))break}m[_+N*b+E]="avg"===a?M/F:O}return v}function aE(e,t,n,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);for(var i=Tp(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,v=Tp(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,x=b;x<0;)x+=l;for(var w=Math.min(r.inHeight,f+b),C=0;C<r.outWidth;++C){for(var E=C*u-p,S=E;S<0;)S+=c;for(var k=Math.min(r.inWidth,h+E),R=Number.NEGATIVE_INFINITY,I=-1,_=x;_<w;_+=l)for(var N=_-b,T=S;T<k;T+=c){var A=T-E,D=v.get(m,_,T,g);D>R&&(R=D,I=o?a?((m*r.inHeight+_)*r.inWidth+T)*r.inChannels+g:(_*r.inWidth+T)*r.inChannels+g:N*h+A)}i.set(I,m,y,C,g)}}return i}function iE(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var sE=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new gm(t,Bh),t}return cf(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,pf().get("IS_NODE")&&qd("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Fm(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return ch(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Tp(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return Bh.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return ff(this,void 0,void 0,function(){var t;return hf(this,function(n){return t=sh(),e(),[2,{kernelMs:sh()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:Bh.keep(e.clone()),imag:Bh.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(rE(e,"slice"),fm(e.shape,t,n)){var r=hm(t,e.strides),o=Df(n);return fp(this.readSync(e.dataId).subarray(r,r+o),n,e.dtype)}for(var a=Tp(n,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(e,n){return e+t[n]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){rE(e,"stridedSlice");var o=um(t,n,r);if(o.some(function(e){return 0===e}))return fp([],o);for(var a=Tp(o,e.dtype),i=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[c]*r[c]+t[c];a.set.apply(a,[i.get.apply(i,l)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Tp([e.size,e.size],e.dtype),r=n.values,o=0;o<t.length;o++)r[o*e.size+o]=t[o];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.reverse=function(e,t){rE(e,"reverse");for(var n=Tp(e.shape,e.dtype),r=this.bufferSync(e),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map(function(e){return lp(e)}),o=e.map(function(e){return cp(e)});return up(this.concat(r,t),this.concat(o,t))}var a=e.map(function(e){var n=Df(e.shape.slice(t));return e.as2D(-1,n)}),i=ip(a.map(function(e){return e.shape}),1),s=Tp(i,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach(function(e){s.set(n.readSync(e.dataId),u),u+=e.size})}else{var l=0;a.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,o=0;o<e.shape[0];++o)for(var a=o*i[1]+l,u=0;u<e.shape[1];++u)s[a+u]=t[r++];l+=e.shape[1]})}var c=ip(e.map(function(e){return e.shape}),t);return fp(s,c,e[0].dtype)},t.prototype.neg=function(e){return rE(e,"neg"),this.multiply(dp(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,Th(e.dtype,t.dtype),function(e,t){return e+t})},t.prototype.addN=function(e){var t=this;rE(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=Tp(e[0].shape,e[0].dtype),o=r.values,a=0;a<e.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=Wf([t],e.shape),r=this.max(e,n),o=ep(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return em(i,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,Th(e.dtype,t.dtype),function(e,t){return e-t})},t.prototype.pow=function(e,t){return rE([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,n,r){rE([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=c[0],h=c[1],d=c[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=p[0],m=p[1],g=p[2],y=a*i,b=Tp([s,a,i],e.dtype),x=b.values,w=this.blockSize,C=0;C<s;C++)for(var E=0;E<a;E+=w)for(var S=0;S<i;S+=w)for(var k=0;k<o;k+=w)for(var R=Math.min(E+w,a),I=Math.min(S+w,i),_=Math.min(k+w,o),N=E;N<R;N++)for(var T=S;T<I;T++){for(var A=0,D=k;D<_;D++)A+=u[C*f+N*h+D*d]*l[D*v+T*m+C*g];x[C*y+(N*i+T)]+=A}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,o);return a&&(u=this.add(u,a)),i&&(u=iE(this,u,i,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,Th(e.dtype,t.dtype),function(e,t){return e*t})},t.prototype.floorDiv=function(e,t){return rE([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){rE(e,"sum"),tp("sum",t,e.rank);for(var n=Zd(e.shape,t),r=n[0],o=n[1],a=bp(r,Th(e.dtype,"int32")),i=Df(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=0,h=0;h<i;++h)f+=u[c+h];s[l]=f}return a},t.prototype.prod=function(e,t){rE(e,"sum");for(var n=Zd(e.shape,t),r=n[0],o=n[1],a=bp(r,Th(e.dtype,"int32")),i=Df(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=1,h=0;h<i;++h)f*=u[c+h];s[l]=f}return a},t.prototype.unsortedSegmentSum=function(e,t,n){rE(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=dp(a,"int32"),s=Ux(i,t).asType("float32").mul(e).sum(0);r.push(s)}return zp(r)},t.prototype.argMin=function(e,t){rE(e,"argMin");var n=[t];tp("argMin",n,e.rank);for(var r=Zd(e.shape,n),o=r[0],a=r[1],i=bp(o,"int32"),s=Df(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,h=l[f],d=0,p=0;p<s;++p){var v=l[f+p];v<h&&(h=v,d=p)}u[c]=d}return i},t.prototype.argMax=function(e,t){rE(e,"argMax");var n=[t];tp("argMax",n,e.rank);for(var r=Zd(e.shape,n),o=r[0],a=r[1],i=bp(o,"int32"),s=Df(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var f=c*s,h=l[f],d=0,p=0;p<s;++p){var v=l[f+p];v>h&&(h=v,d=p)}u[c]=d}return i},t.prototype.cumsum=function(e,t,n,r){if(rE(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=Th(e.dtype,"int32"),a=bp(e.shape,o),i=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var f=0;f<u;f++){var h=l(c,f);if(0===f)i[h]=n?0:s[h];else{var d=l(c,f-1);i[h]=n?s[d]+i[d]:s[h]+i[d]}}return a},t.prototype.equal=function(e,t){return rE([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return rE([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return rE([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return rE([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return rE([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return rE([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalNot=function(e){rE(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return rE([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return rE([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,n){rE([e,t,n],"select");for(var r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(n.dataId),i=bp(t.shape,Th(t.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:Df(t.shape.slice(1)),c=0;c<r.length;c++)for(var f=0;f<l;f++)1===r[c]?s[u++]=o[c]:s[u++]=a[c];return i},t.prototype.where=function(e){rE([e],"where");var t=this.readSync(e.dataId);return Ym(e.shape,t)},t.prototype.topk=function(e,t,n){return rE(e,"topk"),$m(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){rE(e,"min"),tp("min",t,e.rank);for(var n=Zd(e.shape,t),r=n[0],o=n[1],a=bp(r,e.dtype),i=Df(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];d<f&&(f=d)}s[l]=f}return a},t.prototype.minimum=function(e,t){return rE([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return rE([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},t.prototype.max=function(e,t){rE(e,"max"),tp("max",t,e.rank);for(var n=Zd(e.shape,t),r=n[0],o=n[1],a=bp(r,e.dtype),i=Df(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];d>f&&(f=d)}s[l]=f}return a},t.prototype.maximum=function(e,t){return rE([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){rE(e,"all"),tp("all",t,e.rank);for(var n=Zd(e.shape,t),r=n[0],o=n[1],a=bp(r,e.dtype),i=Df(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];f=f&&d}s[l]=f}return a},t.prototype.any=function(e,t){rE(e,"any"),tp("any",t,e.rank);for(var n=Zd(e.shape,t),r=n[0],o=n[1],a=bp(r,e.dtype),i=Df(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,f=u[c],h=0;h<i;++h){var d=u[c+h];f=f||d}s[l]=f}return a},t.prototype.squaredDifference=function(e,t){return rE([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},t.prototype.ceil=function(e){rE(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){rE(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){rE(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){rE(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){rE(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){rE(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){rE(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){rE(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){rE(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){rE(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){rE(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){rE(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){rE(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){rE(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){rE(e,"relu");for(var t=bp(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},t.prototype.relu6=function(e){rE(e,"relu");for(var t=bp(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return t},t.prototype.prelu=function(e,t){return rE([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.elu=function(e){rE(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){rE([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){rE(e,"selu");for(var t=ub,n=lb,r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?n*i:t*(Math.exp(i)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){rE(e,"clip");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){rE(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){rE(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){rE(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){rE(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){rE(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){rE(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){rE(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){rE(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){rE(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return rE([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.sinh=function(e){rE(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){rE(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){rE(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Ff(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){rE(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){rE(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){rE(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){rE(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),a=Math.abs(n[r]),i=1/(1+.3275911*a);t[r]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),rE(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.conv2d(t,n,r);return o&&(s=this.add(s,o)),a&&(s=iE(this,s,a,i)),s},t.prototype.conv2d=function(e,t,n){rE([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l="channelsLast"===n.dataFormat,c=Tp(n.outShape,e.dtype),f=e.strides[0],h=l?e.strides[1]:e.strides[2],d=l?e.strides[2]:1,p=l?1:e.strides[1],v=c.strides[0],m=l?c.strides[1]:c.strides[2],g=l?c.strides[2]:1,y=l?1:c.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=c.values,C=0;C<n.batchSize;++C)for(var E=C*f,S=C*v,k=0;k<n.outHeight;++k)for(var R=S+k*m,I=k*n.strideHeight-u,_=0;_<r;_++){var N=I+_*a;if(!(N<0||N>=n.inHeight))for(var T=_*t.strides[0],A=E+N*h,D=0;D<n.outWidth;++D)for(var O=R+D*g,M=D*n.strideWidth-s,F=0;F<o;F++){var P=M+F*i;if(!(P<0||P>=n.inWidth))for(var L=A+P*d,B=T+F*t.strides[1],z=0;z<n.inChannels;++z){for(var W=b[L+z*p],U=0;U<n.outChannels;++U)w[O+U*y]+=W*x[B+U];B+=n.outChannels}}}return c.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,f=n.padInfo.top,h=Tp(n.outShape,e.dtype),d=this.readSync(e.dataId),p=this.readSync(t.dataId),v=h.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*h.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*h.strides[1],w=b*n.strideDepth-l,C=0;C<r;C++){var E=w+C*i;if(!(E<0||E>=n.inDepth))for(var S=C*t.strides[0],k=g+E*e.strides[1],R=0;R<n.outHeight;++R)for(var I=x+R*h.strides[2],_=R*n.strideHeight-f,N=0;N<o;N++){var T=_+N*s;if(!(T<0||T>=n.inHeight))for(var A=S+N*t.strides[1],D=k+T*e.strides[2],O=0;O<n.outWidth;++O)for(var M=I+O*n.outChannels,F=O*n.strideWidth-c,P=0;P<a;P++){var L=F+P*u;if(!(L<0||L>=n.inWidth))for(var B=A+P*t.strides[2],z=D+L*n.inChannels,W=B,U=0;U<n.inChannels;++U){for(var V=d[z+U],j=0;j<n.outChannels;++j)v[M+j]+=V*p[W+j];W+=n.outChannels}}}}return h.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){rE([e,t],"conv2dDerInput");for(var r=Tp(n.inShape,"float32"),o=r.values,a=this.readSync(e.dataId),i=this.readSync(t.dataId),s=t.strides,u=s[0],l=s[1],c=s[2],f=n.batchSize,h=n.filterHeight,d=n.filterWidth,p=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,C=n.dataFormat,E=h-1-n.padInfo.top,S=d-1-n.padInfo.left,k="channelsLast"===C,R=r.strides[0],I=k?r.strides[1]:r.strides[2],_=k?r.strides[2]:1,N=k?1:r.strides[1],T=e.strides[0],A=k?e.strides[1]:e.strides[2],D=k?e.strides[2]:1,O=k?1:e.strides[1],M=0;M<f;++M)for(var F=0;F<p;++F)for(var P=0;P<v;++P)for(var L=P-E,B=Math.max(0,Math.ceil(L/x)),z=Math.min(y,(h+L)/x),W=0;W<m;++W){for(var U=W-S,V=Math.max(0,Math.ceil(U/w)),j=Math.min(b,(d+U)/w),G=0,H=B;H<z;++H)for(var q=H*x-L,K=V;K<j;++K)for(var X=T*M+A*H+D*K,$=u*(h-1-q)+l*(d-1-(K*w-U))+c*F,Y=0;Y<g;++Y)G+=a[X+O*Y]*i[$+Y];o[R*M+I*P+_*W+N*F]=G}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Tp(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=this.readSync(e.dataId),f=e.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],C=n.batchSize,E=n.filterDepth,S=n.filterHeight,k=n.filterWidth,R=n.inChannels,I=n.inDepth,_=n.inHeight,N=n.inWidth,T=n.outChannels,A=n.outDepth,D=n.outHeight,O=n.outWidth,M=n.strideDepth,F=n.strideHeight,P=n.strideWidth,L=E-1-n.padInfo.front,B=S-1-n.padInfo.top,z=k-1-n.padInfo.left,W=0;W<C;++W)for(var U=0;U<R;++U)for(var V=0;V<I;++V)for(var j=V-L,G=Math.max(0,Math.ceil(j/M)),H=Math.min(A,(E+j)/M),q=0;q<_;++q)for(var K=q-B,X=Math.max(0,Math.ceil(K/F)),$=Math.min(D,(S+K)/F),Y=0;Y<N;++Y){for(var Q=Y-z,J=Math.max(0,Math.ceil(Q/P)),Z=Math.min(O,(k+Q)/P),ee=0,te=G;te<H;++te)for(var ne=te*M-j,re=X;re<$;++re)for(var oe=re*F-K,ae=J;ae<Z;++ae)for(var ie=h*W+d*te+p*re+v*ae,se=y*(E-1-ne)+b*(S-1-oe)+x*(k-1-(ae*P-Q))+w*U,ue=0;ue<T;++ue)ee+=c[ie+ue]*m[se+ue];o[i*W+s*V+u*q+l*Y+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){rE([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s="channelsLast"===n.dataFormat,u=Tp(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,f=this.bufferSync(e),h=this.bufferSync(t),d=0;d<a;++d)for(var p=Math.max(0,Math.ceil((c-d)/r)),v=Math.min(n.outHeight,(n.inHeight+c-d)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((l-m)/o)),y=Math.min(n.outWidth,(n.inWidth+l-m)/o),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,C=0;C<n.batchSize;++C)for(var E=p;E<v;++E)for(var S=d+E*r-c,k=g;k<y;++k){var R=m+k*o-l;w+=s?f.get(C,S,R,b)*h.get(C,E,k,x):f.get(C,b,S,R)*h.get(C,x,E,k)}u.set(w,d,m,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=Tp(n.filterShape,"float32"),c=l.values,f=l.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],C=this.readSync(e.dataId),E=e.strides,S=E[0],k=E[1],R=E[2],I=E[3],_=n.padInfo.front,N=n.padInfo.left,T=n.padInfo.top,A=0;A<i;++A)for(var D=Math.max(0,Math.ceil((_-A)/r)),O=Math.min(n.outDepth,(n.inDepth+_-A)/r),M=A*h,F=0;F<s;++F)for(var P=Math.max(0,Math.ceil((T-F)/o)),L=Math.min(n.outHeight,(n.inHeight+T-F)/o),B=F*d+M,z=0;z<u;++z)for(var W=Math.max(0,Math.ceil((N-z)/a)),U=Math.min(n.outWidth,(n.inWidth+N-z)/a),V=z*p+B,j=0;j<n.inChannels;++j)for(var G=j*v+V,H=0;H<n.outChannels;++H){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*S,$=K*y,Y=D;Y<O;++Y)for(var Q=(A+Y*r-_)*k+X,J=Y*b+$,Z=P;Z<L;++Z)for(var ee=(F+Z*o-T)*R+Q,te=Z*x+J,ne=W;ne<U;++ne){var re=ne*w+te;q+=C[(z+ne*a-N)*I+ee+j]*m[re+H]}c[G+H]=q}return l.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return o&&(s=this.add(s,o)),a&&(s=iE(this,s,a,i)),s},t.prototype.depthwiseConv2D=function(e,t,n){rE([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=Tp(n.outShape,e.dtype),f=this.readSync(e.dataId),h=this.readSync(t.dataId),d=c.values,p=0;p<n.batchSize;++p)for(var v=p*e.strides[0],m=p*c.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*c.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var C=x*t.strides[0],E=v+w*e.strides[1],S=0;S<n.outWidth;++S)for(var k=y+S*c.strides[2],R=S*n.strideWidth-u,I=0;I<o;++I){var _=R+I*i;if(!(_<0||_>=n.inWidth))for(var N=C+I*t.strides[1],T=E+_*n.inChannels,A=k,D=N,O=0;O<n.inChannels;++O){for(var M=f[T+O],F=0;F<l;++F)d[A+F]+=M*h[D+F];A+=l,D+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){rE([e,t],"depthwiseConv2DDerInput");for(var r=Tp(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=this.readSync(e.dataId),c=e.strides,f=c[0],h=c[1],d=c[2],p=this.readSync(t.dataId),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,C=n.inChannels,E=n.inHeight,S=n.inWidth,k=n.outChannels,R=n.outHeight,I=n.outWidth,_=n.strideHeight,N=n.strideWidth,T=x-1-n.padInfo.top,A=w-1-n.padInfo.left,D=k/C,O=0;O<b;++O)for(var M=0;M<C;++M)for(var F=0;F<E;++F)for(var P=F-T,L=Math.max(0,Math.ceil(P/_)),B=Math.min(R,(x+P)/_),z=0;z<S;++z){for(var W=z-A,U=Math.max(0,Math.ceil(W/N)),V=Math.min(I,(w+W)/N),j=0,G=L;G<B;++G)for(var H=G*_-P,q=U;q<V;++q)for(var K=f*O+h*G+d*q,X=m*(x-1-H)+g*(w-1-(q*N-W))+y*M,$=0;$<D;++$)j+=l[K+(M*D+$)]*p[X+$];o[i*O+s*F+u*z+M]=j}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){rE([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Tp(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,f=this.bufferSync(e),h=this.bufferSync(t),d=0;d<a;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),v=Math.min(n.outHeight,(n.inHeight+l-d)/r),m=0;m<i;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/c),w=b%c,C=0,E=0;E<n.batchSize;++E)for(var S=p;S<v;++S)for(var k=d+S*r-l,R=g;R<y;++R){var I=m+R*o-u;C+=f.get(E,k,I,x)*h.get(E,S,R,b)}s.set(C,d,m,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return rE(e,"tile"),Xm(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){rE(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),a=this.bufferSync(e),i=Tp(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map(function(e,t){return e+o[t]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},t.prototype.gather=function(e,t,n){rE([e,t],"gather");var r=e.shape.slice(),o=this.readSync(t.dataId);r[n]=o.length;for(var a=Tp(r,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){rE([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=Up(e.shape,t,r),a=Vp(o.length,t.length),i=jp(e.shape,t,r),s=Gp(n,t.length),u=Hp(i,n,t.length);return mm(e.reshape(o),a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){rE([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Up(i.shape,t,r,!1),u=Vp(s.length,t.length,!1),l=jp(i.shape,t,r,!1);return mm(i.reshape(s),u).reshape(l)},t.prototype.maxPool=function(e,t){return rE(e,"maxPool"),oE(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){rE([t,n],"maxPoolBackprop");for(var o=this.readSync(t.dataId),a=Tp(r.outShape,t.dtype,aE(o,t.shape,t.dtype,r).values),i=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,f=r.effectiveFilterWidth,h=f-1-r.padInfo.left,d=c-1-r.padInfo.top,p=Tp(t.shape,"float32"),v=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-d,w=b-h,C=0,E=0;E<c;E+=u){var S=(x+E)/i;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var k=0;k<f;k+=l){var R=(w+k)/s;if(!(R<0||R>=r.outWidth||Math.floor(R)!==R)){var I=c*f-1-a.get(m,S,R,g)===E*f+k?1:0;0!==I&&(C+=v.get(m,S,R,g)*I)}}}p.set(C,m,y,b,g)}return p.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){rE([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,f=c-1-n.padInfo.left,h=l-1-n.padInfo.top,d=Tp(t.shape,"float32"),p=1/(a*i),v=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-h,w=b-f,C=0,E=0;E<l;E+=s){var S=(x+E)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var R=(w+k)/o;R<0||R>=n.outWidth||Math.floor(R)!==R||(C+=v.get(m,S,R,g))}}d.set(C*p,m,y,b,g)}return d.toTensor()},t.prototype.pool3d=function(e,t,n){rE(e,"pool3d");for(var r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=Tp(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],C=t.outShape[4],E=0;E<t.batchSize;++E)for(var S=E*b,k=E*e.strides[0],R=0;R<t.inChannels;++R)for(var I=0;I<t.outDepth;++I){for(var _=I*r-h,N=_;N<0;)N+=i;for(var T=Math.min(t.inDepth,l+_),A=S+I*x,D=0;D<t.outHeight;++D){for(var O=D*o-d,M=O;M<0;)M+=s;for(var F=Math.min(t.inHeight,c+O),P=A+D*w,L=0;L<t.outWidth;++L){for(var B=L*a-p,z=B;z<0;)z+=u;for(var W=Math.min(t.inWidth,f+B),U=P+L*C,V=v,j=0,G=0,H=N;H<T;H+=i){for(var q=k+H*e.strides[1],K=M;K<F;K+=s){for(var X=q+K*e.strides[2],$=z;$<W;$+=u){var Y=m[X+$*e.strides[3]+R];if("max"===n&&Y>V?V=Y:"avg"===n&&(j+=Y,G++),isNaN(V))break}if(isNaN(V))break}if(isNaN(V))break}y[U+R]="avg"===n?j/G:V}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return rE(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){rE([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=n.dilationDepth,c=n.dilationHeight,f=n.dilationWidth,h=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=h-1-n.padInfo.front,m=p-1-n.padInfo.left,g=d-1-n.padInfo.top,y=Tp(t.shape,"float32"),b=1/(i*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var C=0;C<n.inChannels;++C)for(var E=0;E<n.inDepth;++E)for(var S=0;S<n.inHeight;++S)for(var k=0;k<n.inWidth;++k){for(var R=E-v,I=S-g,_=k-m,N=0,T=0;T<h;T+=l){var A=(R+T)/r;if(!(A<0||A>=n.outDepth||Math.floor(A)!==A))for(var D=0;D<d;D+=c){var O=(I+D)/o;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var M=0;M<p;M+=f){var F=(_+M)/a;F<0||F>=n.outWidth||Math.floor(F)!==F||(N+=x.get(w,A,O,F,C))}}}y.set(N*b,w,E,S,k,C)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return rE(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Tp(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-h,x=b;x<0;)x+=i;for(var w=Math.min(t.inDepth,l+b),C=0;C<t.outHeight;++C){for(var E=C*o-d,S=E;S<0;)S+=s;for(var k=Math.min(t.inHeight,c+E),R=0;R<t.outWidth;++R){for(var I=R*a-p,_=I;_<0;)_+=u;for(var N=Math.min(t.inWidth,f+I),T=Number.NEGATIVE_INFINITY,A=-1,D=x;D<w;D+=i)for(var O=D-b,M=S;M<k;M+=s)for(var F=M-E,P=_;P<N;P+=u){var L=P-I,B=v.get(m,D,M,P,g);B>=T&&(T=B,A=O*c*f+F*c+L)}n.set(A,m,y,C,R,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){rE([t,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(t,r),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=f-1-r.padInfo.front,v=d-1-r.padInfo.left,m=h-1-r.padInfo.top,g=Tp(t.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var C=0;C<r.inDepth;++C)for(var E=0;E<r.inHeight;++E)for(var S=0;S<r.inWidth;++S){for(var k=C-p,R=E-m,I=S-v,_=0,N=0;N<f;N+=u){var T=(k+N)/a;if(!(T<0||T>=r.outDepth||Math.floor(T)!==T))for(var A=0;A<h;A+=l){var D=(R+A)/i;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var O=0;O<d;O+=c){var M=(I+O)/s;if(!(M<0||M>=r.outWidth||Math.floor(M)!==M)){var F=f*h*d-1-y.get(x,T,D,M,w)===N*h*d+A*d+O?1:0;0!==F&&(_+=b.get(x,T,D,M,w)*F)}}}}g.set(_,x,C,E,S,w)}return g.toTensor()},t.prototype.cast=function(e,t){return Dm(e,t,this)},t.prototype.reshape=function(e,t){return Om(e,t)},t.prototype.avgPool=function(e,t){return rE(e,"avgPool"),rE(e,"maxPool"),oE(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){rE(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(Df([a,t,n,u])),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=0,p=f[0]/h[0],v=f[1]/h[1],m=0;m<a;m++)for(var g=0;g<t;g++)for(var y=p*g,b=Math.floor(y),x=y-b,w=Math.min(i-1,Math.ceil(y)),C=m*e.strides[0]+b*e.strides[1],E=m*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var k=v*S,R=Math.floor(k),I=k-R,_=Math.min(s-1,Math.ceil(k)),N=C+R*e.strides[2],T=E+R*e.strides[2],A=C+_*e.strides[2],D=E+_*e.strides[2],O=0;O<u;O++){var M=l[N+O],F=l[T+O],P=M+(l[A+O]-M)*I,L=P+(F+(l[D+O]-F)*I-P)*x;c[d++]=L}return fp(c,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){rE([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),h=[n&&l>1?a-1:a,n&&c>1?i-1:i],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],p=h[0]/d[0],v=h[1]/d[1],m=this.readSync(e.dataId),g=0,y=0;y<o;y++)for(var b=y*t.strides[0],x=0;x<l;x++)for(var w=x*p,C=Math.floor(w),E=Math.min(Math.ceil(w),a-1),S=b+C*t.strides[1],k=b+E*t.strides[1],R=w-C,I=1-R,_=0;_<c;_++)for(var N=_*v,T=Math.floor(N),A=Math.min(Math.ceil(N),i-1),D=N-T,O=1-D,M=S+T*t.strides[2],F=S+A*t.strides[2],P=k+T*t.strides[2],L=k+A*t.strides[2],B=I*O,z=I*D,W=R*O,U=R*D,V=0;V<s;V++){var j=m[g++];f[M+V]+=j*B,f[F+V]+=j*z,f[P+V]+=j*W,f[L+V]+=j*U}return gp(f,[o,i,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){rE(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(a*t*n*u),f=[r&&t>1?i-1:i,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=f[0]/h[0],p=f[1]/h[1],v=0,m=0;m<a;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var b=d*y,x=g+Math.min(i-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var C=p*w,E=x+Math.min(s-1,r?Math.round(C):Math.floor(C))*e.strides[2],S=0;S<u;S++){var k=l[E+S];c[v++]=k}return fp(c,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){rE([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],f=new Float32Array(o*a*i*s),h=this.readSync(e.dataId),d=[n&&l>1?a-1:a,n&&c>1?i-1:i],p=[n&&l>1?l-1:l,n&&c>1?c-1:c],v=d[0]/p[0],m=d[1]/p[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<o;w++)for(var C=w*t.strides[0],E=0;E<a;E++)for(var S=C+E*t.strides[1],k=Math.floor(E*g),R=Math.floor(k-b/2),I=0;I<i;I++)for(var _=S+I*t.strides[2],N=Math.floor(I*y),T=Math.floor(N-x/2),A=0;A<s;A++){for(var D=0,O=0;O<b;O++){var M=O+R;if(!(M<0||M>=l)){var F=C+M*e.strides[1],P=M*v;if(E===Math.min(a-1,n?Math.round(P):Math.floor(P)))for(var L=0;L<x;L++){var B=L+T;if(!(B<0||B>=c)){var z=F+B*e.strides[2],W=B*m;I===Math.min(i-1,n?Math.round(W):Math.floor(W))&&(D+=h[z+A])}}}}f[_+A]=D}return gp(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){rE([e,t,n,o,a],"batchNorm");for(var i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(i.length),h=c.length,d=l.length,p=u.length,v=s.length,m=0,g=0,y=0,b=0,x=0;x<i.length;++x)f[x]=c[m++]+(i[x]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),m>=h&&(m=0),g>=v&&(g=0),y>=d&&(y=0),b>=p&&(b=0);return gp(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){rE(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=this.readSync(e.dataId),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var f=0;f<u;f++){var h=c(f),d=s[f]*Math.pow(n+r*h,-o);l[f]=d}return gp(l,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){rE(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=this.readSync(n.dataId),f=new Float32Array(e.size),h=e.size,d=0;d<h;d++){for(var p=d%s,v=d-p+Math.max(0,p-r),m=d-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(l[y],2);for(g=a*g+o,y=v;y<m;y++){var b=-2*a*i*l[y]*c[d]/g;d===y&&(b+=Math.pow(g,-i)),b*=u[d],f[y]+=b}}return gp(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){rE(e,"multinomial");for(var o=t?e:pm(e),a=o.shape[0],i=o.shape[1],s=bp([a,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<a;++c){var f=c*i,h=new Float32Array(i-1);h[0]=l[f];for(var d=1;d<h.length;++d)h[d]=h[d-1]+l[f+d];for(var p=Kb(r.toString()),v=c*n,m=0;m<n;++m){var g=p();u[v+m]=h.length;for(var y=0;y<h.length;y++)if(g<h[y]){u[v+m]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){rE(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=this.readSync(e.dataId),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return vp(o,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return rE(e,"nonMaxSuppression"),Um(this.readSync(e.dataId),this.readSync(t.dataId),n,r,o)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=Tp(e.shape,"float32"),a=Tp(e.shape,"float32"),i=lp(e).as2D(n,r),s=cp(e).as2D(n,r),u=0;u<n;u++)for(var l=i.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),f=up(l,c),h=this.readSync(this.fftImpl(f,t).dataId),d=0;d<r;d++){var p=Pm(h,d);o.values[u*r+d]=p.real,a.values[u*r+d]=p.imag}return up(o.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=up(lp(o).div(dp(r)),cp(o).div(dp(r)))),o}var a=this.readSync(e.dataId),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return up(i.real,i.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=up(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=up(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=up(l.real,l.imag).mul(u),f=i.add(c),h=i.sub(c),d=lp(f).concat(lp(h)),p=cp(f).concat(cp(h));return up(d,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=Bm(o*s,t,n),l=Pm(e,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}n&&(a/=t,i/=t),Lm(r,a,i,o)}return r},t.prototype.depthToSpace=function(e,t,n){_f("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),_f(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,l=i/(t*t),c=this.readSync(e.dataId),f=new Float32Array(r*s*u*l),h=0,d=0;d<r;++d)for(var p=0;p<s;++p)for(var v=Math.floor(p/t),m=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(m*t+g%t)*l,x=0;x<l;++x){var w=x+b+i*(y+a*(v+o*d));f[h++]=c[w]}return gp(f,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=nv(e.shape,t.shape),a=Tp(o,n),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=ev(e.shape,o),l=ev(t.shape,o),c=a.values;if(u.length+l.length===0)for(var f=0;f<c.length;++f)c[f]=r(i[f%i.length],s[f%s.length]);else{var h=this.bufferSync(e),d=this.bufferSync(t),p=function(n){var o=a.indexToLoc(n),f=o.slice(-e.rank);u.forEach(function(e){return f[e]=0});var p=h.locToIndex(f),v=o.slice(-t.rank);l.forEach(function(e){return v[e]=0});var m=d.locToIndex(v);c[n]=r(i[p],s[m])};for(f=0;f<c.length;++f)p(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=nv(e.shape,t.shape),o=Tp(r,"float32"),a=Tp(r,"float32"),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=ev(e.shape,r),l=ev(t.shape,r),c=o.values,f=a.values;if(u.length+l.length===0)for(var h=0;h<c.length;h++){var d=h%i.length,p=h%s.length,v=n(i[2*d],i[2*d+1],s[2*p],s[2*p+1]);c[h]=v.real,f[h]=v.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),h=a.slice(-e.rank);u.forEach(function(e){return h[e]=0});var d=m.locToIndex(h),p=a.slice(-t.rank);l.forEach(function(e){return p[e]=0});var v=g.locToIndex(p),y=n(i[2*d],i[2*d+1],s[2*v],s[2*v+1]);c[r]=y.real,f[r]=y.imag};for(h=0;h<c.length;h++)y(h)}return this.complex(o.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return Km(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],f=t.shape[0],h=r[0],d=r[1],p=Tp([f,h,d,c],"float32"),v=this.readSync(t.dataId),m=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=p.strides,x=0;x<f;x++){var w=4*x,C=v[w],E=v[w+1],S=v[w+2],k=v[w+3],R=m[x];if(!(R>=s))for(var I=h>1?(S-C)*(u-1)/(h-1):0,_=d>1?(k-E)*(l-1)/(d-1):0,N=0;N<h;N++){var T=h>1?C*(u-1)+N*I:.5*(C+S)*(u-1);if(T<0||T>u-1)for(var A=0;A<d;A++)for(var D=0;D<c;D++){var O=D+A*b[2]+N*b[1]+x*b[0];p.values[O]=a}else if("bilinear"===o){var M=Math.floor(T),F=Math.ceil(T),P=T-M;for(A=0;A<d;A++)if((H=d>1?E*(l-1)+A*_:.5*(E+k)*(l-1))<0||H>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],p.values[O]=a;else{var L=Math.floor(H),B=Math.ceil(H),z=H-L;for(D=0;D<c;D++){var W=g[O=D+L*y[2]+M*y[1]+R*y[0]],U=g[O=D+B*y[2]+M*y[1]+R*y[0]],V=g[O=D+L*y[2]+F*y[1]+R*y[0]],j=W+(U-W)*z,G=V+(g[O=D+B*y[2]+F*y[1]+R*y[0]]-V)*z;O=D+A*b[2]+N*b[1]+x*b[0],p.values[O]=j+(G-j)*P}}}else for(A=0;A<d;++A){var H;if((H=d>1?E*(l-1)+A*_:.5*(E+k)*(l-1))<0||H>l-1)for(D=0;D<c;D++)O=D+A*b[2]+N*b[1]+x*b[0],p.values[O]=a;else{var q=Math.round(H),K=Math.round(T);for(D=0;D<c;D++){var X=D+q*y[2]+K*y[1]+R*y[0],$=D+A*b[2]+N*b[1]+x*b[0];p.values[$]=g[X]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var o=am(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(e,t,n,l,s,i,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=tm(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return fp([],a,e.dtype);for(var l=new yh([i,s],e.dtype),c=this.readSync(t.dataId),f=this.readSync(e.dataId),h=0;h<i;h++){for(var d=[],p=0,v=0;v<r;v++){var m=c[h*r+v];p+=m*u[v],d.push(m)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+d+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[h*s+g]=f[p*s+g]}return l.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=am(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=dp(0);return this.scatter(e,t,n,u,i,a,o,s,l,!0)},t.prototype.fill=function(e,t,n){var r=jf(n=n||Zf(t),Df(e));return r.fill(t),Bh.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=jf(e.dtype,Df(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return Mm(e,t,n)},t.prototype.scatter=function(e,t,n,r,o,a,i,s,u,l){var c=[r/o,o],f=this.readSync(e.dataId),h=this.readSync(t.dataId);if(0===r)return fp([],n,t.dtype);var d=new yh(c,t.dtype);d.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var v=[],m=0,g=0;g<i;g++){var y=f[p*i+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<o;b++)l?d.values[m*o+b]+=h[p*o+b]:d.values[m*o+b]=0===t.rank?h[0]:h[p*o+b]}return d.toTensor().reshape(n)},t}(ym);function uE(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,o=n.backend,a=r,i=a.a,s=a.b,u=o;rE([i,s],e);var l=u.data.get(i.dataId).values,c=u.data.get(s.dataId).values,f=t(i.shape,s.shape,l,c,i.dtype),h=f[0],d=f[1];return{dataId:u.write(h,d,i.dtype),shape:d,dtype:i.dtype}}}}function lE(e){return function(t,n,r,o,a){var i=nv(t,n),s=i.length,u=nh(i),l=Vf(a,Df(i)),c=t.length,f=n.length,h=nh(t),d=nh(n),p=ev(t,i),v=ev(n,i);if(p.length+v.length===0)for(var m=0;m<l.length;++m)l[m]=e(r[m%r.length],o[m%o.length]);else{var g=function(t){var n=hh(t,s,u),a=n.slice(-c);p.forEach(function(e){return a[e]=0});var i=fh(a,c,h),m=n.slice(-f);v.forEach(function(e){return m[e]=0});var g=fh(m,f,d);l[t]=e(r[i],o[g])};for(m=0;m<l.length;++m)g(m)}return[l,i]}}Bh.registerBackend("cpu",function(){return new sE},1);var cE=lE(function(e,t){return e/t}),fE=uE(qp,cE),hE={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;rE(o,"MaxPoolWithArgmax");var f=c.data.get(o.dataId).values,h=xm(o.shape,i,s,[1,1],u),d=function(e,t,n,r,o){var a=oE(e,0,n,nh(t),o,"max"),i=aE(e,t,n,o,!0,r);return[a.values,i.values]}(f,o.shape,o.dtype,l,h),p=d[0],v=d[1],m=c.write(p,h.outShape,o.dtype),g=c.write(v,h.outShape,o.dtype);return[{dataId:m,shape:h.outShape,dtype:o.dtype},{dataId:g,shape:h.outShape,dtype:"int32"}]}},dE={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,h=n;rE(a,"NonMaxSuppressionWithScore");var d=Vm(h.data.get(a.dataId).values,h.data.get(i.dataId).values,u,l,c,f);return[d.selectedIndices,d.selectedScores]}},pE={kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;rE(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},vE=lE(function(e,t){var n=e-t;return n*n});function mE(e,t,n,r,o){for(var a=Df(t),i=t.length,s=nh(t),u=nh(o),l=Vf(n,Df(o)),c=0;c<a;++c){for(var f=hh(c,i,s),h=new Array(f.length),d=0;d<h.length;d++)h[d]=f[r[d]];l[fh(h,i,u)]=e[c]}return l}for(var gE=0,yE=[dE,pE,uE(Kp,vE),fE,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n.perm,i=r;rE(o,"transpose");for(var s=o.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=o.shape[a[l]];var c=mE(i.data.get(o.dataId).values,o.shape,o.dtype,a,u);return{dataId:i.write(c,u,o.dtype),shape:u,dtype:o.dtype}}},hE];gE<yE.length;gE++)wf(yE[gE]);for(var bE,xE=function(e){this.variableNames=["A"];var t=ng(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},wE=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=ng(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},CE=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=vg(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},EE=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=vg(this.rank),a=eg("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},SE=0,kE=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,a=r.numChannels,i="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],f=[c,l],h=[c,l,a];(s||i)&&(null==bE&&(bE=document.createElement("canvas").getContext("2d")),bE.canvas.width=l,bE.canvas.height=c,bE.drawImage(o,0,0,l,c),o=bE.canvas);var d=n.makeTensorInfo(f,"int32");n.texData.get(d.dataId).usage=Vh.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),o);var p=pf().getBool("WEBGL_PACK")?new wE(h):new xE(h),v=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),v}},{kernelName:qp,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;return function(e,t,n){var r=new _g("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new Tg("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",e.shape,t.shape,!0)),n.runWebGLProgram(r,[e,t],"float32")}(r.a,r.b,n)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;qd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,f=s.softNmsSigma,h=n,d=Vm(h.readSync(a.dataId),h.readSync(i.dataId),u,l,c,f);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,a=new cb(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Kp,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n,s=pf().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Tg("return (a - b) * (a - b);",o.shape,a.shape):new _g("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,o=e.backend,a=n.x,i=r.perm,s=o,u=a.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=a.shape[i[c]];if(s.shouldExecuteOnCPU([a])){var f=mE(s.texData.get(a.dataId).values,a.shape,a.dtype,i,l);t=s.makeTensorInfo(l,a.dtype),s.texData.get(t.dataId).values=f}else t=function(e,t,n){var r=pf().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new EE(e.shape,t):new CE(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}(a,i,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,l=a.includeBatchInIndex,c=r;_f(4===o.shape.length,function(){return"Error in maxPool: input must be rank 4 but got rank "+o.shape.length+"."});var f=[1,1];_f(Tm(s,f),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+f+"'"});var h=xm(o.shape,i,s,f,u),d=function(e,t,n,r){var o=new Wy(n,"max",!1),a=r.runWebGLProgram(o,[e],"float32");return o=new Wy(n,"max",!0,!0,t),[a,r.runWebGLProgram(o,[e],"float32")]}(o,l,h,c);return[d[0],d[1]]}}];SE<kE.length;SE++)wf(kE[SE]);for(var RE=0,IE=[{kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=nv(n.shape,r.shape);return{a:function(){var t=e,r=tv(n.shape,o);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},b:function(){var t=e,n=tv(r.shape,o);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n}},{kernelName:Xp,gradFunc:function(e,t,n){for(var r=n,o=r.inputShape,a=r.shape,i=Array.from(a),s=o.length-1;s>=0;s--)if(o[s]===a[s])i[s]=1;else if(1!==o[s])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<i.length;s++)i[s]>1&&u.push(s);return{x:function(){return e.sum(u,!0)}}}},{kernelName:qp,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=nv(n.shape,r.shape);return{a:function(){var t=em(e,r.toFloat()),a=tv(n.shape,o);return a.length>0?Xw(t,a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=tv(r.shape,o);a.length>0&&(t=Xw(t,a).reshape(r.shape));var i=Bx(r);return wv(em(t,i.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,o=t[0],a=t[1],i=t[2],s=t[3],u=Yb(o),l=null==s?dp(1):s,c=tv(a.shape,u.shape),f=[];if(1===a.rank){for(var h=0;h<u.shape.length-1;++h)f.push(u.shape[h]);f.push(1)}var d=Jv(o,a),p=Kv(e,l),v=Sv(Zp(i,dp(r))),m=Kv(Kv(Kv(v,v),v),dp(-.5));return{x:function(){return 1===a.rank?Pp(Kv(Kv(e,bx(v.as4D(1,1,1,a.shape[0]),f)),l),o.shape):Pp(Kv(Kv(e,v),l),o.shape)},mean:function(){var e=Kv(Kv(v,dp(-1)),p);return 1===a.rank&&(e=Xw(e,c)),Pp(e,a.shape)},variance:function(){var e=Kv(Kv(m,d),p);return 1===a.rank&&(e=Xw(e,c)),Pp(e,a.shape)},scale:function(){var t=Kv(d,v),n=Kv(e,t);return 1===a.rank&&(n=Xw(n,c)),Pp(n,a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=Xw(t,c)),Pp(t,a.shape)}}}},{kernelName:Yp,gradFunc:function(e){return{x:function(){return e.toFloat()}}}},{kernelName:$p,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return bp(n.shape,"float32")}}}},{kernelName:Jp,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],o=n.paddings.map(function(e){return e[0]});return{x:function(){return e.slice(o,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Kp,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],o=dp(2);return{a:function(){return Kv(e,Kv(o,Jv(n,r)))},b:function(){return Kv(e,Kv(o,Jv(r,n)))}}}},{kernelName:Qp,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],o=n.reps;return{x:function(){var t=Ep(r);if(1===r.rank)for(var n=0;n<o[0];++n)t=t.add(e.slice([n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<o[0];++n)for(var a=0;a<o[1];++a)t=t.add(e.slice([n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(var i=0;i<o[2];++i)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(i=0;i<o[2];++i)for(var s=0;s<o[3];++s)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=rp(n.perm);return{x:function(){return mm(e,r)}}}}];RE<IE.length;RE++)Cf(IE[RE]);var _E=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();pf().get("IS_BROWSER")&&pf().setPlatform("browser",new _E);var NE,TE=function(){function e(){this.util=n(184),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=pf().global.fetch?pf().global.fetch(e,t):(null==NE&&(NE=n(531)),NE(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();pf().get("IS_NODE")&&pf().setPlatform("node",new TE);var AE={float32:4,int32:4,uint16:2,uint8:1,bool:1};function DE(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=Df(i),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=AE[l.dtype],f=e.slice(r,r+s*c),h="uint8"===l.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===a)u=Float32Array.from(h,function(e){return e*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(h,function(e){return Math.round(e*l.scale+l.min)})}r+=s*c}else if("string"===a){var d=Df(t.shape);u=[];for(var p=0;p<d;p++){var v=new Uint32Array(e.slice(r,r+4))[0];r+=4;var m=new Uint8Array(e.slice(r,r+v));u.push(m),r+=v}}else{var g=AE[a];if(f=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(f);else if("int32"===a)u=new Int32Array(f);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(f)}r+=s*g}n[o]=fp(u,i,a)},a=0,i=t;a<i.length;a++)o(i[a]);return n}function OE(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var ME="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function FE(e){return ME?Buffer.byteLength(e):new Blob([e]).size}function PE(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function LE(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function BE(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:FE(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:FE(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var zE=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),WE="://",UE=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){_f(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(WE)&&(t=t.slice(0,t.indexOf(WE))),_f(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();_f(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function VE(e){if(-1===e.indexOf(WE))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+UE.getSchemes().join(","));return{scheme:e.split(WE)[0],path:e.split(WE)[1]}}function jE(e,t,n){return void 0===n&&(n=!1),ff(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,f;return hf(this,function(h){switch(h.label){case 0:return _f(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),_f((r=zE.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),_f(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],_f((a=zE.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),_f(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=VE(e).scheme,u=VE(e).path,l=s===VE(e).scheme,[4,o.load()];case 1:return c=h.sent(),n&&l?[4,UE.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,i.save(c)];case 4:return f=h.sent(),!n||l?[3,6]:[4,UE.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}var GE="models_store",HE="model_info_store";function qE(){if(!pf().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function KE(e){var t=e.result;t.createObjectStore(GE,{keyPath:"modelPath"}),t.createObjectStore(HE,{keyPath:"modelPath"})}var XE=function(){function e(e){if(this.indexedDB=qE(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return KE(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(GE,"readonly"),s=i.objectStore(GE).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=BE(t),c=a.transaction(HE,"readwrite"),f=c.objectStore(HE),h=f.put({modelPath:n.modelPath,modelArtifactsInfo:l});h.onsuccess=function(){var o=(u=a.transaction(GE,"readwrite")).objectStore(GE).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});o.onsuccess=function(){return e({modelArtifactsInfo:l})},o.onerror=function(e){var t=(f=c.objectStore(HE)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},h.onerror=function(e){return a.close(),r(h.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),$E=function(e){return pf().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(XE.URL_SCHEME)?(t=e.slice(XE.URL_SCHEME.length),new XE(t)):null;var t};zE.registerSaveRouter($E),zE.registerLoadRouter($E);var YE=function(){function e(){this.indexedDB=qE()}return e.prototype.listModels=function(){return ff(this,void 0,void 0,function(){var e=this;return hf(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return KE(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(HE,"readonly"),a=o.objectStore(HE).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return ff(this,void 0,void 0,function(){var t=this;return hf(this,function(n){var r;return e=(r=e).startsWith(XE.URL_SCHEME)?r.slice(XE.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return KE(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(HE,"readwrite"),s=i.objectStore(HE),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(GE,"readwrite")).objectStore(GE).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if(pf().getBool("IS_BROWSER"))try{UE.registerManager(XE.URL_SCHEME,new YE)}catch(lf){}var QE="/",JE="tensorflowjs_models",ZE="info",eS="model_topology",tS="weight_specs",nS="weight_data",rS="model_metadata";function oS(e){return{info:[JE,e,ZE].join(QE),topology:[JE,e,eS].join(QE),weightSpecs:[JE,e,tS].join(QE),weightData:[JE,e,nS].join(QE),modelMetadata:[JE,e,rS].join(QE)}}function aS(e){var t=e.split(QE);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(QE)}var iS=function(){function e(e){if(!pf().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=oS(this.modelPath)}return e.prototype.save=function(e){return ff(this,void 0,void 0,function(){var t,n,r;return hf(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=BE(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(ME)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return ff(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return hf(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(ME){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),sS=function(e){return pf().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(iS.URL_SCHEME)?(t=e.slice(iS.URL_SCHEME.length),new iS(t)):null;var t};zE.registerSaveRouter(sS),zE.registerLoadRouter(sS);var uS=function(){function e(){_f(pf().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),_f("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return ff(this,void 0,void 0,function(){var e,t,n,r,o,a;return hf(this,function(i){for(e={},t=JE+QE,n=QE+ZE,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=aS(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return ff(this,void 0,void 0,function(){var t,n;return hf(this,function(r){var o;if(e=(o=e).startsWith(iS.URL_SCHEME)?o.slice(iS.URL_SCHEME.length):o,t=oS(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(pf().getBool("IS_BROWSER"))try{UE.registerManager(iS.URL_SCHEME,new uS)}catch(lf){}function lS(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var cS=function(){function e(t){if(!pf().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return ff(this,void 0,void 0,function(){var t,n,r,o,a,i;return hf(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,lS(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,lS(function(){return i.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:BE(e)}]}})})},e.URL_SCHEME="downloads://",e}(),fS=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return ff(this,void 0,void 0,function(){var e,t,n=this;return hf(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var c=[],f=[],h=[];u.forEach(function(e){e.paths.forEach(function(e){f.push(e),h.push(null)}),c.push.apply(c,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=f.indexOf(e);h[o]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:PE(h),format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,userDefinedMetadata:i.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return LE(e.name)}),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach(function(e){var a=LE(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function hS(e,t,n,r){!function(e){_f(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){_f(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),_f(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),_f(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var i=n+ ++o/e.length*(r-n);return t(i),a}),a}))}function dS(e,t){return ff(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return hf(this,function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?pf().platform.fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit,{isBinary:!0})}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=f.sent(),[3,4];case 2:return[4,hS(r,t.onProgress,o,a)];case 3:i=f.sent(),f.label=4;case 4:return s=i.map(function(e){return e.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=f.sent(),[3,8];case 6:return[4,hS(s,t.onProgress,u,l)];case 7:c=f.sent(),f.label=8;case 8:return[2,c]}})})}function pS(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),ff(t,void 0,void 0,function(){var t,a,i,s,u,l,c,f,h,d;return hf(this,function(p){switch(p.label){case 0:if(t=n.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,l=AE[u]*Df(e.shape),c=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=o?o.forEach(function(t,n){t===e.name&&(c(),i[n]=!0)}):c(),s.push(e.name),r+=l})}),!i.every(function(e){return e}))throw u=o.filter(function(e,t){return!i[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),c=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)})}),[4,e(c)];case 1:return f=p.sent(),h={},d=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=f[d+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,l=0;l<t;l++){var c=new Uint8Array(f[d+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(e){var t=DE(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]}),d+=t}),[2,h]}})})}}zE.registerSaveRouter(function(e){return pf().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(cS.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new cS(e)}(e.slice(cS.URL_SCHEME.length)):null});var vS=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(_f("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=pf().platform.fetch,_f(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&_f(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return ff(this,void 0,void 0,function(){var t,n,r,o;return hf(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:BE(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return ff(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s,u,l,c,f;return hf(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,i=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:f=h.sent(),l=f[0],c=f[1],h.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:c,userDefinedMetadata:u,generatedBy:a,convertedBy:i,format:s}]}})})},e.prototype.loadWeights=function(e){return ff(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,f;return hf(this,function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,u=e;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],e.forEach(function(e){e.paths.forEach(function(e){c.push(a+e+o)})}),[4,dS(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[i,PE(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function mS(e){return null!=e.match(vS.URL_SCHEME_REGEX)}var gS=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return mS(e)}):mS(e))?yS(e,{onProgress:t}):null};function yS(e,t){return new vS(e,t)}zE.registerSaveRouter(gS),zE.registerLoadRouter(gS);var bS,xS=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){return[2,this.modelArtifacts]})})},e}(),wS=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(t){return[2,this.saveHandler(e)]})})},e}(),CS=Object.freeze({browserFiles:function(e){return new fS(e)},browserHTTPRequest:function(e,t){return yS(e,t)},concatenateArrayBuffers:PE,decodeWeights:DE,encodeWeights:function(e,t){return ff(this,void 0,void 0,function(){var n,r,o,a,i,s=this;return hf(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),a=function(a){var i=o[a],u=Array.isArray(e)?e[a].tensor:e[i];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+u.dtype);var l={name:i,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(e){return ff(s,void 0,void 0,function(){var t,n,r,o,a,i,s;return hf(this,function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(t=l.sent(),n=t.reduce(function(e,t){return e+t.length},0)+4*t.length,r=new Uint8Array(n),o=0,a=0;a<t.length;a++)i=t[a],s=new Uint8Array(new Uint32Array([i.length]).buffer),r.set(s,o),o+=4,r.set(i,o),o+=i.length;return e(r),[2]}})})});r.push(c)}else r.push(u.data());null!=t&&(l.group=t),n.push(l)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:OE(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new xS(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xS({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xS({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return zE.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:BE,getSaveHandlers:function(e){return zE.getSaveHandlers(e)},http:yS,isHTTPScheme:mS,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),ff(this,void 0,void 0,function(){return hf(this,function(o){return[2,pS(function(e){return dS(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return zE.registerLoadRouter(e)},registerSaveRouter:function(e){return zE.registerSaveRouter(e)},weightsLoaderFactory:pS,withSaveHandler:function(e){return new wS(e)},copyModel:function(e,t){return ff(this,void 0,void 0,function(){return hf(this,function(n){return[2,jE(e,t,!1)]})})},listModels:function(){return ff(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return hf(this,function(s){switch(s.label){case 0:e=UE.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,UE.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+WE+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return ff(this,void 0,void 0,function(){return hf(this,function(n){return[2,jE(e,t,!0)]})})},removeModel:function(e){return ff(this,void 0,void 0,function(){var t;return hf(this,function(n){return t=VE(e),[2,UE.getManager(t.scheme).removeModel(t.path)]})})}}),ES=sp({confusionMatrix_:function(e,t,n){var r=$d(e,"labels","confusionMatrix"),o=$d(t,"predictions","confusionMatrix");_f(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),_f(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),_f(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),_f(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),_f(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=Cx(r.asType("int32"),n),i=Cx(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}}),SS=(Object.freeze({confusionMatrix:ES}),sp({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);i=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=yf("FromPixels",Bh.backendName))return Bh.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],f=l[1];if(i?s=e.getContext("2d").getImageData(0,0,c,f).data:r||n?s=e.data:(a||o)&&(null==bS&&(bS=document.createElement("canvas").getContext("2d")),bS.canvas.width=c,bS.canvas.height=f,bS.drawImage(e,0,0,c,f),s=bS.getImageData(0,0,c,f).data),4===t)u=new Int32Array(s);else{var h=c*f;u=new Int32Array(h*t);for(var d=0;d<h;d++)for(var p=0;p<t;++p)u[d*t+p]=s[4*d+p]}return mp(u,[f,c,t],"int32")}})),kS=Object.freeze({toPixels:function(e,t){return ff(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,h,d,p,v,m,g,y,b,x,w,C,E,S;return hf(this,function(k){switch(k.label){case 0:if(n=$d(e,"img","toPixels"),e instanceof Ch||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,n.data()];case 1:return s=k.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=k.sent(),f=c[0],h=c[1],d=f[0],p=h[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(d<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(d<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+p+"].")}for(v="float32"===n.dtype?255:1,m=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)y=void 0,b=void 0,x=void 0,w=void 0,1===i?(y=s[g]*v,b=s[g]*v,x=s[g]*v,w=255):3===i?(y=s[3*g]*v,b=s[3*g+1]*v,x=s[3*g+2]*v,w=255):4===i&&(y=s[4*g]*v,b=s[4*g+1]*v,x=s[4*g+2]*v,w=s[4*g+3]*v),m[0+(C=4*g)]=Math.round(y),m[C+1]=Math.round(b),m[C+2]=Math.round(x),m[C+3]=Math.round(w);return null!=t&&(t.width=a,t.height=o,E=t.getContext("2d"),S=new ImageData(m,a,o),E.putImageData(S,0,0)),n!==e&&n.dispose(),[2,m]}})})},fromPixels:SS}),RS=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),IS=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function _S(e){_f(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),_f("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),_f(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),IS.register(e)}Object.freeze({Serializable:RS,SerializationMap:IS,registerClass:_S}),Object.freeze({gpgpu_util:ky,webgl_util:Ud,forceHalfFloat:function(){pf().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Bb,setWebGLContext:qh,GPGPUContext:Ry});var NS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cf(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;if(null!=n){var i=n.map(function(e){return{name:e.name,tensor:a[e.name]}});this.applyGradients(i)}else this.applyGradients(a);return Hd(a),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){_f(eh(e),function(){return"The f passed in variableGrads(f) must be a function"}),_f(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof _h}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],Bh.registeredVariables)t.push(Bh.registeredVariables[r]);var o=n?t.filter(function(e){return!e.trainable}):null,a=t.length;_f((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=Bh.gradients(e,t,null,!0),s=i.value,u=i.grads;_f(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),_f(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(e,t){null!=u[t]&&(l[e.name]=u[t])}),null!=o&&o.forEach(function(e){return l[e.name]=null}),{value:s,grads:l}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Hd(this.iterations_)},t.prototype.saveIterations=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:dp(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return ff(this,void 0,void 0,function(){var t;return hf(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(RS);Object.defineProperty(NS,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var TS=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=Bh.backend.epsilon()),o}return cf(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Bh.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Gd(function(){return Ep(o).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Gd(function(){return Ep(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Gd(function(){var e=i.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(i.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));i.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Hd(this.accumulatedGrads.map(function(e){return e.variable})),Hd(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){var e;return hf(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){var t;return hf(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(NS);_S(TS);var AS=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return cf(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Bh.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Gd(function(){return xp(o.shape,t.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable;Gd(function(){var e=i.add(a.square());i.assign(e);var n=a.div(e.add(Bh.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Hd(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(NS);_S(AS);var DS=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Gd(function(){a.accBeta1=dp(n).variable(),a.accBeta2=dp(r).variable()}),null==o&&(a.epsilon=Bh.backend.epsilon()),a}return cf(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Gd(function(){var r=Jv(1,t.accBeta1),o=Jv(1,t.accBeta2);n.forEach(function(n,a){var i=Bh.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Gd(function(){return Ep(i).variable(!1)})}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Gd(function(){return Ep(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedSecondMoment[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2).add(s.square().mul(1-t.beta2)),h=c.div(r),d=f.div(o);u.assign(c),l.assign(f);var p=h.div(d.sqrt().add(t.epsilon)).mul(-t.learningRate).add(i);i.assign(p)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Hd(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Hd(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){var e;return hf(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){var t,n=this;return hf(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Gd(function(){n.accBeta1.assign($v(n.beta1,n.iterations_+1)),n.accBeta2.assign($v(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(NS);_S(DS);var OS=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Gd(function(){i.iteration=dp(0).variable(),i.accBeta1=dp(n).variable()}),null==o&&(i.epsilon=Bh.backend.epsilon()),i}return cf(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Gd(function(){var r=Jv(1,t.accBeta1),o=em(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,a){var i=Bh.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Ep(i).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:Ep(i).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedWeightedInfNorm[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),f=l.mul(t.beta2),h=s.abs(),d=f.maximum(h);u.assign(c),l.assign(d);var p=o.div(r).mul(c.div(d.add(t.epsilon))).add(i);i.assign(p)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Hd(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Hd(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(NS);_S(OS);var MS=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return cf(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=Bh.registeredVariables[n];Gd(function(){var e=t.c.mul(o).add(a);a.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return Bh.keep(e)}(dp(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(NS);_S(MS);var FS=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=dp(o.momentum),o}return cf(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Bh.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Gd(function(){return Ep(o).variable(!1)})});var a=t.accumulations[r].variable,i=Array.isArray(e)?e[r].tensor:e[n];null!=i&&Gd(function(){var e,n=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(n.mul(t.m))).add(o):t.c.mul(n).add(o),a.assign(n),o.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Hd(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){return hf(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){return hf(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(MS);_S(FS);var PS=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;if(i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=Bh.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return cf(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Bh.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Gd(function(){return Ep(o).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Gd(function(){return Ep(o).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Gd(function(){return Ep(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Gd(function(){var e=i.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),l=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));i.assign(e),n.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var f=i.mul(t.decay).add(a.square().mul(1-t.decay));l=s.mul(t.momentum).add(a.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),i.assign(f),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Hd(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Hd(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Hd(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ff(this,void 0,void 0,function(){var e;return hf(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ff(this,void 0,void 0,function(){var t;return hf(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(NS);_S(PS);var LS=function(){function e(){}return e.sgd=function(e){return new MS(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new FS(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new PS(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new DS(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new TS(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new OS(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new AS(e,t)},e}();LS.sgd,LS.momentum,LS.adadelta,LS.adagrad,LS.rmsprop,LS.adamax,LS.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;Ch.prototype.add=function(e){return Zp(this,e)},Ch.prototype.broadcastTo=function(e){return cx(this,e)},Ch.prototype.div=function(e){return em(this,e)},Ch.prototype.divNoNan=function(e){return yx(this,e)},Ch.prototype.squaredDifference=function(e){return zx(this,e)},Ch.prototype.tile=function(e){return bx(this,e)},Ch.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),Cx(this,e,t,n)},Ch.prototype.transpose=function(e){return mm(this,e)},Ch.prototype.pad=function(e,t){return Ex(this,e,t)},Ch.prototype.batchNorm=function(e,t,n,r,o){return ex(this,e,t,n,r,o)},xh=nE;var BS=function(){function e(e,t){if(!XS(e)||!XS(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}(),zS=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}();function WS(e,t){return e instanceof Ch&&e.shape.length===t}function US(e){return WS(e,3)}function VS(e){return WS(e,4)}function jS(e){return e%2===0}function GS(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function HS(e){return e&&e.width&&e.height}function qS(e){return e.reduce(function(e,t){return e.add(t)},new zS(0,0)).div(new zS(e.length,e.length))}function KS(e,t,n){return Array(e).fill(0).map(function(e,r){return t+r*n})}function XS(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function $S(e){return XS(e)&&0<=e&&e<=1}var YS,QS=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(XS),a=[r.x,r.y,r.width,r.height].every(XS);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],l=i[2],c=i[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(XS)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new zS(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new zS(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new zS(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new zS(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.round(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.floor(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(n-=i/2,o+=i),a<o&&(r-=i/2,a+=i),new e({x:n,y:r,width:o,height:a})},e.prototype.rescale=function(t){var n=HS(t)?t.width:t,r=HS(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,a=r.y,i=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(a,0),c=i-u,f=s-l;return new e({x:u,y:l,width:Math.min(c,t-u),height:Math.min(f,n-l)}).floor()},e.prototype.shift=function(t,n){var r=this.width,o=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:o})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,o=n,a=r,i=this.left,s=this.top,u=this.right,l=this.bottom;return u>t&&(o=-u+t+n,u=t),l>e&&(a=-l+e+r,l=e),i<1&&(a=2-i,i=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:o,y:s,ey:l,x:i,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),JS=function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:o},a)||this}return l(t,e),t}(QS),ZS=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return l(t,e),t.assertIsValidLabeledBox=function(e,t){if(QS.assertIsValidBox(e,t),!XS(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(QS),ek=function(){function e(e,t,n,r,o){this._imageDims=new BS(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new QS(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new QS(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),tk=(function(e){function t(t,n,r,o){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=o,a}l(t,e),t.assertIsValidPredictedBox=function(e,t){if(ZS.assertIsValidLabeledBox(e,t),!$S(e.score)||!$S(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(ZS),function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:o},a)||this}return l(t,e),t}(QS));function nk(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function rk(e){var t="";if(!e)try{e=n(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(o){t=o.toString()}var r=e?function(t){return new Promise(function(n,r){e.readFile(t,function(e,t){return e?r(e):n(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:r}}function ok(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=rk();return c({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},o)}function ak(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}function ik(){return"object"===typeof n.g&&"undefined"!==typeof process&&!!process.version}function sk(e){YS=e}function uk(){ak()&&sk(nk()),ik()&&sk(ok())}var lk,ck={getEnv:function(){if(!YS)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return YS},setEnv:sk,initialize:uk,createBrowserEnv:nk,createFileSystem:rk,createNodejsEnv:ok,monkeyPatch:function(e){if(YS||uk(),!YS)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?YS.Canvas:t,r=e.Image,o=void 0===r?YS.Image:r;YS.Canvas=n,YS.Image=o,YS.createCanvasElement=e.createCanvasElement||function(){return new n},YS.createImageElement=e.createImageElement||function(){return new o},YS.ImageData=e.ImageData||YS.ImageData,YS.Video=e.Video||YS.Video,YS.fetch=e.fetch||YS.fetch,YS.readFile=e.readFile||YS.readFile},isBrowser:ak,isNodejs:ik};function fk(e){return ck.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function hk(e){var t=ck.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=fk(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}uk(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(lk||(lk={}));var dk=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,o=e.fontSize,a=e.fontStyle,i=e.padding;this.anchorPosition=t||lk.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=i||4},pk=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new dk(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(t){return e.measureText(t).width}).reduce(function(e,t){return e<t?t:e},0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===lk.BOTTOM_RIGHT||n===lk.TOP_RIGHT,o=n===lk.BOTTOM_LEFT||n===lk.BOTTOM_RIGHT,a=this.measureWidth(e),i=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,u=o?this.anchor.y-i:this.anchor.y;if(t){var l=t.width,c=t.height;return{x:Math.max(Math.min(s,l-a),0),y:Math.max(Math.min(u,c-i),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=fk(e),n=hk(t),r=this.options,o=r.backgroundColor,a=r.fontColor,i=r.fontSize,s=r.fontStyle,u=r.padding;n.font=i+"px "+s;var l=this.measureWidth(n),c=this.measureHeight();n.fillStyle=o;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,l,c),n.fillStyle=a,this.text.forEach(function(e,t){var r=u+f.x,o=u+f.y+(t+1)*i;n.fillText(e,r,o)})},e}(),vk=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:lk.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new dk(Object.assign({},a,o))},mk=function(){function e(e,t){void 0===t&&(t={}),this.box=new QS(e),this.options=new vk(t)}return e.prototype.draw=function(e){var t=hk(e),n=this.options,r=n.boxColor,o=n.lineWidth,a=this.box,i=a.x,s=a.y,u=a.width,l=a.height;t.strokeStyle=r,t.lineWidth=o,t.strokeRect(i,s,u,l);var c=this.options.label;c&&new pk([c],{x:i-o/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function gk(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Gd(function(){var o=Zp(sw(e,t.filters,[1,1],n),t.bias);return r?Zw(o):o})}function yk(e,t){Object.keys(e).forEach(function(n){t.some(function(e){return e.originalPath===n})||e[n].dispose()})}function bk(e,t){return function(n,r,o,a){var i=gp(e(n*r*o*o),[o,o,n,r]),s=pp(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function xk(e,t){return function(n,r,o){var a=vp(e(n*r),[n,r]),i=pp(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var wk=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function Ck(e,t){return function(n,r,o){var a=gp(e(9*n),[3,3,n,1]),i=gp(e(n*r),[1,1,n,r]),s=pp(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new wk(a,i,s)}}function Ek(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new wk(n,r,o)}}function Sk(e,t){return function(n,r,o){var a=e[n];if(!WS(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:o||n}),a}}function kk(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function Rk(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",o=(e=e.replace(r,"")).split("/").filter(function(e){return e}),a=e.endsWith(".json")?o[o.length-1]:n,i=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:i=e.startsWith("/")?"/"+i:i,manifestUri:"/"===i?"/"+a:i+"/"+a}}function Ik(e){var t=ck.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function _k(e){var t=ck.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new BS(e.naturalWidth,e.naturalHeight):e instanceof r?new BS(e.videoWidth,e.videoHeight):new BS(e.width,e.height)}function Nk(e){var t=e.width,n=e.height,r=(0,ck.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function Tk(e,t){var n=ck.getEnv().ImageData;if(!(e instanceof n)&&!Ik(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||_k(e),o=r.width,a=r.height,i=Nk({width:o,height:a});return e instanceof n?hk(i).putImageData(e,0,0):hk(i).drawImage(e,0,0,o,a),i}function Ak(e,t){return f(this,void 0,void 0,function(){var n;return h(this,function(r){switch(r.label){case 0:return[4,(0,ck.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function Dk(e){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,Ak(e)];case 1:return[2,t.sent().json()]}})})}function Ok(e,t){return f(this,void 0,void 0,function(){var n,r,o,a,i,s;return h(this,function(u){switch(u.label){case 0:return n=t||ck.getEnv().createCanvasElement(),r=e.shape.slice(VS(e)?1:0),o=r[0],a=r[1],i=r[2],s=Gd(function(){return e.as3D(o,a,i).toInt()}),[4,kS.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function Mk(e){var t=ck.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function Fk(e,t){return f(this,void 0,void 0,function(){var n,r,o,a;return h(this,function(i){switch(i.label){case 0:return n=Rk(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,Dk(r)];case 1:return a=i.sent(),[2,CS.loadWeights(a,o)]}})})}var Pk=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(US(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(VS(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var o=e instanceof ck.getEnv().Canvas?e:Tk(e);n._canvases[t]=o,n._inputDimensions[t]=[o.height,o.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return KS(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new BS(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Gd(function(){var r=KS(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof Ch){var a=VS(o)?o:o.expandDims();return a=function(e,t){return void 0===t&&(t=!1),Gd(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var a=Math.abs(r-o),i=Math.round(a*(t?.5:1)),s=r>o?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,xp(n,0)},l=u(i),c=a-l.shape[s],f=[t&&c?u(c):null,e,l].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return Sp(f,s)})}(a,t),a.shape[1]===e&&a.shape[2]===e||(a=KC.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(o instanceof ck.getEnv().Canvas)return kS.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=ck.getEnv(),o=r.Image,a=r.Canvas;if(!(e instanceof o||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=_k(e),s=t/Math.max(i.height,i.width),u=s*i.width,l=s*i.height,c=Nk({width:t,height:t}),f=e instanceof a?e:Tk(e),h=Math.abs(u-l)/2,d=n&&u<l?h:0,p=n&&l<u?h:0;return hk(c).drawImage(f,d,p,u,l),c}(o,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)}),o=zp(r.map(function(e){return e.toFloat()})).as4D(n.batchSize,e,e,3);return o})},e}();function Lk(e){return f(this,void 0,void 0,function(){var t,n,r;return h(this,function(o){switch(o.label){case 0:if(e instanceof Pk)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(fk)).forEach(function(e,r){if(!Mk(e)&&!US(e)&&!VS(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(VS(e)){var o=e.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(e){return Mk(e)&&(t=e,new Promise(function(e,n){if(t instanceof ck.getEnv().Canvas||Ik(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),n(e))}t.addEventListener("load",r),t.addEventListener("error",o)}));var t}))];case 1:return o.sent(),[2,new Pk(r,Array.isArray(e))]}})})}var Bk=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof _h})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof _h)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,r=t.tensor,o=fp(r.dataSync());r.dispose(),e.reassignParamFromPath(n,o)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return f(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Fk(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(e){return f(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c;return h(this,function(f){switch(f.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=ck.getEnv().readFile,n=Rk(e,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,a=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},i=CS.weightsLoaderFactory(a),l=(u=JSON).parse,[4,t(r)];case 1:return s=l.apply(u,[f.sent().toString()]),[4,i(s,o)];case 2:return c=f.sent(),this.loadFromWeightMap(c),[2]}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}},{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof Ch))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function zk(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function Wk(e,t,n,r){void 0===r&&(r=!0);for(var o=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),a=[],i=function(){var t=o.pop();a.push(t);for(var i=o,s=[],u=0;u<i.length;u++){var l=i[u],c=e[t],f=e[l];s.push(zk(c,f,r))}o=o.filter(function(e,t){return s[t]<=n})};o.length>0;)i();return a}function Uk(e,t){return Gd(function(){var n=t[0],r=t[1],o=t[2],a=xp(d(e.shape.slice(0,3),[1]),n),i=xp(d(e.shape.slice(0,3),[1]),r),s=xp(d(e.shape.slice(0,3),[1]),o),u=Sp([a,i,s],3);return Jv(e,u)})}function Vk(e){return 1/(1+Math.exp(-e))}var jk,Gk=function(e){return"number"===typeof e};function Hk(e){return Gd(function(){var t=Kv(e,dp(.10000000149011612));return Zp(Zw(Jv(e,t)),t)})}function qk(e,t){return Gd(function(){var n=Ex(e,[[0,0],[1,1],[1,1],[0,0]]);return n=sw(n,t.conv.filters,[1,1],"valid"),n=Jv(n,t.bn.sub),n=Kv(n,t.bn.truediv),Hk(n=Zp(n,t.conv.bias))})}function Kk(e,t){return Gd(function(){var n=Ex(e,[[0,0],[1,1],[1,1],[0,0]]);return n=pw(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),Hk(n=Zp(n,t.bias))})}function Xk(e,t){var n=bk(e,t);var r=Ck(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,a){var i=n(r,o,3,a+"/conv"),s=function(n,r){var o=pp(e(n)),a=pp(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:a}}(o,a+"/bn");return{conv:i,bn:s}},extractSeparableConvParams:r}}function $k(e,t){var n=Sk(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),o=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:o}},extractSeparableConvParams:Ek(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(jk||(jk={}));var Yk=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),Qk=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Gk(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"===typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return Gk(e.x)&&Gk(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(Gk)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return l(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=qk(e,t.conv0);return n=qk(n=Iw(n,[2,2],[2,2],"same"),t.conv1),n=qk(n=Iw(n,[2,2],[2,2],"same"),t.conv2),n=qk(n=Iw(n,[2,2],[2,2],"same"),t.conv3),n=qk(n=Iw(n,[2,2],[2,2],"same"),t.conv4),n=qk(n=Iw(n,[2,2],[2,2],"same"),t.conv5),n=qk(n=Iw(n,[2,2],[1,1],"same"),t.conv6),gk(n=qk(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?Hk(gk(e,t.conv0,"valid",!1)):Kk(e,t.conv0);return n=Kk(n=Iw(n,[2,2],[2,2],"same"),t.conv1),n=Kk(n=Iw(n,[2,2],[2,2],"same"),t.conv2),n=Kk(n=Iw(n,[2,2],[2,2],"same"),t.conv3),n=Kk(n=Iw(n,[2,2],[2,2],"same"),t.conv4),n=Kk(n=Iw(n,[2,2],[2,2],"same"),t.conv5),n=Iw(n,[2,2],[1,1],"same"),n=t.conv6?Kk(n,t.conv6):n,gk(n=t.conv7?Kk(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Gd(function(){var o=e.toBatchTensor(t,!1).toFloat();return o=(o=n.config.meanRgb?Uk(o,n.config.meanRgb):o).div(dp(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},t.prototype.forward=function(e,t){return f(this,void 0,void 0,function(){var n;return h(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Lk(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),f(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,v,m=this;return h(this,function(h){switch(h.label){case 0:return n=new Yk(t),r=n.inputSize,o=n.scoreThreshold,[4,Lk(e)];case 1:return a=h.sent(),[4,this.forwardInput(a,r)];case 2:return i=h.sent(),s=Gd(function(){return Wp(i)[0].expandDims()}),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),o)];case 3:return l=h.sent(),i.dispose(),s.dispose(),c=l.map(function(e){return e.box}),f=l.map(function(e){return e.score}),d=l.map(function(e){return e.classScore}),p=l.map(function(e){return m.config.classes[e.label]}),v=Wk(c.map(function(e){return e.rescale(r)}),f,this.config.iouThreshold,!0),[2,v.map(function(e){return new ek(f[e],d[e],p[e],c[e],u)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],o=$k(e,r),a=o.extractConvParams,i=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:a("conv8")};return yk(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var o,a=kk(e),i=a.extractWeights,s=a.getRemainingWeights,u=[],l=Xk(i,u),c=l.extractConvParams,f=l.extractConvWithBatchNormParams,h=l.extractSeparableConvParams;if(t.withSeparableConvs){var d=r[0],p=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8];o={conv0:t.isFirstLayerConv2d?c(d,p,3,"conv0"):h(d,p,"conv0"),conv1:h(p,v,"conv1"),conv2:h(v,m,"conv2"),conv3:h(m,g,"conv3"),conv4:h(g,y,"conv4"),conv5:h(y,b,"conv5"),conv6:x?h(b,x,"conv6"):void 0,conv7:w?h(x,w,"conv7"):void 0,conv8:c(w||x||b,5*n,1,"conv8")}}else d=r[0],p=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8],o={conv0:f(d,p,"conv0"),conv1:f(p,v,"conv1"),conv2:f(v,m,"conv2"),conv3:f(m,g,"conv3"),conv4:f(g,y,"conv4"),conv5:f(y,b,"conv5"),conv6:f(b,x,"conv6"),conv7:f(x,w,"conv7"),conv8:c(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:o,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return f(this,void 0,void 0,function(){var r,o,a,i,s,u,l,f,d,p,v,m,g,y,b,x,w,C,E,S,k,R,I,_,N,T,A,D,O,M=this;return h(this,function(h){switch(h.label){case 0:return r=t.width,o=t.height,a=Math.max(r,o),i=a/r,s=a/o,u=e.shape[1],l=this.config.anchors.length,f=Gd(function(){var t=e.reshape([u,u,l,M.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,l,4]),t.slice([0,0,0,4],[u,u,l,1]),M.withClassScores?pm(t.slice([0,0,0,5],[u,u,l,M.config.classes.length]),3):dp(0)]}),d=f[0],p=f[1],v=f[2],m=[],[4,p.array()];case 1:return g=h.sent(),[4,d.array()];case 2:y=h.sent(),b=0,h.label=3;case 3:if(!(b<u))return[3,12];x=0,h.label=4;case 4:if(!(x<u))return[3,11];w=0,h.label=5;case 5:return w<l?(C=Vk(g[b][x][w][0]),!n||C>n?(E=(x+Vk(y[b][x][w][0]))/u*i,S=(b+Vk(y[b][x][w][1]))/u*s,k=Math.exp(y[b][x][w][2])*this.config.anchors[w].x/u*i,R=Math.exp(y[b][x][w][3])*this.config.anchors[w].y/u*s,I=E-k/2,_=S-R/2,N={row:b,col:x,anchor:w},this.withClassScores?[4,this.extractPredictedClass(v,N)]:[3,7]):[3,9]):[3,10];case 6:return O=h.sent(),[3,8];case 7:O={classScore:1,label:0},h.label=8;case 8:A=(T=O).classScore,D=T.label,m.push(c({box:new JS(I,_,I+k,_+R),score:C,classScore:C*A,label:D},N)),h.label=9;case 9:return w++,[3,5];case 10:return x++,[3,4];case 11:return b++,[3,3];case 12:return d.dispose(),p.dispose(),v.dispose(),[2,m]}})})},t.prototype.extractPredictedClass=function(e,t){return f(this,void 0,void 0,function(){var n,r,o,a;return h(this,function(i){switch(i.label){case 0:return n=t.row,r=t.col,o=t.anchor,[4,e.array()];case 1:return a=i.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return a[n][r][o][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Bk);function Jk(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach(function(n,r){var o=n.x,a=n.y,i=t[r];e.moveTo(i.x,i.y),e.lineTo(o,a)}),n){var r=t[t.length-1],o=t[0];if(!r||!o)return;e.moveTo(r.x,r.y),e.lineTo(o.x,o.y)}e.stroke()}var Zk=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return l(t,e),t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r);return new t(o.score,o.relativeBox,o.imageDims)},t}(ek);function eR(e){return e.detection instanceof Zk}function tR(e,t){var n={detection:t};return Object.assign({},e,n)}function nR(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof Zk?t.score:eR(t)?t.detection.score:void 0,r=t instanceof Zk?t.box:eR(t)?t.detection.box:new QS(t),o=n?""+GS(n):void 0;new mk(r,{label:o}).draw(e)})}function rR(e,t,n){return nt(function(){var r=zs(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Nu(r,t.bias)})}function oR(e,t,n){return void 0===n&&(n=!1),nt(function(){var r=al(n?Nu(Fs(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):rR(e,t.conv0,[2,2])),o=rR(r,t.conv1,[1,1]),a=rR(al(Nu(r,o)),t.conv2,[1,1]);return al(Nu(r,Nu(o,a)))})}function aR(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),nt(function(){var o=al(n?Nu(Fs(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):rR(e,t.conv0,r?[2,2]:[1,1])),a=rR(o,t.conv1,[1,1]),i=rR(al(Nu(o,a)),t.conv2,[1,1]),s=rR(al(Nu(o,Nu(a,i))),t.conv3,[1,1]);return al(Nu(o,Nu(a,Nu(i,s))))})}function iR(e,t){var n=bk(e,t),r=Ck(e,t);function o(e,t,o,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,o+"/conv0"):r(e,t,o+"/conv0"),conv1:r(t,t,o+"/conv1"),conv2:r(t,t,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var i=o(e,t,n,a);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,n+"/conv3")}}}}function sR(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function uR(e,t){var n=Sk(e,t),r=sR(n),o=Ek(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2"),conv3:o(e+"/conv3")}}}}var lR=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return l(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return nt(function(){var n=aR(Uk(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ft(255)),t.dense0,!0);return n=aR(n,t.dense1),n=aR(n,t.dense2),n=aR(n,t.dense3),n=Js(n,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=uR(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return yk(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=kk(e),r=n.extractWeights,o=n.getRemainingWeights,a=iR(r,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),l=a(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:l}}}(e)},t}(Bk);function cR(e,t){return nt(function(){return Nu(Us(e,t.weights),t.bias)})}function fR(e){var t={},n={};return Object.keys(e).forEach(function(r){(r.startsWith("fc")?n:t)[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var hR=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return l(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return nt(function(){var r=e instanceof Pk?t.faceFeatureExtractor.forwardInput(e):e;return cR(r.as2D(r.shape[0],-1),n.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],o=kk(e),a=o.extractWeights,i=o.getRemainingWeights,s=xk(a,r)(t,n,"fc");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=fR(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=Sk(e,n),o={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return yk(e,n),{params:o,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,o=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(Bk),dR=["neutral","happy","sad","angry","fearful","disgusted","surprised"],pR=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);dR.forEach(function(n,r){t[n]=e[r]})}return e.prototype.asSortedArray=function(){var e=this;return dR.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),vR=function(e){function t(t){return void 0===t&&(t=new lR),e.call(this,"FaceExpressionNet",t)||this}return l(t,e),t.prototype.forwardInput=function(e){var t=this;return nt(function(){return Nt(t.runNet(e))})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictExpressions=function(e){return f(this,void 0,void 0,function(){var t,n,r,o,a=this;return h(this,function(i){switch(i.label){case 0:return[4,Lk(e)];case 1:return t=i.sent(),[4,this.forwardInput(t)];case 2:return n=i.sent(),[4,Promise.all(wi(n).map(function(e){return f(a,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}})})}))];case 3:return r=i.sent(),n.dispose(),o=r.map(function(e){return new pR(e)}),[2,t.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(hR);function mR(e,t){var n={expressions:t};return Object.assign({},e,n)}function gR(e,t,n,r){void 0===n&&(n=.1),(Array.isArray(t)?t:[t]).forEach(function(t){var o=t instanceof pR?t:t.expressions instanceof pR?t.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=o.asSortedArray().filter(function(e){return e.probability>n}),i=eR(t)?t.detection.box.bottomLeft:r||new zS(0,0),s=new pk(a.map(function(e){return e.expression+" ("+GS(e.probability)+")"}),i);s.draw(e)})}var yR=function(){function e(e,t,n){void 0===n&&(n=new zS(0,0));var r=t.width,o=t.height;this._imgDims=new BS(r,o),this._shift=n,this._positions=e.map(function(e){return e.mul(new zS(r,o)).add(n)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new zS(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new zS(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new zS(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof Zk?e.box.floor():new QS(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=r.useDlibAlignment,a=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],o=function(e){return r.sub(e).magnitude()},a=(o(t)+o(n))/2,i=Math.floor(a/.45),s=qS(e),u=Math.floor(Math.max(0,s.x-.5*i)),l=Math.floor(Math.max(0,s.y-.43*i));return new tk(u,l,Math.min(i,this.imageWidth+u),Math.min(i,this.imageHeight+l))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map(function(e){return e.x}),n=e.map(function(e){return e.y}),r=t.reduce(function(e,t){return t<e?t:e},1/0),o=n.reduce(function(e,t){return t<e?t:e},1/0),a=t.reduce(function(e,t){return e<t?t:e},0),i=n.reduce(function(e,t){return e<t?t:e},0);return new JS(r,o,a,i)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),bR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(qS)},t}(yR);function xR(e){return eR(e)&&e.landmarks instanceof yR&&e.unshiftedLandmarks instanceof yR&&e.alignedRect instanceof Zk}function wR(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),a=e.detection.imageDims,i={landmarks:r,unshiftedLandmarks:t,alignedRect:new Zk(e.detection.score,o.rescale(a.reverse()),a)};return Object.assign({},e,i)}var CR=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,o=void 0===r||r,a=e.lineWidth,i=e.lineColor,s=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=s||2,this.lineColor=i||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"},ER=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new CR(t)}return e.prototype.draw=function(e){var t=hk(e),n=this.options,r=n.drawLines,o=n.drawPoints,a=n.lineWidth,i=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof bR&&(t.strokeStyle=i,t.lineWidth=a,Jk(t,this.faceLandmarks.getJawOutline()),Jk(t,this.faceLandmarks.getLeftEyeBrow()),Jk(t,this.faceLandmarks.getRightEyeBrow()),Jk(t,this.faceLandmarks.getNose()),Jk(t,this.faceLandmarks.getLeftEye(),!0),Jk(t,this.faceLandmarks.getRightEye(),!0),Jk(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach(function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})}},e}();function SR(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof yR?t:xR(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new ER(n).draw(e)})}function kR(e,t){var n=[],r=kk(e),o=r.extractWeights,a=r.getRemainingWeights,i=function(e,t){var n=bk(e,t),r=Ck(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,o){return{separable_conv0:r(e,t,o+"/separable_conv0"),separable_conv1:r(t,t,o+"/separable_conv1"),expansion_conv:n(e,t,1,o+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(o,n),s=i.extractConvParams,u=i.extractSeparableConvParams,l=i.extractReductionBlockParams,c=i.extractMainBlockParams,f={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:l(32,64,"entry_flow/reduction_block_0"),reduction_block_1:l(64,128,"entry_flow/reduction_block_1")},h={};KS(t,0,1).forEach(function(e){h["main_block_"+e]=c(128,"middle_flow/main_block_"+e)});var d={reduction_block:l(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:h,exit_flow:d}}}function RR(e,t){var n=[],r=function(e,t){var n=Sk(e,t),r=sR(n),o=Ek(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),separable_conv2:o(e+"/separable_conv2")}}}}(e,n),o=r.extractConvParams,a=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:o("entry_flow/conv_in"),reduction_block_0:i("entry_flow/reduction_block_0"),reduction_block_1:i("entry_flow/reduction_block_1")},l={};KS(t,0,1).forEach(function(e){l["main_block_"+e]=s("middle_flow/main_block_"+e)});var c={reduction_block:i("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return yk(e,n),{params:{entry_flow:u,middle_flow:l,exit_flow:c},paramMappings:n}}function IR(e,t,n){return Nu(Fs(e,t.filters,n,"same"),t.bias)}function _R(e,t,n){void 0===n&&(n=!0);var r=n?al(e):e;return r=rR(r,t.separable_conv0,[1,1]),r=rR(al(r),t.separable_conv1,[1,1]),r=Qs(r,[3,3],[2,2],"same"),r=Nu(r,IR(e,t.expansion_conv,[2,2]))}var NR,TR=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return l(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return nt(function(){var r=Uk(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ft(256)),o=al(IR(r,n.entry_flow.conv_in,[2,2]));return o=_R(o,n.entry_flow.reduction_block_0,!1),o=_R(o,n.entry_flow.reduction_block_1),KS(t._numMainBlocks,0,1).forEach(function(e){o=function(e,t){var n=rR(al(e),t.separable_conv0,[1,1]);return n=rR(al(n),t.separable_conv1,[1,1]),n=rR(al(n),t.separable_conv2,[1,1]),Nu(n,e)}(o,n.middle_flow["main_block_"+e])}),o=_R(o,n.exit_flow.reduction_block),o=al(rR(o,n.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return RR(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return kR(e,this._numMainBlocks)},t}(Bk);!function(e){e.FEMALE="female",e.MALE="male"}(NR||(NR={}));var AR=function(e){function t(t){void 0===t&&(t=new TR(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return l(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return nt(function(){var r=e instanceof Pk?t.faceFeatureExtractor.forwardInput(e):e,o=Js(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:cR(o,n.fc.age).as1D(),gender:cR(o,n.fc.gender)}})},t.prototype.forwardInput=function(e){var t=this;return nt(function(){var n=t.runNet(e),r=n.age,o=n.gender;return{age:r,gender:Nt(o)}})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return f(this,void 0,void 0,function(){var t,n,r,o,a,i,s=this;return h(this,function(u){switch(u.label){case 0:return[4,Lk(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=wi(n.age),o=wi(n.gender),a=r.map(function(e,t){return{ageTensor:e,genderTensor:o[t]}}),[4,Promise.all(a.map(function(e){var t=e.ageTensor,n=e.genderTensor;return f(s,void 0,void 0,function(){var e,r,o,a,i;return h(this,function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(o=r>.5)?NR.MALE:NR.FEMALE,i=o?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:i}]}})})}))];case 3:return i=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=kk(e),r=n.extractWeights,o=n.getRemainingWeights,a=xk(r,t),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=fR(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=Sk(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return yk(e,t),{params:o,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(Bk),DR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],qS([e[3],e[4]])]},t}(yR),OR=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+GS(this.distance)+")":"")},e}(),MR=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e}();function FR(e,t){return f(this,void 0,void 0,function(){var n,r,o,a,i,s;return h(this,function(u){switch(u.label){case 0:return n=ck.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,Lk(e)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=o.getInput(0))instanceof n?(i=a,[3,4]):[3,2];case 2:return[4,Ok(a)];case 3:i=u.sent(),u.label=4;case 4:r=i,u.label=5;case 5:return s=hk(r),[2,t.map(function(e){return e instanceof Zk?e.forSize(r.width,r.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(r.width,r.height)}).map(function(e){var t=e.x,n=e.y,r=e.width,o=e.height,a=Nk({width:r,height:o});return hk(a).putImageData(s.getImageData(t,n,r,o),0,0),a})]}})})}function PR(e,t){return f(this,void 0,void 0,function(){return h(this,function(n){if(!US(e)&&!VS(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(VS(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,nt(function(){var n=e.shape.slice(VS(e)?1:0),r=n[0],o=n[1],a=n[2],i=t.map(function(e){return e instanceof Zk?e.forSize(o,r).box:e}).map(function(e){return e.clipAtImageBorders(o,r)}).map(function(t){var n=t.x,i=t.y,s=t.width,u=t.height;return ru(e.as3D(r,o,a),[i,n,0],[u,s,a])});return i})]})})}var LR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map(function(e){var n=e.width,r=e.height,o=t/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return nt(function(){var n=function(e,t){return yi([Vt([68],e),Vt([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],o=n.width,a=n.height;return t(o,a)?Math.abs(o-a)/2:0},i=e.mul(Vt([o,136],t)).sub(yi(Array.from(Array(o),function(e,t){return n(function(e){return a(e,function(e,t){return e<t})}(t),function(e){return a(e,function(e,t){return t<e})}(t))}))).div(yi(Array.from(Array(o),function(e,t){return n(r[t].width,r[t].height)})));return i})},t.prototype.forwardInput=function(e){var t=this;return nt(function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map(function(e){return{height:e[0],width:e[1]}}))})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.detectLandmarks=function(e){return f(this,void 0,void 0,function(){var t,n,r,o=this;return h(this,function(a){switch(a.label){case 0:return[4,Lk(e)];case 1:return t=a.sent(),n=nt(function(){return wi(o.forwardInput(t))}),[4,Promise.all(n.map(function(e,n){return f(o,void 0,void 0,function(){var r,o,a,i,s;return h(this,function(u){switch(u.label){case 0:return a=(o=Array).from,[4,e.data()];case 1:return r=a.apply(o,[u.sent()]),i=r.filter(function(e,t){return jS(t)}),s=r.filter(function(e,t){return!jS(t)}),[2,new bR(Array(68).fill(0).map(function(e,t){return new zS(i[t],s[t])}),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}})})}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(hR),BR=function(e){function t(t){return void 0===t&&(t=new lR),e.call(this,"FaceLandmark68Net",t)||this}return l(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(LR);var zR=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return l(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return nt(function(){var n=oR(Uk(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ft(255)),t.dense0,!0);return n=oR(n,t.dense1),n=oR(n,t.dense2),n=Js(n,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=uR(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return yk(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=kk(e),r=n.extractWeights,o=n.getRemainingWeights,a=iR(r,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}(e)},t}(Bk),WR=function(e){function t(t){return void 0===t&&(t=new zR),e.call(this,"FaceLandmark68TinyNet",t)||this}return l(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(LR);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}l(t,e)}(BR);function UR(e,t,n,r,o){void 0===o&&(o="same");var a=t.conv,i=a.filters,s=a.bias,u=Fs(e,i,n,o);return u=function(e,t){return Nu(Vu(e,t.weights),t.biases)}(u=Nu(u,s),t.scale),r?al(u):u}function VR(e,t){return UR(e,t,[1,1],!1)}function jR(e,t){return UR(e,t,[2,2],!0,"valid")}function GR(e,t){function n(n,r,o,a){var i=function(t,n,r){var o=e(t),a=o.length/(n*r*r);if(a%1!==0)throw new Error("depth has to be an integer: "+a+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return nt(function(){return sl(zt(o,[n,a,r,r]),[2,3,1,0])})}(n,r,o),s=Pt(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}function r(r,o,a,i){var s=n(r,o,a,i+"/conv"),u=function(n,r){var o=Pt(e(n)),a=Pt(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:a}}(o,i+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,o,a){return void 0===a&&(a=!1),{conv1:r((a?.5:1)*e,t,n,o+"/conv1"),conv2:r(e,t,n,o+"/conv2")}}}}function HR(e,t){var n=Sk(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),o=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:o}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function qR(e){var t=[],n=HR(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,a=r("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),f=o("conv64_2"),h=o("conv64_3"),d=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),y=o("conv256_2"),b=o("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!function(e){return WS(e,2)}(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:f,conv64_3:h,conv128_down:d,conv128_1:p,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return yk(e,t),{params:w,paramMappings:t}}function KR(e,t){var n=function(e,t){return UR(e,t,[1,1],!0)}(e,t.conv1);return n=VR(n,t.conv2),n=Nu(n,e),n=al(n)}function XR(e,t){var n=jR(e,t.conv1);n=VR(n,t.conv2);var r=Js(e,2,2,"valid"),o=Ut(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var i=n.shape.slice();i[1]=1;var s=Ut(i),u=(n=Fa([n,s],1)).shape.slice();u[2]=1;var l=Ut(u);n=Fa([n,l],2)}return r=a?Fa([r,o],3):r,n=Nu(r,n),n=al(n)}var $R=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return l(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return nt(function(){var n=jR(Uk(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Ft(256)),t.conv32_down);n=KR(n=Qs(n,3,2,"valid"),t.conv32_1),n=KR(n,t.conv32_2),n=KR(n,t.conv32_3),n=KR(n=XR(n,t.conv64_down),t.conv64_1),n=KR(n,t.conv64_2),n=KR(n,t.conv64_3),n=KR(n=XR(n,t.conv128_down),t.conv128_1),n=KR(n,t.conv128_2),n=KR(n=XR(n,t.conv256_down),t.conv256_1);var r=(n=XR(n=KR(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Us(r,t.fc)})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return f(this,void 0,void 0,function(){var t,n,r,o=this;return h(this,function(a){switch(a.label){case 0:return[4,Lk(e)];case 1:return t=a.sent(),n=nt(function(){return wi(o.forwardInput(t))}),[4,Promise.all(n.map(function(e){return e.data()}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return qR(e)},t.prototype.extractParams=function(e){return function(e){var t=kk(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=GR(n,o),i=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),C=s(589824,256,3,"conv256_down_out"),E=nt(function(){return sl(Lt(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:f,conv64_down:h,conv64_1:d,conv64_2:p,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:w,conv256_down_out:C,fc:E},paramMappings:o}}(e)},t}(Bk);var YR=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,i=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=i,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!==typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function QR(e,t){function n(n,r,o,a,i){var s=zt(e(n*r*o*o),[o,o,n,r]),u=Pt(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(i?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,o){var a=n(e,t,r,o,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function o(n,o,a){var i=function(n,r){var o=zt(e(9*n),[3,3,n,1]),a=Pt(e(n)),i=Pt(e(n)),s=Pt(e(n)),u=Pt(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:a,batch_norm_offset:i,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv");return{depthwise_conv:i,pointwise_conv:r(n,o,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function JR(e){var t=[],n=function(e,t){var n=Sk(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(e){var t="mobilenetv1/conv_"+e,o="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",i=t+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,i)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function i(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:i(0),box_predictor_1:i(1),box_predictor_2:i(2),box_predictor_3:i(3),box_predictor_4:i(4),box_predictor_5:i(5)}}}}(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!US(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:a}};return yk(e,t),{params:i,paramMappings:t}}function ZR(e,t,n){return nt(function(){var r=Fs(e,t.filters,n,"same");return r=Nu(r,t.batch_norm_offset),Fi(r,0,6)})}function eI(e,t){return nt(function(){var n=null,r=ZR(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(e,t){var o=t+1,a=function(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}(o);r=function(e,t,n){return nt(function(){var r=Bs(e,t.filters,n,"same");return r=ys(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Fi(r,0,6)})}(r,e.depthwise_conv,a),r=ZR(r,e.pointwise_conv,[1,1]),11===o&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function tI(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),h=(i-o)*(s-a),d=(c-u)*(f-l);if(h<=0||d<=0)return 0;var p=Math.max(o,u),v=Math.max(a,l),m=Math.min(i,c),g=Math.min(s,f),y=Math.max(m-p,0)*Math.max(g-v,0);return y/(h+d-y)}function nI(e,t){var n=function(e){var t=wi(sl(e,[1,0])),n=[Xu(t[2],t[0]),Xu(t[3],t[1])];return{sizes:n,centers:[Nu(t[0],Ou(n[0],Ft(2))),Nu(t[1],Ou(n[1],Ft(2)))]}}(e),r=n.sizes,o=n.centers,a=wi(sl(t,[1,0])),i=Ou(Vu(zi(Ou(a[2],Ft(5))),r[0]),Ft(2)),s=Nu(Vu(Ou(a[0],Ft(10)),r[0]),o[0]),u=Ou(Vu(zi(Ou(a[3],Ft(5))),r[1]),Ft(2)),l=Nu(Vu(Ou(a[1],Ft(10)),r[1]),o[1]);return sl(yi([Xu(s,i),Xu(l,u),Nu(s,i),Nu(l,u)]),[1,0])}function rI(e,t){return nt(function(){var n=e.shape[0];return{boxPredictionEncoding:vi(gk(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:vi(gk(e,t.class_predictor),[n,-1,3])}})}var oI=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),aI=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return l(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return nt(function(){var n=e.toBatchTensor(512,!1).toFloat(),r=eI(Xu(Vu(n,Ft(.007843137718737125)),Ft(1)),t.mobilenetv1),o=function(e,t,n){return nt(function(){var r=ZR(e,n.conv_0,[1,1]),o=ZR(r,n.conv_1,[2,2]),a=ZR(o,n.conv_2,[1,1]),i=ZR(a,n.conv_3,[2,2]),s=ZR(i,n.conv_4,[1,1]),u=ZR(s,n.conv_5,[2,2]),l=ZR(u,n.conv_6,[1,1]),c=ZR(l,n.conv_7,[2,2]),f=rI(t,n.box_predictor_0),h=rI(e,n.box_predictor_1),d=rI(o,n.box_predictor_2),p=rI(i,n.box_predictor_3),v=rI(u,n.box_predictor_4),m=rI(c,n.box_predictor_5);return{boxPredictions:Fa([f.boxPredictionEncoding,h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:Fa([f.classPrediction,h.classPrediction,d.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1)}})}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return nt(function(){var r=e.shape[0],o=nI(vi(bi(n.extra_dim,[r,1,1]),[-1,4]),vi(e,[-1,4]));o=vi(o,[r,o.shape[0]/r,4]);var a=$i(eu(t,[0,0,1],[-1,-1,-1])),i=eu(a,[0,0,0],[-1,-1,1]);return i=vi(i,[r,i.shape[1]]),{boxes:wi(o),scores:wi(i)}})}(o.boxPredictions,o.classPredictions,t.output_layer)})},t.prototype.forward=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Lk(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),f(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,v,m,g,y,b,x,w,C;return h(this,function(h){switch(h.label){case 0:return n=new oI(t),r=n.maxResults,o=n.minConfidence,[4,Lk(e)];case 1:for(a=h.sent(),i=this.forwardInput(a),s=i.boxes,u=i.scores,l=s[0],c=u[0],f=1;f<s.length;f++)s[f].dispose(),u[f].dispose();return v=(p=Array).from,[4,c.data()];case 2:return d=v.apply(p,[h.sent()]),m=function(e,t,n,r,o){var a=e.shape[0],i=Math.min(n,a),s=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),u=function(e){return e<=r?1:0},l=[];return s.forEach(function(t){if(!(l.length>=i)){for(var n=t.score,r=l.length-1;r>=0;--r){var a=tI(e,t.boxIndex,l[r]);if(0!==a&&(t.score*=u(a),t.score<=o))break}n===t.score&&l.push(t.boxIndex)}}),l}(l,d,r,.5,o),g=a.getReshapedInputDimensions(0),y=a.inputSize,b=y/g.width,x=y/g.height,w=l.arraySync(),C=m.map(function(e){var t=[Math.max(0,w[e][0]),Math.min(1,w[e][2])].map(function(e){return e*x}),n=t[0],r=t[1],o=[Math.max(0,w[e][1]),Math.min(1,w[e][3])].map(function(e){return e*b}),i=o[0],s=o[1];return new Zk(d[e],new tk(i,n,s-i,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),l.dispose(),c.dispose(),[2,C]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return JR(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=kk(e),r=n.extractWeights,o=n.getRemainingWeights,a=QR(r,t),i=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=i(),l=s(),c={extra_dim:Bt(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:c},paramMappings:t}}(e)},t}(Bk);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}l(t,e)}(aI);var iI=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return l(t,e),t}(Yk),sI=function(){function e(){}return e.prototype.then=function(e){return f(this,void 0,void 0,function(){var t;return h(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},e.prototype.run=function(){return f(this,void 0,void 0,function(){return h(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},e}();function uI(e,t){var n={descriptor:t};return Object.assign({},e,n)}function lI(e,t,n,r,o){return void 0===o&&(o=function(e){return e.alignedRect}),f(this,void 0,void 0,function(){var a,i,s,u,l;return h(this,function(c){switch(c.label){case 0:return a=e.map(function(e){return xR(e)?o(e):e.detection}),(s=r)?[3,5]:t instanceof xe?[4,PR(t,a)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,FR(t,a)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return[4,n(i=s)];case 6:return l=c.sent(),i.forEach(function(e){return e instanceof xe&&e.dispose()}),[2,l]}})})}function cI(e,t,n,r,o){return f(this,void 0,void 0,function(){var a=this;return h(this,function(i){return[2,lI([e],t,function(e){return f(a,void 0,void 0,function(){return h(this,function(t){return[2,n(e[0])]})})},r,o)]})})}function fI(e){var t=kk(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=function(e,t){var n=bk(e,t),r=xk(e,t);function o(n,r){var o=Pt(e(n));return t.push({paramPath:r}),o}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:o(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:o(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:o(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return c({},e,{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),i=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return c({},e,{fc1:t,prelu4_alpha:n,fc2_1:i,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),i=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),l=r(256,2,"onet/fc2_1"),f=r(256,4,"onet/fc2_2"),h=r(256,10,"onet/fc2_3");return c({},e,{conv4:t,prelu4_alpha:i,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:f,fc2_3:h})}}}(n,o),i=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,l=i(),f=s(),h=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:f,onet:h},paramMappings:o}}function hI(e){var t=[],n=function(e,t){var n=Sk(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function o(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function i(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return c({},e,{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=i("rnet"),t=o("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return c({},e,{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=i("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=o("onet/fc1"),u=a("onet/prelu5_alpha"),l=o("onet/fc2_1"),f=o("onet/fc2_2"),h=o("onet/fc2_3");return c({},e,{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:f,fc2_3:h})}}}(e,t),r=n.extractPNetParams,o=n.extractRNetParams,a=n.extractONetParams,i=r(),s=o(),u=a();return yk(e,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}function dI(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var pI=function(e){function t(t,n,r,o){return e.call(this,{left:t,top:n,right:r,bottom:o},!0)||this}return l(t,e),t}(QS);function vI(e){return nt(function(){return Vu(Xu(e,Ft(127.5)),Ft(.0078125))})}function mI(e,t){return nt(function(){return Nu(al(e),Vu(t,Hi(al(Hi(e)))))})}function gI(e,t,n){return void 0===n&&(n=!1),nt(function(){var r=gk(e,t.conv1,"valid");return r=mI(r,t.prelu1_alpha),r=mI(r=gk(r=Qs(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=mI(r=gk(r=n?r:Qs(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function yI(e,t,n,r,o){o.stage1=[];var a=t.map(function(t){return nt(function(){var n={scale:t},o=function(e,t){return nt(function(){var n=dI(t,e.shape.slice(1)),r=n.height,o=n.width,a=vI($l.resizeBilinear(e,[r,o]));return sl(a,[0,2,1,3])})}(e,t),a=Date.now(),i=function(e,t){return nt(function(){var n=gI(e,t,!0),r=gk(n,t.conv4_1,"valid"),o=ri(fu(r,3),3);return{prob:Nt(Xu(r,o),3),regions:gk(n,t.conv4_2,"valid")}})}(o,r),s=i.prob,u=i.regions;return n.pnet=Date.now()-a,{scoresTensor:wi(wi(s,3)[1])[0],regionsTensor:wi(u)[0],scale:t,statsForScale:n}})}),i=a.map(function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,i=e.statsForScale,s=function(e,t,n,r){for(var o=[],a=e.arraySync(),i=0;i<e.shape[0];i++)for(var s=0;s<e.shape[1];s++)a[i][s]>=r&&o.push(new zS(s,i));return o.map(function(e){var r=new JS(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),o=a[e.y][e.x],i=t.arraySync();return{cell:r,score:o,region:new pI(i[e.y][e.x][0],i[e.y][e.x][1],i[e.y][e.x][2],i[e.y][e.x][3])}})}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return o.stage1.push(i),[];var u=Date.now(),l=Wk(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.5);return i.nms=Date.now()-u,i.numBoxes=l.length,o.stage1.push(i),l.map(function(e){return s[e]})}),s=i.reduce(function(e,t){return e.concat(t)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),f=Wk(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.7);o.stage1_nms=Date.now()-c,l=f.map(function(e){return s[e].score}),u=f.map(function(e){return s[e]}).map(function(e){var t=e.cell,n=e.region;return new JS(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()})}return{boxes:u,scores:l}}function bI(e,t,n){var r=n.width,o=n.height;return f(this,void 0,void 0,function(){var n,a,i,s=this;return h(this,function(u){switch(u.label){case 0:return n=hk(e),[4,Promise.all(t.map(function(t){return f(s,void 0,void 0,function(){var r,o,a,i,s,u,l,c;return h(this,function(f){return r=t.padAtBorders(e.height,e.width),o=r.y,a=r.ey,i=r.x,s=r.ex,u=i-1,l=o-1,c=n.getImageData(u,l,s-u,a-l),[2,ck.isNodejs()?Tk(c):createImageBitmap(c)]})})}))];case 1:return a=u.sent(),i=[],a.forEach(function(e){var t=hk(Nk({width:r,height:o}));t.drawImage(e,0,0,r,o);for(var n=t.getImageData(0,0,r,o).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);i.push(a)}),[2,i.map(function(e){return nt(function(){return vI(sl(zt(e,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function xI(e,t,n,r,o){return f(this,void 0,void 0,function(){var a,i,s,u,l,c,f,d,p,v,m,g,y,b;return h(this,function(h){switch(h.label){case 0:return a=Date.now(),[4,bI(e,t,{width:24,height:24})];case 1:return i=h.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return nt(function(){var n=gI(e,t),r=mI(cR(vi(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),o=cR(r,t.fc2_1),a=ri(fu(o,1),1),i=Nt(Xu(o,a),1),s=cR(r,t.fc2_2);return{scores:wi(i,1)[1],regions:s}})}(e,r);return e.dispose(),t}),o.stage2_rnet=Date.now()-a,u=s.length>1?Fa(s.map(function(e){return e.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[h.sent()]),u.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),p=d.map(function(e){return t[e]}),v=d.map(function(e){return l[e]}),m=[],g=[],p.length>0&&(a=Date.now(),y=Wk(p,v,.7),o.stage2_nms=Date.now()-a,b=y.map(function(e){var t=s[d[e]].regions.arraySync();return new pI(t[0][0],t[0][1],t[0][2],t[0][3])}),g=y.map(function(e){return v[e]}),m=y.map(function(e,t){return p[e].calibrate(b[t])})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function wI(e,t,n,r,o){return f(this,void 0,void 0,function(){var a,i,s,u,l,c,f,d,p,v,m,g,y,b,x;return h(this,function(h){switch(h.label){case 0:return a=Date.now(),[4,bI(e,t,{width:48,height:48})];case 1:return i=h.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return nt(function(){var n=gI(e,t);n=mI(n=gk(n=Qs(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=mI(cR(vi(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),o=cR(r,t.fc2_1),a=ri(fu(o,1),1),i=Nt(Xu(o,a),1),s=cR(r,t.fc2_2),u=cR(r,t.fc2_3);return{scores:wi(i,1)[1],regions:s,points:u}})}(e,r);return e.dispose(),t}),o.stage3_onet=Date.now()-a,u=s.length>1?Fa(s.map(function(e){return e.scores})):s[0].scores,f=(c=Array).from,[4,u.data()];case 2:return l=f.apply(c,[h.sent()]),u.dispose(),d=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),p=d.map(function(e){var t=s[e].regions.arraySync();return new pI(t[0][0],t[0][1],t[0][2],t[0][3])}),v=d.map(function(e,n){return t[e].calibrate(p[n])}),m=d.map(function(e){return l[e]}),g=[],y=[],b=[],v.length>0&&(a=Date.now(),x=Wk(v,m,.7,!1),o.stage3_nms=Date.now()-a,g=x.map(function(e){return v[e]}),y=x.map(function(e){return m[e]}),b=x.map(function(e,t){return Array(5).fill(0).map(function(n,r){var o=s[e].points.arraySync();return new zS(o[0][r]*(g[t].width+1)+g[t].left,o[0][r+5]*(g[t].height+1)+g[t].top)})})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:g,scores:y,points:b}]}})})}var CI=function(e){function t(){return e.call(this,"Mtcnn")||this}return l(t,e),t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),f(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,f,d,p,v,m,g,y,b,x,w,C,E;return h(this,function(h){switch(h.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},a=Date.now(),i=nt(function(){return function(e){return nt(function(){return yi(wi(e,3).reverse(),3)})}(ri(qc.fromPixels(r)).toFloat())}),s=function(e){return i.dispose(),o.total=Date.now()-a,e},u=i.shape.slice(1),l=u[0],c=u[1],f=new YR(t),d=f.minFaceSize,p=f.scaleFactor,v=f.maxNumScales,m=f.scoreThresholds,g=f.scaleSteps,y=(g||function(e,t,n){for(var r=n[0],o=n[1],a=12/e,i=[],s=Math.min(r,o)*a,u=0;s>=12;)i.push(a*Math.pow(t,u)),s*=t,u+=1;return i}(d,p,[l,c])).filter(function(e){var t=dI(e,[l,c]);return Math.min(t.width,t.height)>12}).slice(0,v),o.scales=y,o.pyramid=y.map(function(e){return dI(e,[l,c])}),b=Date.now(),[4,yI(i,y,m[0],n.pnet,o)];case 1:return x=h.sent(),o.total_stage1=Date.now()-b,x.boxes.length?(o.stage2_numInputBoxes=x.boxes.length,b=Date.now(),[4,xI(r,x.boxes,m[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return w=h.sent(),o.total_stage2=Date.now()-b,w.boxes.length?(o.stage3_numInputBoxes=w.boxes.length,b=Date.now(),[4,wI(r,w.boxes,m[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return C=h.sent(),o.total_stage3=Date.now()-b,E=C.boxes.map(function(e,t){return wR(tR({},new Zk(C.scores[t],new tk(e.left/c,e.top/l,e.width/c,e.height/l),{height:l,width:c})),new DR(C.points[t].map(function(t){return t.sub(new zS(e.left,e.top)).div(new zS(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,s({results:E,stats:o})]}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),f(this,void 0,void 0,function(){var n;return h(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Lk(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),f(this,void 0,void 0,function(){var n;return h(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Lk(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return hI(e)},t.prototype.extractParams=function(e){return fI(e)},t}(Bk),EI=[new zS(1.603231,2.094468),new zS(6.041143,7.080126),new zS(2.882459,3.518061),new zS(4.266906,5.178857),new zS(9.041765,10.66308)],SI=[117.001,114.697,97.404],kI=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:EI,meanRgb:SI,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return l(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new Zk(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Qk),RI=[new zS(.738768,.874946),new zS(2.42204,2.65704),new zS(4.30971,7.04493),new zS(10.246,4.59428),new zS(12.6868,11.8741)],II=[new zS(1.603231,2.094468),new zS(6.041143,7.080126),new zS(2.882459,3.518061),new zS(4.266906,5.178857),new zS(9.041765,10.66308)],_I=[117.001,114.697,97.404],NI=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:II,meanRgb:_I}:{anchors:RI,withClassScores:!0});return e.call(this,n)||this}return l(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return f(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new Zk(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Qk);var TI={ssdMobilenetv1:new aI,tinyFaceDetector:new kI,tinyYolov2:new NI,mtcnn:new CI,faceLandmark68Net:new BR,faceLandmark68TinyNet:new WR,faceRecognitionNet:new $R,faceExpressionNet:new vR,ageGenderNet:new AR};function AI(e,t){var n={age:t};return Object.assign({},e,n)}function DI(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var OI=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return l(t,e),t}(sI),MI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t,n=this;return h(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,lI(e=r.sent(),this.input,function(e){return f(n,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return TI.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){return mR(e,t[n])})]}})})},t.prototype.withAgeAndGender=function(){return new zI(this,this.input)},t}(OI),FI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t;return h(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,cI(e,this.input,function(e){return TI.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,mR(e,t)]}})})},t.prototype.withAgeAndGender=function(){return new WI(this,this.input)},t}(OI),PI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.withAgeAndGender=function(){return new UI(this,this.input)},t.prototype.withFaceDescriptors=function(){return new GI(this,this.input)},t}(MI),LI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.withAgeAndGender=function(){return new VI(this,this.input)},t.prototype.withFaceDescriptor=function(){return new HI(this,this.input)},t}(FI),BI=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return l(t,e),t}(sI),zI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t,n=this;return h(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,lI(e=r.sent(),this.input,function(e){return f(n,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return TI.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){var r=t[n],o=r.age;return AI(DI(e,r.gender,r.genderProbability),o)})]}})})},t.prototype.withFaceExpressions=function(){return new MI(this,this.input)},t}(BI),WI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t,n,r,o;return h(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,cI(e,this.input,function(e){return TI.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,o=t.genderProbability,[2,AI(DI(e,r,o),n)]}})})},t.prototype.withFaceExpressions=function(){return new FI(this,this.input)},t}(BI),UI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.withFaceExpressions=function(){return new PI(this,this.input)},t.prototype.withFaceDescriptors=function(){return new GI(this,this.input)},t}(zI),VI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.withFaceExpressions=function(){return new LI(this,this.input)},t.prototype.withFaceDescriptor=function(){return new HI(this,this.input)},t}(WI),jI=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return l(t,e),t}(sI),GI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e;return h(this,function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,lI(e=t.sent(),this.input,function(e){return Promise.all(e.map(function(e){return TI.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,t.sent().map(function(t,n){return uI(e[n],t)})]}})})},t.prototype.withFaceExpressions=function(){return new PI(this,this.input)},t.prototype.withAgeAndGender=function(){return new UI(this,this.input)},t}(jI),HI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t;return h(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,cI(e,this.input,function(e){return TI.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=n.sent(),[2,uI(e,t)]}})})},t.prototype.withFaceExpressions=function(){return new LI(this,this.input)},t.prototype.withAgeAndGender=function(){return new VI(this,this.input)},t}(jI),qI=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=r,o}return l(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?TI.faceLandmark68TinyNet:TI.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(sI),KI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t,n,r,o,a=this;return h(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),t=e.map(function(e){return e.detection}),this.input instanceof xe?[4,PR(this.input,t)]:[3,3];case 2:return r=i.sent(),[3,5];case 3:return[4,FR(this.input,t)];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,Promise.all(n.map(function(e){return a.landmarkNet.detectLandmarks(e)}))];case 6:return o=i.sent(),n.forEach(function(e){return e instanceof xe&&e.dispose()}),[2,e.map(function(e,t){return wR(e,o[t])})]}})})},t.prototype.withFaceExpressions=function(){return new PI(this,this.input)},t.prototype.withAgeAndGender=function(){return new UI(this,this.input)},t.prototype.withFaceDescriptors=function(){return new GI(this,this.input)},t}(qI),XI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t,n,r,o;return h(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof xe?[4,PR(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,FR(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=a.sent(),n.forEach(function(e){return e instanceof xe&&e.dispose()}),[2,wR(e,o)]}})})},t.prototype.withFaceExpressions=function(){return new LI(this,this.input)},t.prototype.withAgeAndGender=function(){return new VI(this,this.input)},t.prototype.withFaceDescriptor=function(){return new HI(this,this.input)},t}(qI),$I=function(e){function t(t,n){void 0===n&&(n=new oI);var r=e.call(this)||this;return r.input=t,r.options=n,r}return l(t,e),t}(sI),YI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t,n,r;return h(this,function(o){switch(o.label){case 0:return t=(e=this).input,(n=e.options)instanceof YR?[4,TI.mtcnn.forward(t,n)]:[3,2];case 1:return[2,o.sent().map(function(e){return e.detection})];case 2:if(r=n instanceof iI?function(e){return TI.tinyFaceDetector.locateFaces(e,n)}:n instanceof oI?function(e){return TI.ssdMobilenetv1.locateFaces(e,n)}:n instanceof Yk?function(e){return TI.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return f(e,void 0,void 0,function(){var e;return h(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map(function(e){return tR({},e)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new KI(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new MI(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new zI(this.runAndExtendWithFaceDetections(),this.input)},t}($I);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}l(t,e),t.prototype.run=function(){return f(this,void 0,void 0,function(){var e,t;return h(this,function(n){switch(n.label){case 0:return[4,new YI(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return f(e,void 0,void 0,function(){var e;return h(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?tR({},e):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new XI(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new FI(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new WI(this.runAndExtendWithFaceDetection(),this.input)}}($I);!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map(function(e){if(e instanceof MR)return e;if(e instanceof Float32Array)return new MR(o(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new MR(o(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(e,t){return e-r[t]}).reduce(function(e,t){return e+Math.pow(t,2)},0))}(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,o=n.label;return new OR(o,t.computeMeanDistance(e,r))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new OR("unknown",t.distance)}}();c({},e,t);var QI=n(579);const JI=e=>{let{onMoodDetected:t,isActive:n}=e;const o=(0,r.useRef)(null),a=(0,r.useRef)(null),[i,u]=(0,r.useState)(!0),[l,c]=(0,r.useState)(!1),[f,h]=(0,r.useState)(null),[d,p]=(0,r.useState)(0);(0,r.useEffect)(()=>{n&&(async()=>{try{await Promise.all([TI.tinyFaceDetector.loadFromUri("/models"),TI.faceExpressionNet.loadFromUri("/models")]),c(!0),u(!1)}catch(e){console.log("Face detection models not available, using fallback"),u(!1)}})()},[n]);const v=async()=>{if(!o.current||!l||!n)return;const e=o.current.video;var r,a;if(e)try{const n=await(r=e,a=new iI,void 0===a&&(a=new oI),new YI(r,a)).withFaceExpressions();if(n.length>0){const e=n[0].expressions,r={angry:"angry_hungry",sad:"single_and_starving",neutral:"productively_lazy",happy:"peaceful_chaotic",surprised:"tired_dramatic"};let o="",a=0;if(Object.entries(e).forEach(e=>{let[t,n]=e;n>a&&(a=n,o=t)}),a>.3){const e=r[o];e&&(h(o),p(a),t(e,a))}}}catch(i){console.log("Mood detection error:",i)}};return(0,r.useEffect)(()=>{if(n&&l){const e=setInterval(v,1e3);return()=>clearInterval(e)}},[n,l]),n?(0,QI.jsxs)("div",{className:"mood-detector",children:[(0,QI.jsxs)("div",{className:"camera-container",children:[(0,QI.jsx)(s(),{ref:o,audio:!1,screenshotFormat:"image/jpeg",className:"webcam",mirrored:!0}),(0,QI.jsx)("canvas",{ref:a,className:"detection-canvas"}),i&&(0,QI.jsxs)("div",{className:"loading-overlay",children:[(0,QI.jsx)("div",{className:"spinner"}),(0,QI.jsx)("p",{children:"Loading mood detection..."})]}),!l&&!i&&(0,QI.jsxs)("div",{className:"fallback-message",children:[(0,QI.jsx)("p",{children:"\ud83d\udcf7 Camera mood detection unavailable"}),(0,QI.jsx)("small",{children:"Models not loaded - manual selection only"})]})]}),f&&(0,QI.jsx)("div",{className:"mood-result",children:(0,QI.jsxs)("div",{className:"detected-emotion",children:[(0,QI.jsxs)("strong",{children:["Detected: ",f]}),(0,QI.jsx)("div",{className:"confidence-bar",children:(0,QI.jsx)("div",{className:"confidence-fill",style:{width:"".concat(100*d,"%")}})}),(0,QI.jsxs)("small",{children:[Math.round(100*d),"% confident"]})]})})]}):null},ZI=e=>{let{onIngredientsDetected:t}=e;const[n,o]=(0,r.useState)(!1),[a,i]=(0,r.useState)(null),[s,u]=(0,r.useState)([]),l=(0,r.useRef)(null);return(0,QI.jsxs)("div",{className:"ingredient-scanner",children:[(0,QI.jsxs)("div",{className:"scanner-header",children:[(0,QI.jsx)("h4",{children:"\ud83d\udd0d Ingredient Scanner"}),(0,QI.jsx)("p",{children:"Upload a photo of your ingredients and we'll create chaos!"})]}),(0,QI.jsxs)("div",{className:"upload-area",children:[(0,QI.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const n=e.target.files[0];if(n){const e=new FileReader;e.onload=e=>{i(e.target.result),o(!0),u([]),setTimeout(()=>{const e=["tomatoes","onions","garlic","cheese","bread","eggs","milk","rice","chicken","pasta","carrots","potatoes","spinach","bell peppers"],n=Math.floor(4*Math.random())+3,r=[];for(let t=0;t<n;t++){const t=e[Math.floor(Math.random()*e.length)];r.includes(t)||r.push(t)}u(r),o(!1),t(r)},2e3)},e.readAsDataURL(n)}},ref:l,style:{display:"none"}}),a?(0,QI.jsxs)("div",{className:"scan-result",children:[(0,QI.jsx)("img",{src:a,alt:"Uploaded ingredients",className:"uploaded-img"}),n&&(0,QI.jsxs)("div",{className:"scanning-overlay",children:[(0,QI.jsx)("div",{className:"scanner-line"}),(0,QI.jsx)("p",{children:"\ud83e\udd16 AI analyzing ingredients..."})]}),s.length>0&&(0,QI.jsxs)("div",{className:"ingredients-result",children:[(0,QI.jsx)("h5",{children:"Detected Ingredients:"}),(0,QI.jsx)("div",{className:"ingredient-tags",children:s.map((e,t)=>(0,QI.jsx)("span",{className:"ingredient-tag",children:e},t))}),(0,QI.jsx)("button",{className:"generate-recipe-btn",onClick:()=>{const e=(()=>{if(0===s.length)return;const e=["Blend with ice cream and top with crushed crackers","Wrap in chocolate and serve with pickle juice","Deep fry and coat in honey and chili powder","Mix with peanut butter and freeze overnight","Bake with marshmallows and add hot sauce","Stuff into a waffle cone with whipped cream","Marinate in coffee and serve with cotton candy"],t=e[Math.floor(Math.random()*e.length)],n=s.join(", ");return{title:"Chaotic ".concat(s[0].charAt(0).toUpperCase()+s[0].slice(1)," Fusion"),desc:"Take your ".concat(n," and ").concat(t,". Chaos level: ").concat(Math.floor(3*Math.random())+8,"/10"),img:a,chaos:Math.floor(3*Math.random())+8,ingredients:s,isUserGenerated:!0}})();t(s,e)},children:"\ud83c\udfb2 Generate Weird Recipe"})]}),(0,QI.jsx)("button",{className:"rescan-btn",onClick:()=>{i(null),u([]),o(!1)},children:"Scan New Photo"})]}):(0,QI.jsx)("button",{className:"upload-btn",onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},children:"\ud83d\udcf8 Scan Ingredients"})]})]})},e_=e=>{let{soundEnabled:t=!0}=e;const[n,o]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&"AudioContext"in window&&o(new(window.AudioContext||window.webkitAudioContext))},[t]);return{playSound:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n||!t)return;const{frequency:o=440,duration:a=100,volume:i=.1}=r,s=n.createOscillator(),u=n.createGain();switch(s.connect(u),u.connect(n.destination),e){case"click":s.frequency.setValueAtTime(800,n.currentTime),s.frequency.exponentialRampToValueAtTime(400,n.currentTime+.1),u.gain.setValueAtTime(i,n.currentTime),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+.1);break;case"hover":s.frequency.setValueAtTime(600,n.currentTime),u.gain.setValueAtTime(.5*i,n.currentTime),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+.05);break;case"success":s.frequency.setValueAtTime(523,n.currentTime),s.frequency.setValueAtTime(659,n.currentTime+.1),s.frequency.setValueAtTime(784,n.currentTime+.2),u.gain.setValueAtTime(i,n.currentTime),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+.3);break;case"surprise":s.frequency.setValueAtTime(200,n.currentTime),s.frequency.exponentialRampToValueAtTime(1e3,n.currentTime+.2),u.gain.setValueAtTime(i,n.currentTime),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+.2);break;case"chef":s.frequency.setValueAtTime(349,n.currentTime),s.frequency.setValueAtTime(392,n.currentTime+.1),s.frequency.setValueAtTime(440,n.currentTime+.2),u.gain.setValueAtTime(i,n.currentTime),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+.3);break;default:s.frequency.setValueAtTime(o,n.currentTime),u.gain.setValueAtTime(i,n.currentTime),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+a/1e3)}s.start(n.currentTime),s.stop(n.currentTime+a/1e3)}}},t_=e=>{let{currentDish:t,playSound:n}=e;const[o,a]=(0,r.useState)(""),[i,s]=(0,r.useState)(""),[u,l]=(0,r.useState)(""),[c,f]=(0,r.useState)(750),[h,d]=(0,r.useState)(0),[p,v]=(0,r.useState)(""),[m,g]=(0,r.useState)("#ff7a59"),[y,b]=(0,r.useState)(""),x=["Rebellious and edgy","Mysteriously alluring","Chaotically neutral","Aggressively wholesome","Passive-aggressively delicious","Ironically healthy","Suspiciously appetizing","Dramatically underwhelming","Confidently confused"],w=["Perfect for a Tuesday afternoon in fictional weather","Best enjoyed during imaginary rainfall","Ideal temperature: room temperature but emotionally warm","Recommended atmospheric pressure: whatever feels right","Optimal humidity: slightly existential"],C=["Your dish is in Mercury retrograde - expect flavor confusion","Jupiter aligns with your hunger - chaos levels may increase","Venus suggests adding more questionable ingredients","Mars warns against logical food choices today","Saturn recommends questioning your life choices"],E=['"Every weird bite is a step toward culinary enlightenment" - Anonymous Chef','"Chaos in the kitchen leads to growth in the soul" - Probably Gandhi','"Normal food is for normal people. You are not normal." - Your Dish','"Embrace the weird, taste the impossible" - Fake Inspirational Person','"Your taste buds called - they want adventure" - Imaginary Nutritionist'],S=[{lang:"Gibberish",translation:"Flibber jabberwocky nom nommus"},{lang:"Food Latin",translation:"Chaoticus dishius supremus"},{lang:"Alien",translation:"\u1e8c\xf8\u0159\u20b8\u0268\u014b\u01e5 \u20bc\u0247\u20b3\u0142 \xf8f \u0111\xf8\xf8\u20bc"},{lang:"Robot",translation:"EXECUTING_TASTE.EXE... ERROR: LOGIC_NOT_FOUND"},{lang:"Cat",translation:"Meow meow purr... wait, this is weird, meow"}];return(0,r.useEffect)(()=>{if(t){a(x[Math.floor(Math.random()*x.length)]),s(w[Math.floor(Math.random()*w.length)]),l(C[Math.floor(Math.random()*C.length)]),v(E[Math.floor(Math.random()*E.length)]),d(Math.floor(100*Math.random()));const e=["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24","#f0932b","#eb4d4b","#6c5ce7"];g(e[t.chaos%e.length]);const n=S[Math.floor(Math.random()*S.length)];b("".concat(n.lang,': "').concat(n.translation,'"')),f(e=>{const n=t.chaos>7?-Math.floor(50*Math.random()):Math.floor(30*Math.random());return Math.max(0,Math.min(1e3,e+n))})}},[t]),t?(0,QI.jsxs)("div",{className:"useless-features",children:[(0,QI.jsx)("h4",{children:"\ud83e\udd16 Completely Useless Analysis"}),(0,QI.jsxs)("div",{className:"useless-grid",children:[(0,QI.jsxs)("div",{className:"useless-card",children:[(0,QI.jsx)("h5",{children:"\ud83c\udfad Dish Personality"}),(0,QI.jsx)("p",{children:o}),(0,QI.jsx)("div",{className:"personality-bar",children:(0,QI.jsx)("div",{className:"personality-fill",style:{width:"".concat(10*t.chaos,"%"),backgroundColor:m}})})]}),(0,QI.jsxs)("div",{className:"useless-card",children:[(0,QI.jsx)("h5",{children:"\ud83c\udf24\ufe0f Weather Compatibility"}),(0,QI.jsx)("p",{children:i}),(0,QI.jsxs)("div",{className:"weather-indicator",children:[(0,QI.jsx)("span",{className:"weather-icon",children:"\ud83c\udf08"}),(0,QI.jsx)("span",{children:"Fictional Weather: Perfect"})]})]}),(0,QI.jsxs)("div",{className:"useless-card",children:[(0,QI.jsx)("h5",{children:"\ud83d\udd2e Dish Horoscope"}),(0,QI.jsx)("p",{children:u}),(0,QI.jsx)("div",{className:"horoscope-stars",children:"\u2b50".repeat(Math.floor(5*Math.random())+1)})]}),(0,QI.jsxs)("div",{className:"useless-card",children:[(0,QI.jsx)("h5",{children:"\ud83d\udcca Social Credit Score Impact"}),(0,QI.jsx)("p",{children:"Your food choices affect your imaginary social standing!"}),(0,QI.jsx)("div",{className:"credit-score",children:(0,QI.jsxs)("span",{className:c>500?"good-score":"bad-score",children:[c,"/1000"]})})]}),(0,QI.jsxs)("div",{className:"useless-card",children:[(0,QI.jsx)("h5",{children:"\ud83c\udf82 Dish Age Analysis"}),(0,QI.jsxs)("p",{children:["This dish concept is approximately ",(0,QI.jsxs)("strong",{children:[h," food years"]})," old"]}),(0,QI.jsx)("div",{className:"age-wisdom",children:h>50?"\ud83e\uddd9\u200d\u2642\ufe0f Ancient Wisdom":h>25?"\ud83c\udf93 Mature":"\ud83d\udc76 Young & Reckless"})]}),(0,QI.jsxs)("div",{className:"useless-card",children:[(0,QI.jsx)("h5",{children:"\ud83d\udcac Fake Translation"}),(0,QI.jsx)("p",{children:y}),(0,QI.jsx)("button",{className:"translate-btn",onClick:()=>{const e=S[Math.floor(Math.random()*S.length)];b("".concat(e.lang,': "').concat(e.translation,'"')),n("click")},children:"\ud83d\udd04 Retranslate"})]}),(0,QI.jsxs)("div",{className:"useless-card motivational",children:[(0,QI.jsx)("h5",{children:"\u2728 Motivational Nonsense"}),(0,QI.jsx)("p",{className:"quote",children:p}),(0,QI.jsx)("button",{className:"inspire-btn",onClick:()=>{v(E[Math.floor(Math.random()*E.length)]),n("success")},children:"\ud83c\udfaf Inspire Me More"})]}),(0,QI.jsxs)("div",{className:"useless-card",children:[(0,QI.jsx)("h5",{children:"\ud83c\udfa8 Color Psychology"}),(0,QI.jsx)("p",{children:"Your dish emanates the energy of:"}),(0,QI.jsx)("div",{className:"color-circle",style:{backgroundColor:m}}),(0,QI.jsx)("p",{children:(0,QI.jsx)("em",{children:"This means absolutely nothing but looks pretty!"})})]})]}),(0,QI.jsxs)("div",{className:"useless-actions",children:[(0,QI.jsx)("button",{className:"useless-btn",onClick:()=>{alert("Congratulations! You've achieved nothing by clicking this button. Your dish remains ".concat(t.title,".")),n("click")},children:"\ud83c\udf89 Achieve Nothing"}),(0,QI.jsx)("button",{className:"useless-btn",onClick:()=>{const e="DISH REPORT:\n".concat(t.title,"\nPersonality: ").concat(o,"\nSocial Impact: ").concat(c,"\nAge: ").concat(h," food years\nConclusion: Still weird.");navigator.clipboard.writeText(e),alert("Useless analysis copied to clipboard!"),n("success")},children:"\ud83d\udccb Export Nonsense"}),(0,QI.jsx)("button",{className:"useless-btn",onClick:()=>{d(e=>e+1),n("hover"),setTimeout(()=>{alert("Congratulations! Your dish is now 1 food year older. This changes nothing.")},500)},children:"\u23f0 Age Dish Manually"})]})]}):null},n_=e=>{let{dish:t,playSound:n}=e;const[o,a]=(0,r.useState)(!1),[i,s]=(0,r.useState)(0),[u,l]=(0,r.useState)([]),[c,f]=(0,r.useState)(0),[h,d]=(0,r.useState)(0),[p,v]=(0,r.useState)(1),m=["\ud83d\ude0b Surprisingly not terrible!","\ud83e\udd14 My taste buds are confused...","\ud83d\ude35 What have I done?","\ud83e\udd2f This shouldn't work but it does!","\ud83d\ude31 I can taste colors now","\ud83d\ude43 Reality is a lie","\ud83e\udd2a My mouth is having an existential crisis","\ud83d\ude07 I've transcended normal eating","\ud83e\udd20 Yeehaw, that's... something","\ud83e\udd16 TASTE.EXE has stopped working"];return t?(0,QI.jsxs)("div",{className:"dish-simulator",children:[(0,QI.jsx)("h4",{children:"\ud83c\udf7d\ufe0f Virtual Eating Simulator"}),(0,QI.jsx)("p",{className:"simulator-subtitle",children:"Experience the chaos without the calories!"}),(0,QI.jsxs)("div",{className:"simulation-status",children:[(0,QI.jsxs)("div",{className:"status-bars",children:[(0,QI.jsxs)("div",{className:"status-bar",children:[(0,QI.jsx)("label",{children:"\ud83c\udf7d\ufe0f Fullness Level:"}),(0,QI.jsx)("div",{className:"progress-bar",children:(0,QI.jsx)("div",{className:"progress-fill fullness",style:{width:"".concat(c,"%")}})}),(0,QI.jsxs)("span",{children:[c,"%"]})]}),(0,QI.jsxs)("div",{className:"status-bar",children:[(0,QI.jsx)("label",{children:"\ud83d\ude30 Regret Level:"}),(0,QI.jsx)("div",{className:"progress-bar",children:(0,QI.jsx)("div",{className:"progress-fill regret",style:{width:"".concat(h,"%")}})}),(0,QI.jsxs)("span",{children:[h,"%"]})]})]}),(0,QI.jsxs)("div",{className:"bite-counter",children:[(0,QI.jsxs)("span",{className:"bite-count",children:[i,"/10"]}),(0,QI.jsx)("span",{className:"bite-label",children:"Virtual Bites"})]})]}),(0,QI.jsxs)("div",{className:"simulation-controls",children:[(0,QI.jsx)("button",{className:"eat-btn ".concat(o?"eating":""),onClick:()=>{if(i>=10)return void alert("Simulation complete! You've virtually consumed the entire dish. Congratulations on achieving peak uselessness.");a(!0),s(e=>e+1),f(e=>Math.min(100,e+10)),d(e=>Math.min(100,e+t.chaos));const e=m[Math.floor(Math.random()*m.length)];l(t=>[e,...t].slice(0,5)),n("success"),setTimeout(()=>{a(!1)},1e3*p)},disabled:o||i>=10,children:o?"\ud83d\ude0b Chewing...":i>=10?"\u2705 Simulation Complete":"\ud83c\udf74 Take a Virtual Bite"}),(0,QI.jsxs)("div",{className:"speed-control",children:[(0,QI.jsx)("label",{children:"\u26a1 Simulation Speed:"}),(0,QI.jsx)("input",{type:"range",min:"0.5",max:"3",step:"0.5",value:p,onChange:e=>v(parseFloat(e.target.value))}),(0,QI.jsxs)("span",{children:[p,"x"]})]}),(0,QI.jsx)("button",{className:"reset-btn",onClick:()=>{s(0),l([]),f(0),d(0),n("click")},children:"\ud83d\udd04 Reset Simulation"})]}),u.length>0&&(0,QI.jsxs)("div",{className:"taste-reactions",children:[(0,QI.jsx)("h5",{children:"\ud83c\udfad Virtual Taste Reactions:"}),(0,QI.jsx)("div",{className:"reactions-list",children:u.map((e,t)=>(0,QI.jsx)("div",{className:"reaction-bubble ".concat(0===t?"latest":""),children:e},t))})]}),i>=10&&(0,QI.jsxs)("div",{className:"completion-stats",children:[(0,QI.jsx)("h5",{children:"\ud83c\udfc6 Simulation Complete!"}),(0,QI.jsxs)("div",{className:"final-stats",children:[(0,QI.jsxs)("div",{className:"stat",children:[(0,QI.jsxs)("span",{className:"stat-value",children:[Math.round((100-h)/10),"/10"]}),(0,QI.jsx)("span",{className:"stat-label",children:"Imaginary Rating"})]}),(0,QI.jsxs)("div",{className:"stat",children:[(0,QI.jsx)("span",{className:"stat-value",children:t.chaos}),(0,QI.jsx)("span",{className:"stat-label",children:"Chaos Survived"})]}),(0,QI.jsxs)("div",{className:"stat",children:[(0,QI.jsx)("span",{className:"stat-value",children:"0"}),(0,QI.jsx)("span",{className:"stat-label",children:"Actual Calories"})]})]}),(0,QI.jsxs)("p",{className:"completion-message",children:["\ud83c\udf89 You've successfully eaten ",t.title," in your imagination! Your stomach is confused but your curiosity is satisfied."]})]})]}):null},r_=e=>{let{playSound:t}=e;const[n,o]=(0,r.useState)([""]),[a,i]=(0,r.useState)(""),[s,u]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[f,h]=(0,r.useState)(0),[d,p]=(0,r.useState)(""),v=(m=f)<2?{text:"Boringly Normal",emoji:"\ud83d\ude34",color:"#95a5a6"}:m<4?{text:"Mildly Questionable",emoji:"\ud83e\udd14",color:"#f39c12"}:m<6?{text:"Definitely Weird",emoji:"\ud83e\udd2a",color:"#e67e22"}:m<8?{text:"Chaos Incarnate",emoji:"\ud83e\udd2f",color:"#e74c3c"}:{text:"Reality-Breaking",emoji:"\ud83c\udf2a\ufe0f",color:"#9b59b6"};var m;return(0,QI.jsxs)("div",{className:"chaos-calculator",children:[(0,QI.jsx)("h4",{children:"\ud83e\uddee Scientific Chaos Calculator"}),(0,QI.jsx)("p",{className:"calculator-subtitle",children:"Precisely measure the weirdness of your food creation!"}),(0,QI.jsxs)("div",{className:"calculator-form",children:[(0,QI.jsxs)("div",{className:"form-section",children:[(0,QI.jsx)("h5",{children:"\ud83e\udd58 Ingredients"}),n.map((e,t)=>(0,QI.jsxs)("div",{className:"ingredient-input",children:[(0,QI.jsx)("input",{type:"text",value:e,onChange:e=>((e,t)=>{const r=[...n];r[e]=t,o(r)})(t,e.target.value),placeholder:"Ingredient ".concat(t+1),className:"ingredient-field"}),n.length>1&&(0,QI.jsx)("button",{className:"remove-ingredient",onClick:()=>(e=>{n.length>1&&o(n.filter((t,n)=>n!==e))})(t),children:"\u274c"})]},t)),n.length<10&&(0,QI.jsx)("button",{className:"add-ingredient",onClick:()=>{n.length<10&&o([...n,""])},children:"\u2795 Add Ingredient"})]}),(0,QI.jsxs)("div",{className:"form-section",children:[(0,QI.jsx)("h5",{children:"\ud83d\udc68\u200d\ud83c\udf73 Cooking Method"}),(0,QI.jsxs)("select",{value:a,onChange:e=>i(e.target.value),className:"method-select",children:[(0,QI.jsx)("option",{value:"",children:"Select Method"}),["Microwave","Deep Fry","Freeze","Blend","Grill","Steam","Flambe","Sous Vide","Air Fry","Dehydrate","Smoke","Freeze Dry"].map(e=>(0,QI.jsx)("option",{value:e,children:e},e))]})]}),(0,QI.jsxs)("div",{className:"form-section",children:[(0,QI.jsx)("h5",{children:"\ud83d\udd50 Time of Consumption"}),(0,QI.jsxs)("select",{value:s,onChange:e=>u(e.target.value),className:"time-select",children:[(0,QI.jsx)("option",{value:"",children:"Select Time"}),["Breakfast","Lunch","Dinner","Midnight Snack","3AM Confusion","Brunch","Afternoon Tea","Pre-Workout","Post-Breakup"].map(e=>(0,QI.jsx)("option",{value:e,children:e},e))]})]}),(0,QI.jsxs)("div",{className:"form-section",children:[(0,QI.jsx)("h5",{children:"\ud83d\ude04 Emotional State"}),(0,QI.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"emotion-select",children:[(0,QI.jsx)("option",{value:"",children:"Select Emotion"}),["Happy","Sad","Angry","Confused","Rebellious","Nostalgic","Adventurous","Tired","Existential","Chaotic Good"].map(e=>(0,QI.jsx)("option",{value:e,children:e},e))]})]}),(0,QI.jsx)("button",{className:"calculate-btn",onClick:()=>{let e=0,r=[];const o=n.filter(e=>""!==e.trim());e+=.5*o.length,r.push("".concat(o.length," ingredients (+").concat(.5*o.length,")"));const i={chocolate:["pizza","pasta","fish","onion","garlic","curry"],"ice cream":["hot sauce","pizza","soup","bacon","pickle"],pickle:["ice cream","chocolate","cereal","cotton candy"],"cotton candy":["soup","pizza","salad","meat"],"energy drink":["cereal","soup","pasta","ice cream"]};o.forEach(t=>{o.forEach(n=>{t!==n&&Object.entries(i).forEach(o=>{let[a,i]=o;t.toLowerCase().includes(a)&&i.some(e=>n.toLowerCase().includes(e))&&(e+=2,r.push("".concat(t," + ").concat(n," combo (+2)")))})})});const u={Microwave:1,Blend:2,Freeze:2,"Deep Fry":3,Flambe:4,Dehydrate:3,"Freeze Dry":5}[a]||0;e+=u,u>0&&r.push("".concat(a," method (+").concat(u,")"));const c={Breakfast:["ice cream","pizza","chocolate","energy drink"],"Midnight Snack":["soup","salad","full meal"],"3AM Confusion":[]};"3AM Confusion"===s?(e+=3,r.push("3AM timing (+3)")):c[s]&&c[s].forEach(t=>{o.some(e=>e.toLowerCase().includes(t))&&(e+=1.5,r.push("".concat(t," at ").concat(s," (+1.5)")))});const f={Angry:2,Confused:3,Rebellious:2.5,Existential:4,"Chaotic Good":3}[l]||0;e+=f,f>0&&r.push("".concat(l," emotional state (+").concat(f,")"));const d=Math.min(10,Math.round(10*e)/10);h(d),p(r.join(", ")),t("success")},disabled:0===n.filter(e=>e.trim()).length,children:"\ud83d\udd2c Calculate Chaos Level"})]}),f>0&&(0,QI.jsxs)("div",{className:"chaos-result",children:[(0,QI.jsx)("h5",{children:"\ud83d\udcca Scientific Analysis Results"}),(0,QI.jsxs)("div",{className:"chaos-score-display",children:[(0,QI.jsxs)("div",{className:"score-circle",style:{borderColor:v.color},children:[(0,QI.jsxs)("span",{className:"score-number",style:{color:v.color},children:[f,"/10"]}),(0,QI.jsx)("span",{className:"score-emoji",children:v.emoji})]}),(0,QI.jsxs)("div",{className:"score-text",children:[(0,QI.jsx)("h6",{style:{color:v.color},children:v.text}),(0,QI.jsxs)("p",{className:"explanation",children:["Calculation: ",d]})]})]}),(0,QI.jsxs)("div",{className:"chaos-recommendations",children:[(0,QI.jsx)("h6",{children:"\ud83c\udfaf Professional Recommendations:"}),f<3&&(0,QI.jsx)("p",{children:"\u2022 Consider adding more questionable ingredients"}),f<5&&(0,QI.jsx)("p",{children:"\u2022 Try an inappropriate cooking method"}),f>=8&&(0,QI.jsx)("p",{children:"\u2022 Congratulations! You've achieved peak chaos"}),10===f&&(0,QI.jsx)("p",{children:"\u2022 Please document this for future generations"})]})]})]})};function o_(e){return e[Math.floor(Math.random()*e.length)]}function a_(e){let{dish:t,onChef:n,onFavorite:o,isFavorite:a,playSound:i}=e;const[s,u]=(0,r.useState)(!1);return(0,QI.jsxs)("div",{className:"dish-card ".concat(s?"hovered":""," ").concat(t.isUserGenerated?"user-generated":""),onMouseEnter:()=>{u(!0),i("hover")},onMouseLeave:()=>u(!1),style:{color:"#ffffff",backgroundColor:"#2a2a3e"},children:[(0,QI.jsx)("img",{src:t.img,alt:t.title,className:"dish-img"}),(0,QI.jsxs)("div",{className:"dish-body",style:{color:"#ffffff"},children:[(0,QI.jsx)("h3",{style:{color:"#ffffff"},children:t.title}),(0,QI.jsx)("p",{className:"desc",style:{color:"#ffffff"},children:t.desc}),(0,QI.jsxs)("div",{className:"dish-stats",style:{color:"#ffffff"},children:[(0,QI.jsxs)("span",{className:"chaos-level",style:{color:"#ffffff"},children:["Chaos: ",t.chaos,"/10"]}),t.cookTime&&(0,QI.jsxs)("span",{className:"cook-time",style:{color:"#ffffff"},children:["\u23f1\ufe0f ",t.cookTime]}),t.difficulty&&(0,QI.jsxs)("span",{className:"difficulty",style:{color:"#ffffff"},children:["\ud83d\udcca ",t.difficulty]})]}),t.tags&&(0,QI.jsx)("div",{className:"dish-tags",style:{color:"#ffffff"},children:t.tags.map((e,t)=>(0,QI.jsx)("span",{className:"tag",style:{color:"#ffffff",backgroundColor:"#4a4a6e"},children:e},t))}),(0,QI.jsx)("div",{className:"meta",children:(0,QI.jsxs)("div",{className:"actions",children:[(0,QI.jsx)("button",{onClick:()=>{n(t),i("chef")},className:"chef-btn",children:"\ud83d\udc68\u200d\ud83c\udf73 Chef Mode"}),(0,QI.jsxs)("button",{onClick:()=>{o(t),i(a?"click":"success")},className:"favorite-btn ".concat(a?"favorited":""),children:[a?"\u2764\ufe0f":"\ud83e\udd0d"," ",a?"Saved":"Save"]}),(0,QI.jsx)("button",{onClick:()=>{const e="".concat(t.title," \u2014 ").concat(t.desc," (from Mood Menu)");navigator.share?navigator.share({text:e}).catch(()=>navigator.clipboard.writeText(e)):(navigator.clipboard.writeText(e),alert("Copied to clipboard!")),i("click")},className:"share-btn",children:"\ud83d\udce4 Share"})]})})]})]})}function i_(){const[e,t]=(0,r.useState)(0),[n,o]=(0,r.useState)(null),[i,s]=(0,r.useState)([]),[u,l]=(0,r.useState)([]),[c,f]=(0,r.useState)(!1),[h,d]=(0,r.useState)(!1),[p,v]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!0),[x,w]=(0,r.useState)([]),[C,E]=(0,r.useState)(!1),[S,k]=(0,r.useState)(!1),[R,I]=(0,r.useState)(!1),[_,N]=(0,r.useState)(!1),{playSound:T}=e_({soundEnabled:y});function A(e){const t=o_([...e.suggestions,...x]);o(t),s(e=>[t,...e].slice(0,10))}function D(e){l(t=>t.some(t=>t.title===e.title)?t.filter(t=>t.title!==e.title):[e,...t].slice(0,20))}function O(e){if(!("speechSynthesis"in window))return void alert("Chef Mode not supported in this browser.");const t=new SpeechSynthesisUtterance;t.text="Presenting: ".concat(e.title,". ").concat(e.desc,". Recommended chaos level ").concat(e.chaos," out of ten. Bon app\xe9tit!"),t.rate=.95,t.pitch=1.1,t.onstart=()=>f(!0),t.onend=()=>f(!1);const n=window.speechSynthesis.getVoices();n&&n.length&&(t.voice=n.find(e=>e.lang.startsWith("en"))||n[0]),window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}return(0,r.useEffect)(()=>{d("speechSynthesis"in window&&"webkitSpeechRecognition"in window===!1),o(o_(a[0].suggestions));const e=localStorage.getItem("moodMenuFavorites"),t=localStorage.getItem("moodMenuUserDishes"),n=localStorage.getItem("moodMenuSoundEnabled");e&&l(JSON.parse(e)),t&&w(JSON.parse(t)),null!==n&&b(JSON.parse(n))},[]),(0,r.useEffect)(()=>{localStorage.setItem("moodMenuFavorites",JSON.stringify(u))},[u]),(0,r.useEffect)(()=>{localStorage.setItem("moodMenuUserDishes",JSON.stringify(x))},[x]),(0,r.useEffect)(()=>{localStorage.setItem("moodMenuSoundEnabled",JSON.stringify(y))},[y]),(0,QI.jsxs)("div",{className:"app",style:{color:"#ffffff",backgroundColor:"#1a1a2e"},children:[(0,QI.jsxs)("header",{style:{color:"#ffffff"},children:[(0,QI.jsxs)("div",{className:"header-main",style:{color:"#ffffff"},children:[(0,QI.jsxs)("h1",{style:{color:"#ffffff"},children:["Mood Menu ",(0,QI.jsx)("span",{className:"mini",children:"\ud83c\udf7d\ufe0f"})]}),(0,QI.jsx)("p",{className:"tag",style:{color:"#ffffff"},children:"Feeling weird? Eat weirder."})]}),(0,QI.jsxs)("div",{className:"header-controls",children:[(0,QI.jsx)("button",{className:"toggle-btn ".concat(y?"active":""),onClick:()=>b(!y),title:"Toggle sound effects",children:y?"\ud83d\udd0a":"\ud83d\udd07"}),(0,QI.jsx)("button",{className:"toggle-btn ".concat(p?"active":""),onClick:()=>{v(!p),T("click")},title:"AI Mood Detection",children:"\ud83d\udcf7"}),(0,QI.jsx)("button",{className:"toggle-btn ".concat(m?"active":""),onClick:()=>{g(!m),T("click")},title:"Ingredient Scanner",children:"\ud83d\udd0d"}),(0,QI.jsxs)("button",{className:"toggle-btn ".concat(C?"active":""),onClick:()=>{E(!C),T("click")},title:"View Favorites",children:["\u2764\ufe0f ",u.length]}),(0,QI.jsx)("button",{className:"toggle-btn ".concat(S?"active":""),onClick:()=>{k(!S),T("click")},title:"Useless Analysis",children:"\ud83e\udd16"}),(0,QI.jsx)("button",{className:"toggle-btn ".concat(R?"active":""),onClick:()=>{I(!R),T("click")},title:"Virtual Eating Simulator",children:"\ud83c\udf7d\ufe0f"}),(0,QI.jsx)("button",{className:"toggle-btn ".concat(_?"active":""),onClick:()=>{N(!_),T("click")},title:"Chaos Calculator",children:"\ud83e\uddee"})]})]}),(0,QI.jsxs)("main",{children:[p&&(0,QI.jsx)("section",{className:"mood-detection",children:(0,QI.jsx)(JI,{onMoodDetected:function(e,n){const r=a.findIndex(t=>t.id===e);-1!==r&&(t(r),A(a[r]),T("success"))},isActive:p})}),m&&(0,QI.jsx)("section",{className:"ingredient-scanning",children:(0,QI.jsx)(ZI,{onIngredientsDetected:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&(w(e=>[t,...e].slice(0,5)),o(t),s(e=>[t,...e].slice(0,10)),T("success"))}})}),_&&(0,QI.jsx)("section",{className:"chaos-calculation",children:(0,QI.jsx)(r_,{playSound:T})}),(0,QI.jsxs)("section",{className:"controls",style:{color:"#ffffff"},children:[(0,QI.jsxs)("label",{className:"mood-select",style:{color:"#ffffff"},children:["Pick your mood:",(0,QI.jsx)("select",{value:e,onChange:function(e){const n=Number(e.target.value);t(n),A(a[n]),T("click")},style:{color:"#ffffff",backgroundColor:"#2a2a3e",border:"1px solid #4a4a6e",padding:"8px"},children:a.map((e,t)=>(0,QI.jsxs)("option",{value:t,style:{color:"#ffffff",backgroundColor:"#2a2a3e"},children:[e.emoji," ",e.mood]},e.id))})]}),(0,QI.jsxs)("div",{className:"buttons",children:[(0,QI.jsx)("button",{onClick:()=>{A(a[e]),T("click")},children:"\ud83c\udfb2 Give me a dish"}),(0,QI.jsx)("button",{onClick:function(){const e=o_(a);t(a.findIndex(t=>t.id===e.id)),A(e),T("surprise")},className:"surprise",children:"\u2728 Surprise Me"}),(0,QI.jsx)("button",{onClick:()=>{n&&O(n)},disabled:!n,className:"chef-mode-btn",children:c?"\ud83d\udde3\ufe0f Chef is talking...":h?"\ud83d\udc68\u200d\ud83c\udf73 Chef Mode":"\ud83d\udc68\u200d\ud83c\udf73 Chef Mode (may not be supported)"})]})]}),C&&u.length>0&&(0,QI.jsxs)("section",{className:"favorites-section",children:[(0,QI.jsx)("h3",{children:"\u2764\ufe0f Your Favorite Chaos"}),(0,QI.jsx)("div",{className:"favorites-grid",children:u.map((e,t)=>(0,QI.jsx)(a_,{dish:e,onChef:O,onFavorite:D,isFavorite:!0,playSound:T},t))})]}),(0,QI.jsx)("section",{className:"result",style:{color:"#ffffff"},children:n?(0,QI.jsxs)("div",{className:"dish-display",style:{color:"#ffffff"},children:[(0,QI.jsx)(a_,{dish:n,onChef:O,onFavorite:D,isFavorite:(M=n,u.some(e=>e.title===M.title)),playSound:T}),S&&(0,QI.jsx)(t_,{currentDish:n,playSound:T}),R&&(0,QI.jsx)(n_,{dish:n,playSound:T})]}):(0,QI.jsx)("div",{className:"placeholder",children:"Select a mood to see its special dish!"})}),(0,QI.jsxs)("section",{className:"extras",children:[(0,QI.jsxs)("div",{className:"extras-header",children:[(0,QI.jsx)("h3",{children:"\ud83d\udd50 Dish History"}),x.length>0&&(0,QI.jsx)("button",{className:"clear-btn",onClick:()=>{w([]),T("click")},children:"Clear AI Dishes"})]}),(0,QI.jsxs)("div",{className:"history",children:[0===i.length&&(0,QI.jsx)("div",{className:"hint",children:"No dishes yet \u2014 try Surprise Me!"}),i.map((e,t)=>(0,QI.jsxs)("div",{className:"hist-item ".concat(e.isUserGenerated?"user-generated":""),onClick:()=>{o(e),T("click")},children:[(0,QI.jsx)("img",{src:e.img,alt:e.title}),(0,QI.jsxs)("div",{children:[(0,QI.jsx)("strong",{children:e.title}),(0,QI.jsx)("div",{className:"small",children:e.desc}),e.isUserGenerated&&(0,QI.jsx)("span",{className:"ai-badge",children:"\ud83e\udd16 AI Generated"})]})]},t))]}),(0,QI.jsxs)("div",{className:"game",children:[(0,QI.jsx)("h4",{children:"Would You Eat This? (Quick Poll)"}),(0,QI.jsx)("p",{children:"Click Yes or No \u2014 votes are local (just for demo)"}),(0,QI.jsx)(s_,{dish:n,playSound:T})]})]})]}),(0,QI.jsx)("footer",{children:(0,QI.jsxs)("div",{className:"footer-content",children:[(0,QI.jsxs)("small",{children:["Made for Useless Projects \u2014 built in ",(0,QI.jsx)("strong",{children:"18 hours"})," (demo mode)."]}),(0,QI.jsxs)("div",{className:"footer-stats",children:[(0,QI.jsxs)("span",{children:["\ud83c\udf7d\ufe0f ",i.length," dishes tried"]}),(0,QI.jsxs)("span",{children:["\u2764\ufe0f ",u.length," favorites"]}),(0,QI.jsxs)("span",{children:["\ud83e\udd16 ",x.length," AI creations"]})]})]})})]});var M}function s_(e){let{dish:t,playSound:n}=e;const[o,a]=(0,r.useState)(0),[i,s]=(0,r.useState)(0),[u,l]=(0,r.useState)(null);if((0,r.useEffect)(()=>{a(0),s(0),l(null)},[t]),!t)return(0,QI.jsx)("div",{className:"small",children:"Pick a dish to start voting!"});const c=e=>{u||("yes"===e?(a(e=>e+1),l("yes"),n("success")):(s(e=>e+1),l("no"),n("click")))},f=o+i,h=0===f?50:o/f*100;return(0,QI.jsxs)("div",{className:"vote-widget",children:[(0,QI.jsxs)("div",{className:"vote-buttons",children:[(0,QI.jsxs)("button",{onClick:()=>c("yes"),className:"vote-btn yes ".concat("yes"===u?"voted":""),disabled:null!==u,children:["Yes \ud83d\udc4d (",o,")"]}),(0,QI.jsxs)("button",{onClick:()=>c("no"),className:"vote-btn no ".concat("no"===u?"voted":""),disabled:null!==u,children:["No \ud83d\udc4e (",i,")"]})]}),(0,QI.jsxs)("div",{className:"vote-bar",children:[(0,QI.jsx)("div",{className:"yes-bar",style:{width:"".concat(h,"%")}}),(0,QI.jsx)("div",{className:"vote-percentage",children:f>0&&"".concat(Math.round(h),"% yes")})]}),u&&(0,QI.jsxs)("div",{className:"vote-thanks",children:["Thanks for voting! ","yes"===u?"\ud83c\udf89":"\ud83d\ude05"]})]})}const u_=document.getElementById("root");(0,o.createRoot)(u_).render((0,QI.jsx)(i_,{}))})()})();
//# sourceMappingURL=main.6bba0f5b.js.map